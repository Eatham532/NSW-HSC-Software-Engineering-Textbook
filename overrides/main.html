{% extends "base.html" %}
{# Configurable site-wide alert banner #}
{% block header %}
  {% set banner = config.extra.site_banner %}
  {% if banner and banner.enabled and banner.text %}
    {% set variant = banner.variant | default('info') %}
    {% set version = banner.version | default('1') %}
    {% set link_url = (config.repo_url.rstrip('/') + banner.link_url) if banner.link_url else '' %}
    <div class="site-banner site-banner--{{ variant }}" data-banner data-banner-version="{{ version }}" role="status" aria-live="polite">
      <div class="site-banner__inner">
        <span class="site-banner__icon" aria-hidden="true">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            {% if variant == 'error' %}
              <circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/>
            {% elif variant == 'success' %}
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>
            {% elif variant == 'warning' %}
              <path d="M12 9v4"/><path d="M12 17h.01"/><path d="M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0Z"/>
            {% else %}
              <circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/>
            {% endif %}
          </svg>
        </span>
        <p class="site-banner__text">
          {{ banner.text | safe }}
          {% if link_url and banner.link_text %}
            <a class="site-banner__link" href="{{ link_url }}" target="_blank" rel="noopener">{{ banner.link_text }}</a>
          {% endif %}
        </p>
        <button type="button" class="site-banner__close" aria-label="Dismiss banner" title="Dismiss" data-banner-dismiss>&times;</button>
      </div>
    </div>
    <script>
      (function(){
        var banner=document.querySelector('[data-banner]');
        if(!banner) return;
        var version=banner.getAttribute('data-banner-version')||'1';
        var KEY='site_banner_dismissed_v'+version;
        try{ if(localStorage.getItem(KEY)){ banner.remove(); return;} }catch(e){}
        var btn=banner.querySelector('[data-banner-dismiss]');
        if(btn){ btn.addEventListener('click',function(){
          banner.classList.add('is-hiding');
          setTimeout(function(){ banner && banner.remove(); },200);
          try{ localStorage.setItem(KEY,'1'); }catch(e){}
        }); }
      })();
    </script>
  {% endif %}
  {{ super() }}
{% endblock %}
