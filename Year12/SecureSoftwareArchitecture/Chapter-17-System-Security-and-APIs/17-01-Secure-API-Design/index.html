
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Comprehensive educational resource for NSW HSC Software Engineering syllabus">
      
      
      
        <link rel="canonical" href="https://eatham532.github.io/Software-Engineering-HSC-Textbook/Year12/SecureSoftwareArchitecture/Chapter-17-System-Security-and-APIs/17-01-Secure-API-Design/">
      
      
        <link rel="prev" href="../../Chapter-16-Input-Security-and-Data-Protection/16-02-Privacy-by-Design/quiz/">
      
      
        <link rel="next" href="quiz/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>Content - Software Engineering Textbook HSC</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/diagram-modal.css">
    
      <link rel="stylesheet" href="../../../../assets/quiz.css">
    
      <link rel="stylesheet" href="../../../../assets/common.css">
    
      <link rel="stylesheet" href="../../../../assets/diagram-fix.css">
    
      <link rel="stylesheet" href="../../../../assets/cross-reference.css">
    
      <link rel="stylesheet" href="../../../../assets/site-banner.css">
    
      <link rel="stylesheet" href="../../../../assets/code-runner.css">
    
      <link rel="stylesheet" href="../../../../assets/code-editor.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-58275RL1P9"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-58275RL1P9",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-58275RL1P9",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#171-secure-api-design" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
  
  
    
    
    
    <div class="site-banner site-banner--warning" data-banner data-banner-version="1" role="status" aria-live="polite">
      <div class="site-banner__inner">
        <span class="site-banner__icon" aria-hidden="true">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            
              <path d="M12 9v4"/><path d="M12 17h.01"/><path d="M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0Z"/>
            
          </svg>
        </span>
        <p class="site-banner__text">
          This textbook is in <strong>beta</strong> – content is actively being refined.
          
            <a class="site-banner__link" href="https://github.com/Eatham532/Software-Engineering-HSC-Textbook/issues/new/choose" target="_blank" rel="noopener">Report issues or suggestions</a>
          
        </p>
        <button type="button" class="site-banner__close" aria-label="Dismiss banner" title="Dismiss" data-banner-dismiss>&times;</button>
      </div>
    </div>
    <script>
      (function(){
        var banner=document.querySelector('[data-banner]');
        if(!banner) return;
        var version=banner.getAttribute('data-banner-version')||'1';
        var KEY='site_banner_dismissed_v'+version;
        try{ if(localStorage.getItem(KEY)){ banner.remove(); return;} }catch(e){}
        var btn=banner.querySelector('[data-banner-dismiss]');
        if(btn){ btn.addEventListener('click',function(){
          banner.classList.add('is-hiding');
          setTimeout(function(){ banner && banner.remove(); },200);
          try{ localStorage.setItem(KEY,'1'); }catch(e){}
        }); }
      })();
    </script>
  
  
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Software Engineering Textbook HSC" class="md-header__button md-logo" aria-label="Software Engineering Textbook HSC" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Software Engineering Textbook HSC
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Content
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Eatham532/Software-Engineering-HSC-Textbook/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Eatham532/Software-Engineering-HSC-Textbook
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    

    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../Year11/ProgrammingFundamentals/" class="md-tabs__link">
          
  
  
  Year 11

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../ProgrammingForTheWeb/" class="md-tabs__link">
          
  
  
  Year 12

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../code-editor/" class="md-tabs__link">
        
  
  
    
  
  Code Editor

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Software Engineering Textbook HSC" class="md-nav__button md-logo" aria-label="Software Engineering Textbook HSC" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Software Engineering Textbook HSC
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Eatham532/Software-Engineering-HSC-Textbook/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Eatham532/Software-Engineering-HSC-Textbook
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    
  
  
  
    <a href="../../../../Year11/ProgrammingFundamentals/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Year 11
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Year 12
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Year 12
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../ProgrammingForTheWeb/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Programming For The Web
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Secure Software Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Secure Software Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    
  
  
  
    <a href="../../Chapter-14-Security-Foundations/14-01-The-Business-Case-for-Security/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 14 — Security Foundations
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    
  
  
  
    <a href="../../Chapter-15-Core-Security-Principles/15-01-Security-Fundamentals-CIA-Triad-and-AAA/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 15 — Core Security Principles
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    
  
  
  
    <a href="../../Chapter-16-Input-Security-and-Data-Protection/16-01-Input-Validation-and-Sanitization/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 16 — Input Security and Data Protection
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_5" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2_5" id="__nav_3_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 17 — System Security and APIs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2_5">
            <span class="md-nav__icon md-icon"></span>
            Chapter 17 — System Security and APIs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_5_1" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2_5_1" id="__nav_3_2_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    17.1 Secure API Design
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_2_5_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2_5_1">
            <span class="md-nav__icon md-icon"></span>
            17.1 Secure API Design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-it-matters" class="md-nav__link">
    <span class="md-ellipsis">
      Why It Matters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-security-principles-for-apis" class="md-nav__link">
    <span class="md-ellipsis">
      Core Security Principles for APIs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Security Principles for APIs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-defense-in-depth" class="md-nav__link">
    <span class="md-ellipsis">
      1. Defense in Depth
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-principle-of-least-privilege" class="md-nav__link">
    <span class="md-ellipsis">
      2. Principle of Least Privilege
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-fail-securely" class="md-nav__link">
    <span class="md-ellipsis">
      3. Fail Securely
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-security-by-design" class="md-nav__link">
    <span class="md-ellipsis">
      4. Security by Design
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-authentication-methods" class="md-nav__link">
    <span class="md-ellipsis">
      API Authentication Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Authentication Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-authentication-vs-authorization" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding Authentication vs Authorization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-api-keys" class="md-nav__link">
    <span class="md-ellipsis">
      1. API Keys
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. API Keys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-api-key-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Basic API Key Implementation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-key-security-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      API Key Security Best Practices
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-json-web-tokens-jwt" class="md-nav__link">
    <span class="md-ellipsis">
      2. JSON Web Tokens (JWT)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. JSON Web Tokens (JWT)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jwt-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      JWT Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-oauth-20-flow-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      3. OAuth 2.0 Flow Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rate-limiting-and-dos-protection" class="md-nav__link">
    <span class="md-ellipsis">
      Rate Limiting and DoS Protection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rate Limiting and DoS Protection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#token-bucket-algorithm-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Token Bucket Algorithm Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secure-session-management" class="md-nav__link">
    <span class="md-ellipsis">
      Secure Session Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Secure Session Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#session-security-principles" class="md-nav__link">
    <span class="md-ellipsis">
      Session Security Principles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comprehensive-session-manager-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Comprehensive Session Manager Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cors-and-cross-origin-security" class="md-nav__link">
    <span class="md-ellipsis">
      CORS and Cross-Origin Security
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CORS and Cross-Origin Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-cors-security-model" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding CORS Security Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comprehensive-cors-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Comprehensive CORS Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-security-testing" class="md-nav__link">
    <span class="md-ellipsis">
      API Security Testing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Security Testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#security-testing-methodology" class="md-nav__link">
    <span class="md-ellipsis">
      Security Testing Methodology
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automated-security-testing-framework" class="md-nav__link">
    <span class="md-ellipsis">
      Automated Security Testing Framework
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-a-complete-secure-rest-api" class="md-nav__link">
    <span class="md-ellipsis">
      Building a Complete Secure REST API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Building a Complete Secure REST API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#secure-api-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Secure API Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complete-secure-api-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Secure API Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary-and-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Summary and Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary and Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#essential-security-principles" class="md-nav__link">
    <span class="md-ellipsis">
      Essential Security Principles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Checklist
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Checklist">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-keys" class="md-nav__link">
    <span class="md-ellipsis">
      API Keys
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jwt-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      JWT Tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauth-20" class="md-nav__link">
    <span class="md-ellipsis">
      OAuth 2.0
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token-bucket-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Token Bucket Algorithm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#progressive-penalties" class="md-nav__link">
    <span class="md-ellipsis">
      Progressive Penalties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secure-session-ids" class="md-nav__link">
    <span class="md-ellipsis">
      Secure Session IDs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-features" class="md-nav__link">
    <span class="md-ellipsis">
      Security Features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#origin-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Origin Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Security Patterns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automated-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Automated Testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comprehensive-coverage" class="md-nav__link">
    <span class="md-ellipsis">
      Comprehensive Coverage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production-deployment-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Production Deployment Considerations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-pitfalls-to-avoid" class="md-nav__link">
    <span class="md-ellipsis">
      Common Pitfalls to Avoid
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practice-questions-and-exercises" class="md-nav__link">
    <span class="md-ellipsis">
      Practice Questions and Exercises
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Practice Questions and Exercises">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-1-secure-registration-system" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 1: Secure Registration System
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-2-api-rate-limiter" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 2: API Rate Limiter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-3-cors-security-manager" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 3: CORS Security Manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-4-security-testing-suite" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 4: Security Testing Suite
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-study-e-commerce-api-security-breach" class="md-nav__link">
    <span class="md-ellipsis">
      Case Study: E-commerce API Security Breach
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      Summary Checklist
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary Checklist">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication-authorization" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication &amp; Authorization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rate-limiting-dos-protection" class="md-nav__link">
    <span class="md-ellipsis">
      Rate Limiting &amp; DoS Protection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#input-validation-sanitization" class="md-nav__link">
    <span class="md-ellipsis">
      Input Validation &amp; Sanitization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#session-management" class="md-nav__link">
    <span class="md-ellipsis">
      Session Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cors-cross-origin-security" class="md-nav__link">
    <span class="md-ellipsis">
      CORS &amp; Cross-Origin Security
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Monitoring &amp; Testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-security" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment Security
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../17-02-Secure-Execution-and-Resource-Management/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    17.2 Secure Execution & Resource Management
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    
  
  
  
    <a href="../../Chapter-18-Security-Testing-and-Vulnerabilities/18-01-Security-Testing-Fundamentals/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 18 — Security Testing & Vulnerabilities
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    
  
  
  
    <a href="../../Chapter-19-Security-in-Context/19-01-Security-in-Development-Teams/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 19 — Security in Context
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../SoftwareAutomation/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Software Automation
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../SoftwareEngineeringProject/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Software Engineering Project
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../code-editor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Code Editor
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-it-matters" class="md-nav__link">
    <span class="md-ellipsis">
      Why It Matters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-security-principles-for-apis" class="md-nav__link">
    <span class="md-ellipsis">
      Core Security Principles for APIs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Security Principles for APIs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-defense-in-depth" class="md-nav__link">
    <span class="md-ellipsis">
      1. Defense in Depth
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-principle-of-least-privilege" class="md-nav__link">
    <span class="md-ellipsis">
      2. Principle of Least Privilege
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-fail-securely" class="md-nav__link">
    <span class="md-ellipsis">
      3. Fail Securely
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-security-by-design" class="md-nav__link">
    <span class="md-ellipsis">
      4. Security by Design
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-authentication-methods" class="md-nav__link">
    <span class="md-ellipsis">
      API Authentication Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Authentication Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-authentication-vs-authorization" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding Authentication vs Authorization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-api-keys" class="md-nav__link">
    <span class="md-ellipsis">
      1. API Keys
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. API Keys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-api-key-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Basic API Key Implementation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-key-security-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      API Key Security Best Practices
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-json-web-tokens-jwt" class="md-nav__link">
    <span class="md-ellipsis">
      2. JSON Web Tokens (JWT)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. JSON Web Tokens (JWT)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jwt-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      JWT Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-oauth-20-flow-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      3. OAuth 2.0 Flow Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rate-limiting-and-dos-protection" class="md-nav__link">
    <span class="md-ellipsis">
      Rate Limiting and DoS Protection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rate Limiting and DoS Protection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#token-bucket-algorithm-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Token Bucket Algorithm Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secure-session-management" class="md-nav__link">
    <span class="md-ellipsis">
      Secure Session Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Secure Session Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#session-security-principles" class="md-nav__link">
    <span class="md-ellipsis">
      Session Security Principles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comprehensive-session-manager-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Comprehensive Session Manager Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cors-and-cross-origin-security" class="md-nav__link">
    <span class="md-ellipsis">
      CORS and Cross-Origin Security
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CORS and Cross-Origin Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-cors-security-model" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding CORS Security Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comprehensive-cors-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Comprehensive CORS Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-security-testing" class="md-nav__link">
    <span class="md-ellipsis">
      API Security Testing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Security Testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#security-testing-methodology" class="md-nav__link">
    <span class="md-ellipsis">
      Security Testing Methodology
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automated-security-testing-framework" class="md-nav__link">
    <span class="md-ellipsis">
      Automated Security Testing Framework
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-a-complete-secure-rest-api" class="md-nav__link">
    <span class="md-ellipsis">
      Building a Complete Secure REST API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Building a Complete Secure REST API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#secure-api-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Secure API Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complete-secure-api-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Secure API Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary-and-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Summary and Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary and Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#essential-security-principles" class="md-nav__link">
    <span class="md-ellipsis">
      Essential Security Principles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Checklist
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Checklist">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-keys" class="md-nav__link">
    <span class="md-ellipsis">
      API Keys
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jwt-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      JWT Tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauth-20" class="md-nav__link">
    <span class="md-ellipsis">
      OAuth 2.0
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token-bucket-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Token Bucket Algorithm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#progressive-penalties" class="md-nav__link">
    <span class="md-ellipsis">
      Progressive Penalties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secure-session-ids" class="md-nav__link">
    <span class="md-ellipsis">
      Secure Session IDs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-features" class="md-nav__link">
    <span class="md-ellipsis">
      Security Features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#origin-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Origin Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Security Patterns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automated-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Automated Testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comprehensive-coverage" class="md-nav__link">
    <span class="md-ellipsis">
      Comprehensive Coverage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production-deployment-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Production Deployment Considerations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-pitfalls-to-avoid" class="md-nav__link">
    <span class="md-ellipsis">
      Common Pitfalls to Avoid
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practice-questions-and-exercises" class="md-nav__link">
    <span class="md-ellipsis">
      Practice Questions and Exercises
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Practice Questions and Exercises">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-1-secure-registration-system" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 1: Secure Registration System
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-2-api-rate-limiter" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 2: API Rate Limiter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-3-cors-security-manager" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 3: CORS Security Manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-4-security-testing-suite" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 4: Security Testing Suite
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-study-e-commerce-api-security-breach" class="md-nav__link">
    <span class="md-ellipsis">
      Case Study: E-commerce API Security Breach
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      Summary Checklist
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary Checklist">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication-authorization" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication &amp; Authorization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rate-limiting-dos-protection" class="md-nav__link">
    <span class="md-ellipsis">
      Rate Limiting &amp; DoS Protection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#input-validation-sanitization" class="md-nav__link">
    <span class="md-ellipsis">
      Input Validation &amp; Sanitization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#session-management" class="md-nav__link">
    <span class="md-ellipsis">
      Session Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cors-cross-origin-security" class="md-nav__link">
    <span class="md-ellipsis">
      CORS &amp; Cross-Origin Security
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Monitoring &amp; Testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-security" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment Security
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/Eatham532/Software-Engineering-HSC-Textbook/edit/main/docs/Year12/SecureSoftwareArchitecture/Chapter-17-System-Security-and-APIs/17-01-Secure-API-Design/index.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/Eatham532/Software-Engineering-HSC-Textbook/raw/main/docs/Year12/SecureSoftwareArchitecture/Chapter-17-System-Security-and-APIs/17-01-Secure-API-Design/index.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="171-secure-api-design">17.1 Secure API Design<a class="headerlink" href="#171-secure-api-design" title="Permanent link">&para;</a></h1>
<h2 id="why-it-matters">Why It Matters<a class="headerlink" href="#why-it-matters" title="Permanent link">&para;</a></h2>
<p>APIs (Application Programming Interfaces) are the backbone of modern applications, enabling communication between different systems, services, and client applications. However, APIs also represent significant attack surfaces that can expose sensitive data, business logic, and system resources to malicious actors.</p>
<p><strong>Real-world Impact:</strong></p>
<ul>
<li>
<p><strong>2019 Facebook API breach</strong>: Exposed 50 million user accounts through improper access token validation</p>
</li>
<li>
<p><strong>2021 Peloton API vulnerability</strong>: Allowed unauthorized access to private user data through missing authentication</p>
</li>
<li>
<p><strong>2020 Venmo API issue</strong>: Public transaction data accessible without proper authorization controls</p>
</li>
</ul>
<p>Secure API design is critical because APIs often:</p>
<ul>
<li>
<p>Handle sensitive user data and business information</p>
</li>
<li>
<p>Provide direct access to backend systems and databases</p>
</li>
<li>
<p>Are exposed to public networks and untrusted clients</p>
</li>
<li>
<p>Serve as integration points between multiple applications</p>
</li>
</ul>
<h2 id="core-security-principles-for-apis">Core Security Principles for APIs<a class="headerlink" href="#core-security-principles-for-apis" title="Permanent link">&para;</a></h2>
<h3 id="1-defense-in-depth">1. Defense in Depth<a class="headerlink" href="#1-defense-in-depth" title="Permanent link">&para;</a></h3>
<p>Implement multiple layers of security controls rather than relying on a single protection mechanism.</p>
<h3 id="2-principle-of-least-privilege">2. Principle of Least Privilege<a class="headerlink" href="#2-principle-of-least-privilege" title="Permanent link">&para;</a></h3>
<p>Grant the minimum access necessary for each API consumer to perform their intended function.</p>
<h3 id="3-fail-securely">3. Fail Securely<a class="headerlink" href="#3-fail-securely" title="Permanent link">&para;</a></h3>
<p>When errors occur, ensure the system fails to a secure state rather than exposing sensitive information.</p>
<h3 id="4-security-by-design">4. Security by Design<a class="headerlink" href="#4-security-by-design" title="Permanent link">&para;</a></h3>
<p>Build security controls into the API from the initial design phase, not as an afterthought.</p>
<h2 id="api-authentication-methods">API Authentication Methods<a class="headerlink" href="#api-authentication-methods" title="Permanent link">&para;</a></h2>
<h3 id="understanding-authentication-vs-authorization">Understanding Authentication vs Authorization<a class="headerlink" href="#understanding-authentication-vs-authorization" title="Permanent link">&para;</a></h3>
<p><strong>Authentication</strong> answers &ldquo;Who are you?&rdquo; - verifying the identity of the API consumer.
<strong>Authorization</strong> answers &ldquo;What can you do?&rdquo; - determining what resources and actions are permitted.</p>
<div class="diagram-container" data-container-id="kroki-diagram-0"><button class="diagram-expand-btn" onclick="openDiagramModal('kroki-diagram-0')">🔍 View Larger</button><div id="kroki-diagram-0" class="diagram-content"><p><svg xmlns="http://www.w3.org/2000/svg" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="416px" preserveAspectRatio="xMaxYMax meet" style="width:651px;height:416px;background:#FFFFFF;" version="1.1" viewBox="0 0 651 416" width="651px" zoomAndPan="magnify" id="Kroki" data-diagram-id="kroki-svg-0"><defs /><g><g><title>Client</title><rect fill="#000000" fill-opacity="0.00000" height="253.0625" width="8" x="29.2651" y="82.2969" /><line style="stroke:#000000;stroke-width:1;" x1="33" x2="33" y1="82.2969" y2="335.3594" /></g><g><title>API Gateway</title><rect fill="#000000" fill-opacity="0.00000" height="253.0625" width="8" x="224.4805" y="82.2969" /><line style="stroke:#000000;stroke-width:1;" x1="228.2588" x2="228.2588" y1="82.2969" y2="335.3594" /></g><g><title>Auth Service</title><rect fill="#000000" fill-opacity="0.00000" height="253.0625" width="8" x="387.7036" y="82.2969" /><line style="stroke:#000000;stroke-width:1;" x1="391.2017" x2="391.2017" y1="82.2969" y2="335.3594" /></g><g><title>API Service</title><rect fill="#000000" fill-opacity="0.00000" height="253.0625" width="8" x="515.3755" y="82.2969" /><line style="stroke:#000000;stroke-width:1;" x1="519.2056" x2="519.2056" y1="82.2969" y2="335.3594" /></g><g><title>User DB</title><rect fill="#000000" fill-opacity="0.00000" height="253.0625" width="8" x="612.918" y="82.2969" /><line style="stroke:#000000;stroke-width:1;" x1="616.5454" x2="616.5454" y1="82.2969" y2="335.3594" /></g><g class="participant participant-head" data-participant="Client"><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="10" y="78.9951">Client</text><ellipse cx="33.2651" cy="14" fill="#FFFFFF" rx="8" ry="8" style="stroke:#000000;stroke-width:1;" /><path d="M33.2651,22 L33.2651,49 M20.2651,30 L46.2651,30 M33.2651,49 L20.2651,64 M33.2651,49 L46.2651,64" fill="none" style="stroke:#000000;stroke-width:1;" /></g><g class="participant participant-tail" data-participant="Client"><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="10" y="347.3545">Client</text><ellipse cx="33.2651" cy="359.6563" fill="#FFFFFF" rx="8" ry="8" style="stroke:#000000;stroke-width:1;" /><path d="M33.2651,367.6563 L33.2651,394.6563 M20.2651,375.6563 L46.2651,375.6563 M33.2651,394.6563 L20.2651,409.6563 M33.2651,394.6563 L46.2651,409.6563" fill="none" style="stroke:#000000;stroke-width:1;" /></g><g class="participant participant-head" data-participant="Gateway"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="102.4434" x="177.2588" y="51" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="88.4434" x="184.2588" y="70.9951">API Gateway</text></g><g class="participant participant-tail" data-participant="Gateway"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="102.4434" x="177.2588" y="334.3594" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="88.4434" x="184.2588" y="354.3545">API Gateway</text></g><g class="participant participant-head" data-participant="Auth"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="103.0039" x="340.2017" y="51" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="89.0039" x="347.2017" y="70.9951">Auth Service</text></g><g class="participant participant-tail" data-participant="Auth"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="103.0039" x="340.2017" y="334.3594" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="89.0039" x="347.2017" y="354.3545">Auth Service</text></g><g class="participant participant-head" data-participant="API"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="92.3398" x="473.2056" y="51" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="78.3398" x="480.2056" y="70.9951">API Service</text></g><g class="participant participant-tail" data-participant="API"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="92.3398" x="473.2056" y="334.3594" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="78.3398" x="480.2056" y="354.3545">API Service</text></g><g class="participant participant-head" data-participant="DB"><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="56.7451" x="585.5454" y="78.9951">User DB</text><path d="M598.918,30 C598.918,20 616.918,20 616.918,20 C616.918,20 634.918,20 634.918,30 L634.918,56 C634.918,66 616.918,66 616.918,66 C616.918,66 598.918,66 598.918,56 L598.918,30" fill="#FFFFFF" style="stroke:#000000;stroke-width:1.5;" /><path d="M598.918,30 C598.918,40 616.918,40 616.918,40 C616.918,40 634.918,40 634.918,30" fill="none" style="stroke:#000000;stroke-width:1.5;" /></g><g class="participant participant-tail" data-participant="DB"><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="56.7451" x="585.5454" y="347.3545">User DB</text><path d="M598.918,360.6563 C598.918,350.6563 616.918,350.6563 616.918,350.6563 C616.918,350.6563 634.918,350.6563 634.918,360.6563 L634.918,386.6563 C634.918,396.6563 616.918,396.6563 616.918,396.6563 C616.918,396.6563 598.918,396.6563 598.918,386.6563 L598.918,360.6563" fill="#FFFFFF" style="stroke:#000000;stroke-width:1.5;" /><path d="M598.918,360.6563 C598.918,370.6563 616.918,370.6563 616.918,370.6563 C616.918,370.6563 634.918,370.6563 634.918,360.6563" fill="none" style="stroke:#000000;stroke-width:1.5;" /></g><g class="message" data-participant-1="Client" data-participant-2="Gateway"><polygon fill="#000000" points="216.4805,109.4297,226.4805,113.4297,216.4805,117.4297,220.4805,113.4297" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="33.2651" x2="222.4805" y1="113.4297" y2="113.4297" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="171.2153" x="40.2651" y="108.3638">API Request + Credentials</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Auth"><polygon fill="#000000" points="379.7036,138.5625,389.7036,142.5625,379.7036,146.5625,383.7036,142.5625" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="228.4805" x2="385.7036" y1="142.5625" y2="142.5625" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="83.624" x="235.4805" y="137.4966">Authenticate</text></g><g class="message" data-participant-1="Auth" data-participant-2="DB"><polygon fill="#000000" points="604.918,167.6953,614.918,171.6953,604.918,175.6953,608.918,171.6953" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="391.7036" x2="610.918" y1="171.6953" y2="171.6953" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="131.498" x="398.7036" y="166.6294">Validate Credentials</text></g><g class="message" data-participant-1="DB" data-participant-2="Auth"><polygon fill="#000000" points="402.7036,196.8281,392.7036,200.8281,402.7036,204.8281,398.7036,200.8281" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="396.7036" x2="615.918" y1="200.8281" y2="200.8281" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="58.3667" x="408.7036" y="195.7622">User Info</text></g><g class="message" data-participant-1="Auth" data-participant-2="Gateway"><polygon fill="#000000" points="239.4805,225.9609,229.4805,229.9609,239.4805,233.9609,235.4805,229.9609" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="233.4805" x2="390.7036" y1="229.9609" y2="229.9609" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="139.2231" x="245.4805" y="224.895">Authentication Token</text></g><g class="message" data-participant-1="Gateway" data-participant-2="API"><polygon fill="#000000" points="507.3755,255.0938,517.3755,259.0938,507.3755,263.0938,511.3755,259.0938" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="228.4805" x2="513.3755" y1="259.0938" y2="259.0938" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="127.9751" x="235.4805" y="254.0278">Authorized Request</text></g><g class="message" data-participant-1="API" data-participant-2="Gateway"><polygon fill="#000000" points="239.4805,284.2266,229.4805,288.2266,239.4805,292.2266,235.4805,288.2266" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="233.4805" x2="518.3755" y1="288.2266" y2="288.2266" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="63.0195" x="245.4805" y="283.1606">Response</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Client"><polygon fill="#000000" points="44.2651,313.3594,34.2651,317.3594,44.2651,321.3594,40.2651,317.3594" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="38.2651" x2="227.4805" y1="317.3594" y2="317.3594" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="87.7183" x="50.2651" y="312.2935">API Response</text></g></g></svg></p></div></div>
<h3 id="1-api-keys">1. API Keys<a class="headerlink" href="#1-api-keys" title="Permanent link">&para;</a></h3>
<p>API keys are simple tokens that identify and authenticate API consumers. While easy to implement, they have significant limitations.</p>
<h4 id="basic-api-key-implementation">Basic API Key Implementation<a class="headerlink" href="#basic-api-key-implementation" title="Permanent link">&para;</a></h4>
<div class="highlight python-template" data-fence-type="template" data-language="python">
<pre><code class="language-python">import secrets
import hashlib
import time
from typing import Optional, Dict, Any
from dataclasses import dataclass
from datetime import datetime, timedelta

@dataclass
class APIKey:
    &quot;&quot;&quot;Represents an API key with metadata&quot;&quot;&quot;
    key_id: str
    key_hash: str  # Hashed version of the actual key
    name: str
    created_at: datetime
    expires_at: Optional[datetime] = None
    is_active: bool = True
    rate_limit: int = 1000  # requests per hour
    allowed_endpoints: list = None  # None means all endpoints

class APIKeyManager:
    &quot;&quot;&quot;Secure API key management system&quot;&quot;&quot;

    def __init__(self):
        self.keys: Dict[str, APIKey] = {}
        self.usage_tracking: Dict[str, list] = {}

    def generate_api_key(self, name: str, expires_days: Optional[int] = None,
                        rate_limit: int = 1000, allowed_endpoints: list = None) -&gt; tuple[str, str]:
        &quot;&quot;&quot;
        Generate a new API key
        Returns: (key_id, actual_key) - store key_id, give actual_key to user
        &quot;&quot;&quot;
        # Generate cryptographically secure key
        actual_key = secrets.token_urlsafe(32)
        key_id = secrets.token_urlsafe(16)

        # Hash the key for storage (never store plain text keys)
        key_hash = hashlib.sha256(actual_key.encode()).hexdigest()

        # Set expiration
        expires_at = None
        if expires_days:
            expires_at = datetime.now() + timedelta(days=expires_days)

        # Create API key record
        api_key = APIKey(
            key_id=key_id,
            key_hash=key_hash,
            name=name,
            created_at=datetime.now(),
            expires_at=expires_at,
            rate_limit=rate_limit,
            allowed_endpoints=allowed_endpoints or []
        )

        self.keys[key_id] = api_key
        self.usage_tracking[key_id] = []

        return key_id, actual_key

    def validate_api_key(self, provided_key: str) -&gt; Optional[APIKey]:
        &quot;&quot;&quot;
        Validate an API key and return associated metadata
        &quot;&quot;&quot;
        if not provided_key:
            return None

        # Hash the provided key
        provided_hash = hashlib.sha256(provided_key.encode()).hexdigest()

        # Find matching key
        for key_id, api_key in self.keys.items():
            if api_key.key_hash == provided_hash:
                # Check if key is active
                if not api_key.is_active:
                    return None

                # Check if key has expired
                if api_key.expires_at and datetime.now() &gt; api_key.expires_at:
                    return None

                return api_key

        return None

    def revoke_api_key(self, key_id: str) -&gt; bool:
        &quot;&quot;&quot;Revoke an API key&quot;&quot;&quot;
        if key_id in self.keys:
            self.keys[key_id].is_active = False
            return True
        return False

    def track_usage(self, key_id: str, endpoint: str):
        &quot;&quot;&quot;Track API key usage for rate limiting&quot;&quot;&quot;
        if key_id not in self.usage_tracking:
            self.usage_tracking[key_id] = []

        self.usage_tracking[key_id].append({
            &#x27;timestamp&#x27;: datetime.now(),
            &#x27;endpoint&#x27;: endpoint
        })

    def check_rate_limit(self, key_id: str) -&gt; bool:
        &quot;&quot;&quot;Check if API key is within rate limit (last hour)&quot;&quot;&quot;
        if key_id not in self.usage_tracking:
            return True

        api_key = self.keys.get(key_id)
        if not api_key:
            return False

        # Count requests in the last hour
        one_hour_ago = datetime.now() - timedelta(hours=1)
        recent_requests = [
            req for req in self.usage_tracking[key_id]
            if req[&#x27;timestamp&#x27;] &gt; one_hour_ago
        ]

        return len(recent_requests) &lt; api_key.rate_limit

# Example usage
def api_key_authentication_example():
    &quot;&quot;&quot;Demonstrate API key authentication&quot;&quot;&quot;
    key_manager = APIKeyManager()

    # Generate API key for a client
    key_id, actual_key = key_manager.generate_api_key(
        name=&quot;Mobile App Client&quot;,
        expires_days=365,
        rate_limit=5000
    )

    print(f&quot;Generated API Key ID: {key_id}&quot;)
    print(f&quot;API Key (give to client): {actual_key}&quot;)

    # Simulate API request validation
    def authenticate_request(api_key: str) -&gt; Dict[str, Any]:
        &quot;&quot;&quot;Simulate API request authentication&quot;&quot;&quot;
        validated_key = key_manager.validate_api_key(api_key)

        if not validated_key:
            return {&quot;error&quot;: &quot;Invalid or expired API key&quot;, &quot;status&quot;: 401}

        if not key_manager.check_rate_limit(validated_key.key_id):
            return {&quot;error&quot;: &quot;Rate limit exceeded&quot;, &quot;status&quot;: 429}

        # Track the usage
        key_manager.track_usage(validated_key.key_id, &quot;/api/endpoint&quot;)

        return {
            &quot;authenticated&quot;: True,
            &quot;key_name&quot;: validated_key.name,
            &quot;remaining_requests&quot;: validated_key.rate_limit - len(
                key_manager.usage_tracking.get(validated_key.key_id, [])
            )
        }

    # Test authentication
    result = authenticate_request(actual_key)
    print(f&quot;Authentication result: {result}&quot;)

if __name__ == &quot;__main__&quot;:
    api_key_authentication_example()
</code></pre>
</div>
<h4 id="api-key-security-best-practices">API Key Security Best Practices<a class="headerlink" href="#api-key-security-best-practices" title="Permanent link">&para;</a></h4>
<div class="highlight python-template" data-fence-type="template" data-language="python">
<pre><code class="language-python">class SecureAPIKeyValidator:
    &quot;&quot;&quot;Enhanced API key validation with security features&quot;&quot;&quot;

    def __init__(self):
        self.failed_attempts: Dict[str, list] = {}
        self.blocked_ips: set = set()

    def validate_with_security_checks(self, api_key: str, client_ip: str, 
                                    endpoint: str) -&gt; Dict[str, Any]:
        &quot;&quot;&quot;Validate API key with additional security checks&quot;&quot;&quot;

        # Check if IP is blocked
        if client_ip in self.blocked_ips:
            return {&quot;error&quot;: &quot;IP address blocked&quot;, &quot;status&quot;: 403}

        # Rate limiting on failed attempts
        if self._check_brute_force_attempts(client_ip):
            self._block_ip(client_ip)
            return {&quot;error&quot;: &quot;Too many failed attempts&quot;, &quot;status&quot;: 429}

        # Validate API key
        if not self._is_valid_api_key_format(api_key):
            self._track_failed_attempt(client_ip)
            return {&quot;error&quot;: &quot;Invalid API key format&quot;, &quot;status&quot;: 400}

        # Additional timing attack protection
        time.sleep(0.1)  # Constant time delay

        return {&quot;status&quot;: &quot;validated&quot;}

    def _is_valid_api_key_format(self, api_key: str) -&gt; bool:
        &quot;&quot;&quot;Validate API key format to prevent injection&quot;&quot;&quot;
        if not api_key or len(api_key) &lt; 20:
            return False

        # Check for only alphanumeric and safe characters
        import re
        if not re.match(r&#x27;^[A-Za-z0-9_-]+$&#x27;, api_key):
            return False

        return True

    def _track_failed_attempt(self, client_ip: str):
        &quot;&quot;&quot;Track failed authentication attempts&quot;&quot;&quot;
        if client_ip not in self.failed_attempts:
            self.failed_attempts[client_ip] = []

        self.failed_attempts[client_ip].append(datetime.now())

    def _check_brute_force_attempts(self, client_ip: str) -&gt; bool:
        &quot;&quot;&quot;Check if IP has too many failed attempts&quot;&quot;&quot;
        if client_ip not in self.failed_attempts:
            return False

        # Check last 15 minutes
        fifteen_min_ago = datetime.now() - timedelta(minutes=15)
        recent_failures = [
            attempt for attempt in self.failed_attempts[client_ip]
            if attempt &gt; fifteen_min_ago
        ]

        return len(recent_failures) &gt; 10  # More than 10 failures in 15 minutes

    def _block_ip(self, client_ip: str):
        &quot;&quot;&quot;Block an IP address&quot;&quot;&quot;
        self.blocked_ips.add(client_ip)
        print(f&quot;Blocked IP {client_ip} due to suspicious activity&quot;)
</code></pre>
</div>
<h3 id="2-json-web-tokens-jwt">2. JSON Web Tokens (JWT)<a class="headerlink" href="#2-json-web-tokens-jwt" title="Permanent link">&para;</a></h3>
<p>JWTs provide a stateless authentication mechanism that can carry user information and permissions within the token itself.</p>
<h4 id="jwt-implementation">JWT Implementation<a class="headerlink" href="#jwt-implementation" title="Permanent link">&para;</a></h4>
<div class="highlight python-template" data-fence-type="template" data-language="python">
<pre><code class="language-python">import jwt
import json
from datetime import datetime, timedelta
from typing import Dict, Any, Optional

class JWTManager:
    &quot;&quot;&quot;Secure JWT token management&quot;&quot;&quot;

    def __init__(self, secret_key: str, algorithm: str = &quot;HS256&quot;):
        self.secret_key = secret_key
        self.algorithm = algorithm
        self.blacklisted_tokens: set = set()

    def generate_token(self, user_id: str, permissions: list, 
                      expires_hours: int = 24) -&gt; str:
        &quot;&quot;&quot;Generate a JWT token with user information and permissions&quot;&quot;&quot;

        # Current time
        now = datetime.utcnow()

        # Create payload
        payload = {
            &#x27;user_id&#x27;: user_id,
            &#x27;permissions&#x27;: permissions,
            &#x27;iat&#x27;: now,  # issued at
            &#x27;exp&#x27;: now + timedelta(hours=expires_hours),  # expires
            &#x27;jti&#x27;: secrets.token_urlsafe(16)  # unique token ID for blacklisting
        }

        # Generate token
        token = jwt.encode(payload, self.secret_key, algorithm=self.algorithm)
        return token

    def validate_token(self, token: str) -&gt; Optional[Dict[str, Any]]:
        &quot;&quot;&quot;Validate JWT token and return payload if valid&quot;&quot;&quot;
        try:
            # Check if token is blacklisted
            if token in self.blacklisted_tokens:
                return None

            # Decode and validate token
            payload = jwt.decode(
                token, 
                self.secret_key, 
                algorithms=[self.algorithm]
            )

            return payload

        except jwt.ExpiredSignatureError:
            return None  # Token has expired
        except jwt.InvalidTokenError:
            return None  # Token is invalid

    def revoke_token(self, token: str):
        &quot;&quot;&quot;Add token to blacklist (logout functionality)&quot;&quot;&quot;
        self.blacklisted_tokens.add(token)

    def refresh_token(self, old_token: str) -&gt; Optional[str]:
        &quot;&quot;&quot;Generate a new token from a valid existing token&quot;&quot;&quot;
        payload = self.validate_token(old_token)

        if not payload:
            return None

        # Revoke old token
        self.revoke_token(old_token)

        # Generate new token with same permissions
        return self.generate_token(
            user_id=payload[&#x27;user_id&#x27;],
            permissions=payload[&#x27;permissions&#x27;]
        )

# JWT-based API authentication decorator
def jwt_required(permissions_required: list = None):
    &quot;&quot;&quot;Decorator for protecting API endpoints with JWT&quot;&quot;&quot;
    def decorator(func):
        def wrapper(*args, **kwargs):
            # In a real Flask/FastAPI app, you&#x27;d get this from request headers
            # For demo purposes, we&#x27;ll simulate it
            token = kwargs.get(&#x27;jwt_token&#x27;, &#x27;&#x27;)

            jwt_manager = kwargs.get(&#x27;jwt_manager&#x27;)
            if not jwt_manager:
                return {&quot;error&quot;: &quot;JWT manager not configured&quot;, &quot;status&quot;: 500}

            # Validate token
            payload = jwt_manager.validate_token(token)
            if not payload:
                return {&quot;error&quot;: &quot;Invalid or expired token&quot;, &quot;status&quot;: 401}

            # Check permissions
            if permissions_required:
                user_permissions = payload.get(&#x27;permissions&#x27;, [])
                if not any(perm in user_permissions for perm in permissions_required):
                    return {&quot;error&quot;: &quot;Insufficient permissions&quot;, &quot;status&quot;: 403}

            # Add user info to function call
            kwargs[&#x27;current_user&#x27;] = payload
            return func(*args, **kwargs)

        return wrapper
    return decorator

# Example protected API endpoints
class SecureAPI:
    &quot;&quot;&quot;Example API with JWT protection&quot;&quot;&quot;

    def __init__(self, jwt_manager: JWTManager):
        self.jwt_manager = jwt_manager

    @jwt_required([&#x27;read_users&#x27;])
    def get_users(self, jwt_token: str, jwt_manager: JWTManager, current_user: dict):
        &quot;&quot;&quot;Protected endpoint requiring &#x27;read_users&#x27; permission&quot;&quot;&quot;
        return {
            &quot;users&quot;: [&quot;user1&quot;, &quot;user2&quot;, &quot;user3&quot;],
            &quot;accessed_by&quot;: current_user[&#x27;user_id&#x27;]
        }

    @jwt_required([&#x27;admin&#x27;])
    def delete_user(self, user_id: str, jwt_token: str, 
                   jwt_manager: JWTManager, current_user: dict):
        &quot;&quot;&quot;Protected endpoint requiring &#x27;admin&#x27; permission&quot;&quot;&quot;
        return {
            &quot;message&quot;: f&quot;User {user_id} deleted&quot;,
            &quot;deleted_by&quot;: current_user[&#x27;user_id&#x27;]
        }

def jwt_authentication_example():
    &quot;&quot;&quot;Demonstrate JWT authentication&quot;&quot;&quot;

    # Initialize JWT manager
    jwt_manager = JWTManager(secret_key=&quot;your-secret-key-keep-this-secure&quot;)

    # Generate token for a user
    token = jwt_manager.generate_token(
        user_id=&quot;user123&quot;,
        permissions=[&quot;read_users&quot;, &quot;write_posts&quot;]
    )

    print(f&quot;Generated JWT: {token[:50]}...&quot;)

    # Validate token
    payload = jwt_manager.validate_token(token)
    print(f&quot;Token payload: {payload}&quot;)

    # Test API access
    api = SecureAPI(jwt_manager)

    # This should work (user has &#x27;read_users&#x27; permission)
    result = api.get_users(jwt_token=token, jwt_manager=jwt_manager)
    print(f&quot;API result: {result}&quot;)

    # This should fail (user doesn&#x27;t have &#x27;admin&#x27; permission)
    result = api.delete_user(&quot;user456&quot;, jwt_token=token, jwt_manager=jwt_manager)
    print(f&quot;Admin action result: {result}&quot;)

if __name__ == &quot;__main__&quot;:
    jwt_authentication_example()
</code></pre>
</div>
<h3 id="3-oauth-20-flow-implementation">3. OAuth 2.0 Flow Implementation<a class="headerlink" href="#3-oauth-20-flow-implementation" title="Permanent link">&para;</a></h3>
<p>OAuth 2.0 is an authorization framework that enables applications to obtain limited access to user accounts.</p>
<div class="highlight python-template" data-fence-type="template" data-language="python">
<pre><code class="language-python">import urllib.parse
import requests
from typing import Dict, Optional

class OAuth2Manager:
    &quot;&quot;&quot;OAuth 2.0 authorization server implementation&quot;&quot;&quot;

    def __init__(self, client_id: str, client_secret: str, 
                 authorization_base_url: str, token_url: str):
        self.client_id = client_id
        self.client_secret = client_secret
        self.authorization_base_url = authorization_base_url
        self.token_url = token_url
        self.authorization_codes: Dict[str, dict] = {}
        self.access_tokens: Dict[str, dict] = {}

    def generate_authorization_url(self, redirect_uri: str, 
                                 scope: str, state: str = None) -&gt; str:
        &quot;&quot;&quot;Generate OAuth authorization URL&quot;&quot;&quot;

        params = {
            &#x27;response_type&#x27;: &#x27;code&#x27;,
            &#x27;client_id&#x27;: self.client_id,
            &#x27;redirect_uri&#x27;: redirect_uri,
            &#x27;scope&#x27;: scope,
            &#x27;state&#x27;: state or secrets.token_urlsafe(16)
        }

        # Build authorization URL
        authorization_url = f&quot;{self.authorization_base_url}?{urllib.parse.urlencode(params)}&quot;
        return authorization_url

    def exchange_code_for_token(self, authorization_code: str, 
                              redirect_uri: str) -&gt; Optional[Dict[str, Any]]:
        &quot;&quot;&quot;Exchange authorization code for access token&quot;&quot;&quot;

        # Validate authorization code
        if authorization_code not in self.authorization_codes:
            return None

        code_data = self.authorization_codes[authorization_code]

        # Check if code has expired (typically 10 minutes)
        if datetime.now() &gt; code_data[&#x27;expires_at&#x27;]:
            del self.authorization_codes[authorization_code]
            return None

        # Generate access token
        access_token = secrets.token_urlsafe(32)
        refresh_token = secrets.token_urlsafe(32)

        token_data = {
            &#x27;access_token&#x27;: access_token,
            &#x27;refresh_token&#x27;: refresh_token,
            &#x27;token_type&#x27;: &#x27;Bearer&#x27;,
            &#x27;expires_in&#x27;: 3600,  # 1 hour
            &#x27;scope&#x27;: code_data[&#x27;scope&#x27;],
            &#x27;user_id&#x27;: code_data[&#x27;user_id&#x27;],
            &#x27;created_at&#x27;: datetime.now()
        }

        self.access_tokens[access_token] = token_data

        # Remove used authorization code
        del self.authorization_codes[authorization_code]

        return token_data

    def validate_access_token(self, access_token: str) -&gt; Optional[Dict[str, Any]]:
        &quot;&quot;&quot;Validate OAuth access token&quot;&quot;&quot;

        if access_token not in self.access_tokens:
            return None

        token_data = self.access_tokens[access_token]

        # Check if token has expired
        expires_at = token_data[&#x27;created_at&#x27;] + timedelta(seconds=token_data[&#x27;expires_in&#x27;])
        if datetime.now() &gt; expires_at:
            del self.access_tokens[access_token]
            return None

        return token_data

# OAuth-protected API endpoint
def oauth_required(scopes_required: list = None):
    &quot;&quot;&quot;Decorator for OAuth-protected endpoints&quot;&quot;&quot;
    def decorator(func):
        def wrapper(*args, **kwargs):
            # Get access token from Authorization header
            # In real implementation: token = request.headers.get(&#x27;Authorization&#x27;, &#x27;&#x27;).replace(&#x27;Bearer &#x27;, &#x27;&#x27;)
            token = kwargs.get(&#x27;access_token&#x27;, &#x27;&#x27;)

            oauth_manager = kwargs.get(&#x27;oauth_manager&#x27;)
            if not oauth_manager:
                return {&quot;error&quot;: &quot;OAuth not configured&quot;, &quot;status&quot;: 500}

            # Validate token
            token_data = oauth_manager.validate_access_token(token)
            if not token_data:
                return {&quot;error&quot;: &quot;Invalid or expired access token&quot;, &quot;status&quot;: 401}

            # Check scopes
            if scopes_required:
                token_scopes = token_data.get(&#x27;scope&#x27;, &#x27;&#x27;).split()
                if not any(scope in token_scopes for scope in scopes_required):
                    return {&quot;error&quot;: &quot;Insufficient scope&quot;, &quot;status&quot;: 403}

            kwargs[&#x27;token_info&#x27;] = token_data
            return func(*args, **kwargs)

        return wrapper
    return decorator

def oauth_authentication_example():
    &quot;&quot;&quot;Demonstrate OAuth 2.0 authentication flow&quot;&quot;&quot;

    oauth_manager = OAuth2Manager(
        client_id=&quot;your-client-id&quot;,
        client_secret=&quot;your-client-secret&quot;,
        authorization_base_url=&quot;https://auth.example.com/oauth/authorize&quot;,
        token_url=&quot;https://auth.example.com/oauth/token&quot;
    )

    # Step 1: Generate authorization URL
    auth_url = oauth_manager.generate_authorization_url(
        redirect_uri=&quot;https://yourapp.com/callback&quot;,
        scope=&quot;read write&quot;,
        state=&quot;random-state-value&quot;
    )
    print(f&quot;Authorization URL: {auth_url}&quot;)

    # Step 2: Simulate user authorization (in real flow, user clicks auth_url)
    # This would be handled by the authorization server
    authorization_code = secrets.token_urlsafe(32)
    oauth_manager.authorization_codes[authorization_code] = {
        &#x27;user_id&#x27;: &#x27;user123&#x27;,
        &#x27;scope&#x27;: &#x27;read write&#x27;,
        &#x27;expires_at&#x27;: datetime.now() + timedelta(minutes=10)
    }

    # Step 3: Exchange code for token
    token_data = oauth_manager.exchange_code_for_token(
        authorization_code=authorization_code,
        redirect_uri=&quot;https://yourapp.com/callback&quot;
    )
    print(f&quot;Access token data: {token_data}&quot;)

    # Step 4: Use token to access protected resource
    @oauth_required([&#x27;read&#x27;])
    def get_protected_data(access_token: str, oauth_manager: OAuth2Manager, token_info: dict):
        return {
            &quot;data&quot;: &quot;This is protected data&quot;,
            &quot;user_id&quot;: token_info[&#x27;user_id&#x27;],
            &quot;scopes&quot;: token_info[&#x27;scope&#x27;]
        }

    result = get_protected_data(
        access_token=token_data[&#x27;access_token&#x27;],
        oauth_manager=oauth_manager
    )
    print(f&quot;Protected resource access: {result}&quot;)

if __name__ == &quot;__main__&quot;:
    oauth_authentication_example()
</code></pre>
</div>
<h2 id="rate-limiting-and-dos-protection">Rate Limiting and DoS Protection<a class="headerlink" href="#rate-limiting-and-dos-protection" title="Permanent link">&para;</a></h2>
<p>Rate limiting is crucial for preventing abuse and ensuring fair resource allocation among API consumers.</p>
<h3 id="token-bucket-algorithm-implementation">Token Bucket Algorithm Implementation<a class="headerlink" href="#token-bucket-algorithm-implementation" title="Permanent link">&para;</a></h3>
<div class="highlight python-template" data-fence-type="template" data-language="python">
<pre><code class="language-python">import time
from threading import Lock
from typing import Dict, Optional
from dataclasses import dataclass

@dataclass
class TokenBucket:
    &quot;&quot;&quot;Token bucket for rate limiting&quot;&quot;&quot;
    capacity: int  # Maximum number of tokens
    tokens: float  # Current number of tokens
    refill_rate: float  # Tokens added per second
    last_refill: float  # Last refill timestamp

class RateLimiter:
    &quot;&quot;&quot;Advanced rate limiting with multiple algorithms&quot;&quot;&quot;

    def __init__(self):
        self.buckets: Dict[str, TokenBucket] = {}
        self.lock = Lock()
        self.request_history: Dict[str, list] = {}

    def create_rate_limit(self, identifier: str, requests_per_second: float, 
                         burst_capacity: int = None) -&gt; TokenBucket:
        &quot;&quot;&quot;Create a rate limit for an identifier (IP, user, API key)&quot;&quot;&quot;

        if burst_capacity is None:
            burst_capacity = int(requests_per_second * 10)  # Allow 10 seconds of burst

        bucket = TokenBucket(
            capacity=burst_capacity,
            tokens=burst_capacity,  # Start with full bucket
            refill_rate=requests_per_second,
            last_refill=time.time()
        )

        with self.lock:
            self.buckets[identifier] = bucket

        return bucket

    def is_allowed(self, identifier: str, tokens_requested: int = 1) -&gt; tuple[bool, Dict[str, Any]]:
        &quot;&quot;&quot;Check if request is allowed under rate limit&quot;&quot;&quot;

        with self.lock:
            # Get or create bucket
            if identifier not in self.buckets:
                # Default rate limit: 100 requests per second with burst of 1000
                self.create_rate_limit(identifier, 100, 1000)

            bucket = self.buckets[identifier]
            current_time = time.time()

            # Refill tokens based on elapsed time
            elapsed = current_time - bucket.last_refill
            tokens_to_add = elapsed * bucket.refill_rate
            bucket.tokens = min(bucket.capacity, bucket.tokens + tokens_to_add)
            bucket.last_refill = current_time

            # Check if enough tokens available
            if bucket.tokens &gt;= tokens_requested:
                bucket.tokens -= tokens_requested

                return True, {
                    &quot;allowed&quot;: True,
                    &quot;remaining_tokens&quot;: int(bucket.tokens),
                    &quot;reset_time&quot;: current_time + (bucket.capacity - bucket.tokens) / bucket.refill_rate
                }
            else:
                # Calculate when enough tokens will be available
                tokens_needed = tokens_requested - bucket.tokens
                wait_time = tokens_needed / bucket.refill_rate

                return False, {
                    &quot;allowed&quot;: False,
                    &quot;retry_after&quot;: wait_time,
                    &quot;remaining_tokens&quot;: int(bucket.tokens)
                }

    def sliding_window_check(self, identifier: str, window_seconds: int = 3600, 
                           max_requests: int = 1000) -&gt; tuple[bool, Dict[str, Any]]:
        &quot;&quot;&quot;Sliding window rate limiting (alternative algorithm)&quot;&quot;&quot;

        current_time = time.time()
        window_start = current_time - window_seconds

        # Initialize request history if needed
        if identifier not in self.request_history:
            self.request_history[identifier] = []

        # Remove old requests outside the window
        self.request_history[identifier] = [
            req_time for req_time in self.request_history[identifier]
            if req_time &gt; window_start
        ]

        # Check if within limit
        current_requests = len(self.request_history[identifier])

        if current_requests &lt; max_requests:
            # Add current request
            self.request_history[identifier].append(current_time)

            return True, {
                &quot;allowed&quot;: True,
                &quot;requests_remaining&quot;: max_requests - current_requests - 1,
                &quot;window_reset&quot;: window_start + window_seconds
            }
        else:
            # Calculate when window will reset
            oldest_request = min(self.request_history[identifier])
            reset_time = oldest_request + window_seconds

            return False, {
                &quot;allowed&quot;: False,
                &quot;retry_after&quot;: reset_time - current_time,
                &quot;requests_remaining&quot;: 0
            }

class DDoSProtection:
    &quot;&quot;&quot;DDoS protection with progressive penalties&quot;&quot;&quot;

    def __init__(self):
        self.rate_limiter = RateLimiter()
        self.suspicious_ips: Dict[str, dict] = {}
        self.blocked_ips: set = set()

    def analyze_request_pattern(self, ip_address: str, endpoint: str, 
                              user_agent: str) -&gt; Dict[str, Any]:
        &quot;&quot;&quot;Analyze request patterns for DDoS indicators&quot;&quot;&quot;

        # Check if IP is already blocked
        if ip_address in self.blocked_ips:
            return {
                &quot;action&quot;: &quot;block&quot;,
                &quot;reason&quot;: &quot;IP previously blocked for suspicious activity&quot;
            }

        # Progressive rate limiting based on suspicion level
        suspicion_level = self._calculate_suspicion_level(ip_address, endpoint, user_agent)

        if suspicion_level == &quot;low&quot;:
            allowed, info = self.rate_limiter.is_allowed(ip_address, 1)
            requests_per_second = 100
        elif suspicion_level == &quot;medium&quot;:
            allowed, info = self.rate_limiter.sliding_window_check(ip_address, 60, 50)
            requests_per_second = 10
        else:  # high suspicion
            allowed, info = self.rate_limiter.sliding_window_check(ip_address, 60, 10)
            requests_per_second = 1

        if not allowed:
            # Track consecutive violations
            self._track_violation(ip_address)

            # Check if IP should be blocked
            if self._should_block_ip(ip_address):
                self.blocked_ips.add(ip_address)
                return {
                    &quot;action&quot;: &quot;block&quot;,
                    &quot;reason&quot;: &quot;Too many rate limit violations&quot;
                }

        return {
            &quot;action&quot;: &quot;allow&quot; if allowed else &quot;rate_limit&quot;,
            &quot;suspicion_level&quot;: suspicion_level,
            &quot;rate_info&quot;: info
        }

    def _calculate_suspicion_level(self, ip_address: str, endpoint: str, 
                                 user_agent: str) -&gt; str:
        &quot;&quot;&quot;Calculate suspicion level based on various factors&quot;&quot;&quot;

        suspicion_score = 0

        # Check user agent
        if not user_agent or user_agent in [&quot;&quot;, &quot;curl&quot;, &quot;wget&quot;, &quot;python-requests&quot;]:
            suspicion_score += 2

        # Check for suspicious endpoints
        suspicious_endpoints = [&quot;/admin&quot;, &quot;/login&quot;, &quot;/api/auth&quot;, &quot;/.env&quot;, &quot;/config&quot;]
        if any(suspicious in endpoint for suspicious in suspicious_endpoints):
            suspicion_score += 1

        # Check request frequency from this IP
        if ip_address in self.rate_limiter.request_history:
            recent_requests = len(self.rate_limiter.request_history[ip_address])
            if recent_requests &gt; 1000:  # Very high frequency
                suspicion_score += 3
            elif recent_requests &gt; 100:
                suspicion_score += 1

        # Determine level
        if suspicion_score &gt;= 4:
            return &quot;high&quot;
        elif suspicion_score &gt;= 2:
            return &quot;medium&quot;
        else:
            return &quot;low&quot;

    def _track_violation(self, ip_address: str):
        &quot;&quot;&quot;Track rate limit violations&quot;&quot;&quot;
        if ip_address not in self.suspicious_ips:
            self.suspicious_ips[ip_address] = {
                &quot;violations&quot;: 0,
                &quot;first_violation&quot;: time.time()
            }

        self.suspicious_ips[ip_address][&quot;violations&quot;] += 1

    def _should_block_ip(self, ip_address: str) -&gt; bool:
        &quot;&quot;&quot;Determine if IP should be blocked&quot;&quot;&quot;
        if ip_address not in self.suspicious_ips:
            return False

        violations = self.suspicious_ips[ip_address][&quot;violations&quot;]
        first_violation = self.suspicious_ips[ip_address][&quot;first_violation&quot;]

        # Block if more than 10 violations in the last hour
        if violations &gt; 10 and (time.time() - first_violation) &lt; 3600:
            return True

        return False

def rate_limiting_example():
    &quot;&quot;&quot;Demonstrate rate limiting and DDoS protection&quot;&quot;&quot;

    # Initialize protection systems
    rate_limiter = RateLimiter()
    ddos_protection = DDoSProtection()

    # Create rate limits for different users
    rate_limiter.create_rate_limit(&quot;api_key_123&quot;, 10, 50)  # 10 req/sec, burst 50
    rate_limiter.create_rate_limit(&quot;premium_user&quot;, 100, 1000)  # Higher limits

    # Simulate API requests
    def simulate_api_request(identifier: str, ip_address: str):
        &quot;&quot;&quot;Simulate an API request with rate limiting&quot;&quot;&quot;

        # Check DDoS protection
        ddos_result = ddos_protection.analyze_request_pattern(
            ip_address=ip_address,
            endpoint=&quot;/api/data&quot;,
            user_agent=&quot;Mozilla/5.0 (legitimate browser)&quot;
        )

        if ddos_result[&quot;action&quot;] == &quot;block&quot;:
            return {&quot;status&quot;: 403, &quot;error&quot;: ddos_result[&quot;reason&quot;]}

        # Check rate limiting
        allowed, rate_info = rate_limiter.is_allowed(identifier)

        if not allowed:
            return {
                &quot;status&quot;: 429,
                &quot;error&quot;: &quot;Rate limit exceeded&quot;,
                &quot;retry_after&quot;: rate_info[&quot;retry_after&quot;]
            }

        return {
            &quot;status&quot;: 200,
            &quot;data&quot;: &quot;API response data&quot;,
            &quot;rate_limit_remaining&quot;: rate_info[&quot;remaining_tokens&quot;]
        }

    # Test normal usage
    for i in range(5):
        result = simulate_api_request(&quot;api_key_123&quot;, &quot;192.168.1.100&quot;)
        print(f&quot;Request {i+1}: {result}&quot;)
        time.sleep(0.1)  # Small delay between requests

    # Test rate limit exceeded
    for i in range(60):  # Try to exceed rate limit
        result = simulate_api_request(&quot;api_key_123&quot;, &quot;192.168.1.100&quot;)
        if result[&quot;status&quot;] == 429:
            print(f&quot;Rate limited after {i+1} rapid requests&quot;)
            break

if __name__ == &quot;__main__&quot;:
    rate_limiting_example()
</code></pre>
</div>
<h2 id="secure-session-management">Secure Session Management<a class="headerlink" href="#secure-session-management" title="Permanent link">&para;</a></h2>
<p>Session management is critical for maintaining authenticated state between API requests while preventing session-related attacks.</p>
<h3 id="session-security-principles">Session Security Principles<a class="headerlink" href="#session-security-principles" title="Permanent link">&para;</a></h3>
<div class="diagram-container" data-container-id="kroki-diagram-1"><button class="diagram-expand-btn" onclick="openDiagramModal('kroki-diagram-1')">🔍 View Larger</button><div id="kroki-diagram-1" class="diagram-content"><p><svg xmlns="http://www.w3.org/2000/svg" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="533px" preserveAspectRatio="xMaxYMax meet" style="width:622px;height:533px;background:#FFFFFF;" version="1.1" viewBox="0 0 622 533" width="622px" zoomAndPan="magnify" id="Kroki" data-diagram-id="kroki-svg-1"><defs /><g><g><title>Client</title><rect fill="#000000" fill-opacity="0.00000" height="462.125" width="8" x="52.2651" y="36.2969" /><line style="stroke:#000000;stroke-width:1;" x1="56" x2="56" y1="36.2969" y2="498.4219" /></g><g><title>API Gateway</title><rect fill="#000000" fill-opacity="0.00000" height="462.125" width="8" x="300.1533" y="36.2969" /><line style="stroke:#000000;stroke-width:1;" x1="303.9316" x2="303.9316" y1="36.2969" y2="498.4219" /></g><g><title>Session Store</title><rect fill="#000000" fill-opacity="0.00000" height="462.125" width="8" x="435.9634" y="36.2969" /><line style="stroke:#000000;stroke-width:1;" x1="439.375" x2="439.375" y1="36.2969" y2="498.4219" /></g><g><title>API Service</title><rect fill="#000000" fill-opacity="0.00000" height="462.125" width="8" x="566.7217" y="36.2969" /><line style="stroke:#000000;stroke-width:1;" x1="570.5518" x2="570.5518" y1="36.2969" y2="498.4219" /></g><g class="participant participant-head" data-participant="Client"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="54.5303" x="29" y="5" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="36" y="24.9951">Client</text></g><g class="participant participant-tail" data-participant="Client"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="54.5303" x="29" y="497.4219" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="36" y="517.417">Client</text></g><g class="participant participant-head" data-participant="Gateway"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="102.4434" x="252.9316" y="5" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="88.4434" x="259.9316" y="24.9951">API Gateway</text></g><g class="participant participant-tail" data-participant="Gateway"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="102.4434" x="252.9316" y="497.4219" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="88.4434" x="259.9316" y="517.417">API Gateway</text></g><g class="participant participant-head" data-participant="Session"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="109.1768" x="385.375" y="5" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="95.1768" x="392.375" y="24.9951">Session Store</text></g><g class="participant participant-tail" data-participant="Session"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="109.1768" x="385.375" y="497.4219" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="95.1768" x="392.375" y="517.417">Session Store</text></g><g class="participant participant-head" data-participant="API"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="92.3398" x="524.5518" y="5" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="78.3398" x="531.5518" y="24.9951">API Service</text></g><g class="participant participant-tail" data-participant="API"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="92.3398" x="524.5518" y="497.4219" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="78.3398" x="531.5518" y="517.417">API Service</text></g><g class="message" data-participant-1="Client" data-participant-2="Gateway"><polygon fill="#000000" points="292.1533,63.4297,302.1533,67.4297,292.1533,71.4297,296.1533,67.4297" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="56.2651" x2="298.1533" y1="67.4297" y2="67.4297" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="92.8218" x="63.2651" y="62.3638">Login Request</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Session"><polygon fill="#000000" points="427.9634,92.5625,437.9634,96.5625,427.9634,100.5625,431.9634,96.5625" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="304.1533" x2="433.9634" y1="96.5625" y2="96.5625" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="97.2144" x="311.1533" y="91.4966">Create Session</text></g><g class="message" data-participant-1="Session" data-participant-2="Gateway"><polygon fill="#000000" points="315.1533,121.6953,305.1533,125.6953,315.1533,129.6953,311.1533,125.6953" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="309.1533" x2="438.9634" y1="125.6953" y2="125.6953" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="67.5771" x="321.1533" y="120.6294">Session ID</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Client"><polygon fill="#000000" points="67.2651,150.8281,57.2651,154.8281,67.2651,158.8281,63.2651,154.8281" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="61.2651" x2="303.1533" y1="154.8281" y2="154.8281" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="223.8882" x="73.2651" y="149.7622">Session Token (HTTP-Only Cookie)</text></g><path d="M10,167.8281 L10,192.8281 L351,192.8281 L351,177.8281 L341,167.8281 L10,167.8281" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><path d="M341,167.8281 L341,177.8281 L351,177.8281 L341,167.8281" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="166.334" x="93.0205" y="184.895">Subsequent API Requests</text><g class="message" data-participant-1="Client" data-participant-2="Gateway"><polygon fill="#000000" points="292.1533,215.0938,302.1533,219.0938,292.1533,223.0938,296.1533,219.0938" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="56.2651" x2="298.1533" y1="219.0938" y2="219.0938" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="195.1016" x="63.2651" y="214.0278">API Request + Session Cookie</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Session"><polygon fill="#000000" points="427.9634,244.2266,437.9634,248.2266,427.9634,252.2266,431.9634,248.2266" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="304.1533" x2="433.9634" y1="248.2266" y2="248.2266" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="107.1294" x="311.1533" y="243.1606">Validate Session</text></g><g class="message" data-participant-1="Session" data-participant-2="Gateway"><polygon fill="#000000" points="315.1533,273.3594,305.1533,277.3594,315.1533,281.3594,311.1533,277.3594" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="309.1533" x2="438.9634" y1="277.3594" y2="277.3594" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="84.7729" x="321.1533" y="272.2935">Session Data</text></g><g class="message" data-participant-1="Gateway" data-participant-2="API"><polygon fill="#000000" points="558.7217,302.4922,568.7217,306.4922,558.7217,310.4922,562.7217,306.4922" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="304.1533" x2="564.7217" y1="306.4922" y2="306.4922" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="127.9751" x="311.1533" y="301.4263">Authorized Request</text></g><g class="message" data-participant-1="API" data-participant-2="Gateway"><polygon fill="#000000" points="315.1533,331.625,305.1533,335.625,315.1533,339.625,311.1533,335.625" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="309.1533" x2="569.7217" y1="335.625" y2="335.625" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="63.0195" x="321.1533" y="330.5591">Response</text></g><g class="message" data-participant-1="Gateway" data-participant-2="Client"><polygon fill="#000000" points="67.2651,360.7578,57.2651,364.7578,67.2651,368.7578,63.2651,364.7578" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="61.2651" x2="303.1533" y1="364.7578" y2="364.7578" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="87.7183" x="73.2651" y="359.6919">API Response</text></g><path d="M243,377.7578 L243,402.7578 L499,402.7578 L499,387.7578 L489,377.7578 L243,377.7578" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><path d="M489,377.7578 L489,387.7578 L499,387.7578 L489,377.7578" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="168.1431" x="282.7385" y="394.8247">Session Security Features</text><path d="M217,412.8906 L217,482.8906 L390,482.8906 L390,422.8906 L380,412.8906 L217,412.8906" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><path d="M380,412.8906 L380,422.8906 L390,422.8906 L380,412.8906" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="113.0771" x="223" y="429.9575">- CSRF Protection</text><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="108.8306" x="223" y="445.0903">- Secure Cookies</text><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="117.5078" x="223" y="460.2231">- Session Rotation</text><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="152.0962" x="223" y="475.356">- Timeout Management</text></g></svg></p></div></div>
<h3 id="comprehensive-session-manager-implementation">Comprehensive Session Manager Implementation<a class="headerlink" href="#comprehensive-session-manager-implementation" title="Permanent link">&para;</a></h3>
<div class="highlight python-template" data-fence-type="template" data-language="python">
<pre><code class="language-python">import hashlib
import secrets
import json
from datetime import datetime, timedelta
from typing import Dict, Optional, Any
from dataclasses import dataclass, asdict
from threading import Lock
import logging

@dataclass
class SessionData:
    &quot;&quot;&quot;Secure session data structure&quot;&quot;&quot;
    session_id: str
    user_id: str
    created_at: datetime
    last_accessed: datetime
    expires_at: datetime
    ip_address: str
    user_agent: str
    permissions: list
    is_active: bool = True
    csrf_token: str = &quot;&quot;
    login_count: int = 1

class SecureSessionManager:
    &quot;&quot;&quot;Production-ready session management with security features&quot;&quot;&quot;

    def __init__(self, session_timeout_minutes: int = 30, 
                 max_sessions_per_user: int = 5):
        self.sessions: Dict[str, SessionData] = {}
        self.user_sessions: Dict[str, list] = {}  # user_id -&gt; session_ids
        self.session_timeout = timedelta(minutes=session_timeout_minutes)
        self.max_sessions = max_sessions_per_user
        self.lock = Lock()
        self.logger = logging.getLogger(__name__)

        # Security tracking
        self.failed_logins: Dict[str, list] = {}
        self.suspicious_activity: Dict[str, dict] = {}

    def create_session(self, user_id: str, ip_address: str, 
                      user_agent: str, permissions: list) -&gt; tuple[str, str]:
        &quot;&quot;&quot;
        Create a new secure session
        Returns: (session_id, csrf_token)
        &quot;&quot;&quot;
        with self.lock:
            # Check for too many sessions per user
            if user_id in self.user_sessions:
                if len(self.user_sessions[user_id]) &gt;= self.max_sessions:
                    # Remove oldest session
                    oldest_session = self.user_sessions[user_id][0]
                    self._revoke_session_internal(oldest_session)

            # Generate cryptographically secure session ID
            session_id = secrets.token_urlsafe(32)
            csrf_token = secrets.token_urlsafe(24)

            current_time = datetime.now()

            # Create session data
            session_data = SessionData(
                session_id=session_id,
                user_id=user_id,
                created_at=current_time,
                last_accessed=current_time,
                expires_at=current_time + self.session_timeout,
                ip_address=ip_address,
                user_agent=user_agent,
                permissions=permissions,
                csrf_token=csrf_token
            )

            # Store session
            self.sessions[session_id] = session_data

            # Track user sessions
            if user_id not in self.user_sessions:
                self.user_sessions[user_id] = []
            self.user_sessions[user_id].append(session_id)

            self.logger.info(f&quot;Session created for user {user_id} from {ip_address}&quot;)

            return session_id, csrf_token

    def validate_session(self, session_id: str, ip_address: str, 
                        user_agent: str, csrf_token: str = None) -&gt; Optional[SessionData]:
        &quot;&quot;&quot;
        Validate session with security checks
        &quot;&quot;&quot;
        with self.lock:
            if session_id not in self.sessions:
                return None

            session = self.sessions[session_id]
            current_time = datetime.now()

            # Check if session is active
            if not session.is_active:
                return None

            # Check expiration
            if current_time &gt; session.expires_at:
                self._revoke_session_internal(session_id)
                return None

            # Security checks
            security_result = self._perform_security_checks(
                session, ip_address, user_agent, csrf_token
            )

            if not security_result[&quot;valid&quot;]:
                self.logger.warning(
                    f&quot;Security check failed for session {session_id}: {security_result[&#x27;reason&#x27;]}&quot;
                )
                if security_result[&quot;revoke&quot;]:
                    self._revoke_session_internal(session_id)
                return None

            # Update session activity
            session.last_accessed = current_time
            session.expires_at = current_time + self.session_timeout

            return session

    def _perform_security_checks(self, session: SessionData, ip_address: str, 
                                user_agent: str, csrf_token: str) -&gt; Dict[str, Any]:
        &quot;&quot;&quot;Perform comprehensive security validation&quot;&quot;&quot;

        # IP address validation (detect session hijacking)
        if session.ip_address != ip_address:
            # Log potential session hijacking
            self.logger.warning(
                f&quot;IP address mismatch for session {session.session_id}: &quot;
                f&quot;expected {session.ip_address}, got {ip_address}&quot;
            )
            return {&quot;valid&quot;: False, &quot;revoke&quot;: True, &quot;reason&quot;: &quot;IP address mismatch&quot;}

        # User agent validation (basic fingerprinting)
        if session.user_agent != user_agent:
            self.logger.warning(
                f&quot;User agent mismatch for session {session.session_id}&quot;
            )
            # Don&#x27;t revoke for user agent changes, but log suspicious activity
            self._track_suspicious_activity(session.user_id, &quot;user_agent_change&quot;)

        # CSRF token validation (for state-changing operations)
        if csrf_token and csrf_token != session.csrf_token:
            return {&quot;valid&quot;: False, &quot;revoke&quot;: False, &quot;reason&quot;: &quot;Invalid CSRF token&quot;}

        # Check for session fixation attacks
        session_age = datetime.now() - session.created_at
        if session_age &gt; timedelta(hours=24):  # Force re-authentication after 24 hours
            return {&quot;valid&quot;: False, &quot;revoke&quot;: True, &quot;reason&quot;: &quot;Session too old&quot;}

        return {&quot;valid&quot;: True, &quot;revoke&quot;: False, &quot;reason&quot;: &quot;Valid&quot;}

    def refresh_session(self, session_id: str) -&gt; Optional[str]:
        &quot;&quot;&quot;
        Refresh session with new ID (prevent session fixation)
        Returns new session ID if successful
        &quot;&quot;&quot;
        with self.lock:
            if session_id not in self.sessions:
                return None

            old_session = self.sessions[session_id]

            # Generate new session ID
            new_session_id = secrets.token_urlsafe(32)
            new_csrf_token = secrets.token_urlsafe(24)

            # Create new session with same data
            new_session = SessionData(
                session_id=new_session_id,
                user_id=old_session.user_id,
                created_at=datetime.now(),  # Reset creation time
                last_accessed=datetime.now(),
                expires_at=datetime.now() + self.session_timeout,
                ip_address=old_session.ip_address,
                user_agent=old_session.user_agent,
                permissions=old_session.permissions,
                csrf_token=new_csrf_token,
                login_count=old_session.login_count + 1
            )

            # Replace old session
            self.sessions[new_session_id] = new_session
            del self.sessions[session_id]

            # Update user session tracking
            user_sessions = self.user_sessions[old_session.user_id]
            user_sessions.remove(session_id)
            user_sessions.append(new_session_id)

            self.logger.info(f&quot;Session refreshed for user {old_session.user_id}&quot;)

            return new_session_id

    def revoke_session(self, session_id: str) -&gt; bool:
        &quot;&quot;&quot;Revoke a specific session&quot;&quot;&quot;
        with self.lock:
            return self._revoke_session_internal(session_id)

    def _revoke_session_internal(self, session_id: str) -&gt; bool:
        &quot;&quot;&quot;Internal session revocation (assumes lock is held)&quot;&quot;&quot;
        if session_id not in self.sessions:
            return False

        session = self.sessions[session_id]
        user_id = session.user_id

        # Remove from main storage
        del self.sessions[session_id]

        # Remove from user session tracking
        if user_id in self.user_sessions:
            if session_id in self.user_sessions[user_id]:
                self.user_sessions[user_id].remove(session_id)

            # Clean up empty user session list
            if not self.user_sessions[user_id]:
                del self.user_sessions[user_id]

        self.logger.info(f&quot;Session {session_id} revoked for user {user_id}&quot;)
        return True

    def revoke_all_user_sessions(self, user_id: str) -&gt; int:
        &quot;&quot;&quot;Revoke all sessions for a specific user&quot;&quot;&quot;
        with self.lock:
            if user_id not in self.user_sessions:
                return 0

            session_ids = self.user_sessions[user_id].copy()
            revoked_count = 0

            for session_id in session_ids:
                if self._revoke_session_internal(session_id):
                    revoked_count += 1

            self.logger.info(f&quot;Revoked {revoked_count} sessions for user {user_id}&quot;)
            return revoked_count

    def cleanup_expired_sessions(self) -&gt; int:
        &quot;&quot;&quot;Remove expired sessions (should be run periodically)&quot;&quot;&quot;
        with self.lock:
            current_time = datetime.now()
            expired_sessions = []

            for session_id, session in self.sessions.items():
                if current_time &gt; session.expires_at:
                    expired_sessions.append(session_id)

            for session_id in expired_sessions:
                self._revoke_session_internal(session_id)

            if expired_sessions:
                self.logger.info(f&quot;Cleaned up {len(expired_sessions)} expired sessions&quot;)

            return len(expired_sessions)

    def get_user_sessions(self, user_id: str) -&gt; list:
        &quot;&quot;&quot;Get all active sessions for a user&quot;&quot;&quot;
        with self.lock:
            if user_id not in self.user_sessions:
                return []

            active_sessions = []
            for session_id in self.user_sessions[user_id]:
                if session_id in self.sessions:
                    session = self.sessions[session_id]
                    active_sessions.append({
                        &#x27;session_id&#x27;: session_id,
                        &#x27;created_at&#x27;: session.created_at.isoformat(),
                        &#x27;last_accessed&#x27;: session.last_accessed.isoformat(),
                        &#x27;ip_address&#x27;: session.ip_address,
                        &#x27;user_agent&#x27;: session.user_agent[:50] + &#x27;...&#x27; if len(session.user_agent) &gt; 50 else session.user_agent
                    })

            return active_sessions

    def _track_suspicious_activity(self, user_id: str, activity_type: str):
        &quot;&quot;&quot;Track suspicious activity for security monitoring&quot;&quot;&quot;
        if user_id not in self.suspicious_activity:
            self.suspicious_activity[user_id] = {}

        if activity_type not in self.suspicious_activity[user_id]:
            self.suspicious_activity[user_id][activity_type] = []

        self.suspicious_activity[user_id][activity_type].append(datetime.now())

        # Keep only recent activity (last 24 hours)
        cutoff = datetime.now() - timedelta(hours=24)
        self.suspicious_activity[user_id][activity_type] = [
            timestamp for timestamp in self.suspicious_activity[user_id][activity_type]
            if timestamp &gt; cutoff
        ]

class SessionSecurityMiddleware:
    &quot;&quot;&quot;Middleware for secure session handling in web applications&quot;&quot;&quot;

    def __init__(self, session_manager: SecureSessionManager):
        self.session_manager = session_manager

    def generate_secure_cookie_attributes(self, session_id: str, 
                                        is_https: bool = True) -&gt; Dict[str, Any]:
        &quot;&quot;&quot;Generate secure cookie attributes for session&quot;&quot;&quot;

        cookie_attributes = {
            &#x27;httponly&#x27;: True,  # Prevent XSS access to cookies
            &#x27;secure&#x27;: is_https,  # Only send over HTTPS
            &#x27;samesite&#x27;: &#x27;Strict&#x27;,  # CSRF protection
            &#x27;max_age&#x27;: 1800,  # 30 minutes
            &#x27;path&#x27;: &#x27;/&#x27;  # Cookie available for entire domain
        }

        return cookie_attributes

    def validate_request(self, request_data: Dict[str, Any]) -&gt; Dict[str, Any]:
        &quot;&quot;&quot;Validate request with session security checks&quot;&quot;&quot;

        session_id = request_data.get(&#x27;session_id&#x27;, &#x27;&#x27;)
        ip_address = request_data.get(&#x27;ip_address&#x27;, &#x27;&#x27;)
        user_agent = request_data.get(&#x27;user_agent&#x27;, &#x27;&#x27;)
        csrf_token = request_data.get(&#x27;csrf_token&#x27;, &#x27;&#x27;)

        # Validate session
        session = self.session_manager.validate_session(
            session_id, ip_address, user_agent, csrf_token
        )

        if not session:
            return {
                &#x27;valid&#x27;: False,
                &#x27;error&#x27;: &#x27;Invalid or expired session&#x27;,
                &#x27;status_code&#x27;: 401
            }

        return {
            &#x27;valid&#x27;: True,
            &#x27;session&#x27;: session,
            &#x27;user_id&#x27;: session.user_id,
            &#x27;permissions&#x27;: session.permissions
        }

def session_management_example():
    &quot;&quot;&quot;Demonstrate secure session management&quot;&quot;&quot;

    # Initialize session manager
    session_manager = SecureSessionManager(
        session_timeout_minutes=30,
        max_sessions_per_user=3
    )

    # Create session for user login
    session_id, csrf_token = session_manager.create_session(
        user_id=&quot;user123&quot;,
        ip_address=&quot;192.168.1.100&quot;,
        user_agent=&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&quot;,
        permissions=[&quot;read&quot;, &quot;write&quot;]
    )

    print(f&quot;Session created: {session_id[:16]}...&quot;)
    print(f&quot;CSRF token: {csrf_token[:16]}...&quot;)

    # Validate session
    session = session_manager.validate_session(
        session_id=session_id,
        ip_address=&quot;192.168.1.100&quot;,
        user_agent=&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&quot;,
        csrf_token=csrf_token
    )

    if session:
        print(f&quot;Session valid for user: {session.user_id}&quot;)
        print(f&quot;Permissions: {session.permissions}&quot;)

    # Demonstrate session refresh (prevent fixation)
    new_session_id = session_manager.refresh_session(session_id)
    print(f&quot;Session refreshed: {new_session_id[:16]}...&quot;)

    # Show user&#x27;s active sessions
    active_sessions = session_manager.get_user_sessions(&quot;user123&quot;)
    print(f&quot;Active sessions for user: {len(active_sessions)}&quot;)

    # Clean up
    session_manager.revoke_all_user_sessions(&quot;user123&quot;)
    print(&quot;All user sessions revoked&quot;)

if __name__ == &quot;__main__&quot;:
    session_management_example()
</code></pre>
</div>
<h2 id="cors-and-cross-origin-security">CORS and Cross-Origin Security<a class="headerlink" href="#cors-and-cross-origin-security" title="Permanent link">&para;</a></h2>
<p>Cross-Origin Resource Sharing (CORS) is a critical security mechanism that controls how web applications can access resources from different domains.</p>
<h3 id="understanding-cors-security-model">Understanding CORS Security Model<a class="headerlink" href="#understanding-cors-security-model" title="Permanent link">&para;</a></h3>
<div class="diagram-container" data-container-id="kroki-diagram-2"><button class="diagram-expand-btn" onclick="openDiagramModal('kroki-diagram-2')">🔍 View Larger</button><div id="kroki-diagram-2" class="diagram-content"><p><svg xmlns="http://www.w3.org/2000/svg" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="745px" preserveAspectRatio="xMaxYMax meet" style="width:565px;height:745px;background:#FFFFFF;" version="1.1" viewBox="0 0 565 745" width="565px" zoomAndPan="magnify" id="Kroki" data-diagram-id="kroki-svg-2"><defs /><g><rect fill="#FFFFFF" height="309.3984" style="stroke:#000000;stroke-width:1;" width="486.0713" x="30" y="367.1875" /><rect fill="#FFFFFF" height="130.3359" style="stroke:none;stroke-width:1;" width="486.0713" x="30" y="546.25" /><g><title>Web Browser</title><rect fill="#000000" fill-opacity="0.00000" height="640.9922" width="8" x="99.416" y="52.5938" /><line style="stroke:#000000;stroke-width:1;" x1="103" x2="103" y1="52.5938" y2="693.5859" /></g><g><title>Client App</title><rect fill="#000000" fill-opacity="0.00000" height="640.9922" width="8" x="266.9531" y="52.5938" /><line style="stroke:#000000;stroke-width:1;" x1="270.0635" x2="270.0635" y1="52.5938" y2="693.5859" /></g><g><title>API Server</title><rect fill="#000000" fill-opacity="0.00000" height="640.9922" width="8" x="424.457" y="52.5938" /><line style="stroke:#000000;stroke-width:1;" x1="427.8428" x2="427.8428" y1="52.5938" y2="693.5859" /></g><g class="participant participant-head" data-participant="Browser"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="106.832" x="50" y="21.2969" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="92.832" x="57" y="41.292">Web Browser</text></g><g class="participant participant-tail" data-participant="Browser"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="106.832" x="50" y="692.5859" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="92.832" x="57" y="712.5811">Web Browser</text></g><g class="participant participant-head" data-participant="Client"><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="119.7793" x="211.0635" y="5" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="72.3311" x="234.7876" y="24.9951">Client App</text><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="105.7793" x="218.0635" y="41.292">(example.com)</text></g><g class="participant participant-tail" data-participant="Client"><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="119.7793" x="211.0635" y="692.5859" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="72.3311" x="234.7876" y="712.5811">Client App</text><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="105.7793" x="218.0635" y="728.8779">(example.com)</text></g><g class="participant participant-head" data-participant="API"><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="135.2285" x="360.8428" y="5" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="72.5088" x="392.2026" y="24.9951">API Server</text><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="121.2285" x="367.8428" y="41.292">(api.service.com)</text></g><g class="participant participant-tail" data-participant="API"><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="135.2285" x="360.8428" y="692.5859" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="72.5088" x="392.2026" y="712.5811">API Server</text><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="121.2285" x="367.8428" y="728.8779">(api.service.com)</text></g><g class="message" data-participant-1="Browser" data-participant-2="Client"><polygon fill="#000000" points="258.9531,79.7266,268.9531,83.7266,258.9531,87.7266,262.9531,83.7266" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="103.416" x2="264.9531" y1="83.7266" y2="83.7266" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="107.2563" x="110.416" y="78.6606">Load application</text></g><g class="message" data-participant-1="Client" data-participant-2="Browser"><polygon fill="#000000" points="114.416,123.9922,104.416,127.9922,114.416,131.9922,110.416,127.9922" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="108.416" x2="269.9531" y1="127.9922" y2="127.9922" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="130.4253" x="120.416" y="107.7935">Make API request to</text><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="96.8398" x="120.416" y="122.9263">different origin</text></g><path d="M10,140.9922 L10,165.9922 L197,165.9922 L197,150.9922 L187,140.9922 L10,140.9922" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><path d="M187,140.9922 L187,150.9922 L197,150.9922 L187,140.9922" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="166.9751" x="16" y="158.0591">Same-Origin Policy Check</text><g class="message" data-participant-1="Browser" data-participant-2="Browser"><line style="stroke:#000000;stroke-width:1;" x1="103.416" x2="145.416" y1="222.5234" y2="222.5234" /><line style="stroke:#000000;stroke-width:1;" x1="145.416" x2="145.416" y1="222.5234" y2="235.5234" /><line style="stroke:#000000;stroke-width:1;" x1="104.416" x2="145.416" y1="235.5234" y2="235.5234" /><polygon fill="#000000" points="114.416,231.5234,104.416,235.5234,114.416,239.5234,110.416,235.5234" style="stroke:#000000;stroke-width:1;" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="135.8843" x="110.416" y="187.1919">Origin: example.com</text><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="153.5371" x="110.416" y="202.3247">Target: api.service.com</text><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="120.7261" x="110.416" y="217.4575">(Different origins!)</text></g><g class="message" data-participant-1="Browser" data-participant-2="API"><polygon fill="#000000" points="416.457,290.9219,426.457,294.9219,416.457,298.9219,420.457,294.9219" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="103.416" x2="422.457" y1="294.9219" y2="294.9219" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="120.104" x="110.416" y="259.5903">Preflight REQUEST</text><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="120.0596" x="110.416" y="274.7231">OPTIONS /api/data</text><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="135.8843" x="110.416" y="289.856">Origin: example.com</text></g><g class="message" data-participant-1="API" data-participant-2="API"><line style="stroke:#000000;stroke-width:1;" x1="428.457" x2="470.457" y1="339.1875" y2="339.1875" /><line style="stroke:#000000;stroke-width:1;" x1="470.457" x2="470.457" y1="339.1875" y2="352.1875" /><line style="stroke:#000000;stroke-width:1;" x1="429.457" x2="470.457" y1="352.1875" y2="352.1875" /><polygon fill="#000000" points="439.457,348.1875,429.457,352.1875,439.457,356.1875,435.457,352.1875" style="stroke:#000000;stroke-width:1;" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="123.1191" x="435.457" y="318.9888">Check CORS policy</text><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="110.0874" x="435.457" y="334.1216">for example.com</text></g><path d="M30,367.1875 L94.4429,367.1875 L94.4429,374.3203 L84.4429,384.3203 L30,384.3203 L30,367.1875" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><rect fill="none" height="309.3984" style="stroke:#000000;stroke-width:1;" width="486.0713" x="30" y="367.1875" /><text fill="#000000" font-family="Arial" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="45" y="380.2544">alt</text><text fill="#000000" font-family="Arial" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="96.8086" x="109.4429" y="379.3979">[CORS Allowed]</text><g class="message" data-participant-1="API" data-participant-2="Browser"><polygon fill="#000000" points="114.416,431.7188,104.416,435.7188,114.416,439.7188,110.416,435.7188" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="108.416" x2="427.457" y1="435.7188" y2="435.7188" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="47.7026" x="120.416" y="400.3872">200 OK</text><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="276.6689" x="120.416" y="415.52">Access-Control-Allow-Origin: example.com</text><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="273.584" x="120.416" y="430.6528">Access-Control-Allow-Methods: GET, POST</text></g><g class="message" data-participant-1="Browser" data-participant-2="API"><polygon fill="#000000" points="416.457,475.9844,426.457,479.9844,416.457,483.9844,420.457,479.9844" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="103.416" x2="422.457" y1="479.9844" y2="479.9844" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="106.4883" x="110.416" y="459.7856">Actual REQUEST</text><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="88.2324" x="110.416" y="474.9185">GET /api/data</text></g><g class="message" data-participant-1="API" data-participant-2="Browser"><polygon fill="#000000" points="114.416,505.1172,104.416,509.1172,114.416,513.1172,110.416,509.1172" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="108.416" x2="427.457" y1="509.1172" y2="509.1172" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="97.8999" x="120.416" y="504.0513">200 OK + Data</text></g><g class="message" data-participant-1="Browser" data-participant-2="Client"><polygon fill="#000000" points="258.9531,534.25,268.9531,538.25,258.9531,542.25,262.9531,538.25" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="103.416" x2="264.9531" y1="538.25" y2="538.25" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="115.7939" x="110.416" y="533.1841">Success response</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="30" x2="516.0713" y1="547.25" y2="547.25" /><text fill="#000000" font-family="Arial" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="91.228" x="35" y="557.4604">[CORS Denied]</text><g class="message" data-participant-1="API" data-participant-2="Browser"><polygon fill="#000000" points="114.416,593.3203,104.416,597.3203,114.416,601.3203,110.416,597.3203" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="108.416" x2="427.457" y1="597.3203" y2="597.3203" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="94.3262" x="120.416" y="577.1216">403 Forbidden</text><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="125.252" x="120.416" y="592.2544">(No CORS headers)</text></g><g class="message" data-participant-1="Browser" data-participant-2="Browser"><line style="stroke:#000000;stroke-width:1;" x1="103.416" x2="145.416" y1="626.4531" y2="626.4531" /><line style="stroke:#000000;stroke-width:1;" x1="145.416" x2="145.416" y1="626.4531" y2="639.4531" /><line style="stroke:#000000;stroke-width:1;" x1="104.416" x2="145.416" y1="639.4531" y2="639.4531" /><polygon fill="#000000" points="114.416,635.4531,104.416,639.4531,114.416,643.4531,110.416,639.4531" style="stroke:#000000;stroke-width:1;" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="98.6235" x="110.416" y="621.3872">Block response</text></g><g class="message" data-participant-1="Browser" data-participant-2="Client"><polygon fill="#000000" points="258.9531,664.5859,268.9531,668.5859,258.9531,672.5859,262.9531,668.5859" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="103.416" x2="264.9531" y1="668.5859" y2="668.5859" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="72.9282" x="110.416" y="663.52">CORS Error</text></g></g></svg></p></div></div>
<h3 id="comprehensive-cors-implementation">Comprehensive CORS Implementation<a class="headerlink" href="#comprehensive-cors-implementation" title="Permanent link">&para;</a></h3>
<div class="highlight python-template" data-fence-type="template" data-language="python">
<pre><code class="language-python">from typing import Dict, List, Optional, Union
import re
from urllib.parse import urlparse
from dataclasses import dataclass

@dataclass
class CORSPolicy:
    &quot;&quot;&quot;CORS policy configuration&quot;&quot;&quot;
    allowed_origins: List[str]
    allowed_methods: List[str]
    allowed_headers: List[str]
    exposed_headers: List[str]
    allow_credentials: bool
    max_age: int  # Preflight cache duration in seconds

class CORSManager:
    &quot;&quot;&quot;Production-ready CORS management with security features&quot;&quot;&quot;

    def __init__(self):
        self.policies: Dict[str, CORSPolicy] = {}
        self.default_policy: Optional[CORSPolicy] = None

        # Security patterns
        self.dangerous_origins = [
            r&#x27;.*\.evil\.com$&#x27;,
            r&#x27;.*malicious.*&#x27;,
            r&#x27;file://&#x27;,  # Block file:// origins
            r&#x27;data:&#x27;,    # Block data: origins
        ]

    def add_policy(self, policy_name: str, policy: CORSPolicy):
        &quot;&quot;&quot;Add a named CORS policy&quot;&quot;&quot;
        self.policies[policy_name] = policy

    def set_default_policy(self, policy: CORSPolicy):
        &quot;&quot;&quot;Set default CORS policy&quot;&quot;&quot;
        self.default_policy = policy

    def create_secure_policy(self, allowed_origins: List[str], 
                           allow_credentials: bool = False) -&gt; CORSPolicy:
        &quot;&quot;&quot;Create a secure CORS policy with safe defaults&quot;&quot;&quot;

        # Validate origins for security
        validated_origins = []
        for origin in allowed_origins:
            if self._is_safe_origin(origin):
                validated_origins.append(origin)
            else:
                print(f&quot;Warning: Potentially unsafe origin blocked: {origin}&quot;)

        return CORSPolicy(
            allowed_origins=validated_origins,
            allowed_methods=[&#x27;GET&#x27;, &#x27;POST&#x27;, &#x27;PUT&#x27;, &#x27;DELETE&#x27;, &#x27;OPTIONS&#x27;],
            allowed_headers=[
                &#x27;Content-Type&#x27;,
                &#x27;Authorization&#x27;, 
                &#x27;X-Requested-With&#x27;,
                &#x27;X-CSRF-Token&#x27;
            ],
            exposed_headers=[&#x27;X-Total-Count&#x27;, &#x27;X-Page-Count&#x27;],
            allow_credentials=allow_credentials,
            max_age=86400  # 24 hours
        )

    def _is_safe_origin(self, origin: str) -&gt; bool:
        &quot;&quot;&quot;Validate origin against security patterns&quot;&quot;&quot;

        # Check against dangerous patterns
        for pattern in self.dangerous_origins:
            if re.match(pattern, origin, re.IGNORECASE):
                return False

        # Validate URL format
        try:
            parsed = urlparse(origin)
            if not parsed.scheme or not parsed.netloc:
                return False

            # Only allow HTTP/HTTPS
            if parsed.scheme not in [&#x27;http&#x27;, &#x27;https&#x27;]:
                return False

        except Exception:
            return False

        return True

    def handle_preflight_request(self, origin: str, method: str, 
                                headers: List[str], policy_name: str = None) -&gt; Dict[str, str]:
        &quot;&quot;&quot;Handle CORS preflight request&quot;&quot;&quot;

        # Get applicable policy
        policy = self._get_policy(policy_name)
        if not policy:
            return self._create_cors_denial()

        # Validate origin
        if not self._is_origin_allowed(origin, policy):
            return self._create_cors_denial()

        # Validate method
        if method.upper() not in policy.allowed_methods:
            return self._create_cors_denial()

        # Validate headers
        for header in headers:
            if not self._is_header_allowed(header, policy):
                return self._create_cors_denial()

        # Create successful preflight response
        response_headers = {
            &#x27;Access-Control-Allow-Origin&#x27;: self._get_origin_response(origin, policy),
            &#x27;Access-Control-Allow-Methods&#x27;: &#x27;, &#x27;.join(policy.allowed_methods),
            &#x27;Access-Control-Allow-Headers&#x27;: &#x27;, &#x27;.join(policy.allowed_headers),
            &#x27;Access-Control-Max-Age&#x27;: str(policy.max_age),
            &#x27;Vary&#x27;: &#x27;Origin&#x27;  # Important for caching
        }

        if policy.allow_credentials:
            response_headers[&#x27;Access-Control-Allow-Credentials&#x27;] = &#x27;true&#x27;

        return response_headers

    def handle_actual_request(self, origin: str, policy_name: str = None) -&gt; Dict[str, str]:
        &quot;&quot;&quot;Handle actual CORS request&quot;&quot;&quot;

        # Get applicable policy
        policy = self._get_policy(policy_name)
        if not policy:
            return self._create_cors_denial()

        # Validate origin
        if not self._is_origin_allowed(origin, policy):
            return self._create_cors_denial()

        # Create response headers
        response_headers = {
            &#x27;Access-Control-Allow-Origin&#x27;: self._get_origin_response(origin, policy),
            &#x27;Vary&#x27;: &#x27;Origin&#x27;
        }

        if policy.exposed_headers:
            response_headers[&#x27;Access-Control-Expose-Headers&#x27;] = &#x27;, &#x27;.join(policy.exposed_headers)

        if policy.allow_credentials:
            response_headers[&#x27;Access-Control-Allow-Credentials&#x27;] = &#x27;true&#x27;

        return response_headers

    def _get_policy(self, policy_name: str = None) -&gt; Optional[CORSPolicy]:
        &quot;&quot;&quot;Get policy by name or default&quot;&quot;&quot;
        if policy_name and policy_name in self.policies:
            return self.policies[policy_name]
        return self.default_policy

    def _is_origin_allowed(self, origin: str, policy: CORSPolicy) -&gt; bool:
        &quot;&quot;&quot;Check if origin is allowed by policy&quot;&quot;&quot;

        if not origin:
            return False

        # Check exact matches and wildcards
        for allowed_origin in policy.allowed_origins:
            if allowed_origin == &#x27;*&#x27;:
                # Wildcard only allowed if credentials are disabled
                return not policy.allow_credentials
            elif allowed_origin == origin:
                return True
            elif self._match_origin_pattern(origin, allowed_origin):
                return True

        return False

    def _match_origin_pattern(self, origin: str, pattern: str) -&gt; bool:
        &quot;&quot;&quot;Match origin against pattern (supports simple wildcards)&quot;&quot;&quot;

        # Convert simple wildcard pattern to regex
        if &#x27;*&#x27; in pattern:
            regex_pattern = pattern.replace(&#x27;*&#x27;, r&#x27;[^.]*&#x27;)
            regex_pattern = regex_pattern.replace(&#x27;.&#x27;, r&#x27;\.&#x27;)
            return bool(re.match(f&#x27;^{regex_pattern}$&#x27;, origin))

        return origin == pattern

    def _is_header_allowed(self, header: str, policy: CORSPolicy) -&gt; bool:
        &quot;&quot;&quot;Check if header is allowed&quot;&quot;&quot;

        # Case-insensitive header comparison
        header_lower = header.lower()
        allowed_headers_lower = [h.lower() for h in policy.allowed_headers]

        return header_lower in allowed_headers_lower

    def _get_origin_response(self, origin: str, policy: CORSPolicy) -&gt; str:
        &quot;&quot;&quot;Get appropriate origin response value&quot;&quot;&quot;

        # If credentials are allowed, must echo exact origin (not wildcard)
        if policy.allow_credentials:
            return origin

        # Check if wildcard is in allowed origins
        if &#x27;*&#x27; in policy.allowed_origins:
            return &#x27;*&#x27;

        return origin

    def _create_cors_denial(self) -&gt; Dict[str, str]:
        &quot;&quot;&quot;Create CORS denial response (empty headers)&quot;&quot;&quot;
        return {}

class CORSSecurityMiddleware:
    &quot;&quot;&quot;CORS security middleware for web applications&quot;&quot;&quot;

    def __init__(self, cors_manager: CORSManager):
        self.cors_manager = cors_manager

    def process_request(self, request_data: Dict[str, str], 
                       policy_name: str = None) -&gt; Dict[str, Union[str, int, Dict]]:
        &quot;&quot;&quot;Process request with CORS handling&quot;&quot;&quot;

        origin = request_data.get(&#x27;origin&#x27;, &#x27;&#x27;)
        method = request_data.get(&#x27;method&#x27;, &#x27;GET&#x27;)

        # Handle preflight requests
        if method.upper() == &#x27;OPTIONS&#x27;:
            requested_method = request_data.get(&#x27;access_control_request_method&#x27;, &#x27;&#x27;)
            requested_headers = request_data.get(&#x27;access_control_request_headers&#x27;, &#x27;&#x27;).split(&#x27;,&#x27;)
            requested_headers = [h.strip() for h in requested_headers if h.strip()]

            cors_headers = self.cors_manager.handle_preflight_request(
                origin=origin,
                method=requested_method,
                headers=requested_headers,
                policy_name=policy_name
            )

            if not cors_headers:
                return {
                    &#x27;status_code&#x27;: 403,
                    &#x27;error&#x27;: &#x27;CORS policy violation&#x27;,
                    &#x27;headers&#x27;: {}
                }

            return {
                &#x27;status_code&#x27;: 200,
                &#x27;headers&#x27;: cors_headers
            }

        # Handle actual requests
        cors_headers = self.cors_manager.handle_actual_request(
            origin=origin,
            policy_name=policy_name
        )

        if not cors_headers:
            return {
                &#x27;status_code&#x27;: 403,
                &#x27;error&#x27;: &#x27;CORS policy violation&#x27;,
                &#x27;headers&#x27;: {}
            }

        return {
            &#x27;status_code&#x27;: 200,
            &#x27;headers&#x27;: cors_headers
        }

def cors_security_example():
    &quot;&quot;&quot;Demonstrate CORS security implementation&quot;&quot;&quot;

    # Initialize CORS manager
    cors_manager = CORSManager()

    # Create secure policies for different environments

    # Development policy (more permissive)
    dev_policy = cors_manager.create_secure_policy(
        allowed_origins=[
            &#x27;http://localhost:3000&#x27;,
            &#x27;http://localhost:8080&#x27;,
            &#x27;http://127.0.0.1:3000&#x27;
        ],
        allow_credentials=True
    )

    # Production policy (restrictive)
    prod_policy = cors_manager.create_secure_policy(
        allowed_origins=[
            &#x27;https://myapp.com&#x27;,
            &#x27;https://www.myapp.com&#x27;,
            &#x27;https://admin.myapp.com&#x27;
        ],
        allow_credentials=True
    )

    # Public API policy (no credentials)
    public_policy = CORSPolicy(
        allowed_origins=[&#x27;*&#x27;],
        allowed_methods=[&#x27;GET&#x27;, &#x27;OPTIONS&#x27;],
        allowed_headers=[&#x27;Content-Type&#x27;],
        exposed_headers=[&#x27;X-Rate-Limit-Remaining&#x27;],
        allow_credentials=False,
        max_age=3600
    )

    # Register policies
    cors_manager.add_policy(&#x27;development&#x27;, dev_policy)
    cors_manager.add_policy(&#x27;production&#x27;, prod_policy)
    cors_manager.add_policy(&#x27;public&#x27;, public_policy)
    cors_manager.set_default_policy(prod_policy)

    # Create middleware
    cors_middleware = CORSSecurityMiddleware(cors_manager)

    # Simulate preflight request
    preflight_request = {
        &#x27;origin&#x27;: &#x27;https://myapp.com&#x27;,
        &#x27;method&#x27;: &#x27;OPTIONS&#x27;,
        &#x27;access_control_request_method&#x27;: &#x27;POST&#x27;,
        &#x27;access_control_request_headers&#x27;: &#x27;Content-Type, Authorization&#x27;
    }

    result = cors_middleware.process_request(preflight_request, &#x27;production&#x27;)
    print(f&quot;Preflight result: {result}&quot;)

    # Simulate actual request
    actual_request = {
        &#x27;origin&#x27;: &#x27;https://myapp.com&#x27;,
        &#x27;method&#x27;: &#x27;POST&#x27;
    }

    result = cors_middleware.process_request(actual_request, &#x27;production&#x27;)
    print(f&quot;Actual request result: {result}&quot;)

    # Test blocked origin
    blocked_request = {
        &#x27;origin&#x27;: &#x27;https://malicious-site.com&#x27;,
        &#x27;method&#x27;: &#x27;GET&#x27;
    }

    result = cors_middleware.process_request(blocked_request, &#x27;production&#x27;)
    print(f&quot;Blocked request result: {result}&quot;)

if __name__ == &quot;__main__&quot;:
    cors_security_example()
</code></pre>
</div>
<h2 id="api-security-testing">API Security Testing<a class="headerlink" href="#api-security-testing" title="Permanent link">&para;</a></h2>
<p>Security testing is essential for identifying vulnerabilities in API implementations before they can be exploited by attackers.</p>
<h3 id="security-testing-methodology">Security Testing Methodology<a class="headerlink" href="#security-testing-methodology" title="Permanent link">&para;</a></h3>
<div class="diagram-container" data-container-id="kroki-diagram-3"><button class="diagram-expand-btn" onclick="openDiagramModal('kroki-diagram-3')">🔍 View Larger</button><div id="kroki-diagram-3" class="diagram-content"><p><svg xmlns="http://www.w3.org/2000/svg" contentStyleType="text/css" data-diagram-type="ACTIVITY" height="452px" preserveAspectRatio="xMaxYMax meet" style="width:1351px;height:452px;background:#FFFFFF;" version="1.1" viewBox="0 0 1351 452" width="1351px" zoomAndPan="magnify" id="Kroki" data-diagram-id="kroki-svg-3"><defs /><g><ellipse cx="675.3723" cy="15" fill="#FFFFFF" rx="10" ry="10" style="stroke:#000000;stroke-width:1;" /><path d="M754.2278,41.8516 L754.2278,57.9844 L734.2278,61.9844 L754.2278,65.9844 L754.2278,82.1172 A0,0 0 0 0 754.2278,82.1172 L947.4143,82.1172 A0,0 0 0 0 947.4143,82.1172 L947.4143,51.8516 L937.4143,41.8516 L754.2278,41.8516 A0,0 0 0 0 754.2278,41.8516" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><path d="M937.4143,41.8516 L937.4143,51.8516 L947.4143,51.8516 L937.4143,41.8516" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="146.377" x="760.2278" y="58.9185">Identify attack vectors</text><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="172.1865" x="760.2278" y="74.0513">and security requirements</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="117.7109" x="616.5168" y="45" /><text fill="#000000" font-family="Arial" font-size="12" lengthAdjust="spacing" textLength="97.7109" x="626.5168" y="66.1387">Threat Modeling</text><path d="M749.1565,98.9688 L749.1565,115.1016 L729.1565,119.1016 L749.1565,123.1016 L749.1565,139.2344 A0,0 0 0 0 749.1565,139.2344 L914.9275,139.2344 A0,0 0 0 0 914.9275,139.2344 L914.9275,108.9688 L904.9275,98.9688 L749.1565,98.9688 A0,0 0 0 0 749.1565,98.9688" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><path d="M904.9275,98.9688 L904.9275,108.9688 L914.9275,108.9688 L904.9275,98.9688" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="80.6914" x="755.1565" y="116.0356">Code review</text><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="144.771" x="755.1565" y="131.1685">Vulnerability scanning</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="107.5684" x="621.5881" y="102.1172" /><text fill="#000000" font-family="Arial" font-size="12" lengthAdjust="spacing" textLength="87.5684" x="631.5881" y="123.2559">Static Analysis</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="120.9629" x="614.8909" y="159.2344" /><text fill="#000000" font-family="Arial" font-size="12" lengthAdjust="spacing" textLength="100.9629" x="624.8909" y="180.373">Dynamic Testing</text><line style="stroke:#000000;stroke-width:1.5;" x1="84.0654" x2="1093.3447" y1="213.2031" y2="213.2031" /><path d="M182.1309,230.0547 L182.1309,246.1875 L162.1309,250.1875 L182.1309,254.1875 L182.1309,270.3203 A0,0 0 0 0 182.1309,270.3203 L343.9473,270.3203 A0,0 0 0 0 343.9473,270.3203 L343.9473,240.0547 L333.9473,230.0547 L182.1309,230.0547 A0,0 0 0 0 182.1309,230.0547" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><path d="M333.9473,230.0547 L333.9473,240.0547 L343.9473,240.0547 L333.9473,230.0547" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="107.7959" x="188.1309" y="247.1216">Token validation</text><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="140.8164" x="188.1309" y="262.2544">Session management</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="156.1309" x="6" y="233.2031" /><text fill="#000000" font-family="Arial" font-size="12" lengthAdjust="spacing" textLength="136.1309" x="16" y="254.3418">Authentication Testing</text><path d="M522.3613,230.0547 L522.3613,246.1875 L502.3613,250.1875 L522.3613,254.1875 L522.3613,270.3203 A0,0 0 0 0 522.3613,270.3203 L669.8193,270.3203 A0,0 0 0 0 669.8193,270.3203 L669.8193,240.0547 L659.8193,230.0547 L522.3613,230.0547 A0,0 0 0 0 522.3613,230.0547" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><path d="M659.8193,230.0547 L659.8193,240.0547 L669.8193,240.0547 L659.8193,230.0547" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="100.9849" x="528.3613" y="247.1216">Access controls</text><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="126.458" x="528.3613" y="262.2544">Privilege escalation</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="148.4141" x="353.9473" y="233.2031" /><text fill="#000000" font-family="Arial" font-size="12" lengthAdjust="spacing" textLength="128.4141" x="363.9473" y="254.3418">Authorization Testing</text><path d="M880.9346,230.0547 L880.9346,246.1875 L860.9346,250.1875 L880.9346,254.1875 L880.9346,270.3203 A0,0 0 0 0 880.9346,270.3203 L1009.375,270.3203 A0,0 0 0 0 1009.375,270.3203 L1009.375,240.0547 L999.375,230.0547 L880.9346,230.0547 A0,0 0 0 0 880.9346,230.0547" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><path d="M999.375,230.0547 L999.375,240.0547 L1009.375,240.0547 L999.375,230.0547" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="107.4404" x="886.9346" y="247.1216">Injection attacks</text><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="99.1758" x="886.9346" y="262.2544">Data validation</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="163.1152" x="697.8193" y="233.2031" /><text fill="#000000" font-family="Arial" font-size="12" lengthAdjust="spacing" textLength="143.1152" x="707.8193" y="254.3418">Input Validation Testing</text><path d="M1187.3145,230.0547 L1187.3145,246.1875 L1167.3145,250.1875 L1187.3145,254.1875 L1187.3145,270.3203 A0,0 0 0 0 1187.3145,270.3203 L1344.7446,270.3203 A0,0 0 0 0 1344.7446,270.3203 L1344.7446,240.0547 L1334.7446,230.0547 L1187.3145,230.0547 A0,0 0 0 0 1187.3145,230.0547" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><path d="M1334.7446,230.0547 L1334.7446,240.0547 L1344.7446,240.0547 L1334.7446,230.0547" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="97.043" x="1193.3145" y="247.1216">DoS protection</text><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="136.4302" x="1193.3145" y="262.2544">Resource exhaustion</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="147.9395" x="1019.375" y="233.2031" /><text fill="#000000" font-family="Arial" font-size="12" lengthAdjust="spacing" textLength="127.9395" x="1029.375" y="254.3418">Rate Limiting Testing</text><line style="stroke:#000000;stroke-width:1.5;" x1="84.0654" x2="1093.3447" y1="290.3203" y2="290.3203" /><path d="M764.1858,307.1719 L764.1858,323.3047 L744.1858,327.3047 L764.1858,331.3047 L764.1858,347.4375 A0,0 0 0 0 764.1858,347.4375 L920.2195,347.4375 A0,0 0 0 0 920.2195,347.4375 L920.2195,317.1719 L910.2195,307.1719 L764.1858,307.1719 A0,0 0 0 0 764.1858,307.1719" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><path d="M910.2195,307.1719 L910.2195,317.1719 L920.2195,317.1719 L910.2195,307.1719" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="128.4575" x="770.1858" y="324.2388">Manual exploitation</text><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="135.0337" x="770.1858" y="339.3716">Real-world scenarios</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="137.627" x="606.5588" y="310.3203" /><text fill="#000000" font-family="Arial" font-size="12" lengthAdjust="spacing" textLength="117.627" x="616.5588" y="331.459">Penetration Testing</text><path d="M789.1584,364.2891 L789.1584,380.4219 L769.1584,384.4219 L789.1584,388.4219 L789.1584,404.5547 A0,0 0 0 0 789.1584,404.5547 L938.3557,404.5547 A0,0 0 0 0 938.3557,404.5547 L938.3557,374.2891 L928.3557,364.2891 L789.1584,364.2891 A0,0 0 0 0 789.1584,364.2891" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><path d="M928.3557,364.2891 L928.3557,374.2891 L938.3557,374.2891 L928.3557,364.2891" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="128.1973" x="795.1584" y="381.356">Automated security</text><text fill="#000000" font-family="Arial" font-size="13" lengthAdjust="spacing" textLength="60.8169" x="795.1584" y="396.4888">test suite</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="187.5723" x="581.5862" y="367.4375" /><text fill="#000000" font-family="Arial" font-size="12" lengthAdjust="spacing" textLength="167.5723" x="591.5862" y="388.5762">Security Regression Testing</text><ellipse cx="675.3723" cy="435.5547" fill="none" rx="11" ry="11" style="stroke:#000000;stroke-width:1;" /><ellipse cx="675.3723" cy="435.5547" fill="#FFFFFF" rx="6" ry="6" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="675.3723" x2="675.3723" y1="25" y2="45" /><polygon fill="#000000" points="671.3723,35,675.3723,45,679.3723,35,675.3723,39" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="675.3723" x2="675.3723" y1="78.9688" y2="102.1172" /><polygon fill="#000000" points="671.3723,92.1172,675.3723,102.1172,679.3723,92.1172,675.3723,96.1172" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="675.3723" x2="675.3723" y1="136.0859" y2="159.2344" /><polygon fill="#000000" points="671.3723,149.2344,675.3723,159.2344,679.3723,149.2344,675.3723,153.2344" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="84.0654" x2="84.0654" y1="214.7031" y2="233.2031" /><polygon fill="#000000" points="80.0654,223.2031,84.0654,233.2031,88.0654,223.2031,84.0654,227.2031" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="428.1543" x2="428.1543" y1="214.7031" y2="233.2031" /><polygon fill="#000000" points="424.1543,223.2031,428.1543,233.2031,432.1543,223.2031,428.1543,227.2031" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="779.377" x2="779.377" y1="214.7031" y2="233.2031" /><polygon fill="#000000" points="775.377,223.2031,779.377,233.2031,783.377,223.2031,779.377,227.2031" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="1093.3447" x2="1093.3447" y1="214.7031" y2="233.2031" /><polygon fill="#000000" points="1089.3447,223.2031,1093.3447,233.2031,1097.3447,223.2031,1093.3447,227.2031" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="84.0654" x2="84.0654" y1="267.1719" y2="290.3203" /><polygon fill="#000000" points="80.0654,280.3203,84.0654,290.3203,88.0654,280.3203,84.0654,284.3203" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="428.1543" x2="428.1543" y1="267.1719" y2="290.3203" /><polygon fill="#000000" points="424.1543,280.3203,428.1543,290.3203,432.1543,280.3203,428.1543,284.3203" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="779.377" x2="779.377" y1="267.1719" y2="290.3203" /><polygon fill="#000000" points="775.377,280.3203,779.377,290.3203,783.377,280.3203,779.377,284.3203" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="1093.3447" x2="1093.3447" y1="267.1719" y2="290.3203" /><polygon fill="#000000" points="1089.3447,280.3203,1093.3447,290.3203,1097.3447,280.3203,1093.3447,284.3203" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="675.3723" x2="675.3723" y1="193.2031" y2="213.2031" /><polygon fill="#000000" points="671.3723,203.2031,675.3723,213.2031,679.3723,203.2031,675.3723,207.2031" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="675.3723" x2="675.3723" y1="291.8203" y2="310.3203" /><polygon fill="#000000" points="671.3723,300.3203,675.3723,310.3203,679.3723,300.3203,675.3723,304.3203" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="675.3723" x2="675.3723" y1="344.2891" y2="367.4375" /><polygon fill="#000000" points="671.3723,357.4375,675.3723,367.4375,679.3723,357.4375,675.3723,361.4375" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="675.3723" x2="675.3723" y1="401.4063" y2="424.5547" /><polygon fill="#000000" points="671.3723,414.5547,675.3723,424.5547,679.3723,414.5547,675.3723,418.5547" style="stroke:#000000;stroke-width:1;" /></g></svg></p></div></div>
<h3 id="automated-security-testing-framework">Automated Security Testing Framework<a class="headerlink" href="#automated-security-testing-framework" title="Permanent link">&para;</a></h3>
<div class="highlight python-template" data-fence-type="template" data-language="python">
<pre><code class="language-python">import requests
import json
import time
import random
import string
from typing import Dict, List, Any, Optional, Callable
from dataclasses import dataclass
from concurrent.futures import ThreadPoolExecutor, as_completed
import logging
from urllib.parse import urljoin, urlparse

@dataclass
class SecurityTestResult:
    &quot;&quot;&quot;Result of a security test&quot;&quot;&quot;
    test_name: str
    endpoint: str
    method: str
    passed: bool
    severity: str  # &#x27;low&#x27;, &#x27;medium&#x27;, &#x27;high&#x27;, &#x27;critical&#x27;
    description: str
    details: Dict[str, Any]
    remediation: str

@dataclass
class APIEndpoint:
    &quot;&quot;&quot;API endpoint configuration for testing&quot;&quot;&quot;
    path: str
    method: str
    auth_required: bool
    parameters: Dict[str, str]
    expected_status: int

class APISecurityTester:
    &quot;&quot;&quot;Comprehensive API security testing framework&quot;&quot;&quot;

    def __init__(self, base_url: str, timeout: int = 30):
        self.base_url = base_url.rstrip(&#x27;/&#x27;)
        self.timeout = timeout
        self.session = requests.Session()
        self.results: List[SecurityTestResult] = []
        self.logger = logging.getLogger(__name__)

        # Common payloads for injection testing
        self.sql_injection_payloads = [
            &quot;&#x27; OR &#x27;1&#x27;=&#x27;1&quot;,
            &quot;&#x27;; DROP TABLE users;--&quot;,
            &quot;1&#x27; UNION SELECT NULL,username,password FROM users--&quot;,
            &quot;admin&#x27;--&quot;,
            &quot;&#x27; OR 1=1#&quot;
        ]

        self.xss_payloads = [
            &quot;&lt;script&gt;alert(&#x27;XSS&#x27;)&lt;/script&gt;&quot;,
            &quot;javascript:alert(&#x27;XSS&#x27;)&quot;,
            &quot;&lt;img src=x onerror=alert(&#x27;XSS&#x27;)&gt;&quot;,
            &quot;&#x27;;alert(&#x27;XSS&#x27;);//&quot;,
            &quot;&lt;svg onload=alert(&#x27;XSS&#x27;)&gt;&quot;
        ]

        self.path_traversal_payloads = [
            &quot;../../../etc/passwd&quot;,
            &quot;..\\..\\..\\windows\\system32\\drivers\\etc\\hosts&quot;,
            &quot;....//....//....//etc/passwd&quot;,
            &quot;%2e%2e%2f%2e%2e%2f%2e%2e%2fetc%2fpasswd&quot;
        ]

    def authenticate(self, username: str, password: str, auth_endpoint: str = &quot;/auth/login&quot;) -&gt; bool:
        &quot;&quot;&quot;Authenticate with the API and store session&quot;&quot;&quot;
        try:
            auth_data = {&quot;username&quot;: username, &quot;password&quot;: password}
            response = self.session.post(
                urljoin(self.base_url, auth_endpoint),
                json=auth_data,
                timeout=self.timeout
            )

            if response.status_code == 200:
                # Store authentication token if provided
                auth_data = response.json()
                if &#x27;token&#x27; in auth_data:
                    self.session.headers.update({
                        &#x27;Authorization&#x27;: f&quot;Bearer {auth_data[&#x27;token&#x27;]}&quot;
                    })
                return True

        except Exception as e:
            self.logger.error(f&quot;Authentication failed: {e}&quot;)

        return False

    def test_authentication_vulnerabilities(self, endpoints: List[APIEndpoint]) -&gt; List[SecurityTestResult]:
        &quot;&quot;&quot;Test for authentication vulnerabilities&quot;&quot;&quot;
        results = []

        for endpoint in endpoints:
            if not endpoint.auth_required:
                continue

            # Test 1: Access without authentication
            results.append(self._test_unauthenticated_access(endpoint))

            # Test 2: Invalid token handling
            results.append(self._test_invalid_token(endpoint))

            # Test 3: Expired token handling
            results.append(self._test_token_manipulation(endpoint))

        return results

    def _test_unauthenticated_access(self, endpoint: APIEndpoint) -&gt; SecurityTestResult:
        &quot;&quot;&quot;Test access to authenticated endpoint without credentials&quot;&quot;&quot;

        # Remove authentication headers temporarily
        original_headers = self.session.headers.copy()
        if &#x27;Authorization&#x27; in self.session.headers:
            del self.session.headers[&#x27;Authorization&#x27;]

        try:
            response = self.session.request(
                method=endpoint.method,
                url=urljoin(self.base_url, endpoint.path),
                params=endpoint.parameters if endpoint.method == &#x27;GET&#x27; else None,
                json=endpoint.parameters if endpoint.method in [&#x27;POST&#x27;, &#x27;PUT&#x27;] else None,
                timeout=self.timeout
            )

            # Restore headers
            self.session.headers = original_headers

            # Should return 401 Unauthorized
            if response.status_code == 401:
                return SecurityTestResult(
                    test_name=&quot;Unauthenticated Access&quot;,
                    endpoint=endpoint.path,
                    method=endpoint.method,
                    passed=True,
                    severity=&quot;medium&quot;,
                    description=&quot;Endpoint properly requires authentication&quot;,
                    details={&quot;status_code&quot;: response.status_code},
                    remediation=&quot;Continue current authentication enforcement&quot;
                )
            else:
                return SecurityTestResult(
                    test_name=&quot;Unauthenticated Access&quot;,
                    endpoint=endpoint.path,
                    method=endpoint.method,
                    passed=False,
                    severity=&quot;high&quot;,
                    description=&quot;Endpoint accessible without authentication&quot;,
                    details={
                        &quot;status_code&quot;: response.status_code,
                        &quot;response_size&quot;: len(response.content)
                    },
                    remediation=&quot;Implement proper authentication checks&quot;
                )

        except Exception as e:
            return SecurityTestResult(
                test_name=&quot;Unauthenticated Access&quot;,
                endpoint=endpoint.path,
                method=endpoint.method,
                passed=False,
                severity=&quot;medium&quot;,
                description=&quot;Error testing unauthenticated access&quot;,
                details={&quot;error&quot;: str(e)},
                remediation=&quot;Review endpoint implementation&quot;
            )

    def _test_invalid_token(self, endpoint: APIEndpoint) -&gt; SecurityTestResult:
        &quot;&quot;&quot;Test handling of invalid authentication tokens&quot;&quot;&quot;

        # Store original authorization
        original_auth = self.session.headers.get(&#x27;Authorization&#x27;, &#x27;&#x27;)

        # Test with invalid token
        self.session.headers[&#x27;Authorization&#x27;] = &#x27;Bearer invalid_token_12345&#x27;

        try:
            response = self.session.request(
                method=endpoint.method,
                url=urljoin(self.base_url, endpoint.path),
                params=endpoint.parameters if endpoint.method == &#x27;GET&#x27; else None,
                json=endpoint.parameters if endpoint.method in [&#x27;POST&#x27;, &#x27;PUT&#x27;] else None,
                timeout=self.timeout
            )

            # Restore original authorization
            if original_auth:
                self.session.headers[&#x27;Authorization&#x27;] = original_auth
            else:
                del self.session.headers[&#x27;Authorization&#x27;]

            # Should return 401 Unauthorized
            if response.status_code == 401:
                return SecurityTestResult(
                    test_name=&quot;Invalid Token Handling&quot;,
                    endpoint=endpoint.path,
                    method=endpoint.method,
                    passed=True,
                    severity=&quot;medium&quot;,
                    description=&quot;Invalid tokens properly rejected&quot;,
                    details={&quot;status_code&quot;: response.status_code},
                    remediation=&quot;Continue current token validation&quot;
                )
            else:
                return SecurityTestResult(
                    test_name=&quot;Invalid Token Handling&quot;,
                    endpoint=endpoint.path,
                    method=endpoint.method,
                    passed=False,
                    severity=&quot;high&quot;,
                    description=&quot;Invalid token accepted or poor error handling&quot;,
                    details={&quot;status_code&quot;: response.status_code},
                    remediation=&quot;Implement proper token validation and error handling&quot;
                )

        except Exception as e:
            return SecurityTestResult(
                test_name=&quot;Invalid Token Handling&quot;,
                endpoint=endpoint.path,
                method=endpoint.method,
                passed=False,
                severity=&quot;medium&quot;,
                description=&quot;Error testing invalid token&quot;,
                details={&quot;error&quot;: str(e)},
                remediation=&quot;Review token validation implementation&quot;
            )

    def _test_token_manipulation(self, endpoint: APIEndpoint) -&gt; SecurityTestResult:
        &quot;&quot;&quot;Test for token manipulation vulnerabilities&quot;&quot;&quot;

        original_auth = self.session.headers.get(&#x27;Authorization&#x27;, &#x27;&#x27;)

        # Test various token manipulations
        manipulated_tokens = [
            &#x27;Bearer &#x27;,  # Empty token
            &#x27;Bearer null&#x27;,  # Null token
            &#x27;Bearer eyJhbGciOiJub25lIn0.eyJzdWIiOiJhZG1pbiJ9.&#x27;,  # None algorithm JWT
            &#x27;Basic YWRtaW46YWRtaW4=&#x27;,  # Different auth scheme
        ]

        vulnerabilities_found = []

        for token in manipulated_tokens:
            self.session.headers[&#x27;Authorization&#x27;] = token

            try:
                response = self.session.request(
                    method=endpoint.method,
                    url=urljoin(self.base_url, endpoint.path),
                    timeout=self.timeout
                )

                if response.status_code != 401:
                    vulnerabilities_found.append({
                        &#x27;token&#x27;: token,
                        &#x27;status&#x27;: response.status_code
                    })

            except Exception:
                pass

        # Restore original authorization
        if original_auth:
            self.session.headers[&#x27;Authorization&#x27;] = original_auth

        if not vulnerabilities_found:
            return SecurityTestResult(
                test_name=&quot;Token Manipulation&quot;,
                endpoint=endpoint.path,
                method=endpoint.method,
                passed=True,
                severity=&quot;medium&quot;,
                description=&quot;Token manipulation attempts properly blocked&quot;,
                details={&quot;manipulations_tested&quot;: len(manipulated_tokens)},
                remediation=&quot;Continue current token validation&quot;
            )
        else:
            return SecurityTestResult(
                test_name=&quot;Token Manipulation&quot;,
                endpoint=endpoint.path,
                method=endpoint.method,
                passed=False,
                severity=&quot;high&quot;,
                description=&quot;Vulnerable to token manipulation&quot;,
                details={&quot;vulnerabilities&quot;: vulnerabilities_found},
                remediation=&quot;Implement stronger token validation and proper error handling&quot;
            )

    def test_injection_vulnerabilities(self, endpoints: List[APIEndpoint]) -&gt; List[SecurityTestResult]:
        &quot;&quot;&quot;Test for injection vulnerabilities&quot;&quot;&quot;
        results = []

        for endpoint in endpoints:
            # Test SQL injection
            results.append(self._test_sql_injection(endpoint))

            # Test XSS
            results.append(self._test_xss_injection(endpoint))

            # Test path traversal
            results.append(self._test_path_traversal(endpoint))

        return results

    def _test_sql_injection(self, endpoint: APIEndpoint) -&gt; SecurityTestResult:
        &quot;&quot;&quot;Test for SQL injection vulnerabilities&quot;&quot;&quot;

        vulnerabilities_found = []

        for payload in self.sql_injection_payloads:
            # Test in different parameter positions
            for param_name in endpoint.parameters.keys():
                test_params = endpoint.parameters.copy()
                test_params[param_name] = payload

                try:
                    response = self.session.request(
                        method=endpoint.method,
                        url=urljoin(self.base_url, endpoint.path),
                        params=test_params if endpoint.method == &#x27;GET&#x27; else None,
                        json=test_params if endpoint.method in [&#x27;POST&#x27;, &#x27;PUT&#x27;] else None,
                        timeout=self.timeout
                    )

                    # Look for SQL error indicators
                    response_text = response.text.lower()
                    sql_errors = [
                        &#x27;sql syntax&#x27;, &#x27;mysql_fetch&#x27;, &#x27;ora-&#x27;, &#x27;postgresql&#x27;,
                        &#x27;sqlite_&#x27;, &#x27;database error&#x27;, &#x27;sql statement&#x27;,
                        &#x27;syntax error&#x27;, &#x27;table does not exist&#x27;
                    ]

                    if any(error in response_text for error in sql_errors):
                        vulnerabilities_found.append({
                            &#x27;parameter&#x27;: param_name,
                            &#x27;payload&#x27;: payload,
                            &#x27;status_code&#x27;: response.status_code,
                            &#x27;error_indicators&#x27;: [err for err in sql_errors if err in response_text]
                        })

                    # Also check for unusual response times (blind SQL injection)
                    if response.elapsed.total_seconds() &gt; 5:
                        vulnerabilities_found.append({
                            &#x27;parameter&#x27;: param_name,
                            &#x27;payload&#x27;: payload,
                            &#x27;type&#x27;: &#x27;time_based_blind&#x27;,
                            &#x27;response_time&#x27;: response.elapsed.total_seconds()
                        })

                except Exception as e:
                    # Connection errors might indicate successful injection
                    if &#x27;timeout&#x27; in str(e).lower():
                        vulnerabilities_found.append({
                            &#x27;parameter&#x27;: param_name,
                            &#x27;payload&#x27;: payload,
                            &#x27;type&#x27;: &#x27;timeout&#x27;,
                            &#x27;error&#x27;: str(e)
                        })

        if not vulnerabilities_found:
            return SecurityTestResult(
                test_name=&quot;SQL Injection&quot;,
                endpoint=endpoint.path,
                method=endpoint.method,
                passed=True,
                severity=&quot;critical&quot;,
                description=&quot;No SQL injection vulnerabilities detected&quot;,
                details={&quot;payloads_tested&quot;: len(self.sql_injection_payloads)},
                remediation=&quot;Continue using parameterized queries&quot;
            )
        else:
            return SecurityTestResult(
                test_name=&quot;SQL Injection&quot;,
                endpoint=endpoint.path,
                method=endpoint.method,
                passed=False,
                severity=&quot;critical&quot;,
                description=&quot;SQL injection vulnerability detected&quot;,
                details={&quot;vulnerabilities&quot;: vulnerabilities_found},
                remediation=&quot;Use parameterized queries and input validation&quot;
            )

    def _test_xss_injection(self, endpoint: APIEndpoint) -&gt; SecurityTestResult:
        &quot;&quot;&quot;Test for XSS vulnerabilities&quot;&quot;&quot;

        vulnerabilities_found = []

        for payload in self.xss_payloads:
            for param_name in endpoint.parameters.keys():
                test_params = endpoint.parameters.copy()
                test_params[param_name] = payload

                try:
                    response = self.session.request(
                        method=endpoint.method,
                        url=urljoin(self.base_url, endpoint.path),
                        params=test_params if endpoint.method == &#x27;GET&#x27; else None,
                        json=test_params if endpoint.method in [&#x27;POST&#x27;, &#x27;PUT&#x27;] else None,
                        timeout=self.timeout
                    )

                    # Check if payload is reflected in response
                    if payload in response.text:
                        vulnerabilities_found.append({
                            &#x27;parameter&#x27;: param_name,
                            &#x27;payload&#x27;: payload,
                            &#x27;type&#x27;: &#x27;reflected_xss&#x27;
                        })

                except Exception:
                    pass

        if not vulnerabilities_found:
            return SecurityTestResult(
                test_name=&quot;Cross-Site Scripting (XSS)&quot;,
                endpoint=endpoint.path,
                method=endpoint.method,
                passed=True,
                severity=&quot;high&quot;,
                description=&quot;No XSS vulnerabilities detected&quot;,
                details={&quot;payloads_tested&quot;: len(self.xss_payloads)},
                remediation=&quot;Continue proper output encoding&quot;
            )
        else:
            return SecurityTestResult(
                test_name=&quot;Cross-Site Scripting (XSS)&quot;,
                endpoint=endpoint.path,
                method=endpoint.method,
                passed=False,
                severity=&quot;high&quot;,
                description=&quot;XSS vulnerability detected&quot;,
                details={&quot;vulnerabilities&quot;: vulnerabilities_found},
                remediation=&quot;Implement proper input validation and output encoding&quot;
            )

    def _test_path_traversal(self, endpoint: APIEndpoint) -&gt; SecurityTestResult:
        &quot;&quot;&quot;Test for path traversal vulnerabilities&quot;&quot;&quot;

        vulnerabilities_found = []

        for payload in self.path_traversal_payloads:
            for param_name in endpoint.parameters.keys():
                test_params = endpoint.parameters.copy()
                test_params[param_name] = payload

                try:
                    response = self.session.request(
                        method=endpoint.method,
                        url=urljoin(self.base_url, endpoint.path),
                        params=test_params if endpoint.method == &#x27;GET&#x27; else None,
                        json=test_params if endpoint.method in [&#x27;POST&#x27;, &#x27;PUT&#x27;] else None,
                        timeout=self.timeout
                    )

                    # Look for system file indicators
                    response_text = response.text.lower()
                    system_indicators = [
                        &#x27;root:&#x27;, &#x27;bin/bash&#x27;, &#x27;windows\\system32&#x27;,
                        &#x27;/etc/passwd&#x27;, &#x27;localhost&#x27;, &#x27;127.0.0.1&#x27;
                    ]

                    if any(indicator in response_text for indicator in system_indicators):
                        vulnerabilities_found.append({
                            &#x27;parameter&#x27;: param_name,
                            &#x27;payload&#x27;: payload,
                            &#x27;indicators&#x27;: [ind for ind in system_indicators if ind in response_text]
                        })

                except Exception:
                    pass

        if not vulnerabilities_found:
            return SecurityTestResult(
                test_name=&quot;Path Traversal&quot;,
                endpoint=endpoint.path,
                method=endpoint.method,
                passed=True,
                severity=&quot;high&quot;,
                description=&quot;No path traversal vulnerabilities detected&quot;,
                details={&quot;payloads_tested&quot;: len(self.path_traversal_payloads)},
                remediation=&quot;Continue proper file path validation&quot;
            )
        else:
            return SecurityTestResult(
                test_name=&quot;Path Traversal&quot;,
                endpoint=endpoint.path,
                method=endpoint.method,
                passed=False,
                severity=&quot;high&quot;,
                description=&quot;Path traversal vulnerability detected&quot;,
                details={&quot;vulnerabilities&quot;: vulnerabilities_found},
                remediation=&quot;Implement proper file path validation and sandboxing&quot;
            )

    def test_rate_limiting(self, endpoint: APIEndpoint, 
                          requests_count: int = 100, 
                          time_window: int = 60) -&gt; SecurityTestResult:
        &quot;&quot;&quot;Test rate limiting implementation&quot;&quot;&quot;

        start_time = time.time()
        status_codes = []
        response_times = []

        # Send rapid requests
        for i in range(requests_count):
            try:
                request_start = time.time()
                response = self.session.request(
                    method=endpoint.method,
                    url=urljoin(self.base_url, endpoint.path),
                    params=endpoint.parameters if endpoint.method == &#x27;GET&#x27; else None,
                    json=endpoint.parameters if endpoint.method in [&#x27;POST&#x27;, &#x27;PUT&#x27;] else None,
                    timeout=self.timeout
                )
                request_time = time.time() - request_start

                status_codes.append(response.status_code)
                response_times.append(request_time)

                # Short delay to avoid overwhelming the server
                time.sleep(0.1)

            except Exception as e:
                status_codes.append(0)  # Connection error
                response_times.append(self.timeout)

        total_time = time.time() - start_time

        # Analyze results
        rate_limited_responses = sum(1 for code in status_codes if code == 429)
        successful_responses = sum(1 for code in status_codes if 200 &lt;= code &lt; 300)

        if rate_limited_responses &gt; 0:
            return SecurityTestResult(
                test_name=&quot;Rate Limiting&quot;,
                endpoint=endpoint.path,
                method=endpoint.method,
                passed=True,
                severity=&quot;medium&quot;,
                description=&quot;Rate limiting is implemented&quot;,
                details={
                    &quot;total_requests&quot;: requests_count,
                    &quot;rate_limited&quot;: rate_limited_responses,
                    &quot;successful&quot;: successful_responses,
                    &quot;total_time&quot;: total_time,
                    &quot;avg_response_time&quot;: sum(response_times) / len(response_times)
                },
                remediation=&quot;Continue current rate limiting implementation&quot;
            )
        else:
            return SecurityTestResult(
                test_name=&quot;Rate Limiting&quot;,
                endpoint=endpoint.path,
                method=endpoint.method,
                passed=False,
                severity=&quot;medium&quot;,
                description=&quot;No rate limiting detected&quot;,
                details={
                    &quot;total_requests&quot;: requests_count,
                    &quot;successful&quot;: successful_responses,
                    &quot;total_time&quot;: total_time
                },
                remediation=&quot;Implement rate limiting to prevent abuse&quot;
            )

    def test_cors_configuration(self, endpoint: APIEndpoint) -&gt; SecurityTestResult:
        &quot;&quot;&quot;Test CORS configuration security&quot;&quot;&quot;

        cors_issues = []

        # Test with malicious origin
        headers = {&#x27;Origin&#x27;: &#x27;https://evil.com&#x27;}

        try:
            response = self.session.request(
                method=endpoint.method,
                url=urljoin(self.base_url, endpoint.path),
                headers=headers,
                timeout=self.timeout
            )

            cors_origin = response.headers.get(&#x27;Access-Control-Allow-Origin&#x27;, &#x27;&#x27;)
            cors_credentials = response.headers.get(&#x27;Access-Control-Allow-Credentials&#x27;, &#x27;&#x27;)

            # Check for overly permissive CORS
            if cors_origin == &#x27;*&#x27; and cors_credentials.lower() == &#x27;true&#x27;:
                cors_issues.append({
                    &#x27;issue&#x27;: &#x27;Wildcard origin with credentials&#x27;,
                    &#x27;severity&#x27;: &#x27;high&#x27;
                })

            if cors_origin == &#x27;https://evil.com&#x27;:
                cors_issues.append({
                    &#x27;issue&#x27;: &#x27;Malicious origin accepted&#x27;,
                    &#x27;severity&#x27;: &#x27;high&#x27;
                })

            # Test preflight request
            preflight_response = self.session.options(
                url=urljoin(self.base_url, endpoint.path),
                headers={
                    &#x27;Origin&#x27;: &#x27;https://evil.com&#x27;,
                    &#x27;Access-Control-Request-Method&#x27;: &#x27;POST&#x27;,
                    &#x27;Access-Control-Request-Headers&#x27;: &#x27;Content-Type&#x27;
                },
                timeout=self.timeout
            )

            if preflight_response.status_code == 200:
                allowed_methods = preflight_response.headers.get(&#x27;Access-Control-Allow-Methods&#x27;, &#x27;&#x27;)
                if &#x27;DELETE&#x27; in allowed_methods or &#x27;PUT&#x27; in allowed_methods:
                    cors_issues.append({
                        &#x27;issue&#x27;: &#x27;Dangerous methods allowed in CORS&#x27;,
                        &#x27;methods&#x27;: allowed_methods,
                        &#x27;severity&#x27;: &#x27;medium&#x27;
                    })

        except Exception as e:
            cors_issues.append({
                &#x27;issue&#x27;: &#x27;Error testing CORS&#x27;,
                &#x27;error&#x27;: str(e),
                &#x27;severity&#x27;: &#x27;low&#x27;
            })

        if not cors_issues:
            return SecurityTestResult(
                test_name=&quot;CORS Configuration&quot;,
                endpoint=endpoint.path,
                method=endpoint.method,
                passed=True,
                severity=&quot;medium&quot;,
                description=&quot;CORS configuration appears secure&quot;,
                details={&quot;cors_headers&quot;: dict(response.headers)},
                remediation=&quot;Continue current CORS policy&quot;
            )
        else:
            return SecurityTestResult(
                test_name=&quot;CORS Configuration&quot;,
                endpoint=endpoint.path,
                method=endpoint.method,
                passed=False,
                severity=&quot;medium&quot;,
                description=&quot;CORS configuration issues detected&quot;,
                details={&quot;issues&quot;: cors_issues},
                remediation=&quot;Review and tighten CORS policy&quot;
            )

    def generate_security_report(self) -&gt; Dict[str, Any]:
        &quot;&quot;&quot;Generate comprehensive security test report&quot;&quot;&quot;

        if not self.results:
            return {&quot;error&quot;: &quot;No test results available&quot;}

        # Categorize results
        passed_tests = [r for r in self.results if r.passed]
        failed_tests = [r for r in self.results if not r.passed]

        # Count by severity
        severity_counts = {
            &#x27;critical&#x27;: len([r for r in failed_tests if r.severity == &#x27;critical&#x27;]),
            &#x27;high&#x27;: len([r for r in failed_tests if r.severity == &#x27;high&#x27;]),
            &#x27;medium&#x27;: len([r for r in failed_tests if r.severity == &#x27;medium&#x27;]),
            &#x27;low&#x27;: len([r for r in failed_tests if r.severity == &#x27;low&#x27;])
        }

        # Calculate security score
        total_tests = len(self.results)
        security_score = (len(passed_tests) / total_tests) * 100 if total_tests &gt; 0 else 0

        return {
            &#x27;summary&#x27;: {
                &#x27;total_tests&#x27;: total_tests,
                &#x27;passed&#x27;: len(passed_tests),
                &#x27;failed&#x27;: len(failed_tests),
                &#x27;security_score&#x27;: round(security_score, 2)
            },
            &#x27;severity_breakdown&#x27;: severity_counts,
            &#x27;failed_tests&#x27;: [
                {
                    &#x27;test&#x27;: test.test_name,
                    &#x27;endpoint&#x27;: test.endpoint,
                    &#x27;severity&#x27;: test.severity,
                    &#x27;description&#x27;: test.description,
                    &#x27;remediation&#x27;: test.remediation
                }
                for test in failed_tests
            ],
            &#x27;recommendations&#x27;: self._generate_recommendations(failed_tests)
        }

    def _generate_recommendations(self, failed_tests: List[SecurityTestResult]) -&gt; List[str]:
        &quot;&quot;&quot;Generate security recommendations based on test results&quot;&quot;&quot;

        recommendations = []

        # Check for critical issues
        critical_tests = [t for t in failed_tests if t.severity == &#x27;critical&#x27;]
        if critical_tests:
            recommendations.append(
                &quot;CRITICAL: Address SQL injection vulnerabilities immediately using parameterized queries&quot;
            )

        # Check for authentication issues
        auth_tests = [t for t in failed_tests if &#x27;authentication&#x27; in t.test_name.lower()]
        if auth_tests:
            recommendations.append(
                &quot;Strengthen authentication mechanisms and token validation&quot;
            )

        # Check for injection issues
        injection_tests = [t for t in failed_tests if any(
            word in t.test_name.lower() for word in [&#x27;injection&#x27;, &#x27;xss&#x27;, &#x27;traversal&#x27;]
        )]
        if injection_tests:
            recommendations.append(
                &quot;Implement comprehensive input validation and output encoding&quot;
            )

        # Check for CORS issues
        cors_tests = [t for t in failed_tests if &#x27;cors&#x27; in t.test_name.lower()]
        if cors_tests:
            recommendations.append(
                &quot;Review and tighten CORS policies to prevent cross-origin attacks&quot;
            )

        return recommendations

def security_testing_example():
    &quot;&quot;&quot;Demonstrate API security testing&quot;&quot;&quot;

    # Initialize security tester
    tester = APISecurityTester(&quot;https://api.example.com&quot;)

    # Define test endpoints
    test_endpoints = [
        APIEndpoint(
            path=&quot;/api/users&quot;,
            method=&quot;GET&quot;,
            auth_required=True,
            parameters={&quot;page&quot;: &quot;1&quot;, &quot;limit&quot;: &quot;10&quot;},
            expected_status=200
        ),
        APIEndpoint(
            path=&quot;/api/users&quot;,
            method=&quot;POST&quot;,
            auth_required=True,
            parameters={&quot;username&quot;: &quot;test&quot;, &quot;email&quot;: &quot;test@example.com&quot;},
            expected_status=201
        ),
        APIEndpoint(
            path=&quot;/api/files&quot;,
            method=&quot;GET&quot;,
            auth_required=True,
            parameters={&quot;filename&quot;: &quot;document.pdf&quot;},
            expected_status=200
        )
    ]

    # Authenticate (if needed)
    if tester.authenticate(&quot;testuser&quot;, &quot;testpass&quot;):
        print(&quot;Authentication successful&quot;)

    # Run security tests
    print(&quot;Running authentication tests...&quot;)
    auth_results = tester.test_authentication_vulnerabilities(test_endpoints)
    tester.results.extend(auth_results)

    print(&quot;Running injection tests...&quot;)
    injection_results = tester.test_injection_vulnerabilities(test_endpoints)
    tester.results.extend(injection_results)

    print(&quot;Running rate limiting tests...&quot;)
    for endpoint in test_endpoints:
        rate_result = tester.test_rate_limiting(endpoint)
        tester.results.append(rate_result)

    print(&quot;Running CORS tests...&quot;)
    for endpoint in test_endpoints:
        cors_result = tester.test_cors_configuration(endpoint)
        tester.results.append(cors_result)

    # Generate report
    report = tester.generate_security_report()
    print(f&quot;\nSecurity Test Report:&quot;)
    print(f&quot;Security Score: {report[&#x27;summary&#x27;][&#x27;security_score&#x27;]}%&quot;)
    print(f&quot;Tests Passed: {report[&#x27;summary&#x27;][&#x27;passed&#x27;]}/{report[&#x27;summary&#x27;][&#x27;total_tests&#x27;]}&quot;)

    if report[&#x27;failed_tests&#x27;]:
        print(&quot;\nFailed Tests:&quot;)
        for test in report[&#x27;failed_tests&#x27;]:
            print(f&quot;- {test[&#x27;test&#x27;]} ({test[&#x27;severity&#x27;]}): {test[&#x27;description&#x27;]}&quot;)

    if report[&#x27;recommendations&#x27;]:
        print(&quot;\nRecommendations:&quot;)
        for rec in report[&#x27;recommendations&#x27;]:
            print(f&quot;- {rec}&quot;)

if __name__ == &quot;__main__&quot;:
    security_testing_example()
</code></pre>
</div>
<h2 id="building-a-complete-secure-rest-api">Building a Complete Secure REST API<a class="headerlink" href="#building-a-complete-secure-rest-api" title="Permanent link">&para;</a></h2>
<p>Now we&rsquo;ll integrate all the security concepts covered into a complete, production-ready REST API with comprehensive security features.</p>
<h3 id="secure-api-architecture">Secure API Architecture<a class="headerlink" href="#secure-api-architecture" title="Permanent link">&para;</a></h3>
<div class="diagram-container" data-container-id="kroki-diagram-4"><button class="diagram-expand-btn" onclick="openDiagramModal('kroki-diagram-4')">🔍 View Larger</button><div id="kroki-diagram-4" class="diagram-content"><p><svg xmlns="http://www.w3.org/2000/svg" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="798px" preserveAspectRatio="xMaxYMax meet" style="width:596px;height:798px;background:#FFFFFF;" version="1.1" viewBox="0 0 596 798" width="596px" zoomAndPan="magnify" id="Kroki" data-diagram-id="kroki-svg-4"><defs /><g><g class="cluster" data-entity="Client Layer" data-source-line="5" data-uid="ent0002" id="cluster_Client Layer"><path d="M14.5,11 L110.2939,11 A3.75,3.75 0 0 1 112.7939,13.5 L119.7939,33.2969 L482.5,33.2969 A2.5,2.5 0 0 1 485,35.7969 L485,105.8 A2.5,2.5 0 0 1 482.5,108.3 L14.5,108.3 A2.5,2.5 0 0 1 12,105.8 L12,13.5 A2.5,2.5 0 0 1 14.5,11" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="12" x2="119.7939" y1="33.2969" y2="33.2969" /><text fill="#000000" font-family="Arial" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="94.7939" x="16" y="25.9951">Client Layer</text></g><g class="cluster" data-entity="Security Layer" data-source-line="11" data-uid="ent0006" id="cluster_Security Layer"><path d="M186.5,132.3 L301.6328,132.3 A3.75,3.75 0 0 1 304.1328,134.8 L311.1328,154.5969 L357.5,154.5969 A2.5,2.5 0 0 1 360,157.0969 L360,545.99 A2.5,2.5 0 0 1 357.5,548.49 L186.5,548.49 A2.5,2.5 0 0 1 184,545.99 L184,134.8 A2.5,2.5 0 0 1 186.5,132.3" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="184" x2="311.1328" y1="154.5969" y2="154.5969" /><text fill="#000000" font-family="Arial" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="114.1328" x="188" y="147.2951">Security Layer</text></g><g class="cluster" data-entity="API Layer" data-source-line="18" data-uid="ent0011" id="cluster_API Layer"><path d="M13.5,572.49 L89.5723,572.49 A3.75,3.75 0 0 1 92.0723,574.99 L99.0723,594.7869 L537.5,594.7869 A2.5,2.5 0 0 1 540,597.2869 L540,667.28 A2.5,2.5 0 0 1 537.5,669.78 L13.5,669.78 A2.5,2.5 0 0 1 11,667.28 L11,574.99 A2.5,2.5 0 0 1 13.5,572.49" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="11" x2="99.0723" y1="594.7869" y2="594.7869" /><text fill="#000000" font-family="Arial" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="75.0723" x="15" y="587.4851">API Layer</text></g><g class="cluster" data-entity="Data Layer" data-source-line="24" data-uid="ent0015" id="cluster_Data Layer"><path d="M44.5,693.78 L131.4756,693.78 A3.75,3.75 0 0 1 133.9756,696.28 L140.9756,716.0769 L586.5,716.0769 A2.5,2.5 0 0 1 589,718.5769 L589,788.58 A2.5,2.5 0 0 1 586.5,791.08 L44.5,791.08 A2.5,2.5 0 0 1 42,788.58 L42,696.28 A2.5,2.5 0 0 1 44.5,693.78" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;" /><line style="stroke:#000000;stroke-width:1;" x1="42" x2="140.9756" y1="716.0769" y2="716.0769" /><text fill="#000000" font-family="Arial" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="85.9756" x="46" y="708.7751">Data Layer</text></g><g class="entity" data-entity="Web App" data-source-line="6" data-uid="ent0003" id="entity_Web App"><rect fill="#FFFFFF" height="46.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="103.1436" x="365.43" y="46" /><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1;" width="15" x="448.5736" y="51" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="446.5736" y="53" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="446.5736" y="57" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="63.1436" x="380.43" y="78.9951">Web App</text></g><g class="entity" data-entity="Mobile App" data-source-line="7" data-uid="ent0004" id="entity_Mobile App"><rect fill="#FFFFFF" height="46.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="117.7246" x="213.14" y="46" /><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1;" width="15" x="310.8646" y="51" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="308.8646" y="53" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="308.8646" y="57" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="77.7246" x="228.14" y="78.9951">Mobile App</text></g><g class="entity" data-entity="Third-party App" data-source-line="8" data-uid="ent0005" id="entity_Third-party App"><rect fill="#FFFFFF" height="46.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="149.8057" x="28.1" y="46" /><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1;" width="15" x="157.9057" y="51" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="155.9057" y="53" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="155.9057" y="57" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="109.8057" x="43.1" y="78.9951">Third-party App</text></g><g class="entity" data-entity="RL" data-source-line="12" data-uid="ent0007" id="entity_RL"><rect fill="#FFFFFF" height="46.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="125.9346" x="209.03" y="167.3" /><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1;" width="15" x="314.9646" y="172.3" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="312.9646" y="174.3" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="312.9646" y="178.3" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="85.9346" x="224.03" y="200.2951">Rate Limiter</text></g><g class="entity" data-entity="CORS" data-source-line="13" data-uid="ent0008" id="entity_CORS"><rect fill="#FFFFFF" height="46.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="138.9844" x="202.51" y="273.6" /><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1;" width="15" x="321.4944" y="278.6" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="319.4944" y="280.6" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="319.4944" y="284.6" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="98.9844" x="217.51" y="306.5951">CORS Handler</text></g><g class="entity" data-entity="Auth" data-source-line="14" data-uid="ent0009" id="entity_Auth"><rect fill="#FFFFFF" height="46.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="142.7715" x="200.61" y="379.89" /><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1;" width="15" x="323.3815" y="384.89" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="321.3815" y="386.89" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="321.3815" y="390.89" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="102.7715" x="215.61" y="412.8851">Authentication</text></g><g class="entity" data-entity="Validator" data-source-line="15" data-uid="ent0010" id="entity_Validator"><rect fill="#FFFFFF" height="46.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="143.9131" x="200.04" y="486.19" /><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1;" width="15" x="323.9531" y="491.19" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="321.9531" y="493.19" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="321.9531" y="497.19" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="103.9131" x="215.04" y="519.1851">Input Validator</text></g><g class="entity" data-entity="User Controller" data-source-line="19" data-uid="ent0012" id="entity_User Controller"><rect fill="#FFFFFF" height="46.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="145.5332" x="378.23" y="607.49" /><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1;" width="15" x="503.7632" y="612.49" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="501.7632" y="614.49" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="501.7632" y="618.49" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="105.5332" x="393.23" y="640.4851">User Controller</text></g><g class="entity" data-entity="Post Controller" data-source-line="20" data-uid="ent0013" id="entity_Post Controller"><rect fill="#FFFFFF" height="46.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="143.4141" x="200.29" y="607.49" /><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1;" width="15" x="323.7041" y="612.49" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="321.7041" y="614.49" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="321.7041" y="618.49" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="103.4141" x="215.29" y="640.4851">Post Controller</text></g><g class="entity" data-entity="File Controller" data-source-line="21" data-uid="ent0014" id="entity_File Controller"><rect fill="#FFFFFF" height="46.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="138.0684" x="26.97" y="607.49" /><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1;" width="15" x="145.0384" y="612.49" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="143.0384" y="614.49" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="143.0384" y="618.49" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="98.0684" x="41.97" y="640.4851">File Controller</text></g><g class="entity" data-entity="Session Store" data-source-line="25" data-uid="ent0016" id="entity_Session Store"><rect fill="#FFFFFF" height="46.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="135.1768" x="437.41" y="728.78" /><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1;" width="15" x="552.5868" y="733.78" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="550.5868" y="735.78" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="550.5868" y="739.78" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="95.1768" x="452.41" y="761.7751">Session Store</text></g><g class="entity" data-entity="User Database" data-source-line="26" data-uid="ent0017" id="entity_User Database"><rect fill="#FFFFFF" height="46.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="143.1611" x="259.42" y="728.78" /><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1;" width="15" x="382.5811" y="733.78" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="380.5811" y="735.78" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="380.5811" y="739.78" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="103.1611" x="274.42" y="761.7751">User Database</text></g><g class="entity" data-entity="Content Database" data-source-line="27" data-uid="ent0018" id="entity_Content Database"><rect fill="#FFFFFF" height="46.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="166.9297" x="57.54" y="728.78" /><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1;" width="15" x="204.4697" y="733.78" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="202.4697" y="735.78" /><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1;" width="4" x="202.4697" y="739.78" /><text fill="#000000" font-family="Arial" font-size="14" lengthAdjust="spacing" textLength="126.9297" x="72.54" y="761.7751">Content Database</text></g><g class="link" data-entity-1="Web App" data-entity-2="RL" data-source-line="30" data-uid="lnk19" id="link_Web App_RL"><path d="M389.73,92.59 C363.8,113.92 329.6627,141.9971 303.7827,163.2971" fill="none" id="Web App-to-RL" style="stroke:#000000;stroke-width:1;" /><polygon fill="#000000" points="299.15,167.11,308.641,164.4792,303.0106,163.9326,303.5572,158.3022,299.15,167.11" style="stroke:#000000;stroke-width:1;" /></g><g class="link" data-entity-1="Mobile App" data-entity-2="RL" data-source-line="31" data-uid="lnk20" id="link_Mobile App_RL"><path d="M272,92.59 C272,113.92 272,139.81 272,161.11" fill="none" id="Mobile App-to-RL" style="stroke:#000000;stroke-width:1;" /><polygon fill="#000000" points="272,167.11,276,158.11,272,162.11,268,158.11,272,167.11" style="stroke:#000000;stroke-width:1;" /></g><g class="link" data-entity-1="Third-party App" data-entity-2="RL" data-source-line="32" data-uid="lnk21" id="link_Third-party App_RL"><path d="M134.79,92.59 C164.91,113.85 204.9985,142.1495 235.1685,163.4495" fill="none" id="Third-party App-to-RL" style="stroke:#000000;stroke-width:1;" /><polygon fill="#000000" points="240.07,166.91,235.0247,158.4516,235.9854,164.0263,230.4107,164.987,240.07,166.91" style="stroke:#000000;stroke-width:1;" /></g><g class="link" data-entity-1="RL" data-entity-2="CORS" data-source-line="34" data-uid="lnk22" id="link_RL_CORS"><path d="M272,214.08 C272,231.57 272,249.67 272,267.16" fill="none" id="RL-to-CORS" style="stroke:#000000;stroke-width:1;" /><polygon fill="#000000" points="272,273.16,276,264.16,272,268.16,268,264.16,272,273.16" style="stroke:#000000;stroke-width:1;" /></g><g class="link" data-entity-1="CORS" data-entity-2="Auth" data-source-line="35" data-uid="lnk23" id="link_CORS_Auth"><path d="M272,320.37 C272,337.87 272,355.97 272,373.45" fill="none" id="CORS-to-Auth" style="stroke:#000000;stroke-width:1;" /><polygon fill="#000000" points="272,379.45,276,370.45,272,374.45,268,370.45,272,379.45" style="stroke:#000000;stroke-width:1;" /></g><g class="link" data-entity-1="Auth" data-entity-2="Validator" data-source-line="36" data-uid="lnk24" id="link_Auth_Validator"><path d="M272,426.67 C272,444.17 272,462.27 272,479.75" fill="none" id="Auth-to-Validator" style="stroke:#000000;stroke-width:1;" /><polygon fill="#000000" points="272,485.75,276,476.75,272,480.75,268,476.75,272,485.75" style="stroke:#000000;stroke-width:1;" /></g><g class="link" data-entity-1="Validator" data-entity-2="User Controller" data-source-line="37" data-uid="lnk25" id="link_Validator_User Controller"><path d="M310.53,532.86 C326.35,542.35 344.73,553.67 361,564.49 C381.4,578.05 398.8893,590.6177 416.1893,603.4377" fill="none" id="Validator-to-User Controller" style="stroke:#000000;stroke-width:1;" /><polygon fill="#000000" points="421.01,607.01,416.1606,598.4378,416.9928,604.0331,411.3975,604.8653,421.01,607.01" style="stroke:#000000;stroke-width:1;" /></g><g class="link" data-entity-1="Validator" data-entity-2="Post Controller" data-source-line="38" data-uid="lnk26" id="link_Validator_Post Controller"><path d="M272,532.78 C272,554.11 272,580 272,601.3" fill="none" id="Validator-to-Post Controller" style="stroke:#000000;stroke-width:1;" /><polygon fill="#000000" points="272,607.3,276,598.3,272,602.3,268,598.3,272,607.3" style="stroke:#000000;stroke-width:1;" /></g><g class="link" data-entity-1="Validator" data-entity-2="File Controller" data-source-line="39" data-uid="lnk27" id="link_Validator_File Controller"><path d="M233.38,532.73 C217.55,542.2 199.18,553.54 183,564.49 C162.99,578.02 145.9923,590.6372 129.2423,603.5472" fill="none" id="Validator-to-File Controller" style="stroke:#000000;stroke-width:1;" /><polygon fill="#000000" points="124.49,607.21,134.0603,604.884,128.4502,604.1577,129.1765,598.5476,124.49,607.21" style="stroke:#000000;stroke-width:1;" /></g><g class="link" data-entity-1="User Controller" data-entity-2="Session Store" data-source-line="41" data-uid="lnk28" id="link_User Controller_Session Store"><path d="M461.16,654.07 C470.81,675.4 482.7751,701.8342 492.4151,723.1242" fill="none" id="User Controller-to-Session Store" style="stroke:#000000;stroke-width:1;" /><polygon fill="#000000" points="494.89,728.59,494.8215,718.7414,492.8276,724.0352,487.5338,722.0412,494.89,728.59" style="stroke:#000000;stroke-width:1;" /></g><g class="link" data-entity-1="User Controller" data-entity-2="User Database" data-source-line="42" data-uid="lnk29" id="link_User Controller_User Database"><path d="M428.43,654.07 C406.97,675.4 379.1455,703.0703 357.7255,724.3603" fill="none" id="User Controller-to-User Database" style="stroke:#000000;stroke-width:1;" /><polygon fill="#000000" points="353.47,728.59,362.6731,725.0825,357.0163,725.0652,357.0335,719.4084,353.47,728.59" style="stroke:#000000;stroke-width:1;" /></g><g class="link" data-entity-1="Post Controller" data-entity-2="Content Database" data-source-line="43" data-uid="lnk30" id="link_Post Controller_Content Database"><path d="M247.36,654.07 C223.94,675.4 193.3463,703.2603 169.9663,724.5503" fill="none" id="Post Controller-to-Content Database" style="stroke:#000000;stroke-width:1;" /><polygon fill="#000000" points="165.53,728.59,174.8776,725.4879,169.2269,725.2236,169.4913,719.5729,165.53,728.59" style="stroke:#000000;stroke-width:1;" /></g><g class="link" data-entity-1="File Controller" data-entity-2="Content Database" data-source-line="44" data-uid="lnk31" id="link_File Controller_Content Database"><path d="M104.46,654.07 C112.51,675.4 122.4226,701.686 130.4526,722.976" fill="none" id="File Controller-to-Content Database" style="stroke:#000000;stroke-width:1;" /><polygon fill="#000000" points="132.57,728.59,133.1365,718.7574,130.8055,723.9117,125.6512,721.5807,132.57,728.59" style="stroke:#000000;stroke-width:1;" /></g></g></svg></p></div></div>
<h3 id="complete-secure-api-implementation">Complete Secure API Implementation<a class="headerlink" href="#complete-secure-api-implementation" title="Permanent link">&para;</a></h3>
<div class="highlight python-template" data-fence-type="template" data-language="python">
<pre><code class="language-python">from flask import Flask, request, jsonify, g
from werkzeug.security import generate_password_hash, check_password_hash
from functools import wraps
import sqlite3
import secrets
import time
import json
import re
from datetime import datetime, timedelta
from typing import Dict, Any, Optional, List

# Import our security components
# (In a real application, these would be in separate modules)

class SecureTaskAPI:
    &quot;&quot;&quot;Complete secure REST API for task management&quot;&quot;&quot;

    def __init__(self):
        self.app = Flask(__name__)
        self.app.config[&#x27;SECRET_KEY&#x27;] = secrets.token_urlsafe(32)

        # Initialize security components
        self.jwt_manager = JWTManager(self.app.config[&#x27;SECRET_KEY&#x27;])
        self.rate_limiter = RateLimiter()
        self.cors_manager = CORSManager()
        self.session_manager = SecureSessionManager()
        self.security_tester = APISecurityTester(&quot;http://localhost:5000&quot;)

        # Setup database
        self.init_database()

        # Configure CORS policies
        self.setup_cors_policies()

        # Setup rate limiting
        self.setup_rate_limiting()

        # Register routes
        self.register_routes()

    def init_database(self):
        &quot;&quot;&quot;Initialize SQLite database with secure schema&quot;&quot;&quot;
        conn = sqlite3.connect(&#x27;secure_tasks.db&#x27;)
        cursor = conn.cursor()

        # Users table with security features
        cursor.execute(&#x27;&#x27;&#x27;
            CREATE TABLE IF NOT EXISTS users (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                username TEXT UNIQUE NOT NULL,
                email TEXT UNIQUE NOT NULL,
                password_hash TEXT NOT NULL,
                salt TEXT NOT NULL,
                is_active BOOLEAN DEFAULT 1,
                failed_login_attempts INTEGER DEFAULT 0,
                last_failed_login TIMESTAMP,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        &#x27;&#x27;&#x27;)

        # Tasks table
        cursor.execute(&#x27;&#x27;&#x27;
            CREATE TABLE IF NOT EXISTS tasks (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                user_id INTEGER NOT NULL,
                title TEXT NOT NULL,
                description TEXT,
                status TEXT DEFAULT &#x27;pending&#x27;,
                priority INTEGER DEFAULT 1,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (user_id) REFERENCES users (id)
            )
        &#x27;&#x27;&#x27;)

        # API keys table
        cursor.execute(&#x27;&#x27;&#x27;
            CREATE TABLE IF NOT EXISTS api_keys (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                key_id TEXT UNIQUE NOT NULL,
                key_hash TEXT NOT NULL,
                user_id INTEGER NOT NULL,
                name TEXT NOT NULL,
                permissions TEXT NOT NULL,
                is_active BOOLEAN DEFAULT 1,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                expires_at TIMESTAMP,
                FOREIGN KEY (user_id) REFERENCES users (id)
            )
        &#x27;&#x27;&#x27;)

        conn.commit()
        conn.close()

    def setup_cors_policies(self):
        &quot;&quot;&quot;Configure CORS policies for different environments&quot;&quot;&quot;

        # Development policy
        dev_policy = self.cors_manager.create_secure_policy(
            allowed_origins=[&#x27;http://localhost:3000&#x27;, &#x27;http://127.0.0.1:3000&#x27;],
            allow_credentials=True
        )

        # Production policy
        prod_policy = self.cors_manager.create_secure_policy(
            allowed_origins=[&#x27;https://taskapp.com&#x27;, &#x27;https://api.taskapp.com&#x27;],
            allow_credentials=True
        )

        self.cors_manager.add_policy(&#x27;development&#x27;, dev_policy)
        self.cors_manager.add_policy(&#x27;production&#x27;, prod_policy)
        self.cors_manager.set_default_policy(dev_policy)  # Use dev for demo

    def setup_rate_limiting(self):
        &quot;&quot;&quot;Configure rate limiting for different endpoints&quot;&quot;&quot;

        # Different limits for different endpoint types
        self.rate_limiter.create_rate_limit(&#x27;auth_endpoint&#x27;, 5, 50)      # 5 req/sec, burst 50
        self.rate_limiter.create_rate_limit(&#x27;api_endpoint&#x27;, 50, 500)     # 50 req/sec, burst 500
        self.rate_limiter.create_rate_limit(&#x27;public_endpoint&#x27;, 10, 100)  # 10 req/sec, burst 100

    def get_db_connection(self):
        &quot;&quot;&quot;Get database connection with security considerations&quot;&quot;&quot;
        conn = sqlite3.connect(&#x27;secure_tasks.db&#x27;)
        conn.row_factory = sqlite3.Row  # Enable column access by name

        # Enable foreign key constraints
        conn.execute(&#x27;PRAGMA foreign_keys = ON&#x27;)

        return conn

    def validate_input(self, data: Dict[str, Any], rules: Dict[str, Dict]) -&gt; tuple[bool, Dict[str, str]]:
        &quot;&quot;&quot;Comprehensive input validation&quot;&quot;&quot;
        errors = {}

        for field, rule in rules.items():
            value = data.get(field, &#x27;&#x27;)

            # Required field check
            if rule.get(&#x27;required&#x27;, False) and not value:
                errors[field] = f&quot;{field} is required&quot;
                continue

            # Type validation
            expected_type = rule.get(&#x27;type&#x27;, str)
            if value and not isinstance(value, expected_type):
                errors[field] = f&quot;{field} must be of type {expected_type.__name__}&quot;
                continue

            # Length validation
            if isinstance(value, str):
                min_length = rule.get(&#x27;min_length&#x27;, 0)
                max_length = rule.get(&#x27;max_length&#x27;, float(&#x27;inf&#x27;))

                if len(value) &lt; min_length:
                    errors[field] = f&quot;{field} must be at least {min_length} characters&quot;
                    continue

                if len(value) &gt; max_length:
                    errors[field] = f&quot;{field} must be at most {max_length} characters&quot;
                    continue

            # Pattern validation (regex)
            pattern = rule.get(&#x27;pattern&#x27;)
            if pattern and isinstance(value, str):
                if not re.match(pattern, value):
                    errors[field] = f&quot;{field} format is invalid&quot;
                    continue

            # Custom validation function
            validator = rule.get(&#x27;validator&#x27;)
            if validator and callable(validator):
                if not validator(value):
                    errors[field] = f&quot;{field} validation failed&quot;

        return len(errors) == 0, errors

    def sanitize_input(self, data: Dict[str, Any]) -&gt; Dict[str, Any]:
        &quot;&quot;&quot;Sanitize input data to prevent injection attacks&quot;&quot;&quot;
        sanitized = {}

        for key, value in data.items():
            if isinstance(value, str):
                # Remove potential SQL injection characters
                value = value.replace(&quot;&#x27;&quot;, &quot;&#x27;&#x27;&quot;)  # Escape single quotes
                value = re.sub(r&#x27;[&lt;&gt;&quot;\&#x27;]&#x27;, &#x27;&#x27;, value)  # Remove XSS characters

                # Limit length to prevent buffer overflow
                value = value[:1000]

                sanitized[key] = value.strip()
            else:
                sanitized[key] = value

        return sanitized

    # Security decorators
    def require_auth(self, permissions: List[str] = None):
        &quot;&quot;&quot;Decorator for endpoints requiring authentication&quot;&quot;&quot;
        def decorator(f):
            @wraps(f)
            def decorated_function(*args, **kwargs):
                # Check rate limiting first
                client_ip = request.remote_addr
                allowed, rate_info = self.rate_limiter.is_allowed(f&quot;auth_{client_ip}&quot;)

                if not allowed:
                    return jsonify({
                        &#x27;error&#x27;: &#x27;Rate limit exceeded&#x27;,
                        &#x27;retry_after&#x27;: rate_info[&#x27;retry_after&#x27;]
                    }), 429

                # Get token from header
                auth_header = request.headers.get(&#x27;Authorization&#x27;, &#x27;&#x27;)
                if not auth_header.startswith(&#x27;Bearer &#x27;):
                    return jsonify({&#x27;error&#x27;: &#x27;Missing or invalid authorization header&#x27;}), 401

                token = auth_header.replace(&#x27;Bearer &#x27;, &#x27;&#x27;)

                # Validate JWT token
                payload = self.jwt_manager.validate_token(token)
                if not payload:
                    return jsonify({&#x27;error&#x27;: &#x27;Invalid or expired token&#x27;}), 401

                # Check permissions
                if permissions:
                    user_permissions = payload.get(&#x27;permissions&#x27;, [])
                    if not any(perm in user_permissions for perm in permissions):
                        return jsonify({&#x27;error&#x27;: &#x27;Insufficient permissions&#x27;}), 403

                # Store user info for use in endpoint
                g.current_user = payload

                return f(*args, **kwargs)
            return decorated_function
        return decorator

    def require_cors(self, policy_name: str = None):
        &quot;&quot;&quot;Decorator for CORS handling&quot;&quot;&quot;
        def decorator(f):
            @wraps(f)
            def decorated_function(*args, **kwargs):
                origin = request.headers.get(&#x27;Origin&#x27;, &#x27;&#x27;)

                # Handle preflight requests
                if request.method == &#x27;OPTIONS&#x27;:
                    cors_headers = self.cors_manager.handle_preflight_request(
                        origin=origin,
                        method=request.headers.get(&#x27;Access-Control-Request-Method&#x27;, &#x27;&#x27;),
                        headers=request.headers.get(&#x27;Access-Control-Request-Headers&#x27;, &#x27;&#x27;).split(&#x27;,&#x27;),
                        policy_name=policy_name
                    )

                    if not cors_headers:
                        return jsonify({&#x27;error&#x27;: &#x27;CORS policy violation&#x27;}), 403

                    response = jsonify({&#x27;status&#x27;: &#x27;preflight ok&#x27;})
                    for key, value in cors_headers.items():
                        response.headers[key] = value

                    return response

                # Handle actual request
                cors_headers = self.cors_manager.handle_actual_request(origin, policy_name)

                if not cors_headers:
                    return jsonify({&#x27;error&#x27;: &#x27;CORS policy violation&#x27;}), 403

                # Execute the actual function
                response = f(*args, **kwargs)

                # Add CORS headers to response
                if hasattr(response, &#x27;headers&#x27;):
                    for key, value in cors_headers.items():
                        response.headers[key] = value

                return response
            return decorated_function
        return decorator

    def register_routes(self):
        &quot;&quot;&quot;Register all API routes with security&quot;&quot;&quot;

        # Authentication endpoints
        @self.app.route(&#x27;/api/auth/register&#x27;, methods=[&#x27;POST&#x27;, &#x27;OPTIONS&#x27;])
        @self.require_cors()
        def register():
            &quot;&quot;&quot;User registration with security validation&quot;&quot;&quot;
            if request.method == &#x27;OPTIONS&#x27;:
                return &#x27;&#x27;, 200  # Handled by decorator

            # Rate limiting for registration
            client_ip = request.remote_addr
            allowed, rate_info = self.rate_limiter.sliding_window_check(
                f&quot;register_{client_ip}&quot;, 3600, 5  # 5 registrations per hour
            )

            if not allowed:
                return jsonify({
                    &#x27;error&#x27;: &#x27;Registration rate limit exceeded&#x27;,
                    &#x27;retry_after&#x27;: rate_info[&#x27;retry_after&#x27;]
                }), 429

            data = request.get_json()
            if not data:
                return jsonify({&#x27;error&#x27;: &#x27;Invalid JSON data&#x27;}), 400

            # Input validation
            validation_rules = {
                &#x27;username&#x27;: {
                    &#x27;required&#x27;: True,
                    &#x27;type&#x27;: str,
                    &#x27;min_length&#x27;: 3,
                    &#x27;max_length&#x27;: 50,
                    &#x27;pattern&#x27;: r&#x27;^[a-zA-Z0-9_]+$&#x27;
                },
                &#x27;email&#x27;: {
                    &#x27;required&#x27;: True,
                    &#x27;type&#x27;: str,
                    &#x27;pattern&#x27;: r&#x27;^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$&#x27;
                },
                &#x27;password&#x27;: {
                    &#x27;required&#x27;: True,
                    &#x27;type&#x27;: str,
                    &#x27;min_length&#x27;: 8,
                    &#x27;validator&#x27;: lambda p: any(c.isupper() for c in p) and 
                                         any(c.islower() for c in p) and 
                                         any(c.isdigit() for c in p)
                }
            }

            is_valid, errors = self.validate_input(data, validation_rules)
            if not is_valid:
                return jsonify({&#x27;error&#x27;: &#x27;Validation failed&#x27;, &#x27;details&#x27;: errors}), 400

            # Sanitize input
            data = self.sanitize_input(data)

            conn = self.get_db_connection()
            cursor = conn.cursor()

            try:
                # Check if user already exists
                cursor.execute(&#x27;SELECT id FROM users WHERE username = ? OR email = ?&#x27;, 
                             (data[&#x27;username&#x27;], data[&#x27;email&#x27;]))
                if cursor.fetchone():
                    return jsonify({&#x27;error&#x27;: &#x27;User already exists&#x27;}), 409

                # Generate salt and hash password
                salt = secrets.token_hex(16)
                password_hash = generate_password_hash(data[&#x27;password&#x27;] + salt)

                # Insert user
                cursor.execute(&#x27;&#x27;&#x27;
                    INSERT INTO users (username, email, password_hash, salt)
                    VALUES (?, ?, ?, ?)
                &#x27;&#x27;&#x27;, (data[&#x27;username&#x27;], data[&#x27;email&#x27;], password_hash, salt))

                user_id = cursor.lastrowid
                conn.commit()

                # Generate JWT token
                token = self.jwt_manager.generate_token(
                    user_id=str(user_id),
                    permissions=[&#x27;read&#x27;, &#x27;write&#x27;]
                )

                return jsonify({
                    &#x27;message&#x27;: &#x27;User registered successfully&#x27;,
                    &#x27;token&#x27;: token,
                    &#x27;user&#x27;: {
                        &#x27;id&#x27;: user_id,
                        &#x27;username&#x27;: data[&#x27;username&#x27;],
                        &#x27;email&#x27;: data[&#x27;email&#x27;]
                    }
                }), 201

            except Exception as e:
                conn.rollback()
                return jsonify({&#x27;error&#x27;: &#x27;Registration failed&#x27;}), 500

            finally:
                conn.close()

        @self.app.route(&#x27;/api/auth/login&#x27;, methods=[&#x27;POST&#x27;, &#x27;OPTIONS&#x27;])
        @self.require_cors()
        def login():
            &quot;&quot;&quot;User login with brute force protection&quot;&quot;&quot;
            if request.method == &#x27;OPTIONS&#x27;:
                return &#x27;&#x27;, 200

            data = request.get_json()
            if not data:
                return jsonify({&#x27;error&#x27;: &#x27;Invalid JSON data&#x27;}), 400

            # Input validation
            validation_rules = {
                &#x27;username&#x27;: {&#x27;required&#x27;: True, &#x27;type&#x27;: str},
                &#x27;password&#x27;: {&#x27;required&#x27;: True, &#x27;type&#x27;: str}
            }

            is_valid, errors = self.validate_input(data, validation_rules)
            if not is_valid:
                return jsonify({&#x27;error&#x27;: &#x27;Validation failed&#x27;, &#x27;details&#x27;: errors}), 400

            data = self.sanitize_input(data)

            conn = self.get_db_connection()
            cursor = conn.cursor()

            try:
                # Get user with security info
                cursor.execute(&#x27;&#x27;&#x27;
                    SELECT id, username, email, password_hash, salt, 
                           failed_login_attempts, last_failed_login, is_active
                    FROM users WHERE username = ?
                &#x27;&#x27;&#x27;, (data[&#x27;username&#x27;],))

                user = cursor.fetchone()

                if not user or not user[&#x27;is_active&#x27;]:
                    return jsonify({&#x27;error&#x27;: &#x27;Invalid credentials&#x27;}), 401

                # Check for account lockout (brute force protection)
                if user[&#x27;failed_login_attempts&#x27;] &gt;= 5:
                    last_failed = datetime.fromisoformat(user[&#x27;last_failed_login&#x27;]) if user[&#x27;last_failed_login&#x27;] else None
                    if last_failed and datetime.now() - last_failed &lt; timedelta(minutes=15):
                        return jsonify({
                            &#x27;error&#x27;: &#x27;Account temporarily locked due to failed login attempts&#x27;
                        }), 423

                # Verify password
                if check_password_hash(user[&#x27;password_hash&#x27;], data[&#x27;password&#x27;] + user[&#x27;salt&#x27;]):
                    # Reset failed attempts on successful login
                    cursor.execute(&#x27;&#x27;&#x27;
                        UPDATE users SET failed_login_attempts = 0, last_failed_login = NULL 
                        WHERE id = ?
                    &#x27;&#x27;&#x27;, (user[&#x27;id&#x27;],))
                    conn.commit()

                    # Generate JWT token
                    token = self.jwt_manager.generate_token(
                        user_id=str(user[&#x27;id&#x27;]),
                        permissions=[&#x27;read&#x27;, &#x27;write&#x27;]
                    )

                    return jsonify({
                        &#x27;message&#x27;: &#x27;Login successful&#x27;,
                        &#x27;token&#x27;: token,
                        &#x27;user&#x27;: {
                            &#x27;id&#x27;: user[&#x27;id&#x27;],
                            &#x27;username&#x27;: user[&#x27;username&#x27;],
                            &#x27;email&#x27;: user[&#x27;email&#x27;]
                        }
                    }), 200
                else:
                    # Increment failed login attempts
                    cursor.execute(&#x27;&#x27;&#x27;
                        UPDATE users SET 
                            failed_login_attempts = failed_login_attempts + 1,
                            last_failed_login = CURRENT_TIMESTAMP
                        WHERE id = ?
                    &#x27;&#x27;&#x27;, (user[&#x27;id&#x27;],))
                    conn.commit()

                    return jsonify({&#x27;error&#x27;: &#x27;Invalid credentials&#x27;}), 401

            except Exception as e:
                return jsonify({&#x27;error&#x27;: &#x27;Login failed&#x27;}), 500

            finally:
                conn.close()

        # Task management endpoints
        @self.app.route(&#x27;/api/tasks&#x27;, methods=[&#x27;GET&#x27;, &#x27;OPTIONS&#x27;])
        @self.require_cors()
        @self.require_auth([&#x27;read&#x27;])
        def get_tasks():
            &quot;&quot;&quot;Get user&#x27;s tasks with pagination&quot;&quot;&quot;
            if request.method == &#x27;OPTIONS&#x27;:
                return &#x27;&#x27;, 200

            # Get pagination parameters
            page = request.args.get(&#x27;page&#x27;, 1, type=int)
            limit = min(request.args.get(&#x27;limit&#x27;, 10, type=int), 100)  # Cap at 100
            offset = (page - 1) * limit

            # Get filter parameters
            status_filter = request.args.get(&#x27;status&#x27;, &#x27;&#x27;)
            priority_filter = request.args.get(&#x27;priority&#x27;, type=int)

            conn = self.get_db_connection()
            cursor = conn.cursor()

            try:
                # Build query with filters
                query = &#x27;&#x27;&#x27;
                    SELECT id, title, description, status, priority, created_at, updated_at
                    FROM tasks WHERE user_id = ?
                &#x27;&#x27;&#x27;
                params = [g.current_user[&#x27;user_id&#x27;]]

                if status_filter:
                    query += &#x27; AND status = ?&#x27;
                    params.append(status_filter)

                if priority_filter is not None:
                    query += &#x27; AND priority = ?&#x27;
                    params.append(priority_filter)

                query += &#x27; ORDER BY created_at DESC LIMIT ? OFFSET ?&#x27;
                params.extend([limit, offset])

                cursor.execute(query, params)
                tasks = [dict(row) for row in cursor.fetchall()]

                # Get total count for pagination
                count_query = &#x27;SELECT COUNT(*) FROM tasks WHERE user_id = ?&#x27;
                count_params = [g.current_user[&#x27;user_id&#x27;]]

                if status_filter:
                    count_query += &#x27; AND status = ?&#x27;
                    count_params.append(status_filter)

                if priority_filter is not None:
                    count_query += &#x27; AND priority = ?&#x27;
                    count_params.append(priority_filter)

                cursor.execute(count_query, count_params)
                total_count = cursor.fetchone()[0]

                return jsonify({
                    &#x27;tasks&#x27;: tasks,
                    &#x27;pagination&#x27;: {
                        &#x27;page&#x27;: page,
                        &#x27;limit&#x27;: limit,
                        &#x27;total&#x27;: total_count,
                        &#x27;pages&#x27;: (total_count + limit - 1) // limit
                    }
                }), 200

            except Exception as e:
                return jsonify({&#x27;error&#x27;: &#x27;Failed to fetch tasks&#x27;}), 500

            finally:
                conn.close()

        @self.app.route(&#x27;/api/tasks&#x27;, methods=[&#x27;POST&#x27;, &#x27;OPTIONS&#x27;])
        @self.require_cors()
        @self.require_auth([&#x27;write&#x27;])
        def create_task():
            &quot;&quot;&quot;Create a new task&quot;&quot;&quot;
            if request.method == &#x27;OPTIONS&#x27;:
                return &#x27;&#x27;, 200

            data = request.get_json()
            if not data:
                return jsonify({&#x27;error&#x27;: &#x27;Invalid JSON data&#x27;}), 400

            # Input validation
            validation_rules = {
                &#x27;title&#x27;: {
                    &#x27;required&#x27;: True,
                    &#x27;type&#x27;: str,
                    &#x27;min_length&#x27;: 1,
                    &#x27;max_length&#x27;: 200
                },
                &#x27;description&#x27;: {
                    &#x27;required&#x27;: False,
                    &#x27;type&#x27;: str,
                    &#x27;max_length&#x27;: 1000
                },
                &#x27;status&#x27;: {
                    &#x27;required&#x27;: False,
                    &#x27;type&#x27;: str,
                    &#x27;validator&#x27;: lambda s: s in [&#x27;pending&#x27;, &#x27;in_progress&#x27;, &#x27;completed&#x27;]
                },
                &#x27;priority&#x27;: {
                    &#x27;required&#x27;: False,
                    &#x27;type&#x27;: int,
                    &#x27;validator&#x27;: lambda p: 1 &lt;= p &lt;= 5
                }
            }

            is_valid, errors = self.validate_input(data, validation_rules)
            if not is_valid:
                return jsonify({&#x27;error&#x27;: &#x27;Validation failed&#x27;, &#x27;details&#x27;: errors}), 400

            data = self.sanitize_input(data)

            conn = self.get_db_connection()
            cursor = conn.cursor()

            try:
                cursor.execute(&#x27;&#x27;&#x27;
                    INSERT INTO tasks (user_id, title, description, status, priority)
                    VALUES (?, ?, ?, ?, ?)
                &#x27;&#x27;&#x27;, (
                    g.current_user[&#x27;user_id&#x27;],
                    data[&#x27;title&#x27;],
                    data.get(&#x27;description&#x27;, &#x27;&#x27;),
                    data.get(&#x27;status&#x27;, &#x27;pending&#x27;),
                    data.get(&#x27;priority&#x27;, 1)
                ))

                task_id = cursor.lastrowid
                conn.commit()

                # Fetch the created task
                cursor.execute(&#x27;&#x27;&#x27;
                    SELECT id, title, description, status, priority, created_at, updated_at
                    FROM tasks WHERE id = ?
                &#x27;&#x27;&#x27;, (task_id,))

                task = dict(cursor.fetchone())

                return jsonify({
                    &#x27;message&#x27;: &#x27;Task created successfully&#x27;,
                    &#x27;task&#x27;: task
                }), 201

            except Exception as e:
                conn.rollback()
                return jsonify({&#x27;error&#x27;: &#x27;Failed to create task&#x27;}), 500

            finally:
                conn.close()

        @self.app.route(&#x27;/api/tasks/&lt;int:task_id&gt;&#x27;, methods=[&#x27;PUT&#x27;, &#x27;OPTIONS&#x27;])
        @self.require_cors()
        @self.require_auth([&#x27;write&#x27;])
        def update_task(task_id):
            &quot;&quot;&quot;Update an existing task&quot;&quot;&quot;
            if request.method == &#x27;OPTIONS&#x27;:
                return &#x27;&#x27;, 200

            data = request.get_json()
            if not data:
                return jsonify({&#x27;error&#x27;: &#x27;Invalid JSON data&#x27;}), 400

            # Input validation (same as create)
            validation_rules = {
                &#x27;title&#x27;: {
                    &#x27;required&#x27;: False,
                    &#x27;type&#x27;: str,
                    &#x27;min_length&#x27;: 1,
                    &#x27;max_length&#x27;: 200
                },
                &#x27;description&#x27;: {
                    &#x27;required&#x27;: False,
                    &#x27;type&#x27;: str,
                    &#x27;max_length&#x27;: 1000
                },
                &#x27;status&#x27;: {
                    &#x27;required&#x27;: False,
                    &#x27;type&#x27;: str,
                    &#x27;validator&#x27;: lambda s: s in [&#x27;pending&#x27;, &#x27;in_progress&#x27;, &#x27;completed&#x27;]
                },
                &#x27;priority&#x27;: {
                    &#x27;required&#x27;: False,
                    &#x27;type&#x27;: int,
                    &#x27;validator&#x27;: lambda p: 1 &lt;= p &lt;= 5
                }
            }

            is_valid, errors = self.validate_input(data, validation_rules)
            if not is_valid:
                return jsonify({&#x27;error&#x27;: &#x27;Validation failed&#x27;, &#x27;details&#x27;: errors}), 400

            data = self.sanitize_input(data)

            conn = self.get_db_connection()
            cursor = conn.cursor()

            try:
                # Check if task exists and belongs to user
                cursor.execute(&#x27;&#x27;&#x27;
                    SELECT id FROM tasks WHERE id = ? AND user_id = ?
                &#x27;&#x27;&#x27;, (task_id, g.current_user[&#x27;user_id&#x27;]))

                if not cursor.fetchone():
                    return jsonify({&#x27;error&#x27;: &#x27;Task not found&#x27;}), 404

                # Build update query dynamically
                update_fields = []
                update_values = []

                for field in [&#x27;title&#x27;, &#x27;description&#x27;, &#x27;status&#x27;, &#x27;priority&#x27;]:
                    if field in data:
                        update_fields.append(f&quot;{field} = ?&quot;)
                        update_values.append(data[field])

                if update_fields:
                    update_fields.append(&quot;updated_at = CURRENT_TIMESTAMP&quot;)
                    update_values.append(task_id)

                    query = f&quot;UPDATE tasks SET {&#x27;, &#x27;.join(update_fields)} WHERE id = ?&quot;
                    cursor.execute(query, update_values)
                    conn.commit()

                # Fetch updated task
                cursor.execute(&#x27;&#x27;&#x27;
                    SELECT id, title, description, status, priority, created_at, updated_at
                    FROM tasks WHERE id = ?
                &#x27;&#x27;&#x27;, (task_id,))

                task = dict(cursor.fetchone())

                return jsonify({
                    &#x27;message&#x27;: &#x27;Task updated successfully&#x27;,
                    &#x27;task&#x27;: task
                }), 200

            except Exception as e:
                conn.rollback()
                return jsonify({&#x27;error&#x27;: &#x27;Failed to update task&#x27;}), 500

            finally:
                conn.close()

        @self.app.route(&#x27;/api/tasks/&lt;int:task_id&gt;&#x27;, methods=[&#x27;DELETE&#x27;, &#x27;OPTIONS&#x27;])
        @self.require_cors()
        @self.require_auth([&#x27;write&#x27;])
        def delete_task(task_id):
            &quot;&quot;&quot;Delete a task&quot;&quot;&quot;
            if request.method == &#x27;OPTIONS&#x27;:
                return &#x27;&#x27;, 200

            conn = self.get_db_connection()
            cursor = conn.cursor()

            try:
                # Check if task exists and belongs to user
                cursor.execute(&#x27;&#x27;&#x27;
                    SELECT id FROM tasks WHERE id = ? AND user_id = ?
                &#x27;&#x27;&#x27;, (task_id, g.current_user[&#x27;user_id&#x27;]))

                if not cursor.fetchone():
                    return jsonify({&#x27;error&#x27;: &#x27;Task not found&#x27;}), 404

                # Delete the task
                cursor.execute(&#x27;DELETE FROM tasks WHERE id = ?&#x27;, (task_id,))
                conn.commit()

                return jsonify({&#x27;message&#x27;: &#x27;Task deleted successfully&#x27;}), 200

            except Exception as e:
                conn.rollback()
                return jsonify({&#x27;error&#x27;: &#x27;Failed to delete task&#x27;}), 500

            finally:
                conn.close()

        # Health check endpoint
        @self.app.route(&#x27;/api/health&#x27;, methods=[&#x27;GET&#x27;])
        def health_check():
            &quot;&quot;&quot;API health check&quot;&quot;&quot;
            return jsonify({
                &#x27;status&#x27;: &#x27;healthy&#x27;,
                &#x27;timestamp&#x27;: datetime.now().isoformat(),
                &#x27;version&#x27;: &#x27;1.0.0&#x27;
            }), 200

    def run(self, debug=False):
        &quot;&quot;&quot;Run the secure API server&quot;&quot;&quot;
        print(&quot;Starting Secure Task API...&quot;)
        print(&quot;Available endpoints:&quot;)
        print(&quot;POST   /api/auth/register&quot;)
        print(&quot;POST   /api/auth/login&quot;)
        print(&quot;GET    /api/tasks&quot;)
        print(&quot;POST   /api/tasks&quot;)
        print(&quot;PUT    /api/tasks/&lt;id&gt;&quot;)
        print(&quot;DELETE /api/tasks/&lt;id&gt;&quot;)
        print(&quot;GET    /api/health&quot;)

        self.app.run(debug=debug, host=&#x27;0.0.0.0&#x27;, port=5000)

def api_demonstration():
    &quot;&quot;&quot;Demonstrate the complete secure API&quot;&quot;&quot;

    # Create and configure the API
    api = SecureTaskAPI()

    print(&quot;Secure Task API initialized with:&quot;)
    print(&quot;✓ JWT Authentication&quot;)
    print(&quot;✓ Rate Limiting&quot;)
    print(&quot;✓ CORS Protection&quot;)
    print(&quot;✓ Input Validation&quot;)
    print(&quot;✓ SQL Injection Prevention&quot;)
    print(&quot;✓ Session Management&quot;)
    print(&quot;✓ Brute Force Protection&quot;)
    print(&quot;✓ Comprehensive Logging&quot;)

    # In a real application, you would call api.run()
    # For demonstration, we&#x27;ll show the security features

    print(&quot;\nAPI Security Features:&quot;)
    print(&quot;1. Authentication: JWT tokens with expiration&quot;)
    print(&quot;2. Authorization: Permission-based access control&quot;)
    print(&quot;3. Rate Limiting: Prevents abuse and DoS attacks&quot;)
    print(&quot;4. Input Validation: Comprehensive data validation&quot;)
    print(&quot;5. CORS: Configurable cross-origin policies&quot;)
    print(&quot;6. SQL Injection: Parameterized queries&quot;)
    print(&quot;7. XSS Prevention: Input sanitization&quot;)
    print(&quot;8. Brute Force: Account lockout mechanisms&quot;)
    print(&quot;9. Session Security: Secure session management&quot;)
    print(&quot;10. Error Handling: Safe error messages&quot;)

if __name__ == &quot;__main__&quot;:
    api_demonstration()
</code></pre>
</div>
<h2 id="summary-and-best-practices">Summary and Best Practices<a class="headerlink" href="#summary-and-best-practices" title="Permanent link">&para;</a></h2>
<p>This section has covered comprehensive API security through practical implementation. Here are the key takeaways:</p>
<h3 id="essential-security-principles">Essential Security Principles<a class="headerlink" href="#essential-security-principles" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Defense in Depth</strong>: Multiple layers of security controls</p>
</li>
<li>
<p><strong>Fail Securely</strong>: Default to secure states when errors occur</p>
</li>
<li>
<p><strong>Least Privilege</strong>: Grant minimum necessary permissions</p>
</li>
<li>
<p><strong>Security by Design</strong>: Build security from the ground up</p>
</li>
</ol>
<h3 id="implementation-checklist">Implementation Checklist<a class="headerlink" href="#implementation-checklist" title="Permanent link">&para;</a></h3>
<details class="example">
<summary>Authentication Security</summary>
<h4 id="api-keys">API Keys<a class="headerlink" href="#api-keys" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Cryptographically secure generation</p>
</li>
<li>
<p>Secure storage (hash, never plain text)</p>
</li>
<li>
<p>Expiration and revocation mechanisms</p>
</li>
<li>
<p>Rate limiting integration</p>
</li>
</ul>
<h4 id="jwt-tokens">JWT Tokens<a class="headerlink" href="#jwt-tokens" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Strong secret keys</p>
</li>
<li>
<p>Token expiration policies</p>
</li>
<li>
<p>Blacklist capabilities</p>
</li>
<li>
<p>Permission-based access control</p>
</li>
</ul>
<h4 id="oauth-20">OAuth 2.0<a class="headerlink" href="#oauth-20" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Proper flow implementation</p>
</li>
<li>
<p>Scope validation</p>
</li>
<li>
<p>State parameter for CSRF protection</p>
</li>
<li>
<p>Secure token storage</p>
</li>
</ul>
</details>
<details class="example">
<summary>Rate Limiting &amp; DoS Protection</summary>
<h4 id="token-bucket-algorithm">Token Bucket Algorithm<a class="headerlink" href="#token-bucket-algorithm" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Configurable rates per identifier</p>
</li>
<li>
<p>Burst capacity management</p>
</li>
<li>
<p>Thread-safe implementation</p>
</li>
</ul>
<h4 id="progressive-penalties">Progressive Penalties<a class="headerlink" href="#progressive-penalties" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Suspicion level calculation</p>
</li>
<li>
<p>IP-based blocking</p>
</li>
<li>
<p>Pattern recognition</p>
</li>
<li>
<p>Automated responses</p>
</li>
</ul>
</details>
<details class="example">
<summary>Session Management</summary>
<h4 id="secure-session-ids">Secure Session IDs<a class="headerlink" href="#secure-session-ids" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Cryptographically random generation</p>
</li>
<li>
<p>Session rotation to prevent fixation</p>
</li>
<li>
<p>Timeout management</p>
</li>
<li>
<p>IP and user agent validation</p>
</li>
</ul>
<h4 id="security-features">Security Features<a class="headerlink" href="#security-features" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>CSRF token protection</p>
</li>
<li>
<p>Concurrent session limits</p>
</li>
<li>
<p>Suspicious activity tracking</p>
</li>
<li>
<p>Secure cookie attributes</p>
</li>
</ul>
</details>
<details class="example">
<summary>CORS Security</summary>
<h4 id="origin-validation">Origin Validation<a class="headerlink" href="#origin-validation" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Whitelist-based origin control</p>
</li>
<li>
<p>Pattern matching with security checks</p>
</li>
<li>
<p>Credential-aware policies</p>
</li>
<li>
<p>Preflight request handling</p>
</li>
</ul>
<h4 id="security-patterns">Security Patterns<a class="headerlink" href="#security-patterns" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Dangerous origin blocking</p>
</li>
<li>
<p>Method restriction</p>
</li>
<li>
<p>Header validation</p>
</li>
<li>
<p>Environment-specific policies</p>
</li>
</ul>
</details>
<details class="example">
<summary>Security Testing</summary>
<h4 id="automated-testing">Automated Testing<a class="headerlink" href="#automated-testing" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Authentication vulnerability tests</p>
</li>
<li>
<p>Injection attack simulation</p>
</li>
<li>
<p>Rate limiting verification</p>
</li>
<li>
<p>CORS policy validation</p>
</li>
</ul>
<h4 id="comprehensive-coverage">Comprehensive Coverage<a class="headerlink" href="#comprehensive-coverage" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>SQL injection with real payloads</p>
</li>
<li>
<p>XSS detection mechanisms</p>
</li>
<li>
<p>Path traversal testing</p>
</li>
<li>
<p>Security score calculation</p>
</li>
</ul>
</details>
<h3 id="production-deployment-considerations">Production Deployment Considerations<a class="headerlink" href="#production-deployment-considerations" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>HTTPS Only</strong>: Never deploy APIs without TLS encryption</p>
</li>
<li>
<p><strong>Environment Separation</strong>: Different security policies for dev/staging/production</p>
</li>
<li>
<p><strong>Monitoring</strong>: Comprehensive logging and alerting</p>
</li>
<li>
<p><strong>Updates</strong>: Regular security patches and dependency updates</p>
</li>
<li>
<p><strong>Backup</strong>: Secure data backup and recovery procedures</p>
</li>
</ol>
<h3 id="common-pitfalls-to-avoid">Common Pitfalls to Avoid<a class="headerlink" href="#common-pitfalls-to-avoid" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>Overly Permissive CORS</strong>: Never use <code>*</code> with credentials enabled</p>
</li>
<li>
<p><strong>Weak Rate Limiting</strong>: Implement multiple rate limiting strategies</p>
</li>
<li>
<p><strong>Poor Error Messages</strong>: Don&rsquo;t leak sensitive information in errors</p>
</li>
<li>
<p><strong>Insufficient Logging</strong>: Log security events for monitoring</p>
</li>
<li>
<p><strong>Hardcoded Secrets</strong>: Use environment variables for sensitive data</p>
</li>
</ul>
<p>This comprehensive implementation provides a solid foundation for building secure APIs that protect against real-world threats while maintaining usability and performance.</p>
<h2 id="practice-questions-and-exercises">Practice Questions and Exercises<a class="headerlink" href="#practice-questions-and-exercises" title="Permanent link">&para;</a></h2>
<details class="tip">
<summary>Quick Review Questions</summary>
<ol>
<li>
<p>What are the three main components of a JWT token and what information does each contain?</p>
</li>
<li>
<p>Explain the difference between symmetric and asymmetric encryption in the context of API security.</p>
</li>
<li>
<p>How does the token bucket algorithm prevent DoS attacks while allowing legitimate burst traffic?</p>
</li>
<li>
<p>What is the purpose of the <code>OPTIONS</code> method in CORS preflight requests?</p>
</li>
<li>
<p>Why should API keys be stored as hashes rather than plain text?</p>
</li>
<li>
<p>What security vulnerabilities does session rotation help prevent?</p>
</li>
<li>
<p>Explain how rate limiting can be implemented at different layers of an API architecture.</p>
</li>
<li>
<p>What is the significance of the <code>nonce</code> parameter in OAuth 2.0 flows?</p>
</li>
<li>
<p>How do CSRF tokens protect against cross-site request forgery attacks?</p>
</li>
<li>
<p>What are the key indicators that an API security testing framework should monitor?</p>
</li>
</ol>
</details>
<details class="example">
<summary>Practical Programming Exercises</summary>
<h3 id="exercise-1-secure-registration-system">Exercise 1: Secure Registration System<a class="headerlink" href="#exercise-1-secure-registration-system" title="Permanent link">&para;</a></h3>
<p>Implement a user registration system that includes:</p>
<ul>
<li>
<p>Password strength validation (minimum 8 characters, mixed case, numbers, symbols)</p>
</li>
<li>
<p>Email verification with time-limited tokens</p>
</li>
<li>
<p>Rate limiting for registration attempts</p>
</li>
<li>
<p>SQL injection prevention</p>
</li>
<li>
<p>Input sanitization for all fields</p>
</li>
</ul>
<p><strong>Requirements:</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">SecureRegistration</span><span class="p">:</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_verification_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">verify_email_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">register_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</span></code></pre></div>
<h3 id="exercise-2-api-rate-limiter">Exercise 2: API Rate Limiter<a class="headerlink" href="#exercise-2-api-rate-limiter" title="Permanent link">&para;</a></h3>
<p>Create a configurable rate limiting system with:</p>
<ul>
<li>
<p>Multiple rate limiting strategies (fixed window, sliding window, token bucket)</p>
</li>
<li>
<p>Per-user and per-IP tracking</p>
</li>
<li>
<p>Redis backend for distributed applications</p>
</li>
<li>
<p>Automatic rate limit adjustment based on server load</p>
</li>
</ul>
<p><strong>Requirements:</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">AdvancedRateLimiter</span><span class="p">:</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_rate_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_rate_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reset_rate_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_rate_limit_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</span></code></pre></div>
<h3 id="exercise-3-cors-security-manager">Exercise 3: CORS Security Manager<a class="headerlink" href="#exercise-3-cors-security-manager" title="Permanent link">&para;</a></h3>
<p>Build a comprehensive CORS management system with:</p>
<ul>
<li>
<p>Environment-specific policies</p>
</li>
<li>
<p>Origin pattern matching with wildcards</p>
</li>
<li>
<p>Security validation for dangerous combinations</p>
</li>
<li>
<p>Real-time policy updates without service restart</p>
</li>
</ul>
<p><strong>Requirements:</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">EnhancedCORSManager</span><span class="p">:</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_origin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">policy</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">handle_preflight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">updates</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</span></code></pre></div>
<h3 id="exercise-4-security-testing-suite">Exercise 4: Security Testing Suite<a class="headerlink" href="#exercise-4-security-testing-suite" title="Permanent link">&para;</a></h3>
<p>Develop an automated security testing framework for:</p>
<ul>
<li>
<p>Authentication bypass testing</p>
</li>
<li>
<p>Authorization escalation detection</p>
</li>
<li>
<p>Input validation verification</p>
</li>
<li>
<p>Rate limiting effectiveness</p>
</li>
<li>
<p>Session security validation</p>
</li>
</ul>
<p><strong>Requirements:</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">SecurityTestSuite</span><span class="p">:</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_authentication</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_authorization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_roles</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_input_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_security_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</span></code></pre></div>
</details>
<details class="warning">
<summary>Case Study Analysis</summary>
<h3 id="case-study-e-commerce-api-security-breach">Case Study: E-commerce API Security Breach<a class="headerlink" href="#case-study-e-commerce-api-security-breach" title="Permanent link">&para;</a></h3>
<p><strong>Scenario:</strong> An e-commerce platform suffered a security breach where attackers:</p>
<ol>
<li>
<p>Exploited weak API authentication to access user accounts</p>
</li>
<li>
<p>Used SQL injection to extract customer payment data</p>
</li>
<li>
<p>Performed credential stuffing attacks due to lack of rate limiting</p>
</li>
<li>
<p>Bypassed CORS protections through domain spoofing</p>
</li>
</ol>
<p><strong>Analysis Questions:</strong></p>
<ol>
<li>
<p><strong>Authentication Vulnerabilities:</strong></p>
</li>
<li>
<p>What specific authentication weaknesses likely enabled the account access?</p>
</li>
<li>
<p>How could JWT implementation flaws contribute to this breach?</p>
</li>
<li>
<p>What multi-factor authentication strategies could have prevented this?</p>
</li>
<li>
<p><strong>Injection Prevention:</strong></p>
</li>
<li>
<p>Which input validation techniques would have stopped the SQL injection?</p>
</li>
<li>
<p>How should parameterized queries be implemented in the API layer?</p>
</li>
<li>
<p>What role does output encoding play in preventing data extraction?</p>
</li>
<li>
<p><strong>Rate Limiting Failures:</strong></p>
</li>
<li>
<p>Why might traditional rate limiting have failed against credential stuffing?</p>
</li>
<li>
<p>How could progressive penalties have detected the attack pattern?</p>
</li>
<li>
<p>What rate limiting strategies work best for authentication endpoints?</p>
</li>
<li>
<p><strong>CORS Bypass Analysis:</strong></p>
</li>
<li>
<p>How do attackers typically bypass CORS protections?</p>
</li>
<li>
<p>What origin validation techniques prevent domain spoofing?</p>
</li>
<li>
<p>How should CORS policies be configured for financial applications?</p>
</li>
</ol>
<p><strong>Remediation Plan:</strong></p>
<p>Design a comprehensive security improvement plan that addresses each vulnerability type with specific technical controls and monitoring mechanisms.</p>
</details>
<h2 id="summary-checklist">Summary Checklist<a class="headerlink" href="#summary-checklist" title="Permanent link">&para;</a></h2>
<p>Use this checklist to ensure comprehensive API security implementation:</p>
<h3 id="authentication-authorization">Authentication &amp; Authorization<a class="headerlink" href="#authentication-authorization" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item">
<p><input type="checkbox" disabled/> Strong password policies enforced</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Multi-factor authentication implemented</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> JWT tokens with proper expiration</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> API key rotation mechanisms</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> OAuth 2.0 secure flows</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Permission-based access control</p>
</li>
</ul>
<h3 id="rate-limiting-dos-protection">Rate Limiting &amp; DoS Protection<a class="headerlink" href="#rate-limiting-dos-protection" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item">
<p><input type="checkbox" disabled/> Multiple rate limiting strategies</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Progressive penalty systems</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> IP-based blocking capabilities</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Burst traffic handling</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Distributed rate limiting support</p>
</li>
</ul>
<h3 id="input-validation-sanitization">Input Validation &amp; Sanitization<a class="headerlink" href="#input-validation-sanitization" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item">
<p><input type="checkbox" disabled/> Comprehensive validation rules</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> SQL injection prevention</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> XSS protection mechanisms</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> File upload security</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Parameter tampering protection</p>
</li>
</ul>
<h3 id="session-management">Session Management<a class="headerlink" href="#session-management" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item">
<p><input type="checkbox" disabled/> Secure session ID generation</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Session rotation implementation</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Timeout management</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Concurrent session limits</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> CSRF protection</p>
</li>
</ul>
<h3 id="cors-cross-origin-security">CORS &amp; Cross-Origin Security<a class="headerlink" href="#cors-cross-origin-security" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item">
<p><input type="checkbox" disabled/> Whitelist-based origin control</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Preflight request handling</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Credential policy management</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Environment-specific policies</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Security header implementation</p>
</li>
</ul>
<h3 id="monitoring-testing">Monitoring &amp; Testing<a class="headerlink" href="#monitoring-testing" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item">
<p><input type="checkbox" disabled/> Automated security testing</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Vulnerability scanning</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Security event logging</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Incident response procedures</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Regular security audits</p>
</li>
</ul>
<h3 id="deployment-security">Deployment Security<a class="headerlink" href="#deployment-security" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item">
<p><input type="checkbox" disabled/> HTTPS enforcement</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Secure configuration management</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Environment separation</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Secret management</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Regular updates and patches</p>
</li>
</ul>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="October 15, 2025 07:03:58 UTC">October 15, 2025</span>
  </span>

    
    
    
    
  </aside>


  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        Was this page helpful?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              
              
                
                
              
              Thanks for your feedback!
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              
              
                
                
              
              Thanks for your feedback! Help us improve this page by creating an <a href="https://github.com/Eatham532/Software-Engineering-HSC-Textbook/issues/new/choose" target="_blank" rel="noopener">issue</a> on github.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        

<!-- Footer -->
<footer class="md-footer">
  
    <!-- Custom footer with left/right layout -->
    <div class="md-footer__inner md-grid">
      <!-- Left side: Copyright and cookie settings -->
      <div class="md-footer__left">
        <div class="md-footer__copyright">
          
            Copyright &copy; 2025 Eatham532 – <a href="#__consent">Change cookie settings</a>

          
        </div>
      </div>

      <!-- Right side: Page name and BETA -->
      <div class="md-footer__right">
        <div class="md-footer__page-info">
          <span class="md-footer__page-title">Content</span>
          
            <span class="md-footer__beta-badge">BETA</span>
          
        </div>
      </div>
    </div>
  
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            



<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of the textbook. With your consent, you're helping us to make software engineering education better for everyone.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="github" checked>
      <span class="task-list-indicator"></span>
      GitHub
    </label>
  </li>

      
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="analytics" checked>
      <span class="task-list-indicator"></span>
      Google Analytics
    </label>
  </li>

      
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.top", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.prune", "search.highlight", "search.suggest", "content.code.annotate", "content.code.copy", "content.code.select", "content.tabs.link", "content.action.edit", "content.action.view", "toc.follow"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../../../assets/diagram-modal.js"></script>
      
        <script src="../../../../assets/quiz.js"></script>
      
        <script src="../../../../assets/code-blocks.js"></script>
      
    
  </body>
</html>