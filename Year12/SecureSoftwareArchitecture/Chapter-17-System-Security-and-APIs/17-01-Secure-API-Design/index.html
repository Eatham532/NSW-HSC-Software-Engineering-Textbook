
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://eatham532.github.io/Software-Engineering-HSC-Textbook/Year12/SecureSoftwareArchitecture/Chapter-17-System-Security-and-APIs/17-01-Secure-API-Design/">
      
      
        <link rel="prev" href="../../Chapter-16-Input-Security-and-Data-Protection/16-02-Privacy-by-Design/quiz/">
      
      
        <link rel="next" href="quiz/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>Content - Software Engineering</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/diagram-modal.css">
    
      <link rel="stylesheet" href="../../../../assets/quiz.css">
    
      <link rel="stylesheet" href="../../../../assets/common.css">
    
      <link rel="stylesheet" href="../../../../assets/diagram-fix.css">
    
      <link rel="stylesheet" href="../../../../assets/cross-reference.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-58275RL1P9"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-58275RL1P9",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-58275RL1P9",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#171-secure-api-design" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Software Engineering" class="md-header__button md-logo" aria-label="Software Engineering" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Software Engineering
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Content
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Eatham532/Software-Engineering-HSC-Textbook" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Eatham532/Software-Engineering-HSC-Textbook
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../Year11/ProgrammingFundamentals/" class="md-tabs__link">
          
  
  
  Year 11

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../ProgrammingForTheWeb/" class="md-tabs__link">
          
  
  
  Year 12

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Software Engineering" class="md-nav__button md-logo" aria-label="Software Engineering" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Software Engineering
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Eatham532/Software-Engineering-HSC-Textbook" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Eatham532/Software-Engineering-HSC-Textbook
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Year 11
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Year 11
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Programming Fundamentals
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Programming Fundamentals
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_2" >
        
          
          <label class="md-nav__link" for="__nav_2_1_2" id="__nav_2_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 01 — Software Development
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_2">
            <span class="md-nav__icon md-icon"></span>
            Chapter 01 — Software Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1_2_1" id="__nav_2_1_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    1.1 Software Development Steps
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_2_1">
            <span class="md-nav__icon md-icon"></span>
            1.1 Software Development Steps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-01-Software-Development/01-01-Software-Development-Steps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-01-Software-Development/01-01-Software-Development-Steps/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_1_2_2" id="__nav_2_1_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    1.2 Tools and Collaboration (IDE + Git)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_2_2">
            <span class="md-nav__icon md-icon"></span>
            1.2 Tools and Collaboration (IDE + Git)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-01-Software-Development/01-02-Tools-and-Collaboration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-01-Software-Development/01-02-Tools-and-Collaboration/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_1_2_3" id="__nav_2_1_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    1.3 Documentation and Code Style
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_2_3">
            <span class="md-nav__icon md-icon"></span>
            1.3 Documentation and Code Style
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-01-Software-Development/01-03-Documentation-and-Code-Style/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-01-Software-Development/01-03-Documentation-and-Code-Style/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_1_2_4" id="__nav_2_1_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    1.4 Project Management Models (Waterfall vs Agile)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_2_4">
            <span class="md-nav__icon md-icon"></span>
            1.4 Project Management Models (Waterfall vs Agile)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-01-Software-Development/01-04-Project-Management-Models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-01-Software-Development/01-04-Project-Management-Models/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_3" >
        
          
          <label class="md-nav__link" for="__nav_2_1_3" id="__nav_2_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 02 — Designing Algorithms
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_3">
            <span class="md-nav__icon md-icon"></span>
            Chapter 02 — Designing Algorithms
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_3_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1_3_1" id="__nav_2_1_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    2.1 Control Structures (Sequence, Selection, Iteration)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_3_1">
            <span class="md-nav__icon md-icon"></span>
            2.1 Control Structures (Sequence, Selection, Iteration)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-02-Designing-Algorithms/02-01-Control-Structures/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-02-Designing-Algorithms/02-01-Control-Structures/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_3_2" >
        
          
          <label class="md-nav__link" for="__nav_2_1_3_2" id="__nav_2_1_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    2.2 I/O and Purpose: Desk and Peer Checking
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_3_2">
            <span class="md-nav__icon md-icon"></span>
            2.2 I/O and Purpose: Desk and Peer Checking
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-02-Designing-Algorithms/02-02-IO-and-Purpose-Desk-and-Peer-Checking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-02-Designing-Algorithms/02-02-IO-and-Purpose-Desk-and-Peer-Checking/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_3_3" >
        
          
          <label class="md-nav__link" for="__nav_2_1_3_3" id="__nav_2_1_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    2.3 Pseudocode and Flowcharts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_3_3">
            <span class="md-nav__icon md-icon"></span>
            2.3 Pseudocode and Flowcharts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-02-Designing-Algorithms/02-03-Pseudocode-and-Flowcharts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-02-Designing-Algorithms/02-03-Pseudocode-and-Flowcharts/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_3_4" >
        
          
          <label class="md-nav__link" for="__nav_2_1_3_4" id="__nav_2_1_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    2.4 Structure Charts: Abstraction and Refinement
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_3_4">
            <span class="md-nav__icon md-icon"></span>
            2.4 Structure Charts: Abstraction and Refinement
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-02-Designing-Algorithms/02-04-Structure-Charts-Abstraction-and-Refinement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-02-Designing-Algorithms/02-04-Structure-Charts-Abstraction-and-Refinement/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_3_5" >
        
          
          <label class="md-nav__link" for="__nav_2_1_3_5" id="__nav_2_1_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    2.5 Subprograms: Procedures and Functions
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_3_5">
            <span class="md-nav__icon md-icon"></span>
            2.5 Subprograms: Procedures and Functions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-02-Designing-Algorithms/02-05-Subprograms-Procedures-and-Functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-02-Designing-Algorithms/02-05-Subprograms-Procedures-and-Functions/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_3_6" >
        
          
          <label class="md-nav__link" for="__nav_2_1_3_6" id="__nav_2_1_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    2.6 Analysing Written Algorithms (Logic and Structure)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_3_6">
            <span class="md-nav__icon md-icon"></span>
            2.6 Analysing Written Algorithms (Logic and Structure)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-02-Designing-Algorithms/02-06-Analysing-Written-Algorithms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-02-Designing-Algorithms/02-06-Analysing-Written-Algorithms/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_3_7" >
        
          
          <label class="md-nav__link" for="__nav_2_1_3_7" id="__nav_2_1_3_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    2.7 Brief Paradigms Overview
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_3_7">
            <span class="md-nav__icon md-icon"></span>
            2.7 Brief Paradigms Overview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-02-Designing-Algorithms/02-07-Brief-Paradigms-Overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-02-Designing-Algorithms/02-07-Brief-Paradigms-Overview/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_4" >
        
          
          <label class="md-nav__link" for="__nav_2_1_4" id="__nav_2_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 03 — Data for Software Engineering
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_4">
            <span class="md-nav__icon md-icon"></span>
            Chapter 03 — Data for Software Engineering
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_4_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1_4_1" id="__nav_2_1_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    3.1 Number Systems and Two's Complement
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_4_1">
            <span class="md-nav__icon md-icon"></span>
            3.1 Number Systems and Two's Complement
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-03-Data-for-software-engineering/03-01-Number-systems-and-twos-complement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-03-Data-for-software-engineering/03-01-Number-systems-and-twos-complement/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_4_2" >
        
          
          <label class="md-nav__link" for="__nav_2_1_4_2" id="__nav_2_1_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    3.2 Standard Data Types
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_4_2">
            <span class="md-nav__icon md-icon"></span>
            3.2 Standard Data Types
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-03-Data-for-software-engineering/03-02-Standard-Data-Types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-03-Data-for-software-engineering/03-02-Standard-Data-Types/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_4_3" >
        
          
          <label class="md-nav__link" for="__nav_2_1_4_3" id="__nav_2_1_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    3.3 Data Dictionaries
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_4_3">
            <span class="md-nav__icon md-icon"></span>
            3.3 Data Dictionaries
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-03-Data-for-software-engineering/03-03-Data-Dictionaries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-03-Data-for-software-engineering/03-03-Data-Dictionaries/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_4_4" >
        
          
          <label class="md-nav__link" for="__nav_2_1_4_4" id="__nav_2_1_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    3.4 Data Structures Overview
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_4_4">
            <span class="md-nav__icon md-icon"></span>
            3.4 Data Structures Overview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-03-Data-for-software-engineering/03-04-Data-Structures-Overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-03-Data-for-software-engineering/03-04-Data-Structures-Overview/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_5" >
        
          
          <label class="md-nav__link" for="__nav_2_1_5" id="__nav_2_1_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 04 — Developing Solutions with Code
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_5">
            <span class="md-nav__icon md-icon"></span>
            Chapter 04 — Developing Solutions with Code
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_5_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1_5_1" id="__nav_2_1_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    4.1 Control Structures in Python
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_5_1">
            <span class="md-nav__icon md-icon"></span>
            4.1 Control Structures in Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-04-Developing-solutions-with-code/04-01-Control-Structures-in-Python/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-04-Developing-solutions-with-code/04-01-Control-Structures-in-Python/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_5_2" >
        
          
          <label class="md-nav__link" for="__nav_2_1_5_2" id="__nav_2_1_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    4.2 Data Structures in Python
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_5_2">
            <span class="md-nav__icon md-icon"></span>
            4.2 Data Structures in Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-04-Developing-solutions-with-code/04-02-Data-Structures-in-Python/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-04-Developing-solutions-with-code/04-02-Data-Structures-in-Python/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_5_3" >
        
          
          <label class="md-nav__link" for="__nav_2_1_5_3" id="__nav_2_1_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    4.3 From Pseudocode to Python Functions
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_5_3">
            <span class="md-nav__icon md-icon"></span>
            4.3 From Pseudocode to Python Functions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-04-Developing-solutions-with-code/04-03-From-pseudocode-to-Python-functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-04-Developing-solutions-with-code/04-03-From-pseudocode-to-Python-functions/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_5_4" >
        
          
          <label class="md-nav__link" for="__nav_2_1_5_4" id="__nav_2_1_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    4.4 Using Standard Modules
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_5_4">
            <span class="md-nav__icon md-icon"></span>
            4.4 Using Standard Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-04-Developing-solutions-with-code/04-04-Using-Standard-Modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-04-Developing-solutions-with-code/04-04-Using-Standard-Modules/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_5_5" >
        
          
          <label class="md-nav__link" for="__nav_2_1_5_5" id="__nav_2_1_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    4.5 Debugging Tools and Techniques
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_5_5">
            <span class="md-nav__icon md-icon"></span>
            4.5 Debugging Tools and Techniques
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-04-Developing-solutions-with-code/04-05-Debugging-Tools-and-Techniques/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-04-Developing-solutions-with-code/04-05-Debugging-Tools-and-Techniques/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_5_6" >
        
          
          <label class="md-nav__link" for="__nav_2_1_5_6" id="__nav_2_1_5_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    4.6 Designing Suitable Test Data
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_5_6">
            <span class="md-nav__icon md-icon"></span>
            4.6 Designing Suitable Test Data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-04-Developing-solutions-with-code/04-06-Designing-Suitable-Test-Data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-04-Developing-solutions-with-code/04-06-Designing-Suitable-Test-Data/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_5_7" >
        
          
          <label class="md-nav__link" for="__nav_2_1_5_7" id="__nav_2_1_5_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    4.7 Common Errors and Exceptions
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_5_7">
            <span class="md-nav__icon md-icon"></span>
            4.7 Common Errors and Exceptions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-04-Developing-solutions-with-code/04-07-Common-Errors-and-Exceptions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingFundamentals/Chapter-04-Developing-solutions-with-code/04-07-Common-Errors-and-Exceptions/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Object-Oriented Paradigm
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Object-Oriented Paradigm
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2_2" id="__nav_2_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 05 — OOP foundations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            Chapter 05 — OOP foundations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_2_2_1" id="__nav_2_2_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    5.1 Objects and classes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2_1">
            <span class="md-nav__icon md-icon"></span>
            5.1 Objects and classes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-05-OOP-foundations/05-01-Objects-and-classes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-05-OOP-foundations/05-01-Objects-and-classes/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2_2_2" id="__nav_2_2_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    5.2 Encapsulation and state
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            5.2 Encapsulation and state
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-05-OOP-foundations/05-02-Encapsulation-and-state/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-05-OOP-foundations/05-02-Encapsulation-and-state/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_2_2_3" id="__nav_2_2_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    5.3 Abstraction, generalisation, inheritance, polymorphism
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2_3">
            <span class="md-nav__icon md-icon"></span>
            5.3 Abstraction, generalisation, inheritance, polymorphism
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-05-OOP-foundations/05-03-Abstraction-generalisation-inheritance-polymorphism/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-05-OOP-foundations/05-03-Abstraction-generalisation-inheritance-polymorphism/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_2_2_4" id="__nav_2_2_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    5.4 Comparing procedural and OOP
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2_4">
            <span class="md-nav__icon md-icon"></span>
            5.4 Comparing procedural and OOP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-05-OOP-foundations/05-04-Comparing-procedural-and-OOP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-05-OOP-foundations/05-04-Comparing-procedural-and-OOP/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_2_2_5" id="__nav_2_2_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    5.5 Modelling with class diagrams, structure charts and DFDs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2_5">
            <span class="md-nav__icon md-icon"></span>
            5.5 Modelling with class diagrams, structure charts and DFDs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-05-OOP-foundations/05-05-Modelling-with-class-diagrams-structure-charts-and-DFDs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-05-OOP-foundations/05-05-Modelling-with-class-diagrams-structure-charts-and-DFDs/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_2_2_6" id="__nav_2_2_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    5.6 Design process: task definition and decomposition
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2_6">
            <span class="md-nav__icon md-icon"></span>
            5.6 Design process: task definition and decomposition
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-05-OOP-foundations/05-06-Design-process-task-definition-and-decomposition/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-05-OOP-foundations/05-06-Design-process-task-definition-and-decomposition/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_2_2_7" id="__nav_2_2_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    5.7 Collaboration practices and version control
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2_7">
            <span class="md-nav__icon md-icon"></span>
            5.7 Collaboration practices and version control
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-05-OOP-foundations/05-07-Collaboration-practices-and-version-control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-05-OOP-foundations/05-07-Collaboration-practices-and-version-control/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_2_3" id="__nav_2_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 06 — Programming in OOP
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_3">
            <span class="md-nav__icon md-icon"></span>
            Chapter 06 — Programming in OOP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_3_1" >
        
          
          <label class="md-nav__link" for="__nav_2_2_3_1" id="__nav_2_2_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    6.1 Building classes and composition
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_3_1">
            <span class="md-nav__icon md-icon"></span>
            6.1 Building classes and composition
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-06-Programming-in-OOP/06-01-Building-classes-and-composition/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-06-Programming-in-OOP/06-01-Building-classes-and-composition/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_3_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2_3_2" id="__nav_2_2_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    6.2 Control structures within methods
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_3_2">
            <span class="md-nav__icon md-icon"></span>
            6.2 Control structures within methods
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-06-Programming-in-OOP/06-02-Control-structures-within-methods/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-06-Programming-in-OOP/06-02-Control-structures-within-methods/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_3_3" >
        
          
          <label class="md-nav__link" for="__nav_2_2_3_3" id="__nav_2_2_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    6.3 Designing subroutines and stubs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_3_3">
            <span class="md-nav__icon md-icon"></span>
            6.3 Designing subroutines and stubs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-06-Programming-in-OOP/06-03-Designing-subroutines-and-stubs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-06-Programming-in-OOP/06-03-Designing-subroutines-and-stubs/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_3_4" >
        
          
          <label class="md-nav__link" for="__nav_2_2_3_4" id="__nav_2_2_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    6.4 Code quality and maintainability
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_3_4">
            <span class="md-nav__icon md-icon"></span>
            6.4 Code quality and maintainability
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-06-Programming-in-OOP/06-04-Code-quality-and-maintainability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-06-Programming-in-OOP/06-04-Code-quality-and-maintainability/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_3_5" >
        
          
          <label class="md-nav__link" for="__nav_2_2_3_5" id="__nav_2_2_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    6.5 Testing: unit, subsystem, system and quality assurance
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_3_5">
            <span class="md-nav__icon md-icon"></span>
            6.5 Testing: unit, subsystem, system and quality assurance
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-06-Programming-in-OOP/06-05-Testing-unit-subsystem-system-and-quality-assurance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-06-Programming-in-OOP/06-05-Testing-unit-subsystem-system-and-quality-assurance/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_3_6" >
        
          
          <label class="md-nav__link" for="__nav_2_2_3_6" id="__nav_2_2_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    6.6 Test strategies: black/white/grey box
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_3_6">
            <span class="md-nav__icon md-icon"></span>
            6.6 Test strategies: black/white/grey box
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-06-Programming-in-OOP/06-06-Test-strategies-black-white-grey-box/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-06-Programming-in-OOP/06-06-Test-strategies-black-white-grey-box/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_3_7" >
        
          
          <label class="md-nav__link" for="__nav_2_2_3_7" id="__nav_2_2_3_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    6.7 Code optimisation and assessing effectiveness
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_3_7">
            <span class="md-nav__icon md-icon"></span>
            6.7 Code optimisation and assessing effectiveness
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-06-Programming-in-OOP/06-07-Code-optimisation-and-assessing-effectiveness/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ObjectOrientedParadigm/Chapter-06-Programming-in-OOP/06-07-Code-optimisation-and-assessing-effectiveness/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Programming Mechatronics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Programming Mechatronics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_2" >
        
          
          <label class="md-nav__link" for="__nav_2_3_2" id="__nav_2_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 07 — Mechatronics foundations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_2">
            <span class="md-nav__icon md-icon"></span>
            Chapter 07 — Mechatronics foundations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_3_2_1" id="__nav_2_3_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    7.1 Applications of mechatronic systems
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_3_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_2_1">
            <span class="md-nav__icon md-icon"></span>
            7.1 Applications of mechatronic systems
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-07-Mechatronics-foundations/07-01-Applications-of-mechatronic-systems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-07-Mechatronics-foundations/07-01-Applications-of-mechatronic-systems/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_3_2_2" id="__nav_2_3_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    7.2 Computing hardware
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_3_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_2_2">
            <span class="md-nav__icon md-icon"></span>
            7.2 Computing hardware
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-07-Mechatronics-foundations/07-02-Computing-hardware/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-07-Mechatronics-foundations/07-02-Computing-hardware/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3_2_3" id="__nav_2_3_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    7.3 Sensors, actuators, end effectors
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_3_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_2_3">
            <span class="md-nav__icon md-icon"></span>
            7.3 Sensors, actuators, end effectors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-07-Mechatronics-foundations/07-03-Sensors-actuators-end-effectors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-07-Mechatronics-foundations/07-03-Sensors-actuators-end-effectors/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3_3" id="__nav_2_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 08 — Data and integration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_3">
            <span class="md-nav__icon md-icon"></span>
            Chapter 08 — Data and integration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_3_1" >
        
          
          <label class="md-nav__link" for="__nav_2_3_3_1" id="__nav_2_3_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    8.1 Working with device data and diagnostics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_3_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_3_1">
            <span class="md-nav__icon md-icon"></span>
            8.1 Working with device data and diagnostics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-08-Data-and-integration/08-01-Working-with-device-data-and-diagnostics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-08-Data-and-integration/08-01-Working-with-device-data-and-diagnostics/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_3_2" >
        
          
          <label class="md-nav__link" for="__nav_2_3_3_2" id="__nav_2_3_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    8.2 Wiring diagrams and power requirements
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_3_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_3_2">
            <span class="md-nav__icon md-icon"></span>
            8.2 Wiring diagrams and power requirements
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-08-Data-and-integration/08-02-Wiring-diagrams-and-power-requirements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-08-Data-and-integration/08-02-Wiring-diagrams-and-power-requirements/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_3_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3_3_3" id="__nav_2_3_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    8.3 Designing accessible mechatronic systems
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_3_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_3_3">
            <span class="md-nav__icon md-icon"></span>
            8.3 Designing accessible mechatronic systems
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-08-Data-and-integration/08-03-Designing-accessible-mechatronic-systems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-08-Data-and-integration/08-03-Designing-accessible-mechatronic-systems/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_4" >
        
          
          <label class="md-nav__link" for="__nav_2_3_4" id="__nav_2_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 09 — Control algorithms
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_4">
            <span class="md-nav__icon md-icon"></span>
            Chapter 09 — Control algorithms
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_4_1" >
        
          
          <label class="md-nav__link" for="__nav_2_3_4_1" id="__nav_2_3_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    9.1 Open vs closed loop systems
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_3_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_4_1">
            <span class="md-nav__icon md-icon"></span>
            9.1 Open vs closed loop systems
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-09-Control-algorithms/09-01-Open-vs-closed-loop-systems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-09-Control-algorithms/09-01-Open-vs-closed-loop-systems/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_4_2" >
        
          
          <label class="md-nav__link" for="__nav_2_3_4_2" id="__nav_2_3_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    9.2 Autonomous control features
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_3_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_4_2">
            <span class="md-nav__icon md-icon"></span>
            9.2 Autonomous control features
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-09-Control-algorithms/09-02-Autonomous-control-features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-09-Control-algorithms/09-02-Autonomous-control-features/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_4_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3_4_3" id="__nav_2_3_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    9.3 Algorithmic patterns control
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_3_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_4_3">
            <span class="md-nav__icon md-icon"></span>
            9.3 Algorithmic patterns control
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-09-Control-algorithms/09-03-Algorithmic-patterns-control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-09-Control-algorithms/09-03-Algorithmic-patterns-control/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_4_4" >
        
          
          <label class="md-nav__link" for="__nav_2_3_4_4" id="__nav_2_3_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    9.4 Mechanical constraints and subsystem composition
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_3_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_4_4">
            <span class="md-nav__icon md-icon"></span>
            9.4 Mechanical constraints and subsystem composition
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-09-Control-algorithms/09-04-Mechanical-constraints-and-subsystem-composition/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-09-Control-algorithms/09-04-Mechanical-constraints-and-subsystem-composition/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_5" >
        
          
          <label class="md-nav__link" for="__nav_2_3_5" id="__nav_2_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 10 — Programming and building
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_5">
            <span class="md-nav__icon md-icon"></span>
            Chapter 10 — Programming and building
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_5_1" >
        
          
          <label class="md-nav__link" for="__nav_2_3_5_1" id="__nav_2_3_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    10.1 Simulations and prototypes for testing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_3_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_5_1">
            <span class="md-nav__icon md-icon"></span>
            10.1 Simulations and prototypes for testing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-10-Programming-and-building/10-01-Simulations-and-prototypes-for-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-10-Programming-and-building/10-01-Simulations-and-prototypes-for-testing/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_5_2" >
        
          
          <label class="md-nav__link" for="__nav_2_3_5_2" id="__nav_2_3_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    10.2 Implementing closed-loop control
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_3_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_5_2">
            <span class="md-nav__icon md-icon"></span>
            10.2 Implementing closed-loop control
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-10-Programming-and-building/10-02-Implementing-closed-loop-control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-10-Programming-and-building/10-02-Implementing-closed-loop-control/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_5_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3_5_3" id="__nav_2_3_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    10.3 Integrating sensors and actuators
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_3_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_5_3">
            <span class="md-nav__icon md-icon"></span>
            10.3 Integrating sensors and actuators
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-10-Programming-and-building/10-03-Integrating-sensors-and-actuators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-10-Programming-and-building/10-03-Integrating-sensors-and-actuators/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_5_4" >
        
          
          <label class="md-nav__link" for="__nav_2_3_5_4" id="__nav_2_3_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    10.4 User interfaces for control
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_3_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_5_4">
            <span class="md-nav__icon md-icon"></span>
            10.4 User interfaces for control
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-10-Programming-and-building/10-04-User-interfaces-for-control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-10-Programming-and-building/10-04-User-interfaces-for-control/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_5_5" >
        
          
          <label class="md-nav__link" for="__nav_2_3_5_5" id="__nav_2_3_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    10.5 Unit tests subsystems
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_3_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_5_5">
            <span class="md-nav__icon md-icon"></span>
            10.5 Unit tests subsystems
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-10-Programming-and-building/10-05-Unit-tests-subsystems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Year11/ProgrammingMechatronics/Chapter-10-Programming-and-building/10-05-Unit-tests-subsystems/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Year 12
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Year 12
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Programming For The Web
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Programming For The Web
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_2" >
        
          
          <label class="md-nav__link" for="__nav_3_1_2" id="__nav_3_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 11 — Web foundations and data transmission
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_2">
            <span class="md-nav__icon md-icon"></span>
            Chapter 11 — Web foundations and data transmission
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_2_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1_2_1" id="__nav_3_1_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    11.1 Explore the applications of web programming
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_1_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_2_1">
            <span class="md-nav__icon md-icon"></span>
            11.1 Explore the applications of web programming
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-11-Web-foundations-and-data-transmission/11-01-Explore-the-applications-of-web-programming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-11-Web-foundations-and-data-transmission/11-01-Explore-the-applications-of-web-programming/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_2_2" >
        
          
          <label class="md-nav__link" for="__nav_3_1_2_2" id="__nav_3_1_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    11.2 How data moves on the internet
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_1_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_2_2">
            <span class="md-nav__icon md-icon"></span>
            11.2 How data moves on the internet
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-11-Web-foundations-and-data-transmission/11-02-How-data-moves-on-the-internet-packets-IP-DNS-protocols/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-11-Web-foundations-and-data-transmission/11-02-How-data-moves-on-the-internet-packets-IP-DNS-protocols/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_2_3" >
        
          
          <label class="md-nav__link" for="__nav_3_1_2_3" id="__nav_3_1_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    11.3 Web protocols, ports and secure transport concepts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_1_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_2_3">
            <span class="md-nav__icon md-icon"></span>
            11.3 Web protocols, ports and secure transport concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-11-Web-foundations-and-data-transmission/11-03-Web-protocols-ports-and-secure-transport-concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-11-Web-foundations-and-data-transmission/11-03-Web-protocols-ports-and-secure-transport-concepts/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_2_4" >
        
          
          <label class="md-nav__link" for="__nav_3_1_2_4" id="__nav_3_1_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    11.4 Big data and web architectures
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_1_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_2_4">
            <span class="md-nav__icon md-icon"></span>
            11.4 Big data and web architectures
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-11-Web-foundations-and-data-transmission/11-04-Big-data-and-web-architectures/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-11-Web-foundations-and-data-transmission/11-04-Big-data-and-web-architectures/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_3" >
        
          
          <label class="md-nav__link" for="__nav_3_1_3" id="__nav_3_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 12 — Designing web applications
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_3">
            <span class="md-nav__icon md-icon"></span>
            Chapter 12 — Designing web applications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1_3_1" id="__nav_3_1_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    12.1 The role of the W3C and web standards
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_1_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_3_1">
            <span class="md-nav__icon md-icon"></span>
            12.1 The role of the W3C and web standards
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-12-Designing-web-applications/12-01-The-role-of-the-W3C-and-web-standards/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-12-Designing-web-applications/12-01-The-role-of-the-W3C-and-web-standards/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_1_3_2" id="__nav_3_1_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    12.2 Model elements that form a web development system
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_1_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_3_2">
            <span class="md-nav__icon md-icon"></span>
            12.2 Model elements that form a web development system
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-12-Designing-web-applications/12-02-Model-elements-that-form-a-web-development-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-12-Designing-web-applications/12-02-Model-elements-that-form-a-web-development-system/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_1_3_3" id="__nav_3_1_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    12.3 Influence of the web browser and developer tools
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_1_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_3_3">
            <span class="md-nav__icon md-icon"></span>
            12.3 Influence of the web browser and developer tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-12-Designing-web-applications/12-03-Influence-of-the-web-browser-and-developer-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-12-Designing-web-applications/12-03-Influence-of-the-web-browser-and-developer-tools/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_1_3_4" id="__nav_3_1_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    12.4 CSS, UI and UX principles
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_1_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_3_4">
            <span class="md-nav__icon md-icon"></span>
            12.4 CSS, UI and UX principles
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-12-Designing-web-applications/12-04-CSS-UI-and-UX-principles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-12-Designing-web-applications/12-04-CSS-UI-and-UX-principles/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_1_3_5" id="__nav_3_1_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    12.5 Front-end code libraries and frameworks
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_1_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_3_5">
            <span class="md-nav__icon md-icon"></span>
            12.5 Front-end code libraries and frameworks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-12-Designing-web-applications/12-05-Front-end-code-libraries-and-frameworks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-12-Designing-web-applications/12-05-Front-end-code-libraries-and-frameworks/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_1_3_6" id="__nav_3_1_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    12.6 Open-source and content management systems
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_1_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_3_6">
            <span class="md-nav__icon md-icon"></span>
            12.6 Open-source and content management systems
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-12-Designing-web-applications/12-06-Open-source-and-content-management-systems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-12-Designing-web-applications/12-06-Open-source-and-content-management-systems/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_4" >
        
          
          <label class="md-nav__link" for="__nav_3_1_4" id="__nav_3_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 13 — Back-end, databases, and PWAs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_4">
            <span class="md-nav__icon md-icon"></span>
            Chapter 13 — Back-end, databases, and PWAs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_4_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1_4_1" id="__nav_3_1_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    13.1 Server-side Python with a microframework and the back-end request flow
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_1_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_4_1">
            <span class="md-nav__icon md-icon"></span>
            13.1 Server-side Python with a microframework and the back-end request flow
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-13-Back-end-databases-and-PWAs/13-01-Server-side-Python-with-a-microframework-and-the-back-end-request-flow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-13-Back-end-databases-and-PWAs/13-01-Server-side-Python-with-a-microframework-and-the-back-end-request-flow/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_4_2" >
        
          
          <label class="md-nav__link" for="__nav_3_1_4_2" id="__nav_3_1_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    13.2 Databases: SQL, common queries and ORM comparison
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_1_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_4_2">
            <span class="md-nav__icon md-icon"></span>
            13.2 Databases: SQL, common queries and ORM comparison
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-13-Back-end-databases-and-PWAs/13-02-Databases-SQL-common-queries-and-ORM-comparison/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-13-Back-end-databases-and-PWAs/13-02-Databases-SQL-common-queries-and-ORM-comparison/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_4_3" >
        
          
          <label class="md-nav__link" for="__nav_3_1_4_3" id="__nav_3_1_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    13.3 Performance and page-load management
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_1_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_4_3">
            <span class="md-nav__icon md-icon"></span>
            13.3 Performance and page-load management
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-13-Back-end-databases-and-PWAs/13-03-Performance-and-page-load-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-13-Back-end-databases-and-PWAs/13-03-Performance-and-page-load-management/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_4_4" >
        
          
          <label class="md-nav__link" for="__nav_3_1_4_4" id="__nav_3_1_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    13.4 Designing and implementing a PWA
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_1_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_4_4">
            <span class="md-nav__icon md-icon"></span>
            13.4 Designing and implementing a PWA
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-13-Back-end-databases-and-PWAs/13-04-Designing-and-implementing-a-PWA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ProgrammingForTheWeb/Chapter-13-Back-end-databases-and-PWAs/13-04-Designing-and-implementing-a-PWA/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Secure Software Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Secure Software Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2_2" id="__nav_3_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 14 — Security Foundations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_2">
            <span class="md-nav__icon md-icon"></span>
            Chapter 14 — Security Foundations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_2_1" >
        
          
          <label class="md-nav__link" for="__nav_3_2_2_1" id="__nav_3_2_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    14.1 The Business Case for Security
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_2_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_2_1">
            <span class="md-nav__icon md-icon"></span>
            14.1 The Business Case for Security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-14-Security-Foundations/14-01-The-Business-Case-for-Security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-14-Security-Foundations/14-01-The-Business-Case-for-Security/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_2_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2_2_2" id="__nav_3_2_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    14.2 Integrating Security into the SDLC
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_2_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            14.2 Integrating Security into the SDLC
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-14-Security-Foundations/14-02-Integrating-Security-into-the-SDLC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-14-Security-Foundations/14-02-Integrating-Security-into-the-SDLC/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_2_3" >
        
          
          <label class="md-nav__link" for="__nav_3_2_2_3" id="__nav_3_2_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    14.3 User-Centered Security Design
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_2_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_2_3">
            <span class="md-nav__icon md-icon"></span>
            14.3 User-Centered Security Design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-14-Security-Foundations/14-03-User-Centered-Security-Design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-14-Security-Foundations/14-03-User-Centered-Security-Design/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_3" >
        
          
          <label class="md-nav__link" for="__nav_3_2_3" id="__nav_3_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 15 — Core Security Principles
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_3">
            <span class="md-nav__icon md-icon"></span>
            Chapter 15 — Core Security Principles
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_2_3_1" id="__nav_3_2_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    15.1 Security Fundamentals: CIA Triad and AAA
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_2_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_3_1">
            <span class="md-nav__icon md-icon"></span>
            15.1 Security Fundamentals: CIA Triad and AAA
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-15-Core-Security-Principles/15-01-Security-Fundamentals-CIA-Triad-and-AAA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-15-Core-Security-Principles/15-01-Security-Fundamentals-CIA-Triad-and-AAA/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2_3_2" id="__nav_3_2_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    15.2 Cryptography and Data Protection
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_2_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_3_2">
            <span class="md-nav__icon md-icon"></span>
            15.2 Cryptography and Data Protection
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-15-Core-Security-Principles/15-02-Cryptography-and-Data-Protection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-15-Core-Security-Principles/15-02-Cryptography-and-Data-Protection/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_4" >
        
          
          <label class="md-nav__link" for="__nav_3_2_4" id="__nav_3_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 16 — Input Security and Data Protection
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_4">
            <span class="md-nav__icon md-icon"></span>
            Chapter 16 — Input Security and Data Protection
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_4_1" >
        
          
          <label class="md-nav__link" for="__nav_3_2_4_1" id="__nav_3_2_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    16.1 Input Validation and Sanitization
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_2_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_4_1">
            <span class="md-nav__icon md-icon"></span>
            16.1 Input Validation and Sanitization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-16-Input-Security-and-Data-Protection/16-01-Input-Validation-and-Sanitization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-16-Input-Security-and-Data-Protection/16-01-Input-Validation-and-Sanitization/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_4_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2_4_2" id="__nav_3_2_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    16.2 Privacy by Design
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_2_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_4_2">
            <span class="md-nav__icon md-icon"></span>
            16.2 Privacy by Design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-16-Input-Security-and-Data-Protection/16-02-Privacy-by-Design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-16-Input-Security-and-Data-Protection/16-02-Privacy-by-Design/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_5" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2_5" id="__nav_3_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 17 — System Security and APIs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2_5">
            <span class="md-nav__icon md-icon"></span>
            Chapter 17 — System Security and APIs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_5_1" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2_5_1" id="__nav_3_2_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    17.1 Secure API Design
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_2_5_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2_5_1">
            <span class="md-nav__icon md-icon"></span>
            17.1 Secure API Design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-it-matters" class="md-nav__link">
    <span class="md-ellipsis">
      Why It Matters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-security-principles-for-apis" class="md-nav__link">
    <span class="md-ellipsis">
      Core Security Principles for APIs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Security Principles for APIs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-defense-in-depth" class="md-nav__link">
    <span class="md-ellipsis">
      1. Defense in Depth
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-principle-of-least-privilege" class="md-nav__link">
    <span class="md-ellipsis">
      2. Principle of Least Privilege
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-fail-securely" class="md-nav__link">
    <span class="md-ellipsis">
      3. Fail Securely
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-security-by-design" class="md-nav__link">
    <span class="md-ellipsis">
      4. Security by Design
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-authentication-methods" class="md-nav__link">
    <span class="md-ellipsis">
      API Authentication Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Authentication Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-authentication-vs-authorization" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding Authentication vs Authorization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-api-keys" class="md-nav__link">
    <span class="md-ellipsis">
      1. API Keys
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. API Keys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-api-key-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Basic API Key Implementation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-key-security-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      API Key Security Best Practices
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-json-web-tokens-jwt" class="md-nav__link">
    <span class="md-ellipsis">
      2. JSON Web Tokens (JWT)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. JSON Web Tokens (JWT)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jwt-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      JWT Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-oauth-20-flow-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      3. OAuth 2.0 Flow Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rate-limiting-and-dos-protection" class="md-nav__link">
    <span class="md-ellipsis">
      Rate Limiting and DoS Protection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rate Limiting and DoS Protection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#token-bucket-algorithm-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Token Bucket Algorithm Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secure-session-management" class="md-nav__link">
    <span class="md-ellipsis">
      Secure Session Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Secure Session Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#session-security-principles" class="md-nav__link">
    <span class="md-ellipsis">
      Session Security Principles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comprehensive-session-manager-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Comprehensive Session Manager Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cors-and-cross-origin-security" class="md-nav__link">
    <span class="md-ellipsis">
      CORS and Cross-Origin Security
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CORS and Cross-Origin Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-cors-security-model" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding CORS Security Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comprehensive-cors-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Comprehensive CORS Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-security-testing" class="md-nav__link">
    <span class="md-ellipsis">
      API Security Testing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Security Testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#security-testing-methodology" class="md-nav__link">
    <span class="md-ellipsis">
      Security Testing Methodology
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automated-security-testing-framework" class="md-nav__link">
    <span class="md-ellipsis">
      Automated Security Testing Framework
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-a-complete-secure-rest-api" class="md-nav__link">
    <span class="md-ellipsis">
      Building a Complete Secure REST API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Building a Complete Secure REST API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#secure-api-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Secure API Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complete-secure-api-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Secure API Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary-and-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Summary and Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary and Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#essential-security-principles" class="md-nav__link">
    <span class="md-ellipsis">
      Essential Security Principles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Checklist
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Checklist">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-keys" class="md-nav__link">
    <span class="md-ellipsis">
      API Keys
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jwt-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      JWT Tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauth-20" class="md-nav__link">
    <span class="md-ellipsis">
      OAuth 2.0
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token-bucket-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Token Bucket Algorithm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#progressive-penalties" class="md-nav__link">
    <span class="md-ellipsis">
      Progressive Penalties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secure-session-ids" class="md-nav__link">
    <span class="md-ellipsis">
      Secure Session IDs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-features" class="md-nav__link">
    <span class="md-ellipsis">
      Security Features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#origin-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Origin Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Security Patterns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automated-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Automated Testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comprehensive-coverage" class="md-nav__link">
    <span class="md-ellipsis">
      Comprehensive Coverage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production-deployment-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Production Deployment Considerations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-pitfalls-to-avoid" class="md-nav__link">
    <span class="md-ellipsis">
      Common Pitfalls to Avoid
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practice-questions-and-exercises" class="md-nav__link">
    <span class="md-ellipsis">
      Practice Questions and Exercises
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Practice Questions and Exercises">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-1-secure-registration-system" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 1: Secure Registration System
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-2-api-rate-limiter" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 2: API Rate Limiter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-3-cors-security-manager" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 3: CORS Security Manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-4-security-testing-suite" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 4: Security Testing Suite
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-study-e-commerce-api-security-breach" class="md-nav__link">
    <span class="md-ellipsis">
      Case Study: E-commerce API Security Breach
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      Summary Checklist
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary Checklist">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication-authorization" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication &amp; Authorization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rate-limiting-dos-protection" class="md-nav__link">
    <span class="md-ellipsis">
      Rate Limiting &amp; DoS Protection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#input-validation-sanitization" class="md-nav__link">
    <span class="md-ellipsis">
      Input Validation &amp; Sanitization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#session-management" class="md-nav__link">
    <span class="md-ellipsis">
      Session Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cors-cross-origin-security" class="md-nav__link">
    <span class="md-ellipsis">
      CORS &amp; Cross-Origin Security
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Monitoring &amp; Testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-security" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment Security
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_5_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2_5_2" id="__nav_3_2_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    17.2 Secure Execution & Resource Management
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_2_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_5_2">
            <span class="md-nav__icon md-icon"></span>
            17.2 Secure Execution & Resource Management
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../17-02-Secure-Execution-and-Resource-Management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../17-02-Secure-Execution-and-Resource-Management/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_6" >
        
          
          <label class="md-nav__link" for="__nav_3_2_6" id="__nav_3_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 18 — Security Testing & Vulnerabilities
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_6">
            <span class="md-nav__icon md-icon"></span>
            Chapter 18 — Security Testing & Vulnerabilities
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_6_1" >
        
          
          <label class="md-nav__link" for="__nav_3_2_6_1" id="__nav_3_2_6_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    18.1 Security Testing Fundamentals
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_2_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_6_1">
            <span class="md-nav__icon md-icon"></span>
            18.1 Security Testing Fundamentals
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-18-Security-Testing-and-Vulnerabilities/18-01-Security-Testing-Fundamentals/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-18-Security-Testing-and-Vulnerabilities/18-01-Security-Testing-Fundamentals/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_6_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2_6_2" id="__nav_3_2_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    18.2 Web Application Vulnerabilities
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_2_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_6_2">
            <span class="md-nav__icon md-icon"></span>
            18.2 Web Application Vulnerabilities
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-18-Security-Testing-and-Vulnerabilities/18-02-Web-Application-Vulnerabilities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-18-Security-Testing-and-Vulnerabilities/18-02-Web-Application-Vulnerabilities/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_7" >
        
          
          <label class="md-nav__link" for="__nav_3_2_7" id="__nav_3_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 19 — Security in Context
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_7">
            <span class="md-nav__icon md-icon"></span>
            Chapter 19 — Security in Context
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_7_1" >
        
          
          <label class="md-nav__link" for="__nav_3_2_7_1" id="__nav_3_2_7_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    19.1 Security in Development Teams
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_2_7_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_7_1">
            <span class="md-nav__icon md-icon"></span>
            19.1 Security in Development Teams
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-19-Security-in-Context/19-01-Security-in-Development-Teams/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-19-Security-in-Context/19-01-Security-in-Development-Teams/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_7_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2_7_2" id="__nav_3_2_7_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    19.2 Enterprise Security Benefits
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_2_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_7_2">
            <span class="md-nav__icon md-icon"></span>
            19.2 Enterprise Security Benefits
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-19-Security-in-Context/19-02-Enterprise-Security-Benefits/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-19-Security-in-Context/19-02-Enterprise-Security-Benefits/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_7_3" >
        
          
          <label class="md-nav__link" for="__nav_3_2_7_3" id="__nav_3_2_7_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    19.3 Security Ethics & Legal Considerations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_2_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_7_3">
            <span class="md-nav__icon md-icon"></span>
            19.3 Security Ethics & Legal Considerations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-19-Security-in-Context/19-03-Security-Ethics-and-Legal-Considerations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-19-Security-in-Context/19-03-Security-Ethics-and-Legal-Considerations/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_7_4" >
        
          
          <label class="md-nav__link" for="__nav_3_2_7_4" id="__nav_3_2_7_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    19.4 Evaluating Security Programs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_2_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_7_4">
            <span class="md-nav__icon md-icon"></span>
            19.4 Evaluating Security Programs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-19-Security-in-Context/19-04-Evaluating-Security-Programs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chapter-19-Security-in-Context/19-04-Evaluating-Security-Programs/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Software Automation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Software Automation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareAutomation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2" id="__nav_3_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 20 — ML and automation basics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2">
            <span class="md-nav__icon md-icon"></span>
            Chapter 20 — ML and automation basics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_1" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_1" id="__nav_3_3_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    20.1 What is AI vs ML (and where RPA/BPA fit)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_3_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_1">
            <span class="md-nav__icon md-icon"></span>
            20.1 What is AI vs ML (and where RPA/BPA fit)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareAutomation/Chapter-20-ML-and-automation-basics/20-01-What-is-AI-vs-ML/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareAutomation/Chapter-20-ML-and-automation-basics/20-01-What-is-AI-vs-ML/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_2" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_2" id="__nav_3_3_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    20.2 ML training models: supervised, unsupervised, semi, reinforcement
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_3_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_2">
            <span class="md-nav__icon md-icon"></span>
            20.2 ML training models: supervised, unsupervised, semi, reinforcement
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareAutomation/Chapter-20-ML-and-automation-basics/20-02-ML-training-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareAutomation/Chapter-20-ML-and-automation-basics/20-02-ML-training-models/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_3" id="__nav_3_3_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    20.3 Common ML applications
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_3_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_3">
            <span class="md-nav__icon md-icon"></span>
            20.3 Common ML applications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareAutomation/Chapter-20-ML-and-automation-basics/20-03-Common-ML-applications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareAutomation/Chapter-20-ML-and-automation-basics/20-03-Common-ML-applications/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_4" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_4" id="__nav_3_3_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    20.4 Design models: decision trees and neural networks
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_3_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_4">
            <span class="md-nav__icon md-icon"></span>
            20.4 Design models: decision trees and neural networks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareAutomation/Chapter-20-ML-and-automation-basics/20-04-Design-models-decision-trees-and-neural-networks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareAutomation/Chapter-20-ML-and-automation-basics/20-04-Design-models-decision-trees-and-neural-networks/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2_5" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2_5" id="__nav_3_3_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    20.5 RPA and BPA: practical considerations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_3_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2_5">
            <span class="md-nav__icon md-icon"></span>
            20.5 RPA and BPA: practical considerations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareAutomation/Chapter-20-ML-and-automation-basics/20-05-RPA-and-BPA-practical-considerations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareAutomation/Chapter-20-ML-and-automation-basics/20-05-RPA-and-BPA-practical-considerations/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3_3" id="__nav_3_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 21 — Programming for automation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_3">
            <span class="md-nav__icon md-icon"></span>
            Chapter 21 — Programming for automation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_3_3_1" id="__nav_3_3_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    21.1 Regression models and core algorithm types in Python
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_3_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_3_1">
            <span class="md-nav__icon md-icon"></span>
            21.1 Regression models and core algorithm types in Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareAutomation/Chapter-21-Programming-for-automation/21-01-Regression-models-and-core-algorithm-types-in-Python/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareAutomation/Chapter-21-Programming-for-automation/21-01-Regression-models-and-core-algorithm-types-in-Python/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_3_3_2" id="__nav_3_3_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    21.2 Neural networks: concepts and implementation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_3_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_3_2">
            <span class="md-nav__icon md-icon"></span>
            21.2 Neural networks: concepts and implementation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareAutomation/Chapter-21-Programming-for-automation/21-02-Neural-networks-concepts-and-implementation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareAutomation/Chapter-21-Programming-for-automation/21-02-Neural-networks-concepts-and-implementation/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_3_4" id="__nav_3_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 22 — Significance and impact
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_4">
            <span class="md-nav__icon md-icon"></span>
            Chapter 22 — Significance and impact
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_4_1" >
        
          
          <label class="md-nav__link" for="__nav_3_3_4_1" id="__nav_3_3_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    22.1 Assessing the impact of automation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_3_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_4_1">
            <span class="md-nav__icon md-icon"></span>
            22.1 Assessing the impact of automation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareAutomation/Chapter-22-Significance-and-impact/22-01-Assessing-the-impact-of-automation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareAutomation/Chapter-22-Significance-and-impact/22-01-Assessing-the-impact-of-automation/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_4_2" >
        
          
          <label class="md-nav__link" for="__nav_3_3_4_2" id="__nav_3_3_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    22.2 Human behaviour patterns and their influence on ML/AI development
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_3_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_4_2">
            <span class="md-nav__icon md-icon"></span>
            22.2 Human behaviour patterns and their influence on ML/AI development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareAutomation/Chapter-22-Significance-and-impact/22-02-Human-behaviour-patterns-and-their-influence-on-ML-AI-development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareAutomation/Chapter-22-Significance-and-impact/22-02-Human-behaviour-patterns-and-their-influence-on-ML-AI-development/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_4_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3_4_3" id="__nav_3_3_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    22.3 Bias in datasets and models (expanded)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_3_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_4_3">
            <span class="md-nav__icon md-icon"></span>
            22.3 Bias in datasets and models (expanded)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareAutomation/Chapter-22-Significance-and-impact/22-03-Bias-in-datasets-and-models-expanded/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareAutomation/Chapter-22-Significance-and-impact/22-03-Bias-in-datasets-and-models-expanded/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Software Engineering Project
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Software Engineering Project
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_2" >
        
          
          <label class="md-nav__link" for="__nav_3_4_2" id="__nav_3_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 23 — Identifying and defining
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_2">
            <span class="md-nav__icon md-icon"></span>
            Chapter 23 — Identifying and defining
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_2_1" >
        
          
          <label class="md-nav__link" for="__nav_3_4_2_1" id="__nav_3_4_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    23.1 Requirements and feasibility
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_4_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_2_1">
            <span class="md-nav__icon md-icon"></span>
            23.1 Requirements and feasibility
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-23-Identifying-and-defining/23-01-Requirements-and-feasibility/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-23-Identifying-and-defining/23-01-Requirements-and-feasibility/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_2_2" >
        
          
          <label class="md-nav__link" for="__nav_3_4_2_2" id="__nav_3_4_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    23.2 Ideation and modelling tools
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_4_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_2_2">
            <span class="md-nav__icon md-icon"></span>
            23.2 Ideation and modelling tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-23-Identifying-and-defining/23-02-Ideation-and-modelling-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-23-Identifying-and-defining/23-02-Ideation-and-modelling-tools/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_2_3" >
        
          
          <label class="md-nav__link" for="__nav_3_4_2_3" id="__nav_3_4_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    23.3 Implementation methods
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_4_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_2_3">
            <span class="md-nav__icon md-icon"></span>
            23.3 Implementation methods
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-23-Identifying-and-defining/23-03-Implementation-methods/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-23-Identifying-and-defining/23-03-Implementation-methods/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_3" >
        
          
          <label class="md-nav__link" for="__nav_3_4_3" id="__nav_3_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 24 — Research and planning
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_3">
            <span class="md-nav__icon md-icon"></span>
            Chapter 24 — Research and planning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_4_3_1" id="__nav_3_4_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    24.1 Waterfall approach
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_4_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_3_1">
            <span class="md-nav__icon md-icon"></span>
            24.1 Waterfall approach
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-24-Research-and-planning/24-01-Waterfall-approach/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-24-Research-and-planning/24-01-Waterfall-approach/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_4_3_2" id="__nav_3_4_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    24.2 Agile approach
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_4_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_3_2">
            <span class="md-nav__icon md-icon"></span>
            24.2 Agile approach
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-24-Research-and-planning/24-02-Agile-approach/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-24-Research-and-planning/24-02-Agile-approach/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_4_3_3" id="__nav_3_4_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    24.3 WAgile hybrid approach
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_4_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_3_3">
            <span class="md-nav__icon md-icon"></span>
            24.3 WAgile hybrid approach
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-24-Research-and-planning/24-03-WAgile-hybrid-approach/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-24-Research-and-planning/24-03-WAgile-hybrid-approach/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4_3_4" id="__nav_3_4_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    24.4 Project management tools and Gantt
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_4_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_3_4">
            <span class="md-nav__icon md-icon"></span>
            24.4 Project management tools and Gantt
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-24-Research-and-planning/24-04-Project-management-tools-and-Gantt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-24-Research-and-planning/24-04-Project-management-tools-and-Gantt/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_4_3_5" id="__nav_3_4_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    24.5 Social, ethical and communication issues
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_4_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_3_5">
            <span class="md-nav__icon md-icon"></span>
            24.5 Social, ethical and communication issues
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-24-Research-and-planning/24-05-Social-ethical-and-communication-issues/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-24-Research-and-planning/24-05-Social-ethical-and-communication-issues/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_4_3_6" id="__nav_3_4_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    24.6 Quality assurance
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_4_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_3_6">
            <span class="md-nav__icon md-icon"></span>
            24.6 Quality assurance
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-24-Research-and-planning/24-06-Quality-assurance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-24-Research-and-planning/24-06-Quality-assurance/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4_4" id="__nav_3_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 25 — Producing and implementing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_4">
            <span class="md-nav__icon md-icon"></span>
            Chapter 25 — Producing and implementing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_4_1" >
        
          
          <label class="md-nav__link" for="__nav_3_4_4_1" id="__nav_3_4_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    25.1 Building the solution
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_4_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_4_1">
            <span class="md-nav__icon md-icon"></span>
            25.1 Building the solution
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-25-Producing-and-implementing/25-01-Building-the-solution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-25-Producing-and-implementing/25-01-Building-the-solution/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_4_2" >
        
          
          <label class="md-nav__link" for="__nav_3_4_4_2" id="__nav_3_4_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    25.2 Presenting the solution
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_4_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_4_2">
            <span class="md-nav__icon md-icon"></span>
            25.2 Presenting the solution
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-25-Producing-and-implementing/25-02-Presenting-the-solution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-25-Producing-and-implementing/25-02-Presenting-the-solution/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_4_3" >
        
          
          <label class="md-nav__link" for="__nav_3_4_4_3" id="__nav_3_4_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    25.3 Algorithms, documentation and resources
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_4_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_4_3">
            <span class="md-nav__icon md-icon"></span>
            25.3 Algorithms, documentation and resources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-25-Producing-and-implementing/25-03-Algorithms-documentation-and-resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-25-Producing-and-implementing/25-03-Algorithms-documentation-and-resources/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_4_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4_4_4" id="__nav_3_4_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    25.4 Data backup and version control
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_4_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_4_4">
            <span class="md-nav__icon md-icon"></span>
            25.4 Data backup and version control
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-25-Producing-and-implementing/25-04-Data-backup-and-version-control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-25-Producing-and-implementing/25-04-Data-backup-and-version-control/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_4_5" >
        
          
          <label class="md-nav__link" for="__nav_3_4_4_5" id="__nav_3_4_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    25.5 Overcoming development difficulties
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_4_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_4_5">
            <span class="md-nav__icon md-icon"></span>
            25.5 Overcoming development difficulties
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-25-Producing-and-implementing/25-05-Overcoming-development-difficulties/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-25-Producing-and-implementing/25-05-Overcoming-development-difficulties/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_4_6" >
        
          
          <label class="md-nav__link" for="__nav_3_4_4_6" id="__nav_3_4_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    25.6 Prototype and UI design
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_4_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_4_6">
            <span class="md-nav__icon md-icon"></span>
            25.6 Prototype and UI design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-25-Producing-and-implementing/25-06-Prototype-and-UI-design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-25-Producing-and-implementing/25-06-Prototype-and-UI-design/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_5" >
        
          
          <label class="md-nav__link" for="__nav_3_4_5" id="__nav_3_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 26 — Testing and evaluating
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_5">
            <span class="md-nav__icon md-icon"></span>
            Chapter 26 — Testing and evaluating
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_5_1" >
        
          
          <label class="md-nav__link" for="__nav_3_4_5_1" id="__nav_3_4_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    26.1 Testing methodologies and optimisation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_4_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_5_1">
            <span class="md-nav__icon md-icon"></span>
            26.1 Testing methodologies and optimisation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-26-Testing-and-evaluating/26-01-Testing-methodologies-and-optimisation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-26-Testing-and-evaluating/26-01-Testing-methodologies-and-optimisation/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_5_2" >
        
          
          <label class="md-nav__link" for="__nav_3_4_5_2" id="__nav_3_4_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    26.2 Feedback analysis
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_4_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_5_2">
            <span class="md-nav__icon md-icon"></span>
            26.2 Feedback analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-26-Testing-and-evaluating/26-02-Feedback-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-26-Testing-and-evaluating/26-02-Feedback-analysis/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_5_3" >
        
          
          <label class="md-nav__link" for="__nav_3_4_5_3" id="__nav_3_4_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    26.3 Evaluating the software solution
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_4_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_5_3">
            <span class="md-nav__icon md-icon"></span>
            26.3 Evaluating the software solution
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-26-Testing-and-evaluating/26-03-Evaluating-the-software-solution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SoftwareEngineeringProject/Chapter-26-Testing-and-evaluating/26-03-Evaluating-the-software-solution/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-it-matters" class="md-nav__link">
    <span class="md-ellipsis">
      Why It Matters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-security-principles-for-apis" class="md-nav__link">
    <span class="md-ellipsis">
      Core Security Principles for APIs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Security Principles for APIs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-defense-in-depth" class="md-nav__link">
    <span class="md-ellipsis">
      1. Defense in Depth
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-principle-of-least-privilege" class="md-nav__link">
    <span class="md-ellipsis">
      2. Principle of Least Privilege
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-fail-securely" class="md-nav__link">
    <span class="md-ellipsis">
      3. Fail Securely
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-security-by-design" class="md-nav__link">
    <span class="md-ellipsis">
      4. Security by Design
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-authentication-methods" class="md-nav__link">
    <span class="md-ellipsis">
      API Authentication Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Authentication Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-authentication-vs-authorization" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding Authentication vs Authorization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-api-keys" class="md-nav__link">
    <span class="md-ellipsis">
      1. API Keys
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. API Keys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-api-key-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Basic API Key Implementation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-key-security-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      API Key Security Best Practices
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-json-web-tokens-jwt" class="md-nav__link">
    <span class="md-ellipsis">
      2. JSON Web Tokens (JWT)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. JSON Web Tokens (JWT)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jwt-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      JWT Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-oauth-20-flow-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      3. OAuth 2.0 Flow Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rate-limiting-and-dos-protection" class="md-nav__link">
    <span class="md-ellipsis">
      Rate Limiting and DoS Protection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rate Limiting and DoS Protection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#token-bucket-algorithm-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Token Bucket Algorithm Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secure-session-management" class="md-nav__link">
    <span class="md-ellipsis">
      Secure Session Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Secure Session Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#session-security-principles" class="md-nav__link">
    <span class="md-ellipsis">
      Session Security Principles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comprehensive-session-manager-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Comprehensive Session Manager Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cors-and-cross-origin-security" class="md-nav__link">
    <span class="md-ellipsis">
      CORS and Cross-Origin Security
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CORS and Cross-Origin Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-cors-security-model" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding CORS Security Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comprehensive-cors-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Comprehensive CORS Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-security-testing" class="md-nav__link">
    <span class="md-ellipsis">
      API Security Testing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Security Testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#security-testing-methodology" class="md-nav__link">
    <span class="md-ellipsis">
      Security Testing Methodology
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automated-security-testing-framework" class="md-nav__link">
    <span class="md-ellipsis">
      Automated Security Testing Framework
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-a-complete-secure-rest-api" class="md-nav__link">
    <span class="md-ellipsis">
      Building a Complete Secure REST API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Building a Complete Secure REST API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#secure-api-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Secure API Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complete-secure-api-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Secure API Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary-and-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Summary and Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary and Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#essential-security-principles" class="md-nav__link">
    <span class="md-ellipsis">
      Essential Security Principles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Checklist
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Checklist">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-keys" class="md-nav__link">
    <span class="md-ellipsis">
      API Keys
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jwt-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      JWT Tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauth-20" class="md-nav__link">
    <span class="md-ellipsis">
      OAuth 2.0
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token-bucket-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Token Bucket Algorithm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#progressive-penalties" class="md-nav__link">
    <span class="md-ellipsis">
      Progressive Penalties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secure-session-ids" class="md-nav__link">
    <span class="md-ellipsis">
      Secure Session IDs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-features" class="md-nav__link">
    <span class="md-ellipsis">
      Security Features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#origin-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Origin Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Security Patterns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automated-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Automated Testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comprehensive-coverage" class="md-nav__link">
    <span class="md-ellipsis">
      Comprehensive Coverage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production-deployment-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Production Deployment Considerations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-pitfalls-to-avoid" class="md-nav__link">
    <span class="md-ellipsis">
      Common Pitfalls to Avoid
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practice-questions-and-exercises" class="md-nav__link">
    <span class="md-ellipsis">
      Practice Questions and Exercises
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Practice Questions and Exercises">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-1-secure-registration-system" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 1: Secure Registration System
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-2-api-rate-limiter" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 2: API Rate Limiter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-3-cors-security-manager" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 3: CORS Security Manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-4-security-testing-suite" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 4: Security Testing Suite
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-study-e-commerce-api-security-breach" class="md-nav__link">
    <span class="md-ellipsis">
      Case Study: E-commerce API Security Breach
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      Summary Checklist
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary Checklist">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication-authorization" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication &amp; Authorization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rate-limiting-dos-protection" class="md-nav__link">
    <span class="md-ellipsis">
      Rate Limiting &amp; DoS Protection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#input-validation-sanitization" class="md-nav__link">
    <span class="md-ellipsis">
      Input Validation &amp; Sanitization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#session-management" class="md-nav__link">
    <span class="md-ellipsis">
      Session Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cors-cross-origin-security" class="md-nav__link">
    <span class="md-ellipsis">
      CORS &amp; Cross-Origin Security
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Monitoring &amp; Testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-security" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment Security
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/Eatham532/Software-Engineering-HSC-Textbook/edit/main/docs/Year12/SecureSoftwareArchitecture/Chapter-17-System-Security-and-APIs/17-01-Secure-API-Design/index.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/Eatham532/Software-Engineering-HSC-Textbook/raw/main/docs/Year12/SecureSoftwareArchitecture/Chapter-17-System-Security-and-APIs/17-01-Secure-API-Design/index.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="171-secure-api-design">17.1 Secure API Design<a class="headerlink" href="#171-secure-api-design" title="Permanent link">&para;</a></h1>
<h2 id="why-it-matters">Why It Matters<a class="headerlink" href="#why-it-matters" title="Permanent link">&para;</a></h2>
<p>APIs (Application Programming Interfaces) are the backbone of modern applications, enabling communication between different systems, services, and client applications. However, APIs also represent significant attack surfaces that can expose sensitive data, business logic, and system resources to malicious actors.</p>
<p><strong>Real-world Impact:</strong></p>
<ul>
<li>
<p><strong>2019 Facebook API breach</strong>: Exposed 50 million user accounts through improper access token validation</p>
</li>
<li>
<p><strong>2021 Peloton API vulnerability</strong>: Allowed unauthorized access to private user data through missing authentication</p>
</li>
<li>
<p><strong>2020 Venmo API issue</strong>: Public transaction data accessible without proper authorization controls</p>
</li>
</ul>
<p>Secure API design is critical because APIs often:</p>
<ul>
<li>
<p>Handle sensitive user data and business information</p>
</li>
<li>
<p>Provide direct access to backend systems and databases</p>
</li>
<li>
<p>Are exposed to public networks and untrusted clients</p>
</li>
<li>
<p>Serve as integration points between multiple applications</p>
</li>
</ul>
<h2 id="core-security-principles-for-apis">Core Security Principles for APIs<a class="headerlink" href="#core-security-principles-for-apis" title="Permanent link">&para;</a></h2>
<h3 id="1-defense-in-depth">1. Defense in Depth<a class="headerlink" href="#1-defense-in-depth" title="Permanent link">&para;</a></h3>
<p>Implement multiple layers of security controls rather than relying on a single protection mechanism.</p>
<h3 id="2-principle-of-least-privilege">2. Principle of Least Privilege<a class="headerlink" href="#2-principle-of-least-privilege" title="Permanent link">&para;</a></h3>
<p>Grant the minimum access necessary for each API consumer to perform their intended function.</p>
<h3 id="3-fail-securely">3. Fail Securely<a class="headerlink" href="#3-fail-securely" title="Permanent link">&para;</a></h3>
<p>When errors occur, ensure the system fails to a secure state rather than exposing sensitive information.</p>
<h3 id="4-security-by-design">4. Security by Design<a class="headerlink" href="#4-security-by-design" title="Permanent link">&para;</a></h3>
<p>Build security controls into the API from the initial design phase, not as an afterthought.</p>
<h2 id="api-authentication-methods">API Authentication Methods<a class="headerlink" href="#api-authentication-methods" title="Permanent link">&para;</a></h2>
<h3 id="understanding-authentication-vs-authorization">Understanding Authentication vs Authorization<a class="headerlink" href="#understanding-authentication-vs-authorization" title="Permanent link">&para;</a></h3>
<p><strong>Authentication</strong> answers &ldquo;Who are you?&rdquo; - verifying the identity of the API consumer.
<strong>Authorization</strong> answers &ldquo;What can you do?&rdquo; - determining what resources and actions are permitted.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>@startuml API_Auth_Flow
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>!theme plain
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>skinparam backgroundColor white
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>skinparam defaultFontName &quot;Arial&quot;
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>actor Client
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>participant &quot;API Gateway&quot; as Gateway
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>participant &quot;Auth Service&quot; as Auth
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>participant &quot;API Service&quot; as API
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>database &quot;User DB&quot; as DB
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>Client -&gt; Gateway: API Request + Credentials
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>Gateway -&gt; Auth: Authenticate
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>Auth -&gt; DB: Validate Credentials
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>DB -&gt; Auth: User Info
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>Auth -&gt; Gateway: Authentication Token
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>Gateway -&gt; API: Authorized Request
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>API -&gt; Gateway: Response
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>Gateway -&gt; Client: API Response
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>@enduml
</span></code></pre></div>
<h3 id="1-api-keys">1. API Keys<a class="headerlink" href="#1-api-keys" title="Permanent link">&para;</a></h3>
<p>API keys are simple tokens that identify and authenticate API consumers. While easy to implement, they have significant limitations.</p>
<h4 id="basic-api-key-implementation">Basic API Key Implementation<a class="headerlink" href="#basic-api-key-implementation" title="Permanent link">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">secrets</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="nd">@dataclass</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">APIKey</span><span class="p">:</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents an API key with metadata&quot;&quot;&quot;</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>    <span class="n">key_id</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>    <span class="n">key_hash</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># Hashed version of the actual key</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>    <span class="n">expires_at</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>    <span class="n">is_active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>    <span class="n">rate_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># requests per hour</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>    <span class="n">allowed_endpoints</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># None means all endpoints</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="k">class</span><span class="w"> </span><span class="nc">APIKeyManager</span><span class="p">:</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Secure API key management system&quot;&quot;&quot;</span>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">APIKey</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">usage_tracking</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_api_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">expires_days</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a>                        <span class="n">rate_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">allowed_endpoints</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="sd">        Generate a new API key</span>
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="sd">        Returns: (key_id, actual_key) - store key_id, give actual_key to user</span>
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a>        <span class="c1"># Generate cryptographically secure key</span>
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a>        <span class="n">actual_key</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a>        <span class="n">key_id</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a>
</span><span id="__span-1-37"><a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a>        <span class="c1"># Hash the key for storage (never store plain text keys)</span>
</span><span id="__span-1-38"><a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a>        <span class="n">key_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">actual_key</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</span><span id="__span-1-39"><a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a>
</span><span id="__span-1-40"><a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a>        <span class="c1"># Set expiration</span>
</span><span id="__span-1-41"><a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a>        <span class="n">expires_at</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-1-42"><a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a>        <span class="k">if</span> <span class="n">expires_days</span><span class="p">:</span>
</span><span id="__span-1-43"><a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a>            <span class="n">expires_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">expires_days</span><span class="p">)</span>
</span><span id="__span-1-44"><a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a>
</span><span id="__span-1-45"><a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a>        <span class="c1"># Create API key record</span>
</span><span id="__span-1-46"><a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a>        <span class="n">api_key</span> <span class="o">=</span> <span class="n">APIKey</span><span class="p">(</span>
</span><span id="__span-1-47"><a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a>            <span class="n">key_id</span><span class="o">=</span><span class="n">key_id</span><span class="p">,</span>
</span><span id="__span-1-48"><a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a>            <span class="n">key_hash</span><span class="o">=</span><span class="n">key_hash</span><span class="p">,</span>
</span><span id="__span-1-49"><a id="__codelineno-1-49" name="__codelineno-1-49" href="#__codelineno-1-49"></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="__span-1-50"><a id="__codelineno-1-50" name="__codelineno-1-50" href="#__codelineno-1-50"></a>            <span class="n">created_at</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
</span><span id="__span-1-51"><a id="__codelineno-1-51" name="__codelineno-1-51" href="#__codelineno-1-51"></a>            <span class="n">expires_at</span><span class="o">=</span><span class="n">expires_at</span><span class="p">,</span>
</span><span id="__span-1-52"><a id="__codelineno-1-52" name="__codelineno-1-52" href="#__codelineno-1-52"></a>            <span class="n">rate_limit</span><span class="o">=</span><span class="n">rate_limit</span><span class="p">,</span>
</span><span id="__span-1-53"><a id="__codelineno-1-53" name="__codelineno-1-53" href="#__codelineno-1-53"></a>            <span class="n">allowed_endpoints</span><span class="o">=</span><span class="n">allowed_endpoints</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span id="__span-1-54"><a id="__codelineno-1-54" name="__codelineno-1-54" href="#__codelineno-1-54"></a>        <span class="p">)</span>
</span><span id="__span-1-55"><a id="__codelineno-1-55" name="__codelineno-1-55" href="#__codelineno-1-55"></a>
</span><span id="__span-1-56"><a id="__codelineno-1-56" name="__codelineno-1-56" href="#__codelineno-1-56"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="n">key_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">api_key</span>
</span><span id="__span-1-57"><a id="__codelineno-1-57" name="__codelineno-1-57" href="#__codelineno-1-57"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">usage_tracking</span><span class="p">[</span><span class="n">key_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-1-58"><a id="__codelineno-1-58" name="__codelineno-1-58" href="#__codelineno-1-58"></a>
</span><span id="__span-1-59"><a id="__codelineno-1-59" name="__codelineno-1-59" href="#__codelineno-1-59"></a>        <span class="k">return</span> <span class="n">key_id</span><span class="p">,</span> <span class="n">actual_key</span>
</span><span id="__span-1-60"><a id="__codelineno-1-60" name="__codelineno-1-60" href="#__codelineno-1-60"></a>
</span><span id="__span-1-61"><a id="__codelineno-1-61" name="__codelineno-1-61" href="#__codelineno-1-61"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_api_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provided_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">APIKey</span><span class="p">]:</span>
</span><span id="__span-1-62"><a id="__codelineno-1-62" name="__codelineno-1-62" href="#__codelineno-1-62"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-1-63"><a id="__codelineno-1-63" name="__codelineno-1-63" href="#__codelineno-1-63"></a><span class="sd">        Validate an API key and return associated metadata</span>
</span><span id="__span-1-64"><a id="__codelineno-1-64" name="__codelineno-1-64" href="#__codelineno-1-64"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-1-65"><a id="__codelineno-1-65" name="__codelineno-1-65" href="#__codelineno-1-65"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">provided_key</span><span class="p">:</span>
</span><span id="__span-1-66"><a id="__codelineno-1-66" name="__codelineno-1-66" href="#__codelineno-1-66"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-1-67"><a id="__codelineno-1-67" name="__codelineno-1-67" href="#__codelineno-1-67"></a>
</span><span id="__span-1-68"><a id="__codelineno-1-68" name="__codelineno-1-68" href="#__codelineno-1-68"></a>        <span class="c1"># Hash the provided key</span>
</span><span id="__span-1-69"><a id="__codelineno-1-69" name="__codelineno-1-69" href="#__codelineno-1-69"></a>        <span class="n">provided_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">provided_key</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</span><span id="__span-1-70"><a id="__codelineno-1-70" name="__codelineno-1-70" href="#__codelineno-1-70"></a>
</span><span id="__span-1-71"><a id="__codelineno-1-71" name="__codelineno-1-71" href="#__codelineno-1-71"></a>        <span class="c1"># Find matching key</span>
</span><span id="__span-1-72"><a id="__codelineno-1-72" name="__codelineno-1-72" href="#__codelineno-1-72"></a>        <span class="k">for</span> <span class="n">key_id</span><span class="p">,</span> <span class="n">api_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-1-73"><a id="__codelineno-1-73" name="__codelineno-1-73" href="#__codelineno-1-73"></a>            <span class="k">if</span> <span class="n">api_key</span><span class="o">.</span><span class="n">key_hash</span> <span class="o">==</span> <span class="n">provided_hash</span><span class="p">:</span>
</span><span id="__span-1-74"><a id="__codelineno-1-74" name="__codelineno-1-74" href="#__codelineno-1-74"></a>                <span class="c1"># Check if key is active</span>
</span><span id="__span-1-75"><a id="__codelineno-1-75" name="__codelineno-1-75" href="#__codelineno-1-75"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">api_key</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
</span><span id="__span-1-76"><a id="__codelineno-1-76" name="__codelineno-1-76" href="#__codelineno-1-76"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-1-77"><a id="__codelineno-1-77" name="__codelineno-1-77" href="#__codelineno-1-77"></a>
</span><span id="__span-1-78"><a id="__codelineno-1-78" name="__codelineno-1-78" href="#__codelineno-1-78"></a>                <span class="c1"># Check if key has expired</span>
</span><span id="__span-1-79"><a id="__codelineno-1-79" name="__codelineno-1-79" href="#__codelineno-1-79"></a>                <span class="k">if</span> <span class="n">api_key</span><span class="o">.</span><span class="n">expires_at</span> <span class="ow">and</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">api_key</span><span class="o">.</span><span class="n">expires_at</span><span class="p">:</span>
</span><span id="__span-1-80"><a id="__codelineno-1-80" name="__codelineno-1-80" href="#__codelineno-1-80"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-1-81"><a id="__codelineno-1-81" name="__codelineno-1-81" href="#__codelineno-1-81"></a>
</span><span id="__span-1-82"><a id="__codelineno-1-82" name="__codelineno-1-82" href="#__codelineno-1-82"></a>                <span class="k">return</span> <span class="n">api_key</span>
</span><span id="__span-1-83"><a id="__codelineno-1-83" name="__codelineno-1-83" href="#__codelineno-1-83"></a>
</span><span id="__span-1-84"><a id="__codelineno-1-84" name="__codelineno-1-84" href="#__codelineno-1-84"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-1-85"><a id="__codelineno-1-85" name="__codelineno-1-85" href="#__codelineno-1-85"></a>
</span><span id="__span-1-86"><a id="__codelineno-1-86" name="__codelineno-1-86" href="#__codelineno-1-86"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">revoke_api_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-1-87"><a id="__codelineno-1-87" name="__codelineno-1-87" href="#__codelineno-1-87"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Revoke an API key&quot;&quot;&quot;</span>
</span><span id="__span-1-88"><a id="__codelineno-1-88" name="__codelineno-1-88" href="#__codelineno-1-88"></a>        <span class="k">if</span> <span class="n">key_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">:</span>
</span><span id="__span-1-89"><a id="__codelineno-1-89" name="__codelineno-1-89" href="#__codelineno-1-89"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="n">key_id</span><span class="p">]</span><span class="o">.</span><span class="n">is_active</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-1-90"><a id="__codelineno-1-90" name="__codelineno-1-90" href="#__codelineno-1-90"></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-1-91"><a id="__codelineno-1-91" name="__codelineno-1-91" href="#__codelineno-1-91"></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-1-92"><a id="__codelineno-1-92" name="__codelineno-1-92" href="#__codelineno-1-92"></a>
</span><span id="__span-1-93"><a id="__codelineno-1-93" name="__codelineno-1-93" href="#__codelineno-1-93"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">track_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-1-94"><a id="__codelineno-1-94" name="__codelineno-1-94" href="#__codelineno-1-94"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Track API key usage for rate limiting&quot;&quot;&quot;</span>
</span><span id="__span-1-95"><a id="__codelineno-1-95" name="__codelineno-1-95" href="#__codelineno-1-95"></a>        <span class="k">if</span> <span class="n">key_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage_tracking</span><span class="p">:</span>
</span><span id="__span-1-96"><a id="__codelineno-1-96" name="__codelineno-1-96" href="#__codelineno-1-96"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">usage_tracking</span><span class="p">[</span><span class="n">key_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-1-97"><a id="__codelineno-1-97" name="__codelineno-1-97" href="#__codelineno-1-97"></a>
</span><span id="__span-1-98"><a id="__codelineno-1-98" name="__codelineno-1-98" href="#__codelineno-1-98"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">usage_tracking</span><span class="p">[</span><span class="n">key_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-1-99"><a id="__codelineno-1-99" name="__codelineno-1-99" href="#__codelineno-1-99"></a>            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
</span><span id="__span-1-100"><a id="__codelineno-1-100" name="__codelineno-1-100" href="#__codelineno-1-100"></a>            <span class="s1">&#39;endpoint&#39;</span><span class="p">:</span> <span class="n">endpoint</span>
</span><span id="__span-1-101"><a id="__codelineno-1-101" name="__codelineno-1-101" href="#__codelineno-1-101"></a>        <span class="p">})</span>
</span><span id="__span-1-102"><a id="__codelineno-1-102" name="__codelineno-1-102" href="#__codelineno-1-102"></a>
</span><span id="__span-1-103"><a id="__codelineno-1-103" name="__codelineno-1-103" href="#__codelineno-1-103"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_rate_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-1-104"><a id="__codelineno-1-104" name="__codelineno-1-104" href="#__codelineno-1-104"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if API key is within rate limit (last hour)&quot;&quot;&quot;</span>
</span><span id="__span-1-105"><a id="__codelineno-1-105" name="__codelineno-1-105" href="#__codelineno-1-105"></a>        <span class="k">if</span> <span class="n">key_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage_tracking</span><span class="p">:</span>
</span><span id="__span-1-106"><a id="__codelineno-1-106" name="__codelineno-1-106" href="#__codelineno-1-106"></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-1-107"><a id="__codelineno-1-107" name="__codelineno-1-107" href="#__codelineno-1-107"></a>
</span><span id="__span-1-108"><a id="__codelineno-1-108" name="__codelineno-1-108" href="#__codelineno-1-108"></a>        <span class="n">api_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key_id</span><span class="p">)</span>
</span><span id="__span-1-109"><a id="__codelineno-1-109" name="__codelineno-1-109" href="#__codelineno-1-109"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">api_key</span><span class="p">:</span>
</span><span id="__span-1-110"><a id="__codelineno-1-110" name="__codelineno-1-110" href="#__codelineno-1-110"></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-1-111"><a id="__codelineno-1-111" name="__codelineno-1-111" href="#__codelineno-1-111"></a>
</span><span id="__span-1-112"><a id="__codelineno-1-112" name="__codelineno-1-112" href="#__codelineno-1-112"></a>        <span class="c1"># Count requests in the last hour</span>
</span><span id="__span-1-113"><a id="__codelineno-1-113" name="__codelineno-1-113" href="#__codelineno-1-113"></a>        <span class="n">one_hour_ago</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-1-114"><a id="__codelineno-1-114" name="__codelineno-1-114" href="#__codelineno-1-114"></a>        <span class="n">recent_requests</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-1-115"><a id="__codelineno-1-115" name="__codelineno-1-115" href="#__codelineno-1-115"></a>            <span class="n">req</span> <span class="k">for</span> <span class="n">req</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage_tracking</span><span class="p">[</span><span class="n">key_id</span><span class="p">]</span>
</span><span id="__span-1-116"><a id="__codelineno-1-116" name="__codelineno-1-116" href="#__codelineno-1-116"></a>            <span class="k">if</span> <span class="n">req</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">one_hour_ago</span>
</span><span id="__span-1-117"><a id="__codelineno-1-117" name="__codelineno-1-117" href="#__codelineno-1-117"></a>        <span class="p">]</span>
</span><span id="__span-1-118"><a id="__codelineno-1-118" name="__codelineno-1-118" href="#__codelineno-1-118"></a>
</span><span id="__span-1-119"><a id="__codelineno-1-119" name="__codelineno-1-119" href="#__codelineno-1-119"></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_requests</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">api_key</span><span class="o">.</span><span class="n">rate_limit</span>
</span><span id="__span-1-120"><a id="__codelineno-1-120" name="__codelineno-1-120" href="#__codelineno-1-120"></a>
</span><span id="__span-1-121"><a id="__codelineno-1-121" name="__codelineno-1-121" href="#__codelineno-1-121"></a><span class="c1"># Example usage</span>
</span><span id="__span-1-122"><a id="__codelineno-1-122" name="__codelineno-1-122" href="#__codelineno-1-122"></a><span class="k">def</span><span class="w"> </span><span class="nf">api_key_authentication_example</span><span class="p">():</span>
</span><span id="__span-1-123"><a id="__codelineno-1-123" name="__codelineno-1-123" href="#__codelineno-1-123"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate API key authentication&quot;&quot;&quot;</span>
</span><span id="__span-1-124"><a id="__codelineno-1-124" name="__codelineno-1-124" href="#__codelineno-1-124"></a>    <span class="n">key_manager</span> <span class="o">=</span> <span class="n">APIKeyManager</span><span class="p">()</span>
</span><span id="__span-1-125"><a id="__codelineno-1-125" name="__codelineno-1-125" href="#__codelineno-1-125"></a>
</span><span id="__span-1-126"><a id="__codelineno-1-126" name="__codelineno-1-126" href="#__codelineno-1-126"></a>    <span class="c1"># Generate API key for a client</span>
</span><span id="__span-1-127"><a id="__codelineno-1-127" name="__codelineno-1-127" href="#__codelineno-1-127"></a>    <span class="n">key_id</span><span class="p">,</span> <span class="n">actual_key</span> <span class="o">=</span> <span class="n">key_manager</span><span class="o">.</span><span class="n">generate_api_key</span><span class="p">(</span>
</span><span id="__span-1-128"><a id="__codelineno-1-128" name="__codelineno-1-128" href="#__codelineno-1-128"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Mobile App Client&quot;</span><span class="p">,</span>
</span><span id="__span-1-129"><a id="__codelineno-1-129" name="__codelineno-1-129" href="#__codelineno-1-129"></a>        <span class="n">expires_days</span><span class="o">=</span><span class="mi">365</span><span class="p">,</span>
</span><span id="__span-1-130"><a id="__codelineno-1-130" name="__codelineno-1-130" href="#__codelineno-1-130"></a>        <span class="n">rate_limit</span><span class="o">=</span><span class="mi">5000</span>
</span><span id="__span-1-131"><a id="__codelineno-1-131" name="__codelineno-1-131" href="#__codelineno-1-131"></a>    <span class="p">)</span>
</span><span id="__span-1-132"><a id="__codelineno-1-132" name="__codelineno-1-132" href="#__codelineno-1-132"></a>
</span><span id="__span-1-133"><a id="__codelineno-1-133" name="__codelineno-1-133" href="#__codelineno-1-133"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated API Key ID: </span><span class="si">{</span><span class="n">key_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-1-134"><a id="__codelineno-1-134" name="__codelineno-1-134" href="#__codelineno-1-134"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;API Key (give to client): </span><span class="si">{</span><span class="n">actual_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-1-135"><a id="__codelineno-1-135" name="__codelineno-1-135" href="#__codelineno-1-135"></a>
</span><span id="__span-1-136"><a id="__codelineno-1-136" name="__codelineno-1-136" href="#__codelineno-1-136"></a>    <span class="c1"># Simulate API request validation</span>
</span><span id="__span-1-137"><a id="__codelineno-1-137" name="__codelineno-1-137" href="#__codelineno-1-137"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">authenticate_request</span><span class="p">(</span><span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="__span-1-138"><a id="__codelineno-1-138" name="__codelineno-1-138" href="#__codelineno-1-138"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Simulate API request authentication&quot;&quot;&quot;</span>
</span><span id="__span-1-139"><a id="__codelineno-1-139" name="__codelineno-1-139" href="#__codelineno-1-139"></a>        <span class="n">validated_key</span> <span class="o">=</span> <span class="n">key_manager</span><span class="o">.</span><span class="n">validate_api_key</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>
</span><span id="__span-1-140"><a id="__codelineno-1-140" name="__codelineno-1-140" href="#__codelineno-1-140"></a>
</span><span id="__span-1-141"><a id="__codelineno-1-141" name="__codelineno-1-141" href="#__codelineno-1-141"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">validated_key</span><span class="p">:</span>
</span><span id="__span-1-142"><a id="__codelineno-1-142" name="__codelineno-1-142" href="#__codelineno-1-142"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid or expired API key&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="mi">401</span><span class="p">}</span>
</span><span id="__span-1-143"><a id="__codelineno-1-143" name="__codelineno-1-143" href="#__codelineno-1-143"></a>
</span><span id="__span-1-144"><a id="__codelineno-1-144" name="__codelineno-1-144" href="#__codelineno-1-144"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">key_manager</span><span class="o">.</span><span class="n">check_rate_limit</span><span class="p">(</span><span class="n">validated_key</span><span class="o">.</span><span class="n">key_id</span><span class="p">):</span>
</span><span id="__span-1-145"><a id="__codelineno-1-145" name="__codelineno-1-145" href="#__codelineno-1-145"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Rate limit exceeded&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="mi">429</span><span class="p">}</span>
</span><span id="__span-1-146"><a id="__codelineno-1-146" name="__codelineno-1-146" href="#__codelineno-1-146"></a>
</span><span id="__span-1-147"><a id="__codelineno-1-147" name="__codelineno-1-147" href="#__codelineno-1-147"></a>        <span class="c1"># Track the usage</span>
</span><span id="__span-1-148"><a id="__codelineno-1-148" name="__codelineno-1-148" href="#__codelineno-1-148"></a>        <span class="n">key_manager</span><span class="o">.</span><span class="n">track_usage</span><span class="p">(</span><span class="n">validated_key</span><span class="o">.</span><span class="n">key_id</span><span class="p">,</span> <span class="s2">&quot;/api/endpoint&quot;</span><span class="p">)</span>
</span><span id="__span-1-149"><a id="__codelineno-1-149" name="__codelineno-1-149" href="#__codelineno-1-149"></a>
</span><span id="__span-1-150"><a id="__codelineno-1-150" name="__codelineno-1-150" href="#__codelineno-1-150"></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-1-151"><a id="__codelineno-1-151" name="__codelineno-1-151" href="#__codelineno-1-151"></a>            <span class="s2">&quot;authenticated&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-1-152"><a id="__codelineno-1-152" name="__codelineno-1-152" href="#__codelineno-1-152"></a>            <span class="s2">&quot;key_name&quot;</span><span class="p">:</span> <span class="n">validated_key</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="__span-1-153"><a id="__codelineno-1-153" name="__codelineno-1-153" href="#__codelineno-1-153"></a>            <span class="s2">&quot;remaining_requests&quot;</span><span class="p">:</span> <span class="n">validated_key</span><span class="o">.</span><span class="n">rate_limit</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span>
</span><span id="__span-1-154"><a id="__codelineno-1-154" name="__codelineno-1-154" href="#__codelineno-1-154"></a>                <span class="n">key_manager</span><span class="o">.</span><span class="n">usage_tracking</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">validated_key</span><span class="o">.</span><span class="n">key_id</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="__span-1-155"><a id="__codelineno-1-155" name="__codelineno-1-155" href="#__codelineno-1-155"></a>            <span class="p">)</span>
</span><span id="__span-1-156"><a id="__codelineno-1-156" name="__codelineno-1-156" href="#__codelineno-1-156"></a>        <span class="p">}</span>
</span><span id="__span-1-157"><a id="__codelineno-1-157" name="__codelineno-1-157" href="#__codelineno-1-157"></a>
</span><span id="__span-1-158"><a id="__codelineno-1-158" name="__codelineno-1-158" href="#__codelineno-1-158"></a>    <span class="c1"># Test authentication</span>
</span><span id="__span-1-159"><a id="__codelineno-1-159" name="__codelineno-1-159" href="#__codelineno-1-159"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_request</span><span class="p">(</span><span class="n">actual_key</span><span class="p">)</span>
</span><span id="__span-1-160"><a id="__codelineno-1-160" name="__codelineno-1-160" href="#__codelineno-1-160"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Authentication result: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-1-161"><a id="__codelineno-1-161" name="__codelineno-1-161" href="#__codelineno-1-161"></a>
</span><span id="__span-1-162"><a id="__codelineno-1-162" name="__codelineno-1-162" href="#__codelineno-1-162"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-1-163"><a id="__codelineno-1-163" name="__codelineno-1-163" href="#__codelineno-1-163"></a>    <span class="n">api_key_authentication_example</span><span class="p">()</span>
</span></code></pre></div>
<h4 id="api-key-security-best-practices">API Key Security Best Practices<a class="headerlink" href="#api-key-security-best-practices" title="Permanent link">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">SecureAPIKeyValidator</span><span class="p">:</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Enhanced API key validation with security features&quot;&quot;&quot;</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">failed_attempts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">blocked_ips</span><span class="p">:</span> <span class="nb">set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_with_security_checks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_ip</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>                                    <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate API key with additional security checks&quot;&quot;&quot;</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>        <span class="c1"># Check if IP is blocked</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>        <span class="k">if</span> <span class="n">client_ip</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocked_ips</span><span class="p">:</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;IP address blocked&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="mi">403</span><span class="p">}</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>        <span class="c1"># Rate limiting on failed attempts</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_brute_force_attempts</span><span class="p">(</span><span class="n">client_ip</span><span class="p">):</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_block_ip</span><span class="p">(</span><span class="n">client_ip</span><span class="p">)</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Too many failed attempts&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="mi">429</span><span class="p">}</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>        <span class="c1"># Validate API key</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_valid_api_key_format</span><span class="p">(</span><span class="n">api_key</span><span class="p">):</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_track_failed_attempt</span><span class="p">(</span><span class="n">client_ip</span><span class="p">)</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid API key format&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="mi">400</span><span class="p">}</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>        <span class="c1"># Additional timing attack protection</span>
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># Constant time delay</span>
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>
</span><span id="__span-2-29"><a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;validated&quot;</span><span class="p">}</span>
</span><span id="__span-2-30"><a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>
</span><span id="__span-2-31"><a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_is_valid_api_key_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-2-32"><a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate API key format to prevent injection&quot;&quot;&quot;</span>
</span><span id="__span-2-33"><a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">api_key</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
</span><span id="__span-2-34"><a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-2-35"><a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a>
</span><span id="__span-2-36"><a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a>        <span class="c1"># Check for only alphanumeric and safe characters</span>
</span><span id="__span-2-37"><a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
</span><span id="__span-2-38"><a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[A-Za-z0-9_-]+$&#39;</span><span class="p">,</span> <span class="n">api_key</span><span class="p">):</span>
</span><span id="__span-2-39"><a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-2-40"><a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a>
</span><span id="__span-2-41"><a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-2-42"><a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a>
</span><span id="__span-2-43"><a id="__codelineno-2-43" name="__codelineno-2-43" href="#__codelineno-2-43"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_track_failed_attempt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_ip</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-2-44"><a id="__codelineno-2-44" name="__codelineno-2-44" href="#__codelineno-2-44"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Track failed authentication attempts&quot;&quot;&quot;</span>
</span><span id="__span-2-45"><a id="__codelineno-2-45" name="__codelineno-2-45" href="#__codelineno-2-45"></a>        <span class="k">if</span> <span class="n">client_ip</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">failed_attempts</span><span class="p">:</span>
</span><span id="__span-2-46"><a id="__codelineno-2-46" name="__codelineno-2-46" href="#__codelineno-2-46"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">client_ip</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-2-47"><a id="__codelineno-2-47" name="__codelineno-2-47" href="#__codelineno-2-47"></a>
</span><span id="__span-2-48"><a id="__codelineno-2-48" name="__codelineno-2-48" href="#__codelineno-2-48"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">client_ip</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
</span><span id="__span-2-49"><a id="__codelineno-2-49" name="__codelineno-2-49" href="#__codelineno-2-49"></a>
</span><span id="__span-2-50"><a id="__codelineno-2-50" name="__codelineno-2-50" href="#__codelineno-2-50"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_brute_force_attempts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_ip</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-2-51"><a id="__codelineno-2-51" name="__codelineno-2-51" href="#__codelineno-2-51"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if IP has too many failed attempts&quot;&quot;&quot;</span>
</span><span id="__span-2-52"><a id="__codelineno-2-52" name="__codelineno-2-52" href="#__codelineno-2-52"></a>        <span class="k">if</span> <span class="n">client_ip</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">failed_attempts</span><span class="p">:</span>
</span><span id="__span-2-53"><a id="__codelineno-2-53" name="__codelineno-2-53" href="#__codelineno-2-53"></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-2-54"><a id="__codelineno-2-54" name="__codelineno-2-54" href="#__codelineno-2-54"></a>
</span><span id="__span-2-55"><a id="__codelineno-2-55" name="__codelineno-2-55" href="#__codelineno-2-55"></a>        <span class="c1"># Check last 15 minutes</span>
</span><span id="__span-2-56"><a id="__codelineno-2-56" name="__codelineno-2-56" href="#__codelineno-2-56"></a>        <span class="n">fifteen_min_ago</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</span><span id="__span-2-57"><a id="__codelineno-2-57" name="__codelineno-2-57" href="#__codelineno-2-57"></a>        <span class="n">recent_failures</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-2-58"><a id="__codelineno-2-58" name="__codelineno-2-58" href="#__codelineno-2-58"></a>            <span class="n">attempt</span> <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">client_ip</span><span class="p">]</span>
</span><span id="__span-2-59"><a id="__codelineno-2-59" name="__codelineno-2-59" href="#__codelineno-2-59"></a>            <span class="k">if</span> <span class="n">attempt</span> <span class="o">&gt;</span> <span class="n">fifteen_min_ago</span>
</span><span id="__span-2-60"><a id="__codelineno-2-60" name="__codelineno-2-60" href="#__codelineno-2-60"></a>        <span class="p">]</span>
</span><span id="__span-2-61"><a id="__codelineno-2-61" name="__codelineno-2-61" href="#__codelineno-2-61"></a>
</span><span id="__span-2-62"><a id="__codelineno-2-62" name="__codelineno-2-62" href="#__codelineno-2-62"></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_failures</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span>  <span class="c1"># More than 10 failures in 15 minutes</span>
</span><span id="__span-2-63"><a id="__codelineno-2-63" name="__codelineno-2-63" href="#__codelineno-2-63"></a>
</span><span id="__span-2-64"><a id="__codelineno-2-64" name="__codelineno-2-64" href="#__codelineno-2-64"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_block_ip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_ip</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-2-65"><a id="__codelineno-2-65" name="__codelineno-2-65" href="#__codelineno-2-65"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Block an IP address&quot;&quot;&quot;</span>
</span><span id="__span-2-66"><a id="__codelineno-2-66" name="__codelineno-2-66" href="#__codelineno-2-66"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">blocked_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">client_ip</span><span class="p">)</span>
</span><span id="__span-2-67"><a id="__codelineno-2-67" name="__codelineno-2-67" href="#__codelineno-2-67"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Blocked IP </span><span class="si">{</span><span class="n">client_ip</span><span class="si">}</span><span class="s2"> due to suspicious activity&quot;</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="2-json-web-tokens-jwt">2. JSON Web Tokens (JWT)<a class="headerlink" href="#2-json-web-tokens-jwt" title="Permanent link">&para;</a></h3>
<p>JWTs provide a stateless authentication mechanism that can carry user information and permissions within the token itself.</p>
<h4 id="jwt-implementation">JWT Implementation<a class="headerlink" href="#jwt-implementation" title="Permanent link">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jwt</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">JWTManager</span><span class="p">:</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Secure JWT token management&quot;&quot;&quot;</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;HS256&quot;</span><span class="p">):</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="n">secret_key</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">=</span> <span class="n">algorithm</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">blacklisted_tokens</span><span class="p">:</span> <span class="nb">set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">permissions</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> 
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>                      <span class="n">expires_hours</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">24</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a JWT token with user information and permissions&quot;&quot;&quot;</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>        <span class="c1"># Current time</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>        <span class="c1"># Create payload</span>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>            <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>            <span class="s1">&#39;permissions&#39;</span><span class="p">:</span> <span class="n">permissions</span><span class="p">,</span>
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a>            <span class="s1">&#39;iat&#39;</span><span class="p">:</span> <span class="n">now</span><span class="p">,</span>  <span class="c1"># issued at</span>
</span><span id="__span-3-26"><a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a>            <span class="s1">&#39;exp&#39;</span><span class="p">:</span> <span class="n">now</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">expires_hours</span><span class="p">),</span>  <span class="c1"># expires</span>
</span><span id="__span-3-27"><a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a>            <span class="s1">&#39;jti&#39;</span><span class="p">:</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>  <span class="c1"># unique token ID for blacklisting</span>
</span><span id="__span-3-28"><a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a>        <span class="p">}</span>
</span><span id="__span-3-29"><a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a>
</span><span id="__span-3-30"><a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a>        <span class="c1"># Generate token</span>
</span><span id="__span-3-31"><a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a>        <span class="n">token</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">secret_key</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">)</span>
</span><span id="__span-3-32"><a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a>        <span class="k">return</span> <span class="n">token</span>
</span><span id="__span-3-33"><a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a>
</span><span id="__span-3-34"><a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-3-35"><a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate JWT token and return payload if valid&quot;&quot;&quot;</span>
</span><span id="__span-3-36"><a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-3-37"><a id="__codelineno-3-37" name="__codelineno-3-37" href="#__codelineno-3-37"></a>            <span class="c1"># Check if token is blacklisted</span>
</span><span id="__span-3-38"><a id="__codelineno-3-38" name="__codelineno-3-38" href="#__codelineno-3-38"></a>            <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blacklisted_tokens</span><span class="p">:</span>
</span><span id="__span-3-39"><a id="__codelineno-3-39" name="__codelineno-3-39" href="#__codelineno-3-39"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-3-40"><a id="__codelineno-3-40" name="__codelineno-3-40" href="#__codelineno-3-40"></a>
</span><span id="__span-3-41"><a id="__codelineno-3-41" name="__codelineno-3-41" href="#__codelineno-3-41"></a>            <span class="c1"># Decode and validate token</span>
</span><span id="__span-3-42"><a id="__codelineno-3-42" name="__codelineno-3-42" href="#__codelineno-3-42"></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
</span><span id="__span-3-43"><a id="__codelineno-3-43" name="__codelineno-3-43" href="#__codelineno-3-43"></a>                <span class="n">token</span><span class="p">,</span> 
</span><span id="__span-3-44"><a id="__codelineno-3-44" name="__codelineno-3-44" href="#__codelineno-3-44"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">secret_key</span><span class="p">,</span> 
</span><span id="__span-3-45"><a id="__codelineno-3-45" name="__codelineno-3-45" href="#__codelineno-3-45"></a>                <span class="n">algorithms</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">]</span>
</span><span id="__span-3-46"><a id="__codelineno-3-46" name="__codelineno-3-46" href="#__codelineno-3-46"></a>            <span class="p">)</span>
</span><span id="__span-3-47"><a id="__codelineno-3-47" name="__codelineno-3-47" href="#__codelineno-3-47"></a>
</span><span id="__span-3-48"><a id="__codelineno-3-48" name="__codelineno-3-48" href="#__codelineno-3-48"></a>            <span class="k">return</span> <span class="n">payload</span>
</span><span id="__span-3-49"><a id="__codelineno-3-49" name="__codelineno-3-49" href="#__codelineno-3-49"></a>
</span><span id="__span-3-50"><a id="__codelineno-3-50" name="__codelineno-3-50" href="#__codelineno-3-50"></a>        <span class="k">except</span> <span class="n">jwt</span><span class="o">.</span><span class="n">ExpiredSignatureError</span><span class="p">:</span>
</span><span id="__span-3-51"><a id="__codelineno-3-51" name="__codelineno-3-51" href="#__codelineno-3-51"></a>            <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># Token has expired</span>
</span><span id="__span-3-52"><a id="__codelineno-3-52" name="__codelineno-3-52" href="#__codelineno-3-52"></a>        <span class="k">except</span> <span class="n">jwt</span><span class="o">.</span><span class="n">InvalidTokenError</span><span class="p">:</span>
</span><span id="__span-3-53"><a id="__codelineno-3-53" name="__codelineno-3-53" href="#__codelineno-3-53"></a>            <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># Token is invalid</span>
</span><span id="__span-3-54"><a id="__codelineno-3-54" name="__codelineno-3-54" href="#__codelineno-3-54"></a>
</span><span id="__span-3-55"><a id="__codelineno-3-55" name="__codelineno-3-55" href="#__codelineno-3-55"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">revoke_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-3-56"><a id="__codelineno-3-56" name="__codelineno-3-56" href="#__codelineno-3-56"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add token to blacklist (logout functionality)&quot;&quot;&quot;</span>
</span><span id="__span-3-57"><a id="__codelineno-3-57" name="__codelineno-3-57" href="#__codelineno-3-57"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">blacklisted_tokens</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="__span-3-58"><a id="__codelineno-3-58" name="__codelineno-3-58" href="#__codelineno-3-58"></a>
</span><span id="__span-3-59"><a id="__codelineno-3-59" name="__codelineno-3-59" href="#__codelineno-3-59"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">refresh_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="__span-3-60"><a id="__codelineno-3-60" name="__codelineno-3-60" href="#__codelineno-3-60"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a new token from a valid existing token&quot;&quot;&quot;</span>
</span><span id="__span-3-61"><a id="__codelineno-3-61" name="__codelineno-3-61" href="#__codelineno-3-61"></a>        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_token</span><span class="p">(</span><span class="n">old_token</span><span class="p">)</span>
</span><span id="__span-3-62"><a id="__codelineno-3-62" name="__codelineno-3-62" href="#__codelineno-3-62"></a>
</span><span id="__span-3-63"><a id="__codelineno-3-63" name="__codelineno-3-63" href="#__codelineno-3-63"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">payload</span><span class="p">:</span>
</span><span id="__span-3-64"><a id="__codelineno-3-64" name="__codelineno-3-64" href="#__codelineno-3-64"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-3-65"><a id="__codelineno-3-65" name="__codelineno-3-65" href="#__codelineno-3-65"></a>
</span><span id="__span-3-66"><a id="__codelineno-3-66" name="__codelineno-3-66" href="#__codelineno-3-66"></a>        <span class="c1"># Revoke old token</span>
</span><span id="__span-3-67"><a id="__codelineno-3-67" name="__codelineno-3-67" href="#__codelineno-3-67"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">revoke_token</span><span class="p">(</span><span class="n">old_token</span><span class="p">)</span>
</span><span id="__span-3-68"><a id="__codelineno-3-68" name="__codelineno-3-68" href="#__codelineno-3-68"></a>
</span><span id="__span-3-69"><a id="__codelineno-3-69" name="__codelineno-3-69" href="#__codelineno-3-69"></a>        <span class="c1"># Generate new token with same permissions</span>
</span><span id="__span-3-70"><a id="__codelineno-3-70" name="__codelineno-3-70" href="#__codelineno-3-70"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_token</span><span class="p">(</span>
</span><span id="__span-3-71"><a id="__codelineno-3-71" name="__codelineno-3-71" href="#__codelineno-3-71"></a>            <span class="n">user_id</span><span class="o">=</span><span class="n">payload</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">],</span>
</span><span id="__span-3-72"><a id="__codelineno-3-72" name="__codelineno-3-72" href="#__codelineno-3-72"></a>            <span class="n">permissions</span><span class="o">=</span><span class="n">payload</span><span class="p">[</span><span class="s1">&#39;permissions&#39;</span><span class="p">]</span>
</span><span id="__span-3-73"><a id="__codelineno-3-73" name="__codelineno-3-73" href="#__codelineno-3-73"></a>        <span class="p">)</span>
</span><span id="__span-3-74"><a id="__codelineno-3-74" name="__codelineno-3-74" href="#__codelineno-3-74"></a>
</span><span id="__span-3-75"><a id="__codelineno-3-75" name="__codelineno-3-75" href="#__codelineno-3-75"></a><span class="c1"># JWT-based API authentication decorator</span>
</span><span id="__span-3-76"><a id="__codelineno-3-76" name="__codelineno-3-76" href="#__codelineno-3-76"></a><span class="k">def</span><span class="w"> </span><span class="nf">jwt_required</span><span class="p">(</span><span class="n">permissions_required</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="__span-3-77"><a id="__codelineno-3-77" name="__codelineno-3-77" href="#__codelineno-3-77"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator for protecting API endpoints with JWT&quot;&quot;&quot;</span>
</span><span id="__span-3-78"><a id="__codelineno-3-78" name="__codelineno-3-78" href="#__codelineno-3-78"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="__span-3-79"><a id="__codelineno-3-79" name="__codelineno-3-79" href="#__codelineno-3-79"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="__span-3-80"><a id="__codelineno-3-80" name="__codelineno-3-80" href="#__codelineno-3-80"></a>            <span class="c1"># In a real Flask/FastAPI app, you&#39;d get this from request headers</span>
</span><span id="__span-3-81"><a id="__codelineno-3-81" name="__codelineno-3-81" href="#__codelineno-3-81"></a>            <span class="c1"># For demo purposes, we&#39;ll simulate it</span>
</span><span id="__span-3-82"><a id="__codelineno-3-82" name="__codelineno-3-82" href="#__codelineno-3-82"></a>            <span class="n">token</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;jwt_token&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-3-83"><a id="__codelineno-3-83" name="__codelineno-3-83" href="#__codelineno-3-83"></a>
</span><span id="__span-3-84"><a id="__codelineno-3-84" name="__codelineno-3-84" href="#__codelineno-3-84"></a>            <span class="n">jwt_manager</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;jwt_manager&#39;</span><span class="p">)</span>
</span><span id="__span-3-85"><a id="__codelineno-3-85" name="__codelineno-3-85" href="#__codelineno-3-85"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">jwt_manager</span><span class="p">:</span>
</span><span id="__span-3-86"><a id="__codelineno-3-86" name="__codelineno-3-86" href="#__codelineno-3-86"></a>                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;JWT manager not configured&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">}</span>
</span><span id="__span-3-87"><a id="__codelineno-3-87" name="__codelineno-3-87" href="#__codelineno-3-87"></a>
</span><span id="__span-3-88"><a id="__codelineno-3-88" name="__codelineno-3-88" href="#__codelineno-3-88"></a>            <span class="c1"># Validate token</span>
</span><span id="__span-3-89"><a id="__codelineno-3-89" name="__codelineno-3-89" href="#__codelineno-3-89"></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">jwt_manager</span><span class="o">.</span><span class="n">validate_token</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="__span-3-90"><a id="__codelineno-3-90" name="__codelineno-3-90" href="#__codelineno-3-90"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">payload</span><span class="p">:</span>
</span><span id="__span-3-91"><a id="__codelineno-3-91" name="__codelineno-3-91" href="#__codelineno-3-91"></a>                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid or expired token&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="mi">401</span><span class="p">}</span>
</span><span id="__span-3-92"><a id="__codelineno-3-92" name="__codelineno-3-92" href="#__codelineno-3-92"></a>
</span><span id="__span-3-93"><a id="__codelineno-3-93" name="__codelineno-3-93" href="#__codelineno-3-93"></a>            <span class="c1"># Check permissions</span>
</span><span id="__span-3-94"><a id="__codelineno-3-94" name="__codelineno-3-94" href="#__codelineno-3-94"></a>            <span class="k">if</span> <span class="n">permissions_required</span><span class="p">:</span>
</span><span id="__span-3-95"><a id="__codelineno-3-95" name="__codelineno-3-95" href="#__codelineno-3-95"></a>                <span class="n">user_permissions</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;permissions&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="__span-3-96"><a id="__codelineno-3-96" name="__codelineno-3-96" href="#__codelineno-3-96"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">perm</span> <span class="ow">in</span> <span class="n">user_permissions</span> <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">permissions_required</span><span class="p">):</span>
</span><span id="__span-3-97"><a id="__codelineno-3-97" name="__codelineno-3-97" href="#__codelineno-3-97"></a>                    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Insufficient permissions&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="mi">403</span><span class="p">}</span>
</span><span id="__span-3-98"><a id="__codelineno-3-98" name="__codelineno-3-98" href="#__codelineno-3-98"></a>
</span><span id="__span-3-99"><a id="__codelineno-3-99" name="__codelineno-3-99" href="#__codelineno-3-99"></a>            <span class="c1"># Add user info to function call</span>
</span><span id="__span-3-100"><a id="__codelineno-3-100" name="__codelineno-3-100" href="#__codelineno-3-100"></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;current_user&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">payload</span>
</span><span id="__span-3-101"><a id="__codelineno-3-101" name="__codelineno-3-101" href="#__codelineno-3-101"></a>            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-3-102"><a id="__codelineno-3-102" name="__codelineno-3-102" href="#__codelineno-3-102"></a>
</span><span id="__span-3-103"><a id="__codelineno-3-103" name="__codelineno-3-103" href="#__codelineno-3-103"></a>        <span class="k">return</span> <span class="n">wrapper</span>
</span><span id="__span-3-104"><a id="__codelineno-3-104" name="__codelineno-3-104" href="#__codelineno-3-104"></a>    <span class="k">return</span> <span class="n">decorator</span>
</span><span id="__span-3-105"><a id="__codelineno-3-105" name="__codelineno-3-105" href="#__codelineno-3-105"></a>
</span><span id="__span-3-106"><a id="__codelineno-3-106" name="__codelineno-3-106" href="#__codelineno-3-106"></a><span class="c1"># Example protected API endpoints</span>
</span><span id="__span-3-107"><a id="__codelineno-3-107" name="__codelineno-3-107" href="#__codelineno-3-107"></a><span class="k">class</span><span class="w"> </span><span class="nc">SecureAPI</span><span class="p">:</span>
</span><span id="__span-3-108"><a id="__codelineno-3-108" name="__codelineno-3-108" href="#__codelineno-3-108"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Example API with JWT protection&quot;&quot;&quot;</span>
</span><span id="__span-3-109"><a id="__codelineno-3-109" name="__codelineno-3-109" href="#__codelineno-3-109"></a>
</span><span id="__span-3-110"><a id="__codelineno-3-110" name="__codelineno-3-110" href="#__codelineno-3-110"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jwt_manager</span><span class="p">:</span> <span class="n">JWTManager</span><span class="p">):</span>
</span><span id="__span-3-111"><a id="__codelineno-3-111" name="__codelineno-3-111" href="#__codelineno-3-111"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">jwt_manager</span> <span class="o">=</span> <span class="n">jwt_manager</span>
</span><span id="__span-3-112"><a id="__codelineno-3-112" name="__codelineno-3-112" href="#__codelineno-3-112"></a>
</span><span id="__span-3-113"><a id="__codelineno-3-113" name="__codelineno-3-113" href="#__codelineno-3-113"></a>    <span class="nd">@jwt_required</span><span class="p">([</span><span class="s1">&#39;read_users&#39;</span><span class="p">])</span>
</span><span id="__span-3-114"><a id="__codelineno-3-114" name="__codelineno-3-114" href="#__codelineno-3-114"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_users</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jwt_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">jwt_manager</span><span class="p">:</span> <span class="n">JWTManager</span><span class="p">,</span> <span class="n">current_user</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="__span-3-115"><a id="__codelineno-3-115" name="__codelineno-3-115" href="#__codelineno-3-115"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Protected endpoint requiring &#39;read_users&#39; permission&quot;&quot;&quot;</span>
</span><span id="__span-3-116"><a id="__codelineno-3-116" name="__codelineno-3-116" href="#__codelineno-3-116"></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-3-117"><a id="__codelineno-3-117" name="__codelineno-3-117" href="#__codelineno-3-117"></a>            <span class="s2">&quot;users&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;user1&quot;</span><span class="p">,</span> <span class="s2">&quot;user2&quot;</span><span class="p">,</span> <span class="s2">&quot;user3&quot;</span><span class="p">],</span>
</span><span id="__span-3-118"><a id="__codelineno-3-118" name="__codelineno-3-118" href="#__codelineno-3-118"></a>            <span class="s2">&quot;accessed_by&quot;</span><span class="p">:</span> <span class="n">current_user</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span>
</span><span id="__span-3-119"><a id="__codelineno-3-119" name="__codelineno-3-119" href="#__codelineno-3-119"></a>        <span class="p">}</span>
</span><span id="__span-3-120"><a id="__codelineno-3-120" name="__codelineno-3-120" href="#__codelineno-3-120"></a>
</span><span id="__span-3-121"><a id="__codelineno-3-121" name="__codelineno-3-121" href="#__codelineno-3-121"></a>    <span class="nd">@jwt_required</span><span class="p">([</span><span class="s1">&#39;admin&#39;</span><span class="p">])</span>
</span><span id="__span-3-122"><a id="__codelineno-3-122" name="__codelineno-3-122" href="#__codelineno-3-122"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">delete_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">jwt_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span><span id="__span-3-123"><a id="__codelineno-3-123" name="__codelineno-3-123" href="#__codelineno-3-123"></a>                   <span class="n">jwt_manager</span><span class="p">:</span> <span class="n">JWTManager</span><span class="p">,</span> <span class="n">current_user</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="__span-3-124"><a id="__codelineno-3-124" name="__codelineno-3-124" href="#__codelineno-3-124"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Protected endpoint requiring &#39;admin&#39; permission&quot;&quot;&quot;</span>
</span><span id="__span-3-125"><a id="__codelineno-3-125" name="__codelineno-3-125" href="#__codelineno-3-125"></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-3-126"><a id="__codelineno-3-126" name="__codelineno-3-126" href="#__codelineno-3-126"></a>            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> deleted&quot;</span><span class="p">,</span>
</span><span id="__span-3-127"><a id="__codelineno-3-127" name="__codelineno-3-127" href="#__codelineno-3-127"></a>            <span class="s2">&quot;deleted_by&quot;</span><span class="p">:</span> <span class="n">current_user</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span>
</span><span id="__span-3-128"><a id="__codelineno-3-128" name="__codelineno-3-128" href="#__codelineno-3-128"></a>        <span class="p">}</span>
</span><span id="__span-3-129"><a id="__codelineno-3-129" name="__codelineno-3-129" href="#__codelineno-3-129"></a>
</span><span id="__span-3-130"><a id="__codelineno-3-130" name="__codelineno-3-130" href="#__codelineno-3-130"></a><span class="k">def</span><span class="w"> </span><span class="nf">jwt_authentication_example</span><span class="p">():</span>
</span><span id="__span-3-131"><a id="__codelineno-3-131" name="__codelineno-3-131" href="#__codelineno-3-131"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate JWT authentication&quot;&quot;&quot;</span>
</span><span id="__span-3-132"><a id="__codelineno-3-132" name="__codelineno-3-132" href="#__codelineno-3-132"></a>
</span><span id="__span-3-133"><a id="__codelineno-3-133" name="__codelineno-3-133" href="#__codelineno-3-133"></a>    <span class="c1"># Initialize JWT manager</span>
</span><span id="__span-3-134"><a id="__codelineno-3-134" name="__codelineno-3-134" href="#__codelineno-3-134"></a>    <span class="n">jwt_manager</span> <span class="o">=</span> <span class="n">JWTManager</span><span class="p">(</span><span class="n">secret_key</span><span class="o">=</span><span class="s2">&quot;your-secret-key-keep-this-secure&quot;</span><span class="p">)</span>
</span><span id="__span-3-135"><a id="__codelineno-3-135" name="__codelineno-3-135" href="#__codelineno-3-135"></a>
</span><span id="__span-3-136"><a id="__codelineno-3-136" name="__codelineno-3-136" href="#__codelineno-3-136"></a>    <span class="c1"># Generate token for a user</span>
</span><span id="__span-3-137"><a id="__codelineno-3-137" name="__codelineno-3-137" href="#__codelineno-3-137"></a>    <span class="n">token</span> <span class="o">=</span> <span class="n">jwt_manager</span><span class="o">.</span><span class="n">generate_token</span><span class="p">(</span>
</span><span id="__span-3-138"><a id="__codelineno-3-138" name="__codelineno-3-138" href="#__codelineno-3-138"></a>        <span class="n">user_id</span><span class="o">=</span><span class="s2">&quot;user123&quot;</span><span class="p">,</span>
</span><span id="__span-3-139"><a id="__codelineno-3-139" name="__codelineno-3-139" href="#__codelineno-3-139"></a>        <span class="n">permissions</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;read_users&quot;</span><span class="p">,</span> <span class="s2">&quot;write_posts&quot;</span><span class="p">]</span>
</span><span id="__span-3-140"><a id="__codelineno-3-140" name="__codelineno-3-140" href="#__codelineno-3-140"></a>    <span class="p">)</span>
</span><span id="__span-3-141"><a id="__codelineno-3-141" name="__codelineno-3-141" href="#__codelineno-3-141"></a>
</span><span id="__span-3-142"><a id="__codelineno-3-142" name="__codelineno-3-142" href="#__codelineno-3-142"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated JWT: </span><span class="si">{</span><span class="n">token</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="__span-3-143"><a id="__codelineno-3-143" name="__codelineno-3-143" href="#__codelineno-3-143"></a>
</span><span id="__span-3-144"><a id="__codelineno-3-144" name="__codelineno-3-144" href="#__codelineno-3-144"></a>    <span class="c1"># Validate token</span>
</span><span id="__span-3-145"><a id="__codelineno-3-145" name="__codelineno-3-145" href="#__codelineno-3-145"></a>    <span class="n">payload</span> <span class="o">=</span> <span class="n">jwt_manager</span><span class="o">.</span><span class="n">validate_token</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="__span-3-146"><a id="__codelineno-3-146" name="__codelineno-3-146" href="#__codelineno-3-146"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Token payload: </span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-3-147"><a id="__codelineno-3-147" name="__codelineno-3-147" href="#__codelineno-3-147"></a>
</span><span id="__span-3-148"><a id="__codelineno-3-148" name="__codelineno-3-148" href="#__codelineno-3-148"></a>    <span class="c1"># Test API access</span>
</span><span id="__span-3-149"><a id="__codelineno-3-149" name="__codelineno-3-149" href="#__codelineno-3-149"></a>    <span class="n">api</span> <span class="o">=</span> <span class="n">SecureAPI</span><span class="p">(</span><span class="n">jwt_manager</span><span class="p">)</span>
</span><span id="__span-3-150"><a id="__codelineno-3-150" name="__codelineno-3-150" href="#__codelineno-3-150"></a>
</span><span id="__span-3-151"><a id="__codelineno-3-151" name="__codelineno-3-151" href="#__codelineno-3-151"></a>    <span class="c1"># This should work (user has &#39;read_users&#39; permission)</span>
</span><span id="__span-3-152"><a id="__codelineno-3-152" name="__codelineno-3-152" href="#__codelineno-3-152"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">get_users</span><span class="p">(</span><span class="n">jwt_token</span><span class="o">=</span><span class="n">token</span><span class="p">,</span> <span class="n">jwt_manager</span><span class="o">=</span><span class="n">jwt_manager</span><span class="p">)</span>
</span><span id="__span-3-153"><a id="__codelineno-3-153" name="__codelineno-3-153" href="#__codelineno-3-153"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;API result: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-3-154"><a id="__codelineno-3-154" name="__codelineno-3-154" href="#__codelineno-3-154"></a>
</span><span id="__span-3-155"><a id="__codelineno-3-155" name="__codelineno-3-155" href="#__codelineno-3-155"></a>    <span class="c1"># This should fail (user doesn&#39;t have &#39;admin&#39; permission)</span>
</span><span id="__span-3-156"><a id="__codelineno-3-156" name="__codelineno-3-156" href="#__codelineno-3-156"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">delete_user</span><span class="p">(</span><span class="s2">&quot;user456&quot;</span><span class="p">,</span> <span class="n">jwt_token</span><span class="o">=</span><span class="n">token</span><span class="p">,</span> <span class="n">jwt_manager</span><span class="o">=</span><span class="n">jwt_manager</span><span class="p">)</span>
</span><span id="__span-3-157"><a id="__codelineno-3-157" name="__codelineno-3-157" href="#__codelineno-3-157"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Admin action result: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-3-158"><a id="__codelineno-3-158" name="__codelineno-3-158" href="#__codelineno-3-158"></a>
</span><span id="__span-3-159"><a id="__codelineno-3-159" name="__codelineno-3-159" href="#__codelineno-3-159"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-3-160"><a id="__codelineno-3-160" name="__codelineno-3-160" href="#__codelineno-3-160"></a>    <span class="n">jwt_authentication_example</span><span class="p">()</span>
</span></code></pre></div>
<h3 id="3-oauth-20-flow-implementation">3. OAuth 2.0 Flow Implementation<a class="headerlink" href="#3-oauth-20-flow-implementation" title="Permanent link">&para;</a></h3>
<p>OAuth 2.0 is an authorization framework that enables applications to obtain limited access to user accounts.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">urllib.parse</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">OAuth2Manager</span><span class="p">:</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;OAuth 2.0 authorization server implementation&quot;&quot;&quot;</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>                 <span class="n">authorization_base_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">token_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span> <span class="o">=</span> <span class="n">client_id</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client_secret</span> <span class="o">=</span> <span class="n">client_secret</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">authorization_base_url</span> <span class="o">=</span> <span class="n">authorization_base_url</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">token_url</span> <span class="o">=</span> <span class="n">token_url</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">authorization_codes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">access_tokens</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_authorization_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redirect_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>                                 <span class="n">scope</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate OAuth authorization URL&quot;&quot;&quot;</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>            <span class="s1">&#39;response_type&#39;</span><span class="p">:</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>            <span class="s1">&#39;client_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>            <span class="s1">&#39;redirect_uri&#39;</span><span class="p">:</span> <span class="n">redirect_uri</span><span class="p">,</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>            <span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="n">scope</span><span class="p">,</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>            <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="n">state</span> <span class="ow">or</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>        <span class="p">}</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>        <span class="c1"># Build authorization URL</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>        <span class="n">authorization_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">authorization_base_url</span><span class="si">}</span><span class="s2">?</span><span class="si">{</span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>        <span class="k">return</span> <span class="n">authorization_url</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">exchange_code_for_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">authorization_code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a>                              <span class="n">redirect_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Exchange authorization code for access token&quot;&quot;&quot;</span>
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a>
</span><span id="__span-4-37"><a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a>        <span class="c1"># Validate authorization code</span>
</span><span id="__span-4-38"><a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a>        <span class="k">if</span> <span class="n">authorization_code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">authorization_codes</span><span class="p">:</span>
</span><span id="__span-4-39"><a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-4-40"><a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a>
</span><span id="__span-4-41"><a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a>        <span class="n">code_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">authorization_codes</span><span class="p">[</span><span class="n">authorization_code</span><span class="p">]</span>
</span><span id="__span-4-42"><a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a>
</span><span id="__span-4-43"><a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a>        <span class="c1"># Check if code has expired (typically 10 minutes)</span>
</span><span id="__span-4-44"><a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a>        <span class="k">if</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">code_data</span><span class="p">[</span><span class="s1">&#39;expires_at&#39;</span><span class="p">]:</span>
</span><span id="__span-4-45"><a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">authorization_codes</span><span class="p">[</span><span class="n">authorization_code</span><span class="p">]</span>
</span><span id="__span-4-46"><a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-4-47"><a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a>
</span><span id="__span-4-48"><a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a>        <span class="c1"># Generate access token</span>
</span><span id="__span-4-49"><a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a>        <span class="n">access_token</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
</span><span id="__span-4-50"><a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a>        <span class="n">refresh_token</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
</span><span id="__span-4-51"><a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a>
</span><span id="__span-4-52"><a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a>        <span class="n">token_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-4-53"><a id="__codelineno-4-53" name="__codelineno-4-53" href="#__codelineno-4-53"></a>            <span class="s1">&#39;access_token&#39;</span><span class="p">:</span> <span class="n">access_token</span><span class="p">,</span>
</span><span id="__span-4-54"><a id="__codelineno-4-54" name="__codelineno-4-54" href="#__codelineno-4-54"></a>            <span class="s1">&#39;refresh_token&#39;</span><span class="p">:</span> <span class="n">refresh_token</span><span class="p">,</span>
</span><span id="__span-4-55"><a id="__codelineno-4-55" name="__codelineno-4-55" href="#__codelineno-4-55"></a>            <span class="s1">&#39;token_type&#39;</span><span class="p">:</span> <span class="s1">&#39;Bearer&#39;</span><span class="p">,</span>
</span><span id="__span-4-56"><a id="__codelineno-4-56" name="__codelineno-4-56" href="#__codelineno-4-56"></a>            <span class="s1">&#39;expires_in&#39;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">,</span>  <span class="c1"># 1 hour</span>
</span><span id="__span-4-57"><a id="__codelineno-4-57" name="__codelineno-4-57" href="#__codelineno-4-57"></a>            <span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="n">code_data</span><span class="p">[</span><span class="s1">&#39;scope&#39;</span><span class="p">],</span>
</span><span id="__span-4-58"><a id="__codelineno-4-58" name="__codelineno-4-58" href="#__codelineno-4-58"></a>            <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">code_data</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">],</span>
</span><span id="__span-4-59"><a id="__codelineno-4-59" name="__codelineno-4-59" href="#__codelineno-4-59"></a>            <span class="s1">&#39;created_at&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="__span-4-60"><a id="__codelineno-4-60" name="__codelineno-4-60" href="#__codelineno-4-60"></a>        <span class="p">}</span>
</span><span id="__span-4-61"><a id="__codelineno-4-61" name="__codelineno-4-61" href="#__codelineno-4-61"></a>
</span><span id="__span-4-62"><a id="__codelineno-4-62" name="__codelineno-4-62" href="#__codelineno-4-62"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">access_tokens</span><span class="p">[</span><span class="n">access_token</span><span class="p">]</span> <span class="o">=</span> <span class="n">token_data</span>
</span><span id="__span-4-63"><a id="__codelineno-4-63" name="__codelineno-4-63" href="#__codelineno-4-63"></a>
</span><span id="__span-4-64"><a id="__codelineno-4-64" name="__codelineno-4-64" href="#__codelineno-4-64"></a>        <span class="c1"># Remove used authorization code</span>
</span><span id="__span-4-65"><a id="__codelineno-4-65" name="__codelineno-4-65" href="#__codelineno-4-65"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">authorization_codes</span><span class="p">[</span><span class="n">authorization_code</span><span class="p">]</span>
</span><span id="__span-4-66"><a id="__codelineno-4-66" name="__codelineno-4-66" href="#__codelineno-4-66"></a>
</span><span id="__span-4-67"><a id="__codelineno-4-67" name="__codelineno-4-67" href="#__codelineno-4-67"></a>        <span class="k">return</span> <span class="n">token_data</span>
</span><span id="__span-4-68"><a id="__codelineno-4-68" name="__codelineno-4-68" href="#__codelineno-4-68"></a>
</span><span id="__span-4-69"><a id="__codelineno-4-69" name="__codelineno-4-69" href="#__codelineno-4-69"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_access_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">access_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-4-70"><a id="__codelineno-4-70" name="__codelineno-4-70" href="#__codelineno-4-70"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate OAuth access token&quot;&quot;&quot;</span>
</span><span id="__span-4-71"><a id="__codelineno-4-71" name="__codelineno-4-71" href="#__codelineno-4-71"></a>
</span><span id="__span-4-72"><a id="__codelineno-4-72" name="__codelineno-4-72" href="#__codelineno-4-72"></a>        <span class="k">if</span> <span class="n">access_token</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_tokens</span><span class="p">:</span>
</span><span id="__span-4-73"><a id="__codelineno-4-73" name="__codelineno-4-73" href="#__codelineno-4-73"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-4-74"><a id="__codelineno-4-74" name="__codelineno-4-74" href="#__codelineno-4-74"></a>
</span><span id="__span-4-75"><a id="__codelineno-4-75" name="__codelineno-4-75" href="#__codelineno-4-75"></a>        <span class="n">token_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_tokens</span><span class="p">[</span><span class="n">access_token</span><span class="p">]</span>
</span><span id="__span-4-76"><a id="__codelineno-4-76" name="__codelineno-4-76" href="#__codelineno-4-76"></a>
</span><span id="__span-4-77"><a id="__codelineno-4-77" name="__codelineno-4-77" href="#__codelineno-4-77"></a>        <span class="c1"># Check if token has expired</span>
</span><span id="__span-4-78"><a id="__codelineno-4-78" name="__codelineno-4-78" href="#__codelineno-4-78"></a>        <span class="n">expires_at</span> <span class="o">=</span> <span class="n">token_data</span><span class="p">[</span><span class="s1">&#39;created_at&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">token_data</span><span class="p">[</span><span class="s1">&#39;expires_in&#39;</span><span class="p">])</span>
</span><span id="__span-4-79"><a id="__codelineno-4-79" name="__codelineno-4-79" href="#__codelineno-4-79"></a>        <span class="k">if</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">expires_at</span><span class="p">:</span>
</span><span id="__span-4-80"><a id="__codelineno-4-80" name="__codelineno-4-80" href="#__codelineno-4-80"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_tokens</span><span class="p">[</span><span class="n">access_token</span><span class="p">]</span>
</span><span id="__span-4-81"><a id="__codelineno-4-81" name="__codelineno-4-81" href="#__codelineno-4-81"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-4-82"><a id="__codelineno-4-82" name="__codelineno-4-82" href="#__codelineno-4-82"></a>
</span><span id="__span-4-83"><a id="__codelineno-4-83" name="__codelineno-4-83" href="#__codelineno-4-83"></a>        <span class="k">return</span> <span class="n">token_data</span>
</span><span id="__span-4-84"><a id="__codelineno-4-84" name="__codelineno-4-84" href="#__codelineno-4-84"></a>
</span><span id="__span-4-85"><a id="__codelineno-4-85" name="__codelineno-4-85" href="#__codelineno-4-85"></a><span class="c1"># OAuth-protected API endpoint</span>
</span><span id="__span-4-86"><a id="__codelineno-4-86" name="__codelineno-4-86" href="#__codelineno-4-86"></a><span class="k">def</span><span class="w"> </span><span class="nf">oauth_required</span><span class="p">(</span><span class="n">scopes_required</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="__span-4-87"><a id="__codelineno-4-87" name="__codelineno-4-87" href="#__codelineno-4-87"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator for OAuth-protected endpoints&quot;&quot;&quot;</span>
</span><span id="__span-4-88"><a id="__codelineno-4-88" name="__codelineno-4-88" href="#__codelineno-4-88"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="__span-4-89"><a id="__codelineno-4-89" name="__codelineno-4-89" href="#__codelineno-4-89"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="__span-4-90"><a id="__codelineno-4-90" name="__codelineno-4-90" href="#__codelineno-4-90"></a>            <span class="c1"># Get access token from Authorization header</span>
</span><span id="__span-4-91"><a id="__codelineno-4-91" name="__codelineno-4-91" href="#__codelineno-4-91"></a>            <span class="c1"># In real implementation: token = request.headers.get(&#39;Authorization&#39;, &#39;&#39;).replace(&#39;Bearer &#39;, &#39;&#39;)</span>
</span><span id="__span-4-92"><a id="__codelineno-4-92" name="__codelineno-4-92" href="#__codelineno-4-92"></a>            <span class="n">token</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;access_token&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-4-93"><a id="__codelineno-4-93" name="__codelineno-4-93" href="#__codelineno-4-93"></a>
</span><span id="__span-4-94"><a id="__codelineno-4-94" name="__codelineno-4-94" href="#__codelineno-4-94"></a>            <span class="n">oauth_manager</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;oauth_manager&#39;</span><span class="p">)</span>
</span><span id="__span-4-95"><a id="__codelineno-4-95" name="__codelineno-4-95" href="#__codelineno-4-95"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">oauth_manager</span><span class="p">:</span>
</span><span id="__span-4-96"><a id="__codelineno-4-96" name="__codelineno-4-96" href="#__codelineno-4-96"></a>                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;OAuth not configured&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">}</span>
</span><span id="__span-4-97"><a id="__codelineno-4-97" name="__codelineno-4-97" href="#__codelineno-4-97"></a>
</span><span id="__span-4-98"><a id="__codelineno-4-98" name="__codelineno-4-98" href="#__codelineno-4-98"></a>            <span class="c1"># Validate token</span>
</span><span id="__span-4-99"><a id="__codelineno-4-99" name="__codelineno-4-99" href="#__codelineno-4-99"></a>            <span class="n">token_data</span> <span class="o">=</span> <span class="n">oauth_manager</span><span class="o">.</span><span class="n">validate_access_token</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="__span-4-100"><a id="__codelineno-4-100" name="__codelineno-4-100" href="#__codelineno-4-100"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">token_data</span><span class="p">:</span>
</span><span id="__span-4-101"><a id="__codelineno-4-101" name="__codelineno-4-101" href="#__codelineno-4-101"></a>                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid or expired access token&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="mi">401</span><span class="p">}</span>
</span><span id="__span-4-102"><a id="__codelineno-4-102" name="__codelineno-4-102" href="#__codelineno-4-102"></a>
</span><span id="__span-4-103"><a id="__codelineno-4-103" name="__codelineno-4-103" href="#__codelineno-4-103"></a>            <span class="c1"># Check scopes</span>
</span><span id="__span-4-104"><a id="__codelineno-4-104" name="__codelineno-4-104" href="#__codelineno-4-104"></a>            <span class="k">if</span> <span class="n">scopes_required</span><span class="p">:</span>
</span><span id="__span-4-105"><a id="__codelineno-4-105" name="__codelineno-4-105" href="#__codelineno-4-105"></a>                <span class="n">token_scopes</span> <span class="o">=</span> <span class="n">token_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;scope&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</span><span id="__span-4-106"><a id="__codelineno-4-106" name="__codelineno-4-106" href="#__codelineno-4-106"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">scope</span> <span class="ow">in</span> <span class="n">token_scopes</span> <span class="k">for</span> <span class="n">scope</span> <span class="ow">in</span> <span class="n">scopes_required</span><span class="p">):</span>
</span><span id="__span-4-107"><a id="__codelineno-4-107" name="__codelineno-4-107" href="#__codelineno-4-107"></a>                    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Insufficient scope&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="mi">403</span><span class="p">}</span>
</span><span id="__span-4-108"><a id="__codelineno-4-108" name="__codelineno-4-108" href="#__codelineno-4-108"></a>
</span><span id="__span-4-109"><a id="__codelineno-4-109" name="__codelineno-4-109" href="#__codelineno-4-109"></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;token_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">token_data</span>
</span><span id="__span-4-110"><a id="__codelineno-4-110" name="__codelineno-4-110" href="#__codelineno-4-110"></a>            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-4-111"><a id="__codelineno-4-111" name="__codelineno-4-111" href="#__codelineno-4-111"></a>
</span><span id="__span-4-112"><a id="__codelineno-4-112" name="__codelineno-4-112" href="#__codelineno-4-112"></a>        <span class="k">return</span> <span class="n">wrapper</span>
</span><span id="__span-4-113"><a id="__codelineno-4-113" name="__codelineno-4-113" href="#__codelineno-4-113"></a>    <span class="k">return</span> <span class="n">decorator</span>
</span><span id="__span-4-114"><a id="__codelineno-4-114" name="__codelineno-4-114" href="#__codelineno-4-114"></a>
</span><span id="__span-4-115"><a id="__codelineno-4-115" name="__codelineno-4-115" href="#__codelineno-4-115"></a><span class="k">def</span><span class="w"> </span><span class="nf">oauth_authentication_example</span><span class="p">():</span>
</span><span id="__span-4-116"><a id="__codelineno-4-116" name="__codelineno-4-116" href="#__codelineno-4-116"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate OAuth 2.0 authentication flow&quot;&quot;&quot;</span>
</span><span id="__span-4-117"><a id="__codelineno-4-117" name="__codelineno-4-117" href="#__codelineno-4-117"></a>
</span><span id="__span-4-118"><a id="__codelineno-4-118" name="__codelineno-4-118" href="#__codelineno-4-118"></a>    <span class="n">oauth_manager</span> <span class="o">=</span> <span class="n">OAuth2Manager</span><span class="p">(</span>
</span><span id="__span-4-119"><a id="__codelineno-4-119" name="__codelineno-4-119" href="#__codelineno-4-119"></a>        <span class="n">client_id</span><span class="o">=</span><span class="s2">&quot;your-client-id&quot;</span><span class="p">,</span>
</span><span id="__span-4-120"><a id="__codelineno-4-120" name="__codelineno-4-120" href="#__codelineno-4-120"></a>        <span class="n">client_secret</span><span class="o">=</span><span class="s2">&quot;your-client-secret&quot;</span><span class="p">,</span>
</span><span id="__span-4-121"><a id="__codelineno-4-121" name="__codelineno-4-121" href="#__codelineno-4-121"></a>        <span class="n">authorization_base_url</span><span class="o">=</span><span class="s2">&quot;https://auth.example.com/oauth/authorize&quot;</span><span class="p">,</span>
</span><span id="__span-4-122"><a id="__codelineno-4-122" name="__codelineno-4-122" href="#__codelineno-4-122"></a>        <span class="n">token_url</span><span class="o">=</span><span class="s2">&quot;https://auth.example.com/oauth/token&quot;</span>
</span><span id="__span-4-123"><a id="__codelineno-4-123" name="__codelineno-4-123" href="#__codelineno-4-123"></a>    <span class="p">)</span>
</span><span id="__span-4-124"><a id="__codelineno-4-124" name="__codelineno-4-124" href="#__codelineno-4-124"></a>
</span><span id="__span-4-125"><a id="__codelineno-4-125" name="__codelineno-4-125" href="#__codelineno-4-125"></a>    <span class="c1"># Step 1: Generate authorization URL</span>
</span><span id="__span-4-126"><a id="__codelineno-4-126" name="__codelineno-4-126" href="#__codelineno-4-126"></a>    <span class="n">auth_url</span> <span class="o">=</span> <span class="n">oauth_manager</span><span class="o">.</span><span class="n">generate_authorization_url</span><span class="p">(</span>
</span><span id="__span-4-127"><a id="__codelineno-4-127" name="__codelineno-4-127" href="#__codelineno-4-127"></a>        <span class="n">redirect_uri</span><span class="o">=</span><span class="s2">&quot;https://yourapp.com/callback&quot;</span><span class="p">,</span>
</span><span id="__span-4-128"><a id="__codelineno-4-128" name="__codelineno-4-128" href="#__codelineno-4-128"></a>        <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;read write&quot;</span><span class="p">,</span>
</span><span id="__span-4-129"><a id="__codelineno-4-129" name="__codelineno-4-129" href="#__codelineno-4-129"></a>        <span class="n">state</span><span class="o">=</span><span class="s2">&quot;random-state-value&quot;</span>
</span><span id="__span-4-130"><a id="__codelineno-4-130" name="__codelineno-4-130" href="#__codelineno-4-130"></a>    <span class="p">)</span>
</span><span id="__span-4-131"><a id="__codelineno-4-131" name="__codelineno-4-131" href="#__codelineno-4-131"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Authorization URL: </span><span class="si">{</span><span class="n">auth_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-4-132"><a id="__codelineno-4-132" name="__codelineno-4-132" href="#__codelineno-4-132"></a>
</span><span id="__span-4-133"><a id="__codelineno-4-133" name="__codelineno-4-133" href="#__codelineno-4-133"></a>    <span class="c1"># Step 2: Simulate user authorization (in real flow, user clicks auth_url)</span>
</span><span id="__span-4-134"><a id="__codelineno-4-134" name="__codelineno-4-134" href="#__codelineno-4-134"></a>    <span class="c1"># This would be handled by the authorization server</span>
</span><span id="__span-4-135"><a id="__codelineno-4-135" name="__codelineno-4-135" href="#__codelineno-4-135"></a>    <span class="n">authorization_code</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
</span><span id="__span-4-136"><a id="__codelineno-4-136" name="__codelineno-4-136" href="#__codelineno-4-136"></a>    <span class="n">oauth_manager</span><span class="o">.</span><span class="n">authorization_codes</span><span class="p">[</span><span class="n">authorization_code</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-4-137"><a id="__codelineno-4-137" name="__codelineno-4-137" href="#__codelineno-4-137"></a>        <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="s1">&#39;user123&#39;</span><span class="p">,</span>
</span><span id="__span-4-138"><a id="__codelineno-4-138" name="__codelineno-4-138" href="#__codelineno-4-138"></a>        <span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="s1">&#39;read write&#39;</span><span class="p">,</span>
</span><span id="__span-4-139"><a id="__codelineno-4-139" name="__codelineno-4-139" href="#__codelineno-4-139"></a>        <span class="s1">&#39;expires_at&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-4-140"><a id="__codelineno-4-140" name="__codelineno-4-140" href="#__codelineno-4-140"></a>    <span class="p">}</span>
</span><span id="__span-4-141"><a id="__codelineno-4-141" name="__codelineno-4-141" href="#__codelineno-4-141"></a>
</span><span id="__span-4-142"><a id="__codelineno-4-142" name="__codelineno-4-142" href="#__codelineno-4-142"></a>    <span class="c1"># Step 3: Exchange code for token</span>
</span><span id="__span-4-143"><a id="__codelineno-4-143" name="__codelineno-4-143" href="#__codelineno-4-143"></a>    <span class="n">token_data</span> <span class="o">=</span> <span class="n">oauth_manager</span><span class="o">.</span><span class="n">exchange_code_for_token</span><span class="p">(</span>
</span><span id="__span-4-144"><a id="__codelineno-4-144" name="__codelineno-4-144" href="#__codelineno-4-144"></a>        <span class="n">authorization_code</span><span class="o">=</span><span class="n">authorization_code</span><span class="p">,</span>
</span><span id="__span-4-145"><a id="__codelineno-4-145" name="__codelineno-4-145" href="#__codelineno-4-145"></a>        <span class="n">redirect_uri</span><span class="o">=</span><span class="s2">&quot;https://yourapp.com/callback&quot;</span>
</span><span id="__span-4-146"><a id="__codelineno-4-146" name="__codelineno-4-146" href="#__codelineno-4-146"></a>    <span class="p">)</span>
</span><span id="__span-4-147"><a id="__codelineno-4-147" name="__codelineno-4-147" href="#__codelineno-4-147"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Access token data: </span><span class="si">{</span><span class="n">token_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-4-148"><a id="__codelineno-4-148" name="__codelineno-4-148" href="#__codelineno-4-148"></a>
</span><span id="__span-4-149"><a id="__codelineno-4-149" name="__codelineno-4-149" href="#__codelineno-4-149"></a>    <span class="c1"># Step 4: Use token to access protected resource</span>
</span><span id="__span-4-150"><a id="__codelineno-4-150" name="__codelineno-4-150" href="#__codelineno-4-150"></a>    <span class="nd">@oauth_required</span><span class="p">([</span><span class="s1">&#39;read&#39;</span><span class="p">])</span>
</span><span id="__span-4-151"><a id="__codelineno-4-151" name="__codelineno-4-151" href="#__codelineno-4-151"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_protected_data</span><span class="p">(</span><span class="n">access_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">oauth_manager</span><span class="p">:</span> <span class="n">OAuth2Manager</span><span class="p">,</span> <span class="n">token_info</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="__span-4-152"><a id="__codelineno-4-152" name="__codelineno-4-152" href="#__codelineno-4-152"></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-4-153"><a id="__codelineno-4-153" name="__codelineno-4-153" href="#__codelineno-4-153"></a>            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;This is protected data&quot;</span><span class="p">,</span>
</span><span id="__span-4-154"><a id="__codelineno-4-154" name="__codelineno-4-154" href="#__codelineno-4-154"></a>            <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">token_info</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">],</span>
</span><span id="__span-4-155"><a id="__codelineno-4-155" name="__codelineno-4-155" href="#__codelineno-4-155"></a>            <span class="s2">&quot;scopes&quot;</span><span class="p">:</span> <span class="n">token_info</span><span class="p">[</span><span class="s1">&#39;scope&#39;</span><span class="p">]</span>
</span><span id="__span-4-156"><a id="__codelineno-4-156" name="__codelineno-4-156" href="#__codelineno-4-156"></a>        <span class="p">}</span>
</span><span id="__span-4-157"><a id="__codelineno-4-157" name="__codelineno-4-157" href="#__codelineno-4-157"></a>
</span><span id="__span-4-158"><a id="__codelineno-4-158" name="__codelineno-4-158" href="#__codelineno-4-158"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">get_protected_data</span><span class="p">(</span>
</span><span id="__span-4-159"><a id="__codelineno-4-159" name="__codelineno-4-159" href="#__codelineno-4-159"></a>        <span class="n">access_token</span><span class="o">=</span><span class="n">token_data</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">],</span>
</span><span id="__span-4-160"><a id="__codelineno-4-160" name="__codelineno-4-160" href="#__codelineno-4-160"></a>        <span class="n">oauth_manager</span><span class="o">=</span><span class="n">oauth_manager</span>
</span><span id="__span-4-161"><a id="__codelineno-4-161" name="__codelineno-4-161" href="#__codelineno-4-161"></a>    <span class="p">)</span>
</span><span id="__span-4-162"><a id="__codelineno-4-162" name="__codelineno-4-162" href="#__codelineno-4-162"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Protected resource access: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-4-163"><a id="__codelineno-4-163" name="__codelineno-4-163" href="#__codelineno-4-163"></a>
</span><span id="__span-4-164"><a id="__codelineno-4-164" name="__codelineno-4-164" href="#__codelineno-4-164"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-4-165"><a id="__codelineno-4-165" name="__codelineno-4-165" href="#__codelineno-4-165"></a>    <span class="n">oauth_authentication_example</span><span class="p">()</span>
</span></code></pre></div>
<h2 id="rate-limiting-and-dos-protection">Rate Limiting and DoS Protection<a class="headerlink" href="#rate-limiting-and-dos-protection" title="Permanent link">&para;</a></h2>
<p>Rate limiting is crucial for preventing abuse and ensuring fair resource allocation among API consumers.</p>
<h3 id="token-bucket-algorithm-implementation">Token Bucket Algorithm Implementation<a class="headerlink" href="#token-bucket-algorithm-implementation" title="Permanent link">&para;</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">threading</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lock</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="nd">@dataclass</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">TokenBucket</span><span class="p">:</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Token bucket for rate limiting&quot;&quot;&quot;</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>    <span class="n">capacity</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># Maximum number of tokens</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>    <span class="n">tokens</span><span class="p">:</span> <span class="nb">float</span>  <span class="c1"># Current number of tokens</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>    <span class="n">refill_rate</span><span class="p">:</span> <span class="nb">float</span>  <span class="c1"># Tokens added per second</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>    <span class="n">last_refill</span><span class="p">:</span> <span class="nb">float</span>  <span class="c1"># Last refill timestamp</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="k">class</span><span class="w"> </span><span class="nc">RateLimiter</span><span class="p">:</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Advanced rate limiting with multiple algorithms&quot;&quot;&quot;</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">buckets</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TokenBucket</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">request_history</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_rate_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">requests_per_second</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> 
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>                         <span class="n">burst_capacity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TokenBucket</span><span class="p">:</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a rate limit for an identifier (IP, user, API key)&quot;&quot;&quot;</span>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a>        <span class="k">if</span> <span class="n">burst_capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a>            <span class="n">burst_capacity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">requests_per_second</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1"># Allow 10 seconds of burst</span>
</span><span id="__span-5-28"><a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a>
</span><span id="__span-5-29"><a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a>        <span class="n">bucket</span> <span class="o">=</span> <span class="n">TokenBucket</span><span class="p">(</span>
</span><span id="__span-5-30"><a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a>            <span class="n">capacity</span><span class="o">=</span><span class="n">burst_capacity</span><span class="p">,</span>
</span><span id="__span-5-31"><a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a>            <span class="n">tokens</span><span class="o">=</span><span class="n">burst_capacity</span><span class="p">,</span>  <span class="c1"># Start with full bucket</span>
</span><span id="__span-5-32"><a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a>            <span class="n">refill_rate</span><span class="o">=</span><span class="n">requests_per_second</span><span class="p">,</span>
</span><span id="__span-5-33"><a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a>            <span class="n">last_refill</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-5-34"><a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a>        <span class="p">)</span>
</span><span id="__span-5-35"><a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a>
</span><span id="__span-5-36"><a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
</span><span id="__span-5-37"><a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">buckets</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">bucket</span>
</span><span id="__span-5-38"><a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a>
</span><span id="__span-5-39"><a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a>        <span class="k">return</span> <span class="n">bucket</span>
</span><span id="__span-5-40"><a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a>
</span><span id="__span-5-41"><a id="__codelineno-5-41" name="__codelineno-5-41" href="#__codelineno-5-41"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_allowed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tokens_requested</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-5-42"><a id="__codelineno-5-42" name="__codelineno-5-42" href="#__codelineno-5-42"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if request is allowed under rate limit&quot;&quot;&quot;</span>
</span><span id="__span-5-43"><a id="__codelineno-5-43" name="__codelineno-5-43" href="#__codelineno-5-43"></a>
</span><span id="__span-5-44"><a id="__codelineno-5-44" name="__codelineno-5-44" href="#__codelineno-5-44"></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
</span><span id="__span-5-45"><a id="__codelineno-5-45" name="__codelineno-5-45" href="#__codelineno-5-45"></a>            <span class="c1"># Get or create bucket</span>
</span><span id="__span-5-46"><a id="__codelineno-5-46" name="__codelineno-5-46" href="#__codelineno-5-46"></a>            <span class="k">if</span> <span class="n">identifier</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buckets</span><span class="p">:</span>
</span><span id="__span-5-47"><a id="__codelineno-5-47" name="__codelineno-5-47" href="#__codelineno-5-47"></a>                <span class="c1"># Default rate limit: 100 requests per second with burst of 1000</span>
</span><span id="__span-5-48"><a id="__codelineno-5-48" name="__codelineno-5-48" href="#__codelineno-5-48"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">create_rate_limit</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
</span><span id="__span-5-49"><a id="__codelineno-5-49" name="__codelineno-5-49" href="#__codelineno-5-49"></a>
</span><span id="__span-5-50"><a id="__codelineno-5-50" name="__codelineno-5-50" href="#__codelineno-5-50"></a>            <span class="n">bucket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buckets</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span>
</span><span id="__span-5-51"><a id="__codelineno-5-51" name="__codelineno-5-51" href="#__codelineno-5-51"></a>            <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-5-52"><a id="__codelineno-5-52" name="__codelineno-5-52" href="#__codelineno-5-52"></a>
</span><span id="__span-5-53"><a id="__codelineno-5-53" name="__codelineno-5-53" href="#__codelineno-5-53"></a>            <span class="c1"># Refill tokens based on elapsed time</span>
</span><span id="__span-5-54"><a id="__codelineno-5-54" name="__codelineno-5-54" href="#__codelineno-5-54"></a>            <span class="n">elapsed</span> <span class="o">=</span> <span class="n">current_time</span> <span class="o">-</span> <span class="n">bucket</span><span class="o">.</span><span class="n">last_refill</span>
</span><span id="__span-5-55"><a id="__codelineno-5-55" name="__codelineno-5-55" href="#__codelineno-5-55"></a>            <span class="n">tokens_to_add</span> <span class="o">=</span> <span class="n">elapsed</span> <span class="o">*</span> <span class="n">bucket</span><span class="o">.</span><span class="n">refill_rate</span>
</span><span id="__span-5-56"><a id="__codelineno-5-56" name="__codelineno-5-56" href="#__codelineno-5-56"></a>            <span class="n">bucket</span><span class="o">.</span><span class="n">tokens</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">bucket</span><span class="o">.</span><span class="n">capacity</span><span class="p">,</span> <span class="n">bucket</span><span class="o">.</span><span class="n">tokens</span> <span class="o">+</span> <span class="n">tokens_to_add</span><span class="p">)</span>
</span><span id="__span-5-57"><a id="__codelineno-5-57" name="__codelineno-5-57" href="#__codelineno-5-57"></a>            <span class="n">bucket</span><span class="o">.</span><span class="n">last_refill</span> <span class="o">=</span> <span class="n">current_time</span>
</span><span id="__span-5-58"><a id="__codelineno-5-58" name="__codelineno-5-58" href="#__codelineno-5-58"></a>
</span><span id="__span-5-59"><a id="__codelineno-5-59" name="__codelineno-5-59" href="#__codelineno-5-59"></a>            <span class="c1"># Check if enough tokens available</span>
</span><span id="__span-5-60"><a id="__codelineno-5-60" name="__codelineno-5-60" href="#__codelineno-5-60"></a>            <span class="k">if</span> <span class="n">bucket</span><span class="o">.</span><span class="n">tokens</span> <span class="o">&gt;=</span> <span class="n">tokens_requested</span><span class="p">:</span>
</span><span id="__span-5-61"><a id="__codelineno-5-61" name="__codelineno-5-61" href="#__codelineno-5-61"></a>                <span class="n">bucket</span><span class="o">.</span><span class="n">tokens</span> <span class="o">-=</span> <span class="n">tokens_requested</span>
</span><span id="__span-5-62"><a id="__codelineno-5-62" name="__codelineno-5-62" href="#__codelineno-5-62"></a>
</span><span id="__span-5-63"><a id="__codelineno-5-63" name="__codelineno-5-63" href="#__codelineno-5-63"></a>                <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="p">{</span>
</span><span id="__span-5-64"><a id="__codelineno-5-64" name="__codelineno-5-64" href="#__codelineno-5-64"></a>                    <span class="s2">&quot;allowed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-5-65"><a id="__codelineno-5-65" name="__codelineno-5-65" href="#__codelineno-5-65"></a>                    <span class="s2">&quot;remaining_tokens&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">bucket</span><span class="o">.</span><span class="n">tokens</span><span class="p">),</span>
</span><span id="__span-5-66"><a id="__codelineno-5-66" name="__codelineno-5-66" href="#__codelineno-5-66"></a>                    <span class="s2">&quot;reset_time&quot;</span><span class="p">:</span> <span class="n">current_time</span> <span class="o">+</span> <span class="p">(</span><span class="n">bucket</span><span class="o">.</span><span class="n">capacity</span> <span class="o">-</span> <span class="n">bucket</span><span class="o">.</span><span class="n">tokens</span><span class="p">)</span> <span class="o">/</span> <span class="n">bucket</span><span class="o">.</span><span class="n">refill_rate</span>
</span><span id="__span-5-67"><a id="__codelineno-5-67" name="__codelineno-5-67" href="#__codelineno-5-67"></a>                <span class="p">}</span>
</span><span id="__span-5-68"><a id="__codelineno-5-68" name="__codelineno-5-68" href="#__codelineno-5-68"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-5-69"><a id="__codelineno-5-69" name="__codelineno-5-69" href="#__codelineno-5-69"></a>                <span class="c1"># Calculate when enough tokens will be available</span>
</span><span id="__span-5-70"><a id="__codelineno-5-70" name="__codelineno-5-70" href="#__codelineno-5-70"></a>                <span class="n">tokens_needed</span> <span class="o">=</span> <span class="n">tokens_requested</span> <span class="o">-</span> <span class="n">bucket</span><span class="o">.</span><span class="n">tokens</span>
</span><span id="__span-5-71"><a id="__codelineno-5-71" name="__codelineno-5-71" href="#__codelineno-5-71"></a>                <span class="n">wait_time</span> <span class="o">=</span> <span class="n">tokens_needed</span> <span class="o">/</span> <span class="n">bucket</span><span class="o">.</span><span class="n">refill_rate</span>
</span><span id="__span-5-72"><a id="__codelineno-5-72" name="__codelineno-5-72" href="#__codelineno-5-72"></a>
</span><span id="__span-5-73"><a id="__codelineno-5-73" name="__codelineno-5-73" href="#__codelineno-5-73"></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">{</span>
</span><span id="__span-5-74"><a id="__codelineno-5-74" name="__codelineno-5-74" href="#__codelineno-5-74"></a>                    <span class="s2">&quot;allowed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-5-75"><a id="__codelineno-5-75" name="__codelineno-5-75" href="#__codelineno-5-75"></a>                    <span class="s2">&quot;retry_after&quot;</span><span class="p">:</span> <span class="n">wait_time</span><span class="p">,</span>
</span><span id="__span-5-76"><a id="__codelineno-5-76" name="__codelineno-5-76" href="#__codelineno-5-76"></a>                    <span class="s2">&quot;remaining_tokens&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">bucket</span><span class="o">.</span><span class="n">tokens</span><span class="p">)</span>
</span><span id="__span-5-77"><a id="__codelineno-5-77" name="__codelineno-5-77" href="#__codelineno-5-77"></a>                <span class="p">}</span>
</span><span id="__span-5-78"><a id="__codelineno-5-78" name="__codelineno-5-78" href="#__codelineno-5-78"></a>
</span><span id="__span-5-79"><a id="__codelineno-5-79" name="__codelineno-5-79" href="#__codelineno-5-79"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sliding_window_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">window_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3600</span><span class="p">,</span> 
</span><span id="__span-5-80"><a id="__codelineno-5-80" name="__codelineno-5-80" href="#__codelineno-5-80"></a>                           <span class="n">max_requests</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-5-81"><a id="__codelineno-5-81" name="__codelineno-5-81" href="#__codelineno-5-81"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sliding window rate limiting (alternative algorithm)&quot;&quot;&quot;</span>
</span><span id="__span-5-82"><a id="__codelineno-5-82" name="__codelineno-5-82" href="#__codelineno-5-82"></a>
</span><span id="__span-5-83"><a id="__codelineno-5-83" name="__codelineno-5-83" href="#__codelineno-5-83"></a>        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-5-84"><a id="__codelineno-5-84" name="__codelineno-5-84" href="#__codelineno-5-84"></a>        <span class="n">window_start</span> <span class="o">=</span> <span class="n">current_time</span> <span class="o">-</span> <span class="n">window_seconds</span>
</span><span id="__span-5-85"><a id="__codelineno-5-85" name="__codelineno-5-85" href="#__codelineno-5-85"></a>
</span><span id="__span-5-86"><a id="__codelineno-5-86" name="__codelineno-5-86" href="#__codelineno-5-86"></a>        <span class="c1"># Initialize request history if needed</span>
</span><span id="__span-5-87"><a id="__codelineno-5-87" name="__codelineno-5-87" href="#__codelineno-5-87"></a>        <span class="k">if</span> <span class="n">identifier</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_history</span><span class="p">:</span>
</span><span id="__span-5-88"><a id="__codelineno-5-88" name="__codelineno-5-88" href="#__codelineno-5-88"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">request_history</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-5-89"><a id="__codelineno-5-89" name="__codelineno-5-89" href="#__codelineno-5-89"></a>
</span><span id="__span-5-90"><a id="__codelineno-5-90" name="__codelineno-5-90" href="#__codelineno-5-90"></a>        <span class="c1"># Remove old requests outside the window</span>
</span><span id="__span-5-91"><a id="__codelineno-5-91" name="__codelineno-5-91" href="#__codelineno-5-91"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">request_history</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-5-92"><a id="__codelineno-5-92" name="__codelineno-5-92" href="#__codelineno-5-92"></a>            <span class="n">req_time</span> <span class="k">for</span> <span class="n">req_time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_history</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span>
</span><span id="__span-5-93"><a id="__codelineno-5-93" name="__codelineno-5-93" href="#__codelineno-5-93"></a>            <span class="k">if</span> <span class="n">req_time</span> <span class="o">&gt;</span> <span class="n">window_start</span>
</span><span id="__span-5-94"><a id="__codelineno-5-94" name="__codelineno-5-94" href="#__codelineno-5-94"></a>        <span class="p">]</span>
</span><span id="__span-5-95"><a id="__codelineno-5-95" name="__codelineno-5-95" href="#__codelineno-5-95"></a>
</span><span id="__span-5-96"><a id="__codelineno-5-96" name="__codelineno-5-96" href="#__codelineno-5-96"></a>        <span class="c1"># Check if within limit</span>
</span><span id="__span-5-97"><a id="__codelineno-5-97" name="__codelineno-5-97" href="#__codelineno-5-97"></a>        <span class="n">current_requests</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_history</span><span class="p">[</span><span class="n">identifier</span><span class="p">])</span>
</span><span id="__span-5-98"><a id="__codelineno-5-98" name="__codelineno-5-98" href="#__codelineno-5-98"></a>
</span><span id="__span-5-99"><a id="__codelineno-5-99" name="__codelineno-5-99" href="#__codelineno-5-99"></a>        <span class="k">if</span> <span class="n">current_requests</span> <span class="o">&lt;</span> <span class="n">max_requests</span><span class="p">:</span>
</span><span id="__span-5-100"><a id="__codelineno-5-100" name="__codelineno-5-100" href="#__codelineno-5-100"></a>            <span class="c1"># Add current request</span>
</span><span id="__span-5-101"><a id="__codelineno-5-101" name="__codelineno-5-101" href="#__codelineno-5-101"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">request_history</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_time</span><span class="p">)</span>
</span><span id="__span-5-102"><a id="__codelineno-5-102" name="__codelineno-5-102" href="#__codelineno-5-102"></a>
</span><span id="__span-5-103"><a id="__codelineno-5-103" name="__codelineno-5-103" href="#__codelineno-5-103"></a>            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="p">{</span>
</span><span id="__span-5-104"><a id="__codelineno-5-104" name="__codelineno-5-104" href="#__codelineno-5-104"></a>                <span class="s2">&quot;allowed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-5-105"><a id="__codelineno-5-105" name="__codelineno-5-105" href="#__codelineno-5-105"></a>                <span class="s2">&quot;requests_remaining&quot;</span><span class="p">:</span> <span class="n">max_requests</span> <span class="o">-</span> <span class="n">current_requests</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="__span-5-106"><a id="__codelineno-5-106" name="__codelineno-5-106" href="#__codelineno-5-106"></a>                <span class="s2">&quot;window_reset&quot;</span><span class="p">:</span> <span class="n">window_start</span> <span class="o">+</span> <span class="n">window_seconds</span>
</span><span id="__span-5-107"><a id="__codelineno-5-107" name="__codelineno-5-107" href="#__codelineno-5-107"></a>            <span class="p">}</span>
</span><span id="__span-5-108"><a id="__codelineno-5-108" name="__codelineno-5-108" href="#__codelineno-5-108"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-5-109"><a id="__codelineno-5-109" name="__codelineno-5-109" href="#__codelineno-5-109"></a>            <span class="c1"># Calculate when window will reset</span>
</span><span id="__span-5-110"><a id="__codelineno-5-110" name="__codelineno-5-110" href="#__codelineno-5-110"></a>            <span class="n">oldest_request</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_history</span><span class="p">[</span><span class="n">identifier</span><span class="p">])</span>
</span><span id="__span-5-111"><a id="__codelineno-5-111" name="__codelineno-5-111" href="#__codelineno-5-111"></a>            <span class="n">reset_time</span> <span class="o">=</span> <span class="n">oldest_request</span> <span class="o">+</span> <span class="n">window_seconds</span>
</span><span id="__span-5-112"><a id="__codelineno-5-112" name="__codelineno-5-112" href="#__codelineno-5-112"></a>
</span><span id="__span-5-113"><a id="__codelineno-5-113" name="__codelineno-5-113" href="#__codelineno-5-113"></a>            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">{</span>
</span><span id="__span-5-114"><a id="__codelineno-5-114" name="__codelineno-5-114" href="#__codelineno-5-114"></a>                <span class="s2">&quot;allowed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-5-115"><a id="__codelineno-5-115" name="__codelineno-5-115" href="#__codelineno-5-115"></a>                <span class="s2">&quot;retry_after&quot;</span><span class="p">:</span> <span class="n">reset_time</span> <span class="o">-</span> <span class="n">current_time</span><span class="p">,</span>
</span><span id="__span-5-116"><a id="__codelineno-5-116" name="__codelineno-5-116" href="#__codelineno-5-116"></a>                <span class="s2">&quot;requests_remaining&quot;</span><span class="p">:</span> <span class="mi">0</span>
</span><span id="__span-5-117"><a id="__codelineno-5-117" name="__codelineno-5-117" href="#__codelineno-5-117"></a>            <span class="p">}</span>
</span><span id="__span-5-118"><a id="__codelineno-5-118" name="__codelineno-5-118" href="#__codelineno-5-118"></a>
</span><span id="__span-5-119"><a id="__codelineno-5-119" name="__codelineno-5-119" href="#__codelineno-5-119"></a><span class="k">class</span><span class="w"> </span><span class="nc">DDoSProtection</span><span class="p">:</span>
</span><span id="__span-5-120"><a id="__codelineno-5-120" name="__codelineno-5-120" href="#__codelineno-5-120"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;DDoS protection with progressive penalties&quot;&quot;&quot;</span>
</span><span id="__span-5-121"><a id="__codelineno-5-121" name="__codelineno-5-121" href="#__codelineno-5-121"></a>
</span><span id="__span-5-122"><a id="__codelineno-5-122" name="__codelineno-5-122" href="#__codelineno-5-122"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-5-123"><a id="__codelineno-5-123" name="__codelineno-5-123" href="#__codelineno-5-123"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span> <span class="o">=</span> <span class="n">RateLimiter</span><span class="p">()</span>
</span><span id="__span-5-124"><a id="__codelineno-5-124" name="__codelineno-5-124" href="#__codelineno-5-124"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">suspicious_ips</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-5-125"><a id="__codelineno-5-125" name="__codelineno-5-125" href="#__codelineno-5-125"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">blocked_ips</span><span class="p">:</span> <span class="nb">set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="__span-5-126"><a id="__codelineno-5-126" name="__codelineno-5-126" href="#__codelineno-5-126"></a>
</span><span id="__span-5-127"><a id="__codelineno-5-127" name="__codelineno-5-127" href="#__codelineno-5-127"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_request_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span><span id="__span-5-128"><a id="__codelineno-5-128" name="__codelineno-5-128" href="#__codelineno-5-128"></a>                              <span class="n">user_agent</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="__span-5-129"><a id="__codelineno-5-129" name="__codelineno-5-129" href="#__codelineno-5-129"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze request patterns for DDoS indicators&quot;&quot;&quot;</span>
</span><span id="__span-5-130"><a id="__codelineno-5-130" name="__codelineno-5-130" href="#__codelineno-5-130"></a>
</span><span id="__span-5-131"><a id="__codelineno-5-131" name="__codelineno-5-131" href="#__codelineno-5-131"></a>        <span class="c1"># Check if IP is already blocked</span>
</span><span id="__span-5-132"><a id="__codelineno-5-132" name="__codelineno-5-132" href="#__codelineno-5-132"></a>        <span class="k">if</span> <span class="n">ip_address</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocked_ips</span><span class="p">:</span>
</span><span id="__span-5-133"><a id="__codelineno-5-133" name="__codelineno-5-133" href="#__codelineno-5-133"></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-5-134"><a id="__codelineno-5-134" name="__codelineno-5-134" href="#__codelineno-5-134"></a>                <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;block&quot;</span><span class="p">,</span>
</span><span id="__span-5-135"><a id="__codelineno-5-135" name="__codelineno-5-135" href="#__codelineno-5-135"></a>                <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;IP previously blocked for suspicious activity&quot;</span>
</span><span id="__span-5-136"><a id="__codelineno-5-136" name="__codelineno-5-136" href="#__codelineno-5-136"></a>            <span class="p">}</span>
</span><span id="__span-5-137"><a id="__codelineno-5-137" name="__codelineno-5-137" href="#__codelineno-5-137"></a>
</span><span id="__span-5-138"><a id="__codelineno-5-138" name="__codelineno-5-138" href="#__codelineno-5-138"></a>        <span class="c1"># Progressive rate limiting based on suspicion level</span>
</span><span id="__span-5-139"><a id="__codelineno-5-139" name="__codelineno-5-139" href="#__codelineno-5-139"></a>        <span class="n">suspicion_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_suspicion_level</span><span class="p">(</span><span class="n">ip_address</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">user_agent</span><span class="p">)</span>
</span><span id="__span-5-140"><a id="__codelineno-5-140" name="__codelineno-5-140" href="#__codelineno-5-140"></a>
</span><span id="__span-5-141"><a id="__codelineno-5-141" name="__codelineno-5-141" href="#__codelineno-5-141"></a>        <span class="k">if</span> <span class="n">suspicion_level</span> <span class="o">==</span> <span class="s2">&quot;low&quot;</span><span class="p">:</span>
</span><span id="__span-5-142"><a id="__codelineno-5-142" name="__codelineno-5-142" href="#__codelineno-5-142"></a>            <span class="n">allowed</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="o">.</span><span class="n">is_allowed</span><span class="p">(</span><span class="n">ip_address</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-5-143"><a id="__codelineno-5-143" name="__codelineno-5-143" href="#__codelineno-5-143"></a>            <span class="n">requests_per_second</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="__span-5-144"><a id="__codelineno-5-144" name="__codelineno-5-144" href="#__codelineno-5-144"></a>        <span class="k">elif</span> <span class="n">suspicion_level</span> <span class="o">==</span> <span class="s2">&quot;medium&quot;</span><span class="p">:</span>
</span><span id="__span-5-145"><a id="__codelineno-5-145" name="__codelineno-5-145" href="#__codelineno-5-145"></a>            <span class="n">allowed</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="o">.</span><span class="n">sliding_window_check</span><span class="p">(</span><span class="n">ip_address</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="__span-5-146"><a id="__codelineno-5-146" name="__codelineno-5-146" href="#__codelineno-5-146"></a>            <span class="n">requests_per_second</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="__span-5-147"><a id="__codelineno-5-147" name="__codelineno-5-147" href="#__codelineno-5-147"></a>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># high suspicion</span>
</span><span id="__span-5-148"><a id="__codelineno-5-148" name="__codelineno-5-148" href="#__codelineno-5-148"></a>            <span class="n">allowed</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="o">.</span><span class="n">sliding_window_check</span><span class="p">(</span><span class="n">ip_address</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</span><span id="__span-5-149"><a id="__codelineno-5-149" name="__codelineno-5-149" href="#__codelineno-5-149"></a>            <span class="n">requests_per_second</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-5-150"><a id="__codelineno-5-150" name="__codelineno-5-150" href="#__codelineno-5-150"></a>
</span><span id="__span-5-151"><a id="__codelineno-5-151" name="__codelineno-5-151" href="#__codelineno-5-151"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">allowed</span><span class="p">:</span>
</span><span id="__span-5-152"><a id="__codelineno-5-152" name="__codelineno-5-152" href="#__codelineno-5-152"></a>            <span class="c1"># Track consecutive violations</span>
</span><span id="__span-5-153"><a id="__codelineno-5-153" name="__codelineno-5-153" href="#__codelineno-5-153"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_track_violation</span><span class="p">(</span><span class="n">ip_address</span><span class="p">)</span>
</span><span id="__span-5-154"><a id="__codelineno-5-154" name="__codelineno-5-154" href="#__codelineno-5-154"></a>
</span><span id="__span-5-155"><a id="__codelineno-5-155" name="__codelineno-5-155" href="#__codelineno-5-155"></a>            <span class="c1"># Check if IP should be blocked</span>
</span><span id="__span-5-156"><a id="__codelineno-5-156" name="__codelineno-5-156" href="#__codelineno-5-156"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_block_ip</span><span class="p">(</span><span class="n">ip_address</span><span class="p">):</span>
</span><span id="__span-5-157"><a id="__codelineno-5-157" name="__codelineno-5-157" href="#__codelineno-5-157"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">blocked_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ip_address</span><span class="p">)</span>
</span><span id="__span-5-158"><a id="__codelineno-5-158" name="__codelineno-5-158" href="#__codelineno-5-158"></a>                <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-5-159"><a id="__codelineno-5-159" name="__codelineno-5-159" href="#__codelineno-5-159"></a>                    <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;block&quot;</span><span class="p">,</span>
</span><span id="__span-5-160"><a id="__codelineno-5-160" name="__codelineno-5-160" href="#__codelineno-5-160"></a>                    <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Too many rate limit violations&quot;</span>
</span><span id="__span-5-161"><a id="__codelineno-5-161" name="__codelineno-5-161" href="#__codelineno-5-161"></a>                <span class="p">}</span>
</span><span id="__span-5-162"><a id="__codelineno-5-162" name="__codelineno-5-162" href="#__codelineno-5-162"></a>
</span><span id="__span-5-163"><a id="__codelineno-5-163" name="__codelineno-5-163" href="#__codelineno-5-163"></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-5-164"><a id="__codelineno-5-164" name="__codelineno-5-164" href="#__codelineno-5-164"></a>            <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;allow&quot;</span> <span class="k">if</span> <span class="n">allowed</span> <span class="k">else</span> <span class="s2">&quot;rate_limit&quot;</span><span class="p">,</span>
</span><span id="__span-5-165"><a id="__codelineno-5-165" name="__codelineno-5-165" href="#__codelineno-5-165"></a>            <span class="s2">&quot;suspicion_level&quot;</span><span class="p">:</span> <span class="n">suspicion_level</span><span class="p">,</span>
</span><span id="__span-5-166"><a id="__codelineno-5-166" name="__codelineno-5-166" href="#__codelineno-5-166"></a>            <span class="s2">&quot;rate_info&quot;</span><span class="p">:</span> <span class="n">info</span>
</span><span id="__span-5-167"><a id="__codelineno-5-167" name="__codelineno-5-167" href="#__codelineno-5-167"></a>        <span class="p">}</span>
</span><span id="__span-5-168"><a id="__codelineno-5-168" name="__codelineno-5-168" href="#__codelineno-5-168"></a>
</span><span id="__span-5-169"><a id="__codelineno-5-169" name="__codelineno-5-169" href="#__codelineno-5-169"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_suspicion_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span><span id="__span-5-170"><a id="__codelineno-5-170" name="__codelineno-5-170" href="#__codelineno-5-170"></a>                                 <span class="n">user_agent</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-5-171"><a id="__codelineno-5-171" name="__codelineno-5-171" href="#__codelineno-5-171"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate suspicion level based on various factors&quot;&quot;&quot;</span>
</span><span id="__span-5-172"><a id="__codelineno-5-172" name="__codelineno-5-172" href="#__codelineno-5-172"></a>
</span><span id="__span-5-173"><a id="__codelineno-5-173" name="__codelineno-5-173" href="#__codelineno-5-173"></a>        <span class="n">suspicion_score</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-5-174"><a id="__codelineno-5-174" name="__codelineno-5-174" href="#__codelineno-5-174"></a>
</span><span id="__span-5-175"><a id="__codelineno-5-175" name="__codelineno-5-175" href="#__codelineno-5-175"></a>        <span class="c1"># Check user agent</span>
</span><span id="__span-5-176"><a id="__codelineno-5-176" name="__codelineno-5-176" href="#__codelineno-5-176"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_agent</span> <span class="ow">or</span> <span class="n">user_agent</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;curl&quot;</span><span class="p">,</span> <span class="s2">&quot;wget&quot;</span><span class="p">,</span> <span class="s2">&quot;python-requests&quot;</span><span class="p">]:</span>
</span><span id="__span-5-177"><a id="__codelineno-5-177" name="__codelineno-5-177" href="#__codelineno-5-177"></a>            <span class="n">suspicion_score</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="__span-5-178"><a id="__codelineno-5-178" name="__codelineno-5-178" href="#__codelineno-5-178"></a>
</span><span id="__span-5-179"><a id="__codelineno-5-179" name="__codelineno-5-179" href="#__codelineno-5-179"></a>        <span class="c1"># Check for suspicious endpoints</span>
</span><span id="__span-5-180"><a id="__codelineno-5-180" name="__codelineno-5-180" href="#__codelineno-5-180"></a>        <span class="n">suspicious_endpoints</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;/admin&quot;</span><span class="p">,</span> <span class="s2">&quot;/login&quot;</span><span class="p">,</span> <span class="s2">&quot;/api/auth&quot;</span><span class="p">,</span> <span class="s2">&quot;/.env&quot;</span><span class="p">,</span> <span class="s2">&quot;/config&quot;</span><span class="p">]</span>
</span><span id="__span-5-181"><a id="__codelineno-5-181" name="__codelineno-5-181" href="#__codelineno-5-181"></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">suspicious</span> <span class="ow">in</span> <span class="n">endpoint</span> <span class="k">for</span> <span class="n">suspicious</span> <span class="ow">in</span> <span class="n">suspicious_endpoints</span><span class="p">):</span>
</span><span id="__span-5-182"><a id="__codelineno-5-182" name="__codelineno-5-182" href="#__codelineno-5-182"></a>            <span class="n">suspicion_score</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-5-183"><a id="__codelineno-5-183" name="__codelineno-5-183" href="#__codelineno-5-183"></a>
</span><span id="__span-5-184"><a id="__codelineno-5-184" name="__codelineno-5-184" href="#__codelineno-5-184"></a>        <span class="c1"># Check request frequency from this IP</span>
</span><span id="__span-5-185"><a id="__codelineno-5-185" name="__codelineno-5-185" href="#__codelineno-5-185"></a>        <span class="k">if</span> <span class="n">ip_address</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="o">.</span><span class="n">request_history</span><span class="p">:</span>
</span><span id="__span-5-186"><a id="__codelineno-5-186" name="__codelineno-5-186" href="#__codelineno-5-186"></a>            <span class="n">recent_requests</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="o">.</span><span class="n">request_history</span><span class="p">[</span><span class="n">ip_address</span><span class="p">])</span>
</span><span id="__span-5-187"><a id="__codelineno-5-187" name="__codelineno-5-187" href="#__codelineno-5-187"></a>            <span class="k">if</span> <span class="n">recent_requests</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>  <span class="c1"># Very high frequency</span>
</span><span id="__span-5-188"><a id="__codelineno-5-188" name="__codelineno-5-188" href="#__codelineno-5-188"></a>                <span class="n">suspicion_score</span> <span class="o">+=</span> <span class="mi">3</span>
</span><span id="__span-5-189"><a id="__codelineno-5-189" name="__codelineno-5-189" href="#__codelineno-5-189"></a>            <span class="k">elif</span> <span class="n">recent_requests</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="__span-5-190"><a id="__codelineno-5-190" name="__codelineno-5-190" href="#__codelineno-5-190"></a>                <span class="n">suspicion_score</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-5-191"><a id="__codelineno-5-191" name="__codelineno-5-191" href="#__codelineno-5-191"></a>
</span><span id="__span-5-192"><a id="__codelineno-5-192" name="__codelineno-5-192" href="#__codelineno-5-192"></a>        <span class="c1"># Determine level</span>
</span><span id="__span-5-193"><a id="__codelineno-5-193" name="__codelineno-5-193" href="#__codelineno-5-193"></a>        <span class="k">if</span> <span class="n">suspicion_score</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="__span-5-194"><a id="__codelineno-5-194" name="__codelineno-5-194" href="#__codelineno-5-194"></a>            <span class="k">return</span> <span class="s2">&quot;high&quot;</span>
</span><span id="__span-5-195"><a id="__codelineno-5-195" name="__codelineno-5-195" href="#__codelineno-5-195"></a>        <span class="k">elif</span> <span class="n">suspicion_score</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-5-196"><a id="__codelineno-5-196" name="__codelineno-5-196" href="#__codelineno-5-196"></a>            <span class="k">return</span> <span class="s2">&quot;medium&quot;</span>
</span><span id="__span-5-197"><a id="__codelineno-5-197" name="__codelineno-5-197" href="#__codelineno-5-197"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-5-198"><a id="__codelineno-5-198" name="__codelineno-5-198" href="#__codelineno-5-198"></a>            <span class="k">return</span> <span class="s2">&quot;low&quot;</span>
</span><span id="__span-5-199"><a id="__codelineno-5-199" name="__codelineno-5-199" href="#__codelineno-5-199"></a>
</span><span id="__span-5-200"><a id="__codelineno-5-200" name="__codelineno-5-200" href="#__codelineno-5-200"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_track_violation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-5-201"><a id="__codelineno-5-201" name="__codelineno-5-201" href="#__codelineno-5-201"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Track rate limit violations&quot;&quot;&quot;</span>
</span><span id="__span-5-202"><a id="__codelineno-5-202" name="__codelineno-5-202" href="#__codelineno-5-202"></a>        <span class="k">if</span> <span class="n">ip_address</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">suspicious_ips</span><span class="p">:</span>
</span><span id="__span-5-203"><a id="__codelineno-5-203" name="__codelineno-5-203" href="#__codelineno-5-203"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">suspicious_ips</span><span class="p">[</span><span class="n">ip_address</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-5-204"><a id="__codelineno-5-204" name="__codelineno-5-204" href="#__codelineno-5-204"></a>                <span class="s2">&quot;violations&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-5-205"><a id="__codelineno-5-205" name="__codelineno-5-205" href="#__codelineno-5-205"></a>                <span class="s2">&quot;first_violation&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-5-206"><a id="__codelineno-5-206" name="__codelineno-5-206" href="#__codelineno-5-206"></a>            <span class="p">}</span>
</span><span id="__span-5-207"><a id="__codelineno-5-207" name="__codelineno-5-207" href="#__codelineno-5-207"></a>
</span><span id="__span-5-208"><a id="__codelineno-5-208" name="__codelineno-5-208" href="#__codelineno-5-208"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">suspicious_ips</span><span class="p">[</span><span class="n">ip_address</span><span class="p">][</span><span class="s2">&quot;violations&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-5-209"><a id="__codelineno-5-209" name="__codelineno-5-209" href="#__codelineno-5-209"></a>
</span><span id="__span-5-210"><a id="__codelineno-5-210" name="__codelineno-5-210" href="#__codelineno-5-210"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_should_block_ip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-5-211"><a id="__codelineno-5-211" name="__codelineno-5-211" href="#__codelineno-5-211"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine if IP should be blocked&quot;&quot;&quot;</span>
</span><span id="__span-5-212"><a id="__codelineno-5-212" name="__codelineno-5-212" href="#__codelineno-5-212"></a>        <span class="k">if</span> <span class="n">ip_address</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">suspicious_ips</span><span class="p">:</span>
</span><span id="__span-5-213"><a id="__codelineno-5-213" name="__codelineno-5-213" href="#__codelineno-5-213"></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-5-214"><a id="__codelineno-5-214" name="__codelineno-5-214" href="#__codelineno-5-214"></a>
</span><span id="__span-5-215"><a id="__codelineno-5-215" name="__codelineno-5-215" href="#__codelineno-5-215"></a>        <span class="n">violations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suspicious_ips</span><span class="p">[</span><span class="n">ip_address</span><span class="p">][</span><span class="s2">&quot;violations&quot;</span><span class="p">]</span>
</span><span id="__span-5-216"><a id="__codelineno-5-216" name="__codelineno-5-216" href="#__codelineno-5-216"></a>        <span class="n">first_violation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suspicious_ips</span><span class="p">[</span><span class="n">ip_address</span><span class="p">][</span><span class="s2">&quot;first_violation&quot;</span><span class="p">]</span>
</span><span id="__span-5-217"><a id="__codelineno-5-217" name="__codelineno-5-217" href="#__codelineno-5-217"></a>
</span><span id="__span-5-218"><a id="__codelineno-5-218" name="__codelineno-5-218" href="#__codelineno-5-218"></a>        <span class="c1"># Block if more than 10 violations in the last hour</span>
</span><span id="__span-5-219"><a id="__codelineno-5-219" name="__codelineno-5-219" href="#__codelineno-5-219"></a>        <span class="k">if</span> <span class="n">violations</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="ow">and</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">first_violation</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3600</span><span class="p">:</span>
</span><span id="__span-5-220"><a id="__codelineno-5-220" name="__codelineno-5-220" href="#__codelineno-5-220"></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-5-221"><a id="__codelineno-5-221" name="__codelineno-5-221" href="#__codelineno-5-221"></a>
</span><span id="__span-5-222"><a id="__codelineno-5-222" name="__codelineno-5-222" href="#__codelineno-5-222"></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-5-223"><a id="__codelineno-5-223" name="__codelineno-5-223" href="#__codelineno-5-223"></a>
</span><span id="__span-5-224"><a id="__codelineno-5-224" name="__codelineno-5-224" href="#__codelineno-5-224"></a><span class="k">def</span><span class="w"> </span><span class="nf">rate_limiting_example</span><span class="p">():</span>
</span><span id="__span-5-225"><a id="__codelineno-5-225" name="__codelineno-5-225" href="#__codelineno-5-225"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate rate limiting and DDoS protection&quot;&quot;&quot;</span>
</span><span id="__span-5-226"><a id="__codelineno-5-226" name="__codelineno-5-226" href="#__codelineno-5-226"></a>
</span><span id="__span-5-227"><a id="__codelineno-5-227" name="__codelineno-5-227" href="#__codelineno-5-227"></a>    <span class="c1"># Initialize protection systems</span>
</span><span id="__span-5-228"><a id="__codelineno-5-228" name="__codelineno-5-228" href="#__codelineno-5-228"></a>    <span class="n">rate_limiter</span> <span class="o">=</span> <span class="n">RateLimiter</span><span class="p">()</span>
</span><span id="__span-5-229"><a id="__codelineno-5-229" name="__codelineno-5-229" href="#__codelineno-5-229"></a>    <span class="n">ddos_protection</span> <span class="o">=</span> <span class="n">DDoSProtection</span><span class="p">()</span>
</span><span id="__span-5-230"><a id="__codelineno-5-230" name="__codelineno-5-230" href="#__codelineno-5-230"></a>
</span><span id="__span-5-231"><a id="__codelineno-5-231" name="__codelineno-5-231" href="#__codelineno-5-231"></a>    <span class="c1"># Create rate limits for different users</span>
</span><span id="__span-5-232"><a id="__codelineno-5-232" name="__codelineno-5-232" href="#__codelineno-5-232"></a>    <span class="n">rate_limiter</span><span class="o">.</span><span class="n">create_rate_limit</span><span class="p">(</span><span class="s2">&quot;api_key_123&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>  <span class="c1"># 10 req/sec, burst 50</span>
</span><span id="__span-5-233"><a id="__codelineno-5-233" name="__codelineno-5-233" href="#__codelineno-5-233"></a>    <span class="n">rate_limiter</span><span class="o">.</span><span class="n">create_rate_limit</span><span class="p">(</span><span class="s2">&quot;premium_user&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>  <span class="c1"># Higher limits</span>
</span><span id="__span-5-234"><a id="__codelineno-5-234" name="__codelineno-5-234" href="#__codelineno-5-234"></a>
</span><span id="__span-5-235"><a id="__codelineno-5-235" name="__codelineno-5-235" href="#__codelineno-5-235"></a>    <span class="c1"># Simulate API requests</span>
</span><span id="__span-5-236"><a id="__codelineno-5-236" name="__codelineno-5-236" href="#__codelineno-5-236"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">simulate_api_request</span><span class="p">(</span><span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-5-237"><a id="__codelineno-5-237" name="__codelineno-5-237" href="#__codelineno-5-237"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Simulate an API request with rate limiting&quot;&quot;&quot;</span>
</span><span id="__span-5-238"><a id="__codelineno-5-238" name="__codelineno-5-238" href="#__codelineno-5-238"></a>
</span><span id="__span-5-239"><a id="__codelineno-5-239" name="__codelineno-5-239" href="#__codelineno-5-239"></a>        <span class="c1"># Check DDoS protection</span>
</span><span id="__span-5-240"><a id="__codelineno-5-240" name="__codelineno-5-240" href="#__codelineno-5-240"></a>        <span class="n">ddos_result</span> <span class="o">=</span> <span class="n">ddos_protection</span><span class="o">.</span><span class="n">analyze_request_pattern</span><span class="p">(</span>
</span><span id="__span-5-241"><a id="__codelineno-5-241" name="__codelineno-5-241" href="#__codelineno-5-241"></a>            <span class="n">ip_address</span><span class="o">=</span><span class="n">ip_address</span><span class="p">,</span>
</span><span id="__span-5-242"><a id="__codelineno-5-242" name="__codelineno-5-242" href="#__codelineno-5-242"></a>            <span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;/api/data&quot;</span><span class="p">,</span>
</span><span id="__span-5-243"><a id="__codelineno-5-243" name="__codelineno-5-243" href="#__codelineno-5-243"></a>            <span class="n">user_agent</span><span class="o">=</span><span class="s2">&quot;Mozilla/5.0 (legitimate browser)&quot;</span>
</span><span id="__span-5-244"><a id="__codelineno-5-244" name="__codelineno-5-244" href="#__codelineno-5-244"></a>        <span class="p">)</span>
</span><span id="__span-5-245"><a id="__codelineno-5-245" name="__codelineno-5-245" href="#__codelineno-5-245"></a>
</span><span id="__span-5-246"><a id="__codelineno-5-246" name="__codelineno-5-246" href="#__codelineno-5-246"></a>        <span class="k">if</span> <span class="n">ddos_result</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;block&quot;</span><span class="p">:</span>
</span><span id="__span-5-247"><a id="__codelineno-5-247" name="__codelineno-5-247" href="#__codelineno-5-247"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="mi">403</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">ddos_result</span><span class="p">[</span><span class="s2">&quot;reason&quot;</span><span class="p">]}</span>
</span><span id="__span-5-248"><a id="__codelineno-5-248" name="__codelineno-5-248" href="#__codelineno-5-248"></a>
</span><span id="__span-5-249"><a id="__codelineno-5-249" name="__codelineno-5-249" href="#__codelineno-5-249"></a>        <span class="c1"># Check rate limiting</span>
</span><span id="__span-5-250"><a id="__codelineno-5-250" name="__codelineno-5-250" href="#__codelineno-5-250"></a>        <span class="n">allowed</span><span class="p">,</span> <span class="n">rate_info</span> <span class="o">=</span> <span class="n">rate_limiter</span><span class="o">.</span><span class="n">is_allowed</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
</span><span id="__span-5-251"><a id="__codelineno-5-251" name="__codelineno-5-251" href="#__codelineno-5-251"></a>
</span><span id="__span-5-252"><a id="__codelineno-5-252" name="__codelineno-5-252" href="#__codelineno-5-252"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">allowed</span><span class="p">:</span>
</span><span id="__span-5-253"><a id="__codelineno-5-253" name="__codelineno-5-253" href="#__codelineno-5-253"></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-5-254"><a id="__codelineno-5-254" name="__codelineno-5-254" href="#__codelineno-5-254"></a>                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="mi">429</span><span class="p">,</span>
</span><span id="__span-5-255"><a id="__codelineno-5-255" name="__codelineno-5-255" href="#__codelineno-5-255"></a>                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Rate limit exceeded&quot;</span><span class="p">,</span>
</span><span id="__span-5-256"><a id="__codelineno-5-256" name="__codelineno-5-256" href="#__codelineno-5-256"></a>                <span class="s2">&quot;retry_after&quot;</span><span class="p">:</span> <span class="n">rate_info</span><span class="p">[</span><span class="s2">&quot;retry_after&quot;</span><span class="p">]</span>
</span><span id="__span-5-257"><a id="__codelineno-5-257" name="__codelineno-5-257" href="#__codelineno-5-257"></a>            <span class="p">}</span>
</span><span id="__span-5-258"><a id="__codelineno-5-258" name="__codelineno-5-258" href="#__codelineno-5-258"></a>
</span><span id="__span-5-259"><a id="__codelineno-5-259" name="__codelineno-5-259" href="#__codelineno-5-259"></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-5-260"><a id="__codelineno-5-260" name="__codelineno-5-260" href="#__codelineno-5-260"></a>            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
</span><span id="__span-5-261"><a id="__codelineno-5-261" name="__codelineno-5-261" href="#__codelineno-5-261"></a>            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;API response data&quot;</span><span class="p">,</span>
</span><span id="__span-5-262"><a id="__codelineno-5-262" name="__codelineno-5-262" href="#__codelineno-5-262"></a>            <span class="s2">&quot;rate_limit_remaining&quot;</span><span class="p">:</span> <span class="n">rate_info</span><span class="p">[</span><span class="s2">&quot;remaining_tokens&quot;</span><span class="p">]</span>
</span><span id="__span-5-263"><a id="__codelineno-5-263" name="__codelineno-5-263" href="#__codelineno-5-263"></a>        <span class="p">}</span>
</span><span id="__span-5-264"><a id="__codelineno-5-264" name="__codelineno-5-264" href="#__codelineno-5-264"></a>
</span><span id="__span-5-265"><a id="__codelineno-5-265" name="__codelineno-5-265" href="#__codelineno-5-265"></a>    <span class="c1"># Test normal usage</span>
</span><span id="__span-5-266"><a id="__codelineno-5-266" name="__codelineno-5-266" href="#__codelineno-5-266"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
</span><span id="__span-5-267"><a id="__codelineno-5-267" name="__codelineno-5-267" href="#__codelineno-5-267"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">simulate_api_request</span><span class="p">(</span><span class="s2">&quot;api_key_123&quot;</span><span class="p">,</span> <span class="s2">&quot;192.168.1.100&quot;</span><span class="p">)</span>
</span><span id="__span-5-268"><a id="__codelineno-5-268" name="__codelineno-5-268" href="#__codelineno-5-268"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Request </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-5-269"><a id="__codelineno-5-269" name="__codelineno-5-269" href="#__codelineno-5-269"></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># Small delay between requests</span>
</span><span id="__span-5-270"><a id="__codelineno-5-270" name="__codelineno-5-270" href="#__codelineno-5-270"></a>
</span><span id="__span-5-271"><a id="__codelineno-5-271" name="__codelineno-5-271" href="#__codelineno-5-271"></a>    <span class="c1"># Test rate limit exceeded</span>
</span><span id="__span-5-272"><a id="__codelineno-5-272" name="__codelineno-5-272" href="#__codelineno-5-272"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">60</span><span class="p">):</span>  <span class="c1"># Try to exceed rate limit</span>
</span><span id="__span-5-273"><a id="__codelineno-5-273" name="__codelineno-5-273" href="#__codelineno-5-273"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">simulate_api_request</span><span class="p">(</span><span class="s2">&quot;api_key_123&quot;</span><span class="p">,</span> <span class="s2">&quot;192.168.1.100&quot;</span><span class="p">)</span>
</span><span id="__span-5-274"><a id="__codelineno-5-274" name="__codelineno-5-274" href="#__codelineno-5-274"></a>        <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>
</span><span id="__span-5-275"><a id="__codelineno-5-275" name="__codelineno-5-275" href="#__codelineno-5-275"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rate limited after </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> rapid requests&quot;</span><span class="p">)</span>
</span><span id="__span-5-276"><a id="__codelineno-5-276" name="__codelineno-5-276" href="#__codelineno-5-276"></a>            <span class="k">break</span>
</span><span id="__span-5-277"><a id="__codelineno-5-277" name="__codelineno-5-277" href="#__codelineno-5-277"></a>
</span><span id="__span-5-278"><a id="__codelineno-5-278" name="__codelineno-5-278" href="#__codelineno-5-278"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-5-279"><a id="__codelineno-5-279" name="__codelineno-5-279" href="#__codelineno-5-279"></a>    <span class="n">rate_limiting_example</span><span class="p">()</span>
</span></code></pre></div>
<h2 id="secure-session-management">Secure Session Management<a class="headerlink" href="#secure-session-management" title="Permanent link">&para;</a></h2>
<p>Session management is critical for maintaining authenticated state between API requests while preventing session-related attacks.</p>
<h3 id="session-security-principles">Session Security Principles<a class="headerlink" href="#session-security-principles" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>@startuml Session_Security_Model
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>!theme plain
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>skinparam backgroundColor white
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>skinparam defaultFontName &quot;Arial&quot;
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>participant Client
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>participant &quot;API Gateway&quot; as Gateway
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>participant &quot;Session Store&quot; as Session
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>participant &quot;API Service&quot; as API
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>Client -&gt; Gateway: Login Request
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>Gateway -&gt; Session: Create Session
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>Session -&gt; Gateway: Session ID
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>Gateway -&gt; Client: Session Token (HTTP-Only Cookie)
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>note over Client, Gateway: Subsequent API Requests
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>Client -&gt; Gateway: API Request + Session Cookie
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>Gateway -&gt; Session: Validate Session
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>Session -&gt; Gateway: Session Data
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>Gateway -&gt; API: Authorized Request
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>API -&gt; Gateway: Response
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>Gateway -&gt; Client: API Response
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>note over Gateway, Session: Session Security Features
</span><span id="__span-6-26"><a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>note over Gateway: - CSRF Protection\n- Secure Cookies\n- Session Rotation\n- Timeout Management
</span><span id="__span-6-27"><a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>
</span><span id="__span-6-28"><a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>@enduml
</span></code></pre></div>
<h3 id="comprehensive-session-manager-implementation">Comprehensive Session Manager Implementation<a class="headerlink" href="#comprehensive-session-manager-implementation" title="Permanent link">&para;</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">secrets</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Any</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">asdict</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">threading</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lock</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="nd">@dataclass</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">SessionData</span><span class="p">:</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Secure session data structure&quot;&quot;&quot;</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>    <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>    <span class="n">last_accessed</span><span class="p">:</span> <span class="n">datetime</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>    <span class="n">expires_at</span><span class="p">:</span> <span class="n">datetime</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>    <span class="n">ip_address</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>    <span class="n">user_agent</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>    <span class="n">permissions</span><span class="p">:</span> <span class="nb">list</span>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>    <span class="n">is_active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>    <span class="n">csrf_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>    <span class="n">login_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>
</span><span id="__span-7-25"><a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a><span class="k">class</span><span class="w"> </span><span class="nc">SecureSessionManager</span><span class="p">:</span>
</span><span id="__span-7-26"><a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Production-ready session management with security features&quot;&quot;&quot;</span>
</span><span id="__span-7-27"><a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a>
</span><span id="__span-7-28"><a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_timeout_minutes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> 
</span><span id="__span-7-29"><a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a>                 <span class="n">max_sessions_per_user</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
</span><span id="__span-7-30"><a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">SessionData</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-7-31"><a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_sessions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># user_id -&gt; session_ids</span>
</span><span id="__span-7-32"><a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">session_timeout</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">session_timeout_minutes</span><span class="p">)</span>
</span><span id="__span-7-33"><a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_sessions</span> <span class="o">=</span> <span class="n">max_sessions_per_user</span>
</span><span id="__span-7-34"><a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
</span><span id="__span-7-35"><a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-7-36"><a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a>
</span><span id="__span-7-37"><a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a>        <span class="c1"># Security tracking</span>
</span><span id="__span-7-38"><a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">failed_logins</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-7-39"><a id="__codelineno-7-39" name="__codelineno-7-39" href="#__codelineno-7-39"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">suspicious_activity</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-7-40"><a id="__codelineno-7-40" name="__codelineno-7-40" href="#__codelineno-7-40"></a>
</span><span id="__span-7-41"><a id="__codelineno-7-41" name="__codelineno-7-41" href="#__codelineno-7-41"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span><span id="__span-7-42"><a id="__codelineno-7-42" name="__codelineno-7-42" href="#__codelineno-7-42"></a>                      <span class="n">user_agent</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">permissions</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="__span-7-43"><a id="__codelineno-7-43" name="__codelineno-7-43" href="#__codelineno-7-43"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-7-44"><a id="__codelineno-7-44" name="__codelineno-7-44" href="#__codelineno-7-44"></a><span class="sd">        Create a new secure session</span>
</span><span id="__span-7-45"><a id="__codelineno-7-45" name="__codelineno-7-45" href="#__codelineno-7-45"></a><span class="sd">        Returns: (session_id, csrf_token)</span>
</span><span id="__span-7-46"><a id="__codelineno-7-46" name="__codelineno-7-46" href="#__codelineno-7-46"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-7-47"><a id="__codelineno-7-47" name="__codelineno-7-47" href="#__codelineno-7-47"></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
</span><span id="__span-7-48"><a id="__codelineno-7-48" name="__codelineno-7-48" href="#__codelineno-7-48"></a>            <span class="c1"># Check for too many sessions per user</span>
</span><span id="__span-7-49"><a id="__codelineno-7-49" name="__codelineno-7-49" href="#__codelineno-7-49"></a>            <span class="k">if</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_sessions</span><span class="p">:</span>
</span><span id="__span-7-50"><a id="__codelineno-7-50" name="__codelineno-7-50" href="#__codelineno-7-50"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_sessions</span><span class="p">[</span><span class="n">user_id</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_sessions</span><span class="p">:</span>
</span><span id="__span-7-51"><a id="__codelineno-7-51" name="__codelineno-7-51" href="#__codelineno-7-51"></a>                    <span class="c1"># Remove oldest session</span>
</span><span id="__span-7-52"><a id="__codelineno-7-52" name="__codelineno-7-52" href="#__codelineno-7-52"></a>                    <span class="n">oldest_session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_sessions</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-7-53"><a id="__codelineno-7-53" name="__codelineno-7-53" href="#__codelineno-7-53"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_revoke_session_internal</span><span class="p">(</span><span class="n">oldest_session</span><span class="p">)</span>
</span><span id="__span-7-54"><a id="__codelineno-7-54" name="__codelineno-7-54" href="#__codelineno-7-54"></a>
</span><span id="__span-7-55"><a id="__codelineno-7-55" name="__codelineno-7-55" href="#__codelineno-7-55"></a>            <span class="c1"># Generate cryptographically secure session ID</span>
</span><span id="__span-7-56"><a id="__codelineno-7-56" name="__codelineno-7-56" href="#__codelineno-7-56"></a>            <span class="n">session_id</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
</span><span id="__span-7-57"><a id="__codelineno-7-57" name="__codelineno-7-57" href="#__codelineno-7-57"></a>            <span class="n">csrf_token</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
</span><span id="__span-7-58"><a id="__codelineno-7-58" name="__codelineno-7-58" href="#__codelineno-7-58"></a>
</span><span id="__span-7-59"><a id="__codelineno-7-59" name="__codelineno-7-59" href="#__codelineno-7-59"></a>            <span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="__span-7-60"><a id="__codelineno-7-60" name="__codelineno-7-60" href="#__codelineno-7-60"></a>
</span><span id="__span-7-61"><a id="__codelineno-7-61" name="__codelineno-7-61" href="#__codelineno-7-61"></a>            <span class="c1"># Create session data</span>
</span><span id="__span-7-62"><a id="__codelineno-7-62" name="__codelineno-7-62" href="#__codelineno-7-62"></a>            <span class="n">session_data</span> <span class="o">=</span> <span class="n">SessionData</span><span class="p">(</span>
</span><span id="__span-7-63"><a id="__codelineno-7-63" name="__codelineno-7-63" href="#__codelineno-7-63"></a>                <span class="n">session_id</span><span class="o">=</span><span class="n">session_id</span><span class="p">,</span>
</span><span id="__span-7-64"><a id="__codelineno-7-64" name="__codelineno-7-64" href="#__codelineno-7-64"></a>                <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="__span-7-65"><a id="__codelineno-7-65" name="__codelineno-7-65" href="#__codelineno-7-65"></a>                <span class="n">created_at</span><span class="o">=</span><span class="n">current_time</span><span class="p">,</span>
</span><span id="__span-7-66"><a id="__codelineno-7-66" name="__codelineno-7-66" href="#__codelineno-7-66"></a>                <span class="n">last_accessed</span><span class="o">=</span><span class="n">current_time</span><span class="p">,</span>
</span><span id="__span-7-67"><a id="__codelineno-7-67" name="__codelineno-7-67" href="#__codelineno-7-67"></a>                <span class="n">expires_at</span><span class="o">=</span><span class="n">current_time</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_timeout</span><span class="p">,</span>
</span><span id="__span-7-68"><a id="__codelineno-7-68" name="__codelineno-7-68" href="#__codelineno-7-68"></a>                <span class="n">ip_address</span><span class="o">=</span><span class="n">ip_address</span><span class="p">,</span>
</span><span id="__span-7-69"><a id="__codelineno-7-69" name="__codelineno-7-69" href="#__codelineno-7-69"></a>                <span class="n">user_agent</span><span class="o">=</span><span class="n">user_agent</span><span class="p">,</span>
</span><span id="__span-7-70"><a id="__codelineno-7-70" name="__codelineno-7-70" href="#__codelineno-7-70"></a>                <span class="n">permissions</span><span class="o">=</span><span class="n">permissions</span><span class="p">,</span>
</span><span id="__span-7-71"><a id="__codelineno-7-71" name="__codelineno-7-71" href="#__codelineno-7-71"></a>                <span class="n">csrf_token</span><span class="o">=</span><span class="n">csrf_token</span>
</span><span id="__span-7-72"><a id="__codelineno-7-72" name="__codelineno-7-72" href="#__codelineno-7-72"></a>            <span class="p">)</span>
</span><span id="__span-7-73"><a id="__codelineno-7-73" name="__codelineno-7-73" href="#__codelineno-7-73"></a>
</span><span id="__span-7-74"><a id="__codelineno-7-74" name="__codelineno-7-74" href="#__codelineno-7-74"></a>            <span class="c1"># Store session</span>
</span><span id="__span-7-75"><a id="__codelineno-7-75" name="__codelineno-7-75" href="#__codelineno-7-75"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">[</span><span class="n">session_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">session_data</span>
</span><span id="__span-7-76"><a id="__codelineno-7-76" name="__codelineno-7-76" href="#__codelineno-7-76"></a>
</span><span id="__span-7-77"><a id="__codelineno-7-77" name="__codelineno-7-77" href="#__codelineno-7-77"></a>            <span class="c1"># Track user sessions</span>
</span><span id="__span-7-78"><a id="__codelineno-7-78" name="__codelineno-7-78" href="#__codelineno-7-78"></a>            <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_sessions</span><span class="p">:</span>
</span><span id="__span-7-79"><a id="__codelineno-7-79" name="__codelineno-7-79" href="#__codelineno-7-79"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">user_sessions</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-7-80"><a id="__codelineno-7-80" name="__codelineno-7-80" href="#__codelineno-7-80"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">user_sessions</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
</span><span id="__span-7-81"><a id="__codelineno-7-81" name="__codelineno-7-81" href="#__codelineno-7-81"></a>
</span><span id="__span-7-82"><a id="__codelineno-7-82" name="__codelineno-7-82" href="#__codelineno-7-82"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Session created for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">ip_address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-7-83"><a id="__codelineno-7-83" name="__codelineno-7-83" href="#__codelineno-7-83"></a>
</span><span id="__span-7-84"><a id="__codelineno-7-84" name="__codelineno-7-84" href="#__codelineno-7-84"></a>            <span class="k">return</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">csrf_token</span>
</span><span id="__span-7-85"><a id="__codelineno-7-85" name="__codelineno-7-85" href="#__codelineno-7-85"></a>
</span><span id="__span-7-86"><a id="__codelineno-7-86" name="__codelineno-7-86" href="#__codelineno-7-86"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span><span id="__span-7-87"><a id="__codelineno-7-87" name="__codelineno-7-87" href="#__codelineno-7-87"></a>                        <span class="n">user_agent</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">csrf_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SessionData</span><span class="p">]:</span>
</span><span id="__span-7-88"><a id="__codelineno-7-88" name="__codelineno-7-88" href="#__codelineno-7-88"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-7-89"><a id="__codelineno-7-89" name="__codelineno-7-89" href="#__codelineno-7-89"></a><span class="sd">        Validate session with security checks</span>
</span><span id="__span-7-90"><a id="__codelineno-7-90" name="__codelineno-7-90" href="#__codelineno-7-90"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-7-91"><a id="__codelineno-7-91" name="__codelineno-7-91" href="#__codelineno-7-91"></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
</span><span id="__span-7-92"><a id="__codelineno-7-92" name="__codelineno-7-92" href="#__codelineno-7-92"></a>            <span class="k">if</span> <span class="n">session_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">:</span>
</span><span id="__span-7-93"><a id="__codelineno-7-93" name="__codelineno-7-93" href="#__codelineno-7-93"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-7-94"><a id="__codelineno-7-94" name="__codelineno-7-94" href="#__codelineno-7-94"></a>
</span><span id="__span-7-95"><a id="__codelineno-7-95" name="__codelineno-7-95" href="#__codelineno-7-95"></a>            <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">[</span><span class="n">session_id</span><span class="p">]</span>
</span><span id="__span-7-96"><a id="__codelineno-7-96" name="__codelineno-7-96" href="#__codelineno-7-96"></a>            <span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="__span-7-97"><a id="__codelineno-7-97" name="__codelineno-7-97" href="#__codelineno-7-97"></a>
</span><span id="__span-7-98"><a id="__codelineno-7-98" name="__codelineno-7-98" href="#__codelineno-7-98"></a>            <span class="c1"># Check if session is active</span>
</span><span id="__span-7-99"><a id="__codelineno-7-99" name="__codelineno-7-99" href="#__codelineno-7-99"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">session</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
</span><span id="__span-7-100"><a id="__codelineno-7-100" name="__codelineno-7-100" href="#__codelineno-7-100"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-7-101"><a id="__codelineno-7-101" name="__codelineno-7-101" href="#__codelineno-7-101"></a>
</span><span id="__span-7-102"><a id="__codelineno-7-102" name="__codelineno-7-102" href="#__codelineno-7-102"></a>            <span class="c1"># Check expiration</span>
</span><span id="__span-7-103"><a id="__codelineno-7-103" name="__codelineno-7-103" href="#__codelineno-7-103"></a>            <span class="k">if</span> <span class="n">current_time</span> <span class="o">&gt;</span> <span class="n">session</span><span class="o">.</span><span class="n">expires_at</span><span class="p">:</span>
</span><span id="__span-7-104"><a id="__codelineno-7-104" name="__codelineno-7-104" href="#__codelineno-7-104"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_revoke_session_internal</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
</span><span id="__span-7-105"><a id="__codelineno-7-105" name="__codelineno-7-105" href="#__codelineno-7-105"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-7-106"><a id="__codelineno-7-106" name="__codelineno-7-106" href="#__codelineno-7-106"></a>
</span><span id="__span-7-107"><a id="__codelineno-7-107" name="__codelineno-7-107" href="#__codelineno-7-107"></a>            <span class="c1"># Security checks</span>
</span><span id="__span-7-108"><a id="__codelineno-7-108" name="__codelineno-7-108" href="#__codelineno-7-108"></a>            <span class="n">security_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_perform_security_checks</span><span class="p">(</span>
</span><span id="__span-7-109"><a id="__codelineno-7-109" name="__codelineno-7-109" href="#__codelineno-7-109"></a>                <span class="n">session</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">,</span> <span class="n">user_agent</span><span class="p">,</span> <span class="n">csrf_token</span>
</span><span id="__span-7-110"><a id="__codelineno-7-110" name="__codelineno-7-110" href="#__codelineno-7-110"></a>            <span class="p">)</span>
</span><span id="__span-7-111"><a id="__codelineno-7-111" name="__codelineno-7-111" href="#__codelineno-7-111"></a>
</span><span id="__span-7-112"><a id="__codelineno-7-112" name="__codelineno-7-112" href="#__codelineno-7-112"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">security_result</span><span class="p">[</span><span class="s2">&quot;valid&quot;</span><span class="p">]:</span>
</span><span id="__span-7-113"><a id="__codelineno-7-113" name="__codelineno-7-113" href="#__codelineno-7-113"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="__span-7-114"><a id="__codelineno-7-114" name="__codelineno-7-114" href="#__codelineno-7-114"></a>                    <span class="sa">f</span><span class="s2">&quot;Security check failed for session </span><span class="si">{</span><span class="n">session_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">security_result</span><span class="p">[</span><span class="s1">&#39;reason&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-7-115"><a id="__codelineno-7-115" name="__codelineno-7-115" href="#__codelineno-7-115"></a>                <span class="p">)</span>
</span><span id="__span-7-116"><a id="__codelineno-7-116" name="__codelineno-7-116" href="#__codelineno-7-116"></a>                <span class="k">if</span> <span class="n">security_result</span><span class="p">[</span><span class="s2">&quot;revoke&quot;</span><span class="p">]:</span>
</span><span id="__span-7-117"><a id="__codelineno-7-117" name="__codelineno-7-117" href="#__codelineno-7-117"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_revoke_session_internal</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
</span><span id="__span-7-118"><a id="__codelineno-7-118" name="__codelineno-7-118" href="#__codelineno-7-118"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-7-119"><a id="__codelineno-7-119" name="__codelineno-7-119" href="#__codelineno-7-119"></a>
</span><span id="__span-7-120"><a id="__codelineno-7-120" name="__codelineno-7-120" href="#__codelineno-7-120"></a>            <span class="c1"># Update session activity</span>
</span><span id="__span-7-121"><a id="__codelineno-7-121" name="__codelineno-7-121" href="#__codelineno-7-121"></a>            <span class="n">session</span><span class="o">.</span><span class="n">last_accessed</span> <span class="o">=</span> <span class="n">current_time</span>
</span><span id="__span-7-122"><a id="__codelineno-7-122" name="__codelineno-7-122" href="#__codelineno-7-122"></a>            <span class="n">session</span><span class="o">.</span><span class="n">expires_at</span> <span class="o">=</span> <span class="n">current_time</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_timeout</span>
</span><span id="__span-7-123"><a id="__codelineno-7-123" name="__codelineno-7-123" href="#__codelineno-7-123"></a>
</span><span id="__span-7-124"><a id="__codelineno-7-124" name="__codelineno-7-124" href="#__codelineno-7-124"></a>            <span class="k">return</span> <span class="n">session</span>
</span><span id="__span-7-125"><a id="__codelineno-7-125" name="__codelineno-7-125" href="#__codelineno-7-125"></a>
</span><span id="__span-7-126"><a id="__codelineno-7-126" name="__codelineno-7-126" href="#__codelineno-7-126"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_perform_security_checks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">SessionData</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span><span id="__span-7-127"><a id="__codelineno-7-127" name="__codelineno-7-127" href="#__codelineno-7-127"></a>                                <span class="n">user_agent</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">csrf_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="__span-7-128"><a id="__codelineno-7-128" name="__codelineno-7-128" href="#__codelineno-7-128"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform comprehensive security validation&quot;&quot;&quot;</span>
</span><span id="__span-7-129"><a id="__codelineno-7-129" name="__codelineno-7-129" href="#__codelineno-7-129"></a>
</span><span id="__span-7-130"><a id="__codelineno-7-130" name="__codelineno-7-130" href="#__codelineno-7-130"></a>        <span class="c1"># IP address validation (detect session hijacking)</span>
</span><span id="__span-7-131"><a id="__codelineno-7-131" name="__codelineno-7-131" href="#__codelineno-7-131"></a>        <span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">ip_address</span> <span class="o">!=</span> <span class="n">ip_address</span><span class="p">:</span>
</span><span id="__span-7-132"><a id="__codelineno-7-132" name="__codelineno-7-132" href="#__codelineno-7-132"></a>            <span class="c1"># Log potential session hijacking</span>
</span><span id="__span-7-133"><a id="__codelineno-7-133" name="__codelineno-7-133" href="#__codelineno-7-133"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="__span-7-134"><a id="__codelineno-7-134" name="__codelineno-7-134" href="#__codelineno-7-134"></a>                <span class="sa">f</span><span class="s2">&quot;IP address mismatch for session </span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">session_id</span><span class="si">}</span><span class="s2">: &quot;</span>
</span><span id="__span-7-135"><a id="__codelineno-7-135" name="__codelineno-7-135" href="#__codelineno-7-135"></a>                <span class="sa">f</span><span class="s2">&quot;expected </span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">ip_address</span><span class="si">}</span><span class="s2">, got </span><span class="si">{</span><span class="n">ip_address</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-7-136"><a id="__codelineno-7-136" name="__codelineno-7-136" href="#__codelineno-7-136"></a>            <span class="p">)</span>
</span><span id="__span-7-137"><a id="__codelineno-7-137" name="__codelineno-7-137" href="#__codelineno-7-137"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;revoke&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;IP address mismatch&quot;</span><span class="p">}</span>
</span><span id="__span-7-138"><a id="__codelineno-7-138" name="__codelineno-7-138" href="#__codelineno-7-138"></a>
</span><span id="__span-7-139"><a id="__codelineno-7-139" name="__codelineno-7-139" href="#__codelineno-7-139"></a>        <span class="c1"># User agent validation (basic fingerprinting)</span>
</span><span id="__span-7-140"><a id="__codelineno-7-140" name="__codelineno-7-140" href="#__codelineno-7-140"></a>        <span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">user_agent</span> <span class="o">!=</span> <span class="n">user_agent</span><span class="p">:</span>
</span><span id="__span-7-141"><a id="__codelineno-7-141" name="__codelineno-7-141" href="#__codelineno-7-141"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="__span-7-142"><a id="__codelineno-7-142" name="__codelineno-7-142" href="#__codelineno-7-142"></a>                <span class="sa">f</span><span class="s2">&quot;User agent mismatch for session </span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">session_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-7-143"><a id="__codelineno-7-143" name="__codelineno-7-143" href="#__codelineno-7-143"></a>            <span class="p">)</span>
</span><span id="__span-7-144"><a id="__codelineno-7-144" name="__codelineno-7-144" href="#__codelineno-7-144"></a>            <span class="c1"># Don&#39;t revoke for user agent changes, but log suspicious activity</span>
</span><span id="__span-7-145"><a id="__codelineno-7-145" name="__codelineno-7-145" href="#__codelineno-7-145"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_track_suspicious_activity</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="s2">&quot;user_agent_change&quot;</span><span class="p">)</span>
</span><span id="__span-7-146"><a id="__codelineno-7-146" name="__codelineno-7-146" href="#__codelineno-7-146"></a>
</span><span id="__span-7-147"><a id="__codelineno-7-147" name="__codelineno-7-147" href="#__codelineno-7-147"></a>        <span class="c1"># CSRF token validation (for state-changing operations)</span>
</span><span id="__span-7-148"><a id="__codelineno-7-148" name="__codelineno-7-148" href="#__codelineno-7-148"></a>        <span class="k">if</span> <span class="n">csrf_token</span> <span class="ow">and</span> <span class="n">csrf_token</span> <span class="o">!=</span> <span class="n">session</span><span class="o">.</span><span class="n">csrf_token</span><span class="p">:</span>
</span><span id="__span-7-149"><a id="__codelineno-7-149" name="__codelineno-7-149" href="#__codelineno-7-149"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;revoke&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid CSRF token&quot;</span><span class="p">}</span>
</span><span id="__span-7-150"><a id="__codelineno-7-150" name="__codelineno-7-150" href="#__codelineno-7-150"></a>
</span><span id="__span-7-151"><a id="__codelineno-7-151" name="__codelineno-7-151" href="#__codelineno-7-151"></a>        <span class="c1"># Check for session fixation attacks</span>
</span><span id="__span-7-152"><a id="__codelineno-7-152" name="__codelineno-7-152" href="#__codelineno-7-152"></a>        <span class="n">session_age</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">session</span><span class="o">.</span><span class="n">created_at</span>
</span><span id="__span-7-153"><a id="__codelineno-7-153" name="__codelineno-7-153" href="#__codelineno-7-153"></a>        <span class="k">if</span> <span class="n">session_age</span> <span class="o">&gt;</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">24</span><span class="p">):</span>  <span class="c1"># Force re-authentication after 24 hours</span>
</span><span id="__span-7-154"><a id="__codelineno-7-154" name="__codelineno-7-154" href="#__codelineno-7-154"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;revoke&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Session too old&quot;</span><span class="p">}</span>
</span><span id="__span-7-155"><a id="__codelineno-7-155" name="__codelineno-7-155" href="#__codelineno-7-155"></a>
</span><span id="__span-7-156"><a id="__codelineno-7-156" name="__codelineno-7-156" href="#__codelineno-7-156"></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;revoke&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Valid&quot;</span><span class="p">}</span>
</span><span id="__span-7-157"><a id="__codelineno-7-157" name="__codelineno-7-157" href="#__codelineno-7-157"></a>
</span><span id="__span-7-158"><a id="__codelineno-7-158" name="__codelineno-7-158" href="#__codelineno-7-158"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">refresh_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="__span-7-159"><a id="__codelineno-7-159" name="__codelineno-7-159" href="#__codelineno-7-159"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-7-160"><a id="__codelineno-7-160" name="__codelineno-7-160" href="#__codelineno-7-160"></a><span class="sd">        Refresh session with new ID (prevent session fixation)</span>
</span><span id="__span-7-161"><a id="__codelineno-7-161" name="__codelineno-7-161" href="#__codelineno-7-161"></a><span class="sd">        Returns new session ID if successful</span>
</span><span id="__span-7-162"><a id="__codelineno-7-162" name="__codelineno-7-162" href="#__codelineno-7-162"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-7-163"><a id="__codelineno-7-163" name="__codelineno-7-163" href="#__codelineno-7-163"></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
</span><span id="__span-7-164"><a id="__codelineno-7-164" name="__codelineno-7-164" href="#__codelineno-7-164"></a>            <span class="k">if</span> <span class="n">session_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">:</span>
</span><span id="__span-7-165"><a id="__codelineno-7-165" name="__codelineno-7-165" href="#__codelineno-7-165"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-7-166"><a id="__codelineno-7-166" name="__codelineno-7-166" href="#__codelineno-7-166"></a>
</span><span id="__span-7-167"><a id="__codelineno-7-167" name="__codelineno-7-167" href="#__codelineno-7-167"></a>            <span class="n">old_session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">[</span><span class="n">session_id</span><span class="p">]</span>
</span><span id="__span-7-168"><a id="__codelineno-7-168" name="__codelineno-7-168" href="#__codelineno-7-168"></a>
</span><span id="__span-7-169"><a id="__codelineno-7-169" name="__codelineno-7-169" href="#__codelineno-7-169"></a>            <span class="c1"># Generate new session ID</span>
</span><span id="__span-7-170"><a id="__codelineno-7-170" name="__codelineno-7-170" href="#__codelineno-7-170"></a>            <span class="n">new_session_id</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
</span><span id="__span-7-171"><a id="__codelineno-7-171" name="__codelineno-7-171" href="#__codelineno-7-171"></a>            <span class="n">new_csrf_token</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
</span><span id="__span-7-172"><a id="__codelineno-7-172" name="__codelineno-7-172" href="#__codelineno-7-172"></a>
</span><span id="__span-7-173"><a id="__codelineno-7-173" name="__codelineno-7-173" href="#__codelineno-7-173"></a>            <span class="c1"># Create new session with same data</span>
</span><span id="__span-7-174"><a id="__codelineno-7-174" name="__codelineno-7-174" href="#__codelineno-7-174"></a>            <span class="n">new_session</span> <span class="o">=</span> <span class="n">SessionData</span><span class="p">(</span>
</span><span id="__span-7-175"><a id="__codelineno-7-175" name="__codelineno-7-175" href="#__codelineno-7-175"></a>                <span class="n">session_id</span><span class="o">=</span><span class="n">new_session_id</span><span class="p">,</span>
</span><span id="__span-7-176"><a id="__codelineno-7-176" name="__codelineno-7-176" href="#__codelineno-7-176"></a>                <span class="n">user_id</span><span class="o">=</span><span class="n">old_session</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="__span-7-177"><a id="__codelineno-7-177" name="__codelineno-7-177" href="#__codelineno-7-177"></a>                <span class="n">created_at</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>  <span class="c1"># Reset creation time</span>
</span><span id="__span-7-178"><a id="__codelineno-7-178" name="__codelineno-7-178" href="#__codelineno-7-178"></a>                <span class="n">last_accessed</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
</span><span id="__span-7-179"><a id="__codelineno-7-179" name="__codelineno-7-179" href="#__codelineno-7-179"></a>                <span class="n">expires_at</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_timeout</span><span class="p">,</span>
</span><span id="__span-7-180"><a id="__codelineno-7-180" name="__codelineno-7-180" href="#__codelineno-7-180"></a>                <span class="n">ip_address</span><span class="o">=</span><span class="n">old_session</span><span class="o">.</span><span class="n">ip_address</span><span class="p">,</span>
</span><span id="__span-7-181"><a id="__codelineno-7-181" name="__codelineno-7-181" href="#__codelineno-7-181"></a>                <span class="n">user_agent</span><span class="o">=</span><span class="n">old_session</span><span class="o">.</span><span class="n">user_agent</span><span class="p">,</span>
</span><span id="__span-7-182"><a id="__codelineno-7-182" name="__codelineno-7-182" href="#__codelineno-7-182"></a>                <span class="n">permissions</span><span class="o">=</span><span class="n">old_session</span><span class="o">.</span><span class="n">permissions</span><span class="p">,</span>
</span><span id="__span-7-183"><a id="__codelineno-7-183" name="__codelineno-7-183" href="#__codelineno-7-183"></a>                <span class="n">csrf_token</span><span class="o">=</span><span class="n">new_csrf_token</span><span class="p">,</span>
</span><span id="__span-7-184"><a id="__codelineno-7-184" name="__codelineno-7-184" href="#__codelineno-7-184"></a>                <span class="n">login_count</span><span class="o">=</span><span class="n">old_session</span><span class="o">.</span><span class="n">login_count</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="__span-7-185"><a id="__codelineno-7-185" name="__codelineno-7-185" href="#__codelineno-7-185"></a>            <span class="p">)</span>
</span><span id="__span-7-186"><a id="__codelineno-7-186" name="__codelineno-7-186" href="#__codelineno-7-186"></a>
</span><span id="__span-7-187"><a id="__codelineno-7-187" name="__codelineno-7-187" href="#__codelineno-7-187"></a>            <span class="c1"># Replace old session</span>
</span><span id="__span-7-188"><a id="__codelineno-7-188" name="__codelineno-7-188" href="#__codelineno-7-188"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">[</span><span class="n">new_session_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_session</span>
</span><span id="__span-7-189"><a id="__codelineno-7-189" name="__codelineno-7-189" href="#__codelineno-7-189"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">[</span><span class="n">session_id</span><span class="p">]</span>
</span><span id="__span-7-190"><a id="__codelineno-7-190" name="__codelineno-7-190" href="#__codelineno-7-190"></a>
</span><span id="__span-7-191"><a id="__codelineno-7-191" name="__codelineno-7-191" href="#__codelineno-7-191"></a>            <span class="c1"># Update user session tracking</span>
</span><span id="__span-7-192"><a id="__codelineno-7-192" name="__codelineno-7-192" href="#__codelineno-7-192"></a>            <span class="n">user_sessions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_sessions</span><span class="p">[</span><span class="n">old_session</span><span class="o">.</span><span class="n">user_id</span><span class="p">]</span>
</span><span id="__span-7-193"><a id="__codelineno-7-193" name="__codelineno-7-193" href="#__codelineno-7-193"></a>            <span class="n">user_sessions</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
</span><span id="__span-7-194"><a id="__codelineno-7-194" name="__codelineno-7-194" href="#__codelineno-7-194"></a>            <span class="n">user_sessions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_session_id</span><span class="p">)</span>
</span><span id="__span-7-195"><a id="__codelineno-7-195" name="__codelineno-7-195" href="#__codelineno-7-195"></a>
</span><span id="__span-7-196"><a id="__codelineno-7-196" name="__codelineno-7-196" href="#__codelineno-7-196"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Session refreshed for user </span><span class="si">{</span><span class="n">old_session</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-7-197"><a id="__codelineno-7-197" name="__codelineno-7-197" href="#__codelineno-7-197"></a>
</span><span id="__span-7-198"><a id="__codelineno-7-198" name="__codelineno-7-198" href="#__codelineno-7-198"></a>            <span class="k">return</span> <span class="n">new_session_id</span>
</span><span id="__span-7-199"><a id="__codelineno-7-199" name="__codelineno-7-199" href="#__codelineno-7-199"></a>
</span><span id="__span-7-200"><a id="__codelineno-7-200" name="__codelineno-7-200" href="#__codelineno-7-200"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">revoke_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-7-201"><a id="__codelineno-7-201" name="__codelineno-7-201" href="#__codelineno-7-201"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Revoke a specific session&quot;&quot;&quot;</span>
</span><span id="__span-7-202"><a id="__codelineno-7-202" name="__codelineno-7-202" href="#__codelineno-7-202"></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
</span><span id="__span-7-203"><a id="__codelineno-7-203" name="__codelineno-7-203" href="#__codelineno-7-203"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_revoke_session_internal</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
</span><span id="__span-7-204"><a id="__codelineno-7-204" name="__codelineno-7-204" href="#__codelineno-7-204"></a>
</span><span id="__span-7-205"><a id="__codelineno-7-205" name="__codelineno-7-205" href="#__codelineno-7-205"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_revoke_session_internal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-7-206"><a id="__codelineno-7-206" name="__codelineno-7-206" href="#__codelineno-7-206"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal session revocation (assumes lock is held)&quot;&quot;&quot;</span>
</span><span id="__span-7-207"><a id="__codelineno-7-207" name="__codelineno-7-207" href="#__codelineno-7-207"></a>        <span class="k">if</span> <span class="n">session_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">:</span>
</span><span id="__span-7-208"><a id="__codelineno-7-208" name="__codelineno-7-208" href="#__codelineno-7-208"></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-7-209"><a id="__codelineno-7-209" name="__codelineno-7-209" href="#__codelineno-7-209"></a>
</span><span id="__span-7-210"><a id="__codelineno-7-210" name="__codelineno-7-210" href="#__codelineno-7-210"></a>        <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">[</span><span class="n">session_id</span><span class="p">]</span>
</span><span id="__span-7-211"><a id="__codelineno-7-211" name="__codelineno-7-211" href="#__codelineno-7-211"></a>        <span class="n">user_id</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">user_id</span>
</span><span id="__span-7-212"><a id="__codelineno-7-212" name="__codelineno-7-212" href="#__codelineno-7-212"></a>
</span><span id="__span-7-213"><a id="__codelineno-7-213" name="__codelineno-7-213" href="#__codelineno-7-213"></a>        <span class="c1"># Remove from main storage</span>
</span><span id="__span-7-214"><a id="__codelineno-7-214" name="__codelineno-7-214" href="#__codelineno-7-214"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">[</span><span class="n">session_id</span><span class="p">]</span>
</span><span id="__span-7-215"><a id="__codelineno-7-215" name="__codelineno-7-215" href="#__codelineno-7-215"></a>
</span><span id="__span-7-216"><a id="__codelineno-7-216" name="__codelineno-7-216" href="#__codelineno-7-216"></a>        <span class="c1"># Remove from user session tracking</span>
</span><span id="__span-7-217"><a id="__codelineno-7-217" name="__codelineno-7-217" href="#__codelineno-7-217"></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_sessions</span><span class="p">:</span>
</span><span id="__span-7-218"><a id="__codelineno-7-218" name="__codelineno-7-218" href="#__codelineno-7-218"></a>            <span class="k">if</span> <span class="n">session_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_sessions</span><span class="p">[</span><span class="n">user_id</span><span class="p">]:</span>
</span><span id="__span-7-219"><a id="__codelineno-7-219" name="__codelineno-7-219" href="#__codelineno-7-219"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">user_sessions</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
</span><span id="__span-7-220"><a id="__codelineno-7-220" name="__codelineno-7-220" href="#__codelineno-7-220"></a>
</span><span id="__span-7-221"><a id="__codelineno-7-221" name="__codelineno-7-221" href="#__codelineno-7-221"></a>            <span class="c1"># Clean up empty user session list</span>
</span><span id="__span-7-222"><a id="__codelineno-7-222" name="__codelineno-7-222" href="#__codelineno-7-222"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_sessions</span><span class="p">[</span><span class="n">user_id</span><span class="p">]:</span>
</span><span id="__span-7-223"><a id="__codelineno-7-223" name="__codelineno-7-223" href="#__codelineno-7-223"></a>                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_sessions</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
</span><span id="__span-7-224"><a id="__codelineno-7-224" name="__codelineno-7-224" href="#__codelineno-7-224"></a>
</span><span id="__span-7-225"><a id="__codelineno-7-225" name="__codelineno-7-225" href="#__codelineno-7-225"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Session </span><span class="si">{</span><span class="n">session_id</span><span class="si">}</span><span class="s2"> revoked for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-7-226"><a id="__codelineno-7-226" name="__codelineno-7-226" href="#__codelineno-7-226"></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-7-227"><a id="__codelineno-7-227" name="__codelineno-7-227" href="#__codelineno-7-227"></a>
</span><span id="__span-7-228"><a id="__codelineno-7-228" name="__codelineno-7-228" href="#__codelineno-7-228"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">revoke_all_user_sessions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-7-229"><a id="__codelineno-7-229" name="__codelineno-7-229" href="#__codelineno-7-229"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Revoke all sessions for a specific user&quot;&quot;&quot;</span>
</span><span id="__span-7-230"><a id="__codelineno-7-230" name="__codelineno-7-230" href="#__codelineno-7-230"></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
</span><span id="__span-7-231"><a id="__codelineno-7-231" name="__codelineno-7-231" href="#__codelineno-7-231"></a>            <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_sessions</span><span class="p">:</span>
</span><span id="__span-7-232"><a id="__codelineno-7-232" name="__codelineno-7-232" href="#__codelineno-7-232"></a>                <span class="k">return</span> <span class="mi">0</span>
</span><span id="__span-7-233"><a id="__codelineno-7-233" name="__codelineno-7-233" href="#__codelineno-7-233"></a>
</span><span id="__span-7-234"><a id="__codelineno-7-234" name="__codelineno-7-234" href="#__codelineno-7-234"></a>            <span class="n">session_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_sessions</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="__span-7-235"><a id="__codelineno-7-235" name="__codelineno-7-235" href="#__codelineno-7-235"></a>            <span class="n">revoked_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-7-236"><a id="__codelineno-7-236" name="__codelineno-7-236" href="#__codelineno-7-236"></a>
</span><span id="__span-7-237"><a id="__codelineno-7-237" name="__codelineno-7-237" href="#__codelineno-7-237"></a>            <span class="k">for</span> <span class="n">session_id</span> <span class="ow">in</span> <span class="n">session_ids</span><span class="p">:</span>
</span><span id="__span-7-238"><a id="__codelineno-7-238" name="__codelineno-7-238" href="#__codelineno-7-238"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_revoke_session_internal</span><span class="p">(</span><span class="n">session_id</span><span class="p">):</span>
</span><span id="__span-7-239"><a id="__codelineno-7-239" name="__codelineno-7-239" href="#__codelineno-7-239"></a>                    <span class="n">revoked_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-7-240"><a id="__codelineno-7-240" name="__codelineno-7-240" href="#__codelineno-7-240"></a>
</span><span id="__span-7-241"><a id="__codelineno-7-241" name="__codelineno-7-241" href="#__codelineno-7-241"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Revoked </span><span class="si">{</span><span class="n">revoked_count</span><span class="si">}</span><span class="s2"> sessions for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-7-242"><a id="__codelineno-7-242" name="__codelineno-7-242" href="#__codelineno-7-242"></a>            <span class="k">return</span> <span class="n">revoked_count</span>
</span><span id="__span-7-243"><a id="__codelineno-7-243" name="__codelineno-7-243" href="#__codelineno-7-243"></a>
</span><span id="__span-7-244"><a id="__codelineno-7-244" name="__codelineno-7-244" href="#__codelineno-7-244"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cleanup_expired_sessions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-7-245"><a id="__codelineno-7-245" name="__codelineno-7-245" href="#__codelineno-7-245"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove expired sessions (should be run periodically)&quot;&quot;&quot;</span>
</span><span id="__span-7-246"><a id="__codelineno-7-246" name="__codelineno-7-246" href="#__codelineno-7-246"></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
</span><span id="__span-7-247"><a id="__codelineno-7-247" name="__codelineno-7-247" href="#__codelineno-7-247"></a>            <span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="__span-7-248"><a id="__codelineno-7-248" name="__codelineno-7-248" href="#__codelineno-7-248"></a>            <span class="n">expired_sessions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-7-249"><a id="__codelineno-7-249" name="__codelineno-7-249" href="#__codelineno-7-249"></a>
</span><span id="__span-7-250"><a id="__codelineno-7-250" name="__codelineno-7-250" href="#__codelineno-7-250"></a>            <span class="k">for</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">session</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-7-251"><a id="__codelineno-7-251" name="__codelineno-7-251" href="#__codelineno-7-251"></a>                <span class="k">if</span> <span class="n">current_time</span> <span class="o">&gt;</span> <span class="n">session</span><span class="o">.</span><span class="n">expires_at</span><span class="p">:</span>
</span><span id="__span-7-252"><a id="__codelineno-7-252" name="__codelineno-7-252" href="#__codelineno-7-252"></a>                    <span class="n">expired_sessions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
</span><span id="__span-7-253"><a id="__codelineno-7-253" name="__codelineno-7-253" href="#__codelineno-7-253"></a>
</span><span id="__span-7-254"><a id="__codelineno-7-254" name="__codelineno-7-254" href="#__codelineno-7-254"></a>            <span class="k">for</span> <span class="n">session_id</span> <span class="ow">in</span> <span class="n">expired_sessions</span><span class="p">:</span>
</span><span id="__span-7-255"><a id="__codelineno-7-255" name="__codelineno-7-255" href="#__codelineno-7-255"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_revoke_session_internal</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
</span><span id="__span-7-256"><a id="__codelineno-7-256" name="__codelineno-7-256" href="#__codelineno-7-256"></a>
</span><span id="__span-7-257"><a id="__codelineno-7-257" name="__codelineno-7-257" href="#__codelineno-7-257"></a>            <span class="k">if</span> <span class="n">expired_sessions</span><span class="p">:</span>
</span><span id="__span-7-258"><a id="__codelineno-7-258" name="__codelineno-7-258" href="#__codelineno-7-258"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cleaned up </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">expired_sessions</span><span class="p">)</span><span class="si">}</span><span class="s2"> expired sessions&quot;</span><span class="p">)</span>
</span><span id="__span-7-259"><a id="__codelineno-7-259" name="__codelineno-7-259" href="#__codelineno-7-259"></a>
</span><span id="__span-7-260"><a id="__codelineno-7-260" name="__codelineno-7-260" href="#__codelineno-7-260"></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">expired_sessions</span><span class="p">)</span>
</span><span id="__span-7-261"><a id="__codelineno-7-261" name="__codelineno-7-261" href="#__codelineno-7-261"></a>
</span><span id="__span-7-262"><a id="__codelineno-7-262" name="__codelineno-7-262" href="#__codelineno-7-262"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_user_sessions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="__span-7-263"><a id="__codelineno-7-263" name="__codelineno-7-263" href="#__codelineno-7-263"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all active sessions for a user&quot;&quot;&quot;</span>
</span><span id="__span-7-264"><a id="__codelineno-7-264" name="__codelineno-7-264" href="#__codelineno-7-264"></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
</span><span id="__span-7-265"><a id="__codelineno-7-265" name="__codelineno-7-265" href="#__codelineno-7-265"></a>            <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_sessions</span><span class="p">:</span>
</span><span id="__span-7-266"><a id="__codelineno-7-266" name="__codelineno-7-266" href="#__codelineno-7-266"></a>                <span class="k">return</span> <span class="p">[]</span>
</span><span id="__span-7-267"><a id="__codelineno-7-267" name="__codelineno-7-267" href="#__codelineno-7-267"></a>
</span><span id="__span-7-268"><a id="__codelineno-7-268" name="__codelineno-7-268" href="#__codelineno-7-268"></a>            <span class="n">active_sessions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-7-269"><a id="__codelineno-7-269" name="__codelineno-7-269" href="#__codelineno-7-269"></a>            <span class="k">for</span> <span class="n">session_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_sessions</span><span class="p">[</span><span class="n">user_id</span><span class="p">]:</span>
</span><span id="__span-7-270"><a id="__codelineno-7-270" name="__codelineno-7-270" href="#__codelineno-7-270"></a>                <span class="k">if</span> <span class="n">session_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">:</span>
</span><span id="__span-7-271"><a id="__codelineno-7-271" name="__codelineno-7-271" href="#__codelineno-7-271"></a>                    <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">[</span><span class="n">session_id</span><span class="p">]</span>
</span><span id="__span-7-272"><a id="__codelineno-7-272" name="__codelineno-7-272" href="#__codelineno-7-272"></a>                    <span class="n">active_sessions</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-7-273"><a id="__codelineno-7-273" name="__codelineno-7-273" href="#__codelineno-7-273"></a>                        <span class="s1">&#39;session_id&#39;</span><span class="p">:</span> <span class="n">session_id</span><span class="p">,</span>
</span><span id="__span-7-274"><a id="__codelineno-7-274" name="__codelineno-7-274" href="#__codelineno-7-274"></a>                        <span class="s1">&#39;created_at&#39;</span><span class="p">:</span> <span class="n">session</span><span class="o">.</span><span class="n">created_at</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="__span-7-275"><a id="__codelineno-7-275" name="__codelineno-7-275" href="#__codelineno-7-275"></a>                        <span class="s1">&#39;last_accessed&#39;</span><span class="p">:</span> <span class="n">session</span><span class="o">.</span><span class="n">last_accessed</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="__span-7-276"><a id="__codelineno-7-276" name="__codelineno-7-276" href="#__codelineno-7-276"></a>                        <span class="s1">&#39;ip_address&#39;</span><span class="p">:</span> <span class="n">session</span><span class="o">.</span><span class="n">ip_address</span><span class="p">,</span>
</span><span id="__span-7-277"><a id="__codelineno-7-277" name="__codelineno-7-277" href="#__codelineno-7-277"></a>                        <span class="s1">&#39;user_agent&#39;</span><span class="p">:</span> <span class="n">session</span><span class="o">.</span><span class="n">user_agent</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;...&#39;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">user_agent</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span> <span class="k">else</span> <span class="n">session</span><span class="o">.</span><span class="n">user_agent</span>
</span><span id="__span-7-278"><a id="__codelineno-7-278" name="__codelineno-7-278" href="#__codelineno-7-278"></a>                    <span class="p">})</span>
</span><span id="__span-7-279"><a id="__codelineno-7-279" name="__codelineno-7-279" href="#__codelineno-7-279"></a>
</span><span id="__span-7-280"><a id="__codelineno-7-280" name="__codelineno-7-280" href="#__codelineno-7-280"></a>            <span class="k">return</span> <span class="n">active_sessions</span>
</span><span id="__span-7-281"><a id="__codelineno-7-281" name="__codelineno-7-281" href="#__codelineno-7-281"></a>
</span><span id="__span-7-282"><a id="__codelineno-7-282" name="__codelineno-7-282" href="#__codelineno-7-282"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_track_suspicious_activity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">activity_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-7-283"><a id="__codelineno-7-283" name="__codelineno-7-283" href="#__codelineno-7-283"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Track suspicious activity for security monitoring&quot;&quot;&quot;</span>
</span><span id="__span-7-284"><a id="__codelineno-7-284" name="__codelineno-7-284" href="#__codelineno-7-284"></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">suspicious_activity</span><span class="p">:</span>
</span><span id="__span-7-285"><a id="__codelineno-7-285" name="__codelineno-7-285" href="#__codelineno-7-285"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">suspicious_activity</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-7-286"><a id="__codelineno-7-286" name="__codelineno-7-286" href="#__codelineno-7-286"></a>
</span><span id="__span-7-287"><a id="__codelineno-7-287" name="__codelineno-7-287" href="#__codelineno-7-287"></a>        <span class="k">if</span> <span class="n">activity_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">suspicious_activity</span><span class="p">[</span><span class="n">user_id</span><span class="p">]:</span>
</span><span id="__span-7-288"><a id="__codelineno-7-288" name="__codelineno-7-288" href="#__codelineno-7-288"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">suspicious_activity</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="n">activity_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-7-289"><a id="__codelineno-7-289" name="__codelineno-7-289" href="#__codelineno-7-289"></a>
</span><span id="__span-7-290"><a id="__codelineno-7-290" name="__codelineno-7-290" href="#__codelineno-7-290"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">suspicious_activity</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="n">activity_type</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
</span><span id="__span-7-291"><a id="__codelineno-7-291" name="__codelineno-7-291" href="#__codelineno-7-291"></a>
</span><span id="__span-7-292"><a id="__codelineno-7-292" name="__codelineno-7-292" href="#__codelineno-7-292"></a>        <span class="c1"># Keep only recent activity (last 24 hours)</span>
</span><span id="__span-7-293"><a id="__codelineno-7-293" name="__codelineno-7-293" href="#__codelineno-7-293"></a>        <span class="n">cutoff</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
</span><span id="__span-7-294"><a id="__codelineno-7-294" name="__codelineno-7-294" href="#__codelineno-7-294"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">suspicious_activity</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="n">activity_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-7-295"><a id="__codelineno-7-295" name="__codelineno-7-295" href="#__codelineno-7-295"></a>            <span class="n">timestamp</span> <span class="k">for</span> <span class="n">timestamp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">suspicious_activity</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="n">activity_type</span><span class="p">]</span>
</span><span id="__span-7-296"><a id="__codelineno-7-296" name="__codelineno-7-296" href="#__codelineno-7-296"></a>            <span class="k">if</span> <span class="n">timestamp</span> <span class="o">&gt;</span> <span class="n">cutoff</span>
</span><span id="__span-7-297"><a id="__codelineno-7-297" name="__codelineno-7-297" href="#__codelineno-7-297"></a>        <span class="p">]</span>
</span><span id="__span-7-298"><a id="__codelineno-7-298" name="__codelineno-7-298" href="#__codelineno-7-298"></a>
</span><span id="__span-7-299"><a id="__codelineno-7-299" name="__codelineno-7-299" href="#__codelineno-7-299"></a><span class="k">class</span><span class="w"> </span><span class="nc">SessionSecurityMiddleware</span><span class="p">:</span>
</span><span id="__span-7-300"><a id="__codelineno-7-300" name="__codelineno-7-300" href="#__codelineno-7-300"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Middleware for secure session handling in web applications&quot;&quot;&quot;</span>
</span><span id="__span-7-301"><a id="__codelineno-7-301" name="__codelineno-7-301" href="#__codelineno-7-301"></a>
</span><span id="__span-7-302"><a id="__codelineno-7-302" name="__codelineno-7-302" href="#__codelineno-7-302"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_manager</span><span class="p">:</span> <span class="n">SecureSessionManager</span><span class="p">):</span>
</span><span id="__span-7-303"><a id="__codelineno-7-303" name="__codelineno-7-303" href="#__codelineno-7-303"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">session_manager</span> <span class="o">=</span> <span class="n">session_manager</span>
</span><span id="__span-7-304"><a id="__codelineno-7-304" name="__codelineno-7-304" href="#__codelineno-7-304"></a>
</span><span id="__span-7-305"><a id="__codelineno-7-305" name="__codelineno-7-305" href="#__codelineno-7-305"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_secure_cookie_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span><span id="__span-7-306"><a id="__codelineno-7-306" name="__codelineno-7-306" href="#__codelineno-7-306"></a>                                        <span class="n">is_https</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="__span-7-307"><a id="__codelineno-7-307" name="__codelineno-7-307" href="#__codelineno-7-307"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate secure cookie attributes for session&quot;&quot;&quot;</span>
</span><span id="__span-7-308"><a id="__codelineno-7-308" name="__codelineno-7-308" href="#__codelineno-7-308"></a>
</span><span id="__span-7-309"><a id="__codelineno-7-309" name="__codelineno-7-309" href="#__codelineno-7-309"></a>        <span class="n">cookie_attributes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-7-310"><a id="__codelineno-7-310" name="__codelineno-7-310" href="#__codelineno-7-310"></a>            <span class="s1">&#39;httponly&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># Prevent XSS access to cookies</span>
</span><span id="__span-7-311"><a id="__codelineno-7-311" name="__codelineno-7-311" href="#__codelineno-7-311"></a>            <span class="s1">&#39;secure&#39;</span><span class="p">:</span> <span class="n">is_https</span><span class="p">,</span>  <span class="c1"># Only send over HTTPS</span>
</span><span id="__span-7-312"><a id="__codelineno-7-312" name="__codelineno-7-312" href="#__codelineno-7-312"></a>            <span class="s1">&#39;samesite&#39;</span><span class="p">:</span> <span class="s1">&#39;Strict&#39;</span><span class="p">,</span>  <span class="c1"># CSRF protection</span>
</span><span id="__span-7-313"><a id="__codelineno-7-313" name="__codelineno-7-313" href="#__codelineno-7-313"></a>            <span class="s1">&#39;max_age&#39;</span><span class="p">:</span> <span class="mi">1800</span><span class="p">,</span>  <span class="c1"># 30 minutes</span>
</span><span id="__span-7-314"><a id="__codelineno-7-314" name="__codelineno-7-314" href="#__codelineno-7-314"></a>            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="s1">&#39;/&#39;</span>  <span class="c1"># Cookie available for entire domain</span>
</span><span id="__span-7-315"><a id="__codelineno-7-315" name="__codelineno-7-315" href="#__codelineno-7-315"></a>        <span class="p">}</span>
</span><span id="__span-7-316"><a id="__codelineno-7-316" name="__codelineno-7-316" href="#__codelineno-7-316"></a>
</span><span id="__span-7-317"><a id="__codelineno-7-317" name="__codelineno-7-317" href="#__codelineno-7-317"></a>        <span class="k">return</span> <span class="n">cookie_attributes</span>
</span><span id="__span-7-318"><a id="__codelineno-7-318" name="__codelineno-7-318" href="#__codelineno-7-318"></a>
</span><span id="__span-7-319"><a id="__codelineno-7-319" name="__codelineno-7-319" href="#__codelineno-7-319"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="__span-7-320"><a id="__codelineno-7-320" name="__codelineno-7-320" href="#__codelineno-7-320"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate request with session security checks&quot;&quot;&quot;</span>
</span><span id="__span-7-321"><a id="__codelineno-7-321" name="__codelineno-7-321" href="#__codelineno-7-321"></a>
</span><span id="__span-7-322"><a id="__codelineno-7-322" name="__codelineno-7-322" href="#__codelineno-7-322"></a>        <span class="n">session_id</span> <span class="o">=</span> <span class="n">request_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;session_id&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-7-323"><a id="__codelineno-7-323" name="__codelineno-7-323" href="#__codelineno-7-323"></a>        <span class="n">ip_address</span> <span class="o">=</span> <span class="n">request_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ip_address&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-7-324"><a id="__codelineno-7-324" name="__codelineno-7-324" href="#__codelineno-7-324"></a>        <span class="n">user_agent</span> <span class="o">=</span> <span class="n">request_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user_agent&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-7-325"><a id="__codelineno-7-325" name="__codelineno-7-325" href="#__codelineno-7-325"></a>        <span class="n">csrf_token</span> <span class="o">=</span> <span class="n">request_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;csrf_token&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-7-326"><a id="__codelineno-7-326" name="__codelineno-7-326" href="#__codelineno-7-326"></a>
</span><span id="__span-7-327"><a id="__codelineno-7-327" name="__codelineno-7-327" href="#__codelineno-7-327"></a>        <span class="c1"># Validate session</span>
</span><span id="__span-7-328"><a id="__codelineno-7-328" name="__codelineno-7-328" href="#__codelineno-7-328"></a>        <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_manager</span><span class="o">.</span><span class="n">validate_session</span><span class="p">(</span>
</span><span id="__span-7-329"><a id="__codelineno-7-329" name="__codelineno-7-329" href="#__codelineno-7-329"></a>            <span class="n">session_id</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">,</span> <span class="n">user_agent</span><span class="p">,</span> <span class="n">csrf_token</span>
</span><span id="__span-7-330"><a id="__codelineno-7-330" name="__codelineno-7-330" href="#__codelineno-7-330"></a>        <span class="p">)</span>
</span><span id="__span-7-331"><a id="__codelineno-7-331" name="__codelineno-7-331" href="#__codelineno-7-331"></a>
</span><span id="__span-7-332"><a id="__codelineno-7-332" name="__codelineno-7-332" href="#__codelineno-7-332"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">session</span><span class="p">:</span>
</span><span id="__span-7-333"><a id="__codelineno-7-333" name="__codelineno-7-333" href="#__codelineno-7-333"></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-7-334"><a id="__codelineno-7-334" name="__codelineno-7-334" href="#__codelineno-7-334"></a>                <span class="s1">&#39;valid&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-7-335"><a id="__codelineno-7-335" name="__codelineno-7-335" href="#__codelineno-7-335"></a>                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Invalid or expired session&#39;</span><span class="p">,</span>
</span><span id="__span-7-336"><a id="__codelineno-7-336" name="__codelineno-7-336" href="#__codelineno-7-336"></a>                <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="mi">401</span>
</span><span id="__span-7-337"><a id="__codelineno-7-337" name="__codelineno-7-337" href="#__codelineno-7-337"></a>            <span class="p">}</span>
</span><span id="__span-7-338"><a id="__codelineno-7-338" name="__codelineno-7-338" href="#__codelineno-7-338"></a>
</span><span id="__span-7-339"><a id="__codelineno-7-339" name="__codelineno-7-339" href="#__codelineno-7-339"></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-7-340"><a id="__codelineno-7-340" name="__codelineno-7-340" href="#__codelineno-7-340"></a>            <span class="s1">&#39;valid&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-7-341"><a id="__codelineno-7-341" name="__codelineno-7-341" href="#__codelineno-7-341"></a>            <span class="s1">&#39;session&#39;</span><span class="p">:</span> <span class="n">session</span><span class="p">,</span>
</span><span id="__span-7-342"><a id="__codelineno-7-342" name="__codelineno-7-342" href="#__codelineno-7-342"></a>            <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">session</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span><span id="__span-7-343"><a id="__codelineno-7-343" name="__codelineno-7-343" href="#__codelineno-7-343"></a>            <span class="s1">&#39;permissions&#39;</span><span class="p">:</span> <span class="n">session</span><span class="o">.</span><span class="n">permissions</span>
</span><span id="__span-7-344"><a id="__codelineno-7-344" name="__codelineno-7-344" href="#__codelineno-7-344"></a>        <span class="p">}</span>
</span><span id="__span-7-345"><a id="__codelineno-7-345" name="__codelineno-7-345" href="#__codelineno-7-345"></a>
</span><span id="__span-7-346"><a id="__codelineno-7-346" name="__codelineno-7-346" href="#__codelineno-7-346"></a><span class="k">def</span><span class="w"> </span><span class="nf">session_management_example</span><span class="p">():</span>
</span><span id="__span-7-347"><a id="__codelineno-7-347" name="__codelineno-7-347" href="#__codelineno-7-347"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate secure session management&quot;&quot;&quot;</span>
</span><span id="__span-7-348"><a id="__codelineno-7-348" name="__codelineno-7-348" href="#__codelineno-7-348"></a>
</span><span id="__span-7-349"><a id="__codelineno-7-349" name="__codelineno-7-349" href="#__codelineno-7-349"></a>    <span class="c1"># Initialize session manager</span>
</span><span id="__span-7-350"><a id="__codelineno-7-350" name="__codelineno-7-350" href="#__codelineno-7-350"></a>    <span class="n">session_manager</span> <span class="o">=</span> <span class="n">SecureSessionManager</span><span class="p">(</span>
</span><span id="__span-7-351"><a id="__codelineno-7-351" name="__codelineno-7-351" href="#__codelineno-7-351"></a>        <span class="n">session_timeout_minutes</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
</span><span id="__span-7-352"><a id="__codelineno-7-352" name="__codelineno-7-352" href="#__codelineno-7-352"></a>        <span class="n">max_sessions_per_user</span><span class="o">=</span><span class="mi">3</span>
</span><span id="__span-7-353"><a id="__codelineno-7-353" name="__codelineno-7-353" href="#__codelineno-7-353"></a>    <span class="p">)</span>
</span><span id="__span-7-354"><a id="__codelineno-7-354" name="__codelineno-7-354" href="#__codelineno-7-354"></a>
</span><span id="__span-7-355"><a id="__codelineno-7-355" name="__codelineno-7-355" href="#__codelineno-7-355"></a>    <span class="c1"># Create session for user login</span>
</span><span id="__span-7-356"><a id="__codelineno-7-356" name="__codelineno-7-356" href="#__codelineno-7-356"></a>    <span class="n">session_id</span><span class="p">,</span> <span class="n">csrf_token</span> <span class="o">=</span> <span class="n">session_manager</span><span class="o">.</span><span class="n">create_session</span><span class="p">(</span>
</span><span id="__span-7-357"><a id="__codelineno-7-357" name="__codelineno-7-357" href="#__codelineno-7-357"></a>        <span class="n">user_id</span><span class="o">=</span><span class="s2">&quot;user123&quot;</span><span class="p">,</span>
</span><span id="__span-7-358"><a id="__codelineno-7-358" name="__codelineno-7-358" href="#__codelineno-7-358"></a>        <span class="n">ip_address</span><span class="o">=</span><span class="s2">&quot;192.168.1.100&quot;</span><span class="p">,</span>
</span><span id="__span-7-359"><a id="__codelineno-7-359" name="__codelineno-7-359" href="#__codelineno-7-359"></a>        <span class="n">user_agent</span><span class="o">=</span><span class="s2">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&quot;</span><span class="p">,</span>
</span><span id="__span-7-360"><a id="__codelineno-7-360" name="__codelineno-7-360" href="#__codelineno-7-360"></a>        <span class="n">permissions</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="s2">&quot;write&quot;</span><span class="p">]</span>
</span><span id="__span-7-361"><a id="__codelineno-7-361" name="__codelineno-7-361" href="#__codelineno-7-361"></a>    <span class="p">)</span>
</span><span id="__span-7-362"><a id="__codelineno-7-362" name="__codelineno-7-362" href="#__codelineno-7-362"></a>
</span><span id="__span-7-363"><a id="__codelineno-7-363" name="__codelineno-7-363" href="#__codelineno-7-363"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Session created: </span><span class="si">{</span><span class="n">session_id</span><span class="p">[:</span><span class="mi">16</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="__span-7-364"><a id="__codelineno-7-364" name="__codelineno-7-364" href="#__codelineno-7-364"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CSRF token: </span><span class="si">{</span><span class="n">csrf_token</span><span class="p">[:</span><span class="mi">16</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="__span-7-365"><a id="__codelineno-7-365" name="__codelineno-7-365" href="#__codelineno-7-365"></a>
</span><span id="__span-7-366"><a id="__codelineno-7-366" name="__codelineno-7-366" href="#__codelineno-7-366"></a>    <span class="c1"># Validate session</span>
</span><span id="__span-7-367"><a id="__codelineno-7-367" name="__codelineno-7-367" href="#__codelineno-7-367"></a>    <span class="n">session</span> <span class="o">=</span> <span class="n">session_manager</span><span class="o">.</span><span class="n">validate_session</span><span class="p">(</span>
</span><span id="__span-7-368"><a id="__codelineno-7-368" name="__codelineno-7-368" href="#__codelineno-7-368"></a>        <span class="n">session_id</span><span class="o">=</span><span class="n">session_id</span><span class="p">,</span>
</span><span id="__span-7-369"><a id="__codelineno-7-369" name="__codelineno-7-369" href="#__codelineno-7-369"></a>        <span class="n">ip_address</span><span class="o">=</span><span class="s2">&quot;192.168.1.100&quot;</span><span class="p">,</span>
</span><span id="__span-7-370"><a id="__codelineno-7-370" name="__codelineno-7-370" href="#__codelineno-7-370"></a>        <span class="n">user_agent</span><span class="o">=</span><span class="s2">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&quot;</span><span class="p">,</span>
</span><span id="__span-7-371"><a id="__codelineno-7-371" name="__codelineno-7-371" href="#__codelineno-7-371"></a>        <span class="n">csrf_token</span><span class="o">=</span><span class="n">csrf_token</span>
</span><span id="__span-7-372"><a id="__codelineno-7-372" name="__codelineno-7-372" href="#__codelineno-7-372"></a>    <span class="p">)</span>
</span><span id="__span-7-373"><a id="__codelineno-7-373" name="__codelineno-7-373" href="#__codelineno-7-373"></a>
</span><span id="__span-7-374"><a id="__codelineno-7-374" name="__codelineno-7-374" href="#__codelineno-7-374"></a>    <span class="k">if</span> <span class="n">session</span><span class="p">:</span>
</span><span id="__span-7-375"><a id="__codelineno-7-375" name="__codelineno-7-375" href="#__codelineno-7-375"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Session valid for user: </span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-7-376"><a id="__codelineno-7-376" name="__codelineno-7-376" href="#__codelineno-7-376"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Permissions: </span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">permissions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-7-377"><a id="__codelineno-7-377" name="__codelineno-7-377" href="#__codelineno-7-377"></a>
</span><span id="__span-7-378"><a id="__codelineno-7-378" name="__codelineno-7-378" href="#__codelineno-7-378"></a>    <span class="c1"># Demonstrate session refresh (prevent fixation)</span>
</span><span id="__span-7-379"><a id="__codelineno-7-379" name="__codelineno-7-379" href="#__codelineno-7-379"></a>    <span class="n">new_session_id</span> <span class="o">=</span> <span class="n">session_manager</span><span class="o">.</span><span class="n">refresh_session</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
</span><span id="__span-7-380"><a id="__codelineno-7-380" name="__codelineno-7-380" href="#__codelineno-7-380"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Session refreshed: </span><span class="si">{</span><span class="n">new_session_id</span><span class="p">[:</span><span class="mi">16</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="__span-7-381"><a id="__codelineno-7-381" name="__codelineno-7-381" href="#__codelineno-7-381"></a>
</span><span id="__span-7-382"><a id="__codelineno-7-382" name="__codelineno-7-382" href="#__codelineno-7-382"></a>    <span class="c1"># Show user&#39;s active sessions</span>
</span><span id="__span-7-383"><a id="__codelineno-7-383" name="__codelineno-7-383" href="#__codelineno-7-383"></a>    <span class="n">active_sessions</span> <span class="o">=</span> <span class="n">session_manager</span><span class="o">.</span><span class="n">get_user_sessions</span><span class="p">(</span><span class="s2">&quot;user123&quot;</span><span class="p">)</span>
</span><span id="__span-7-384"><a id="__codelineno-7-384" name="__codelineno-7-384" href="#__codelineno-7-384"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Active sessions for user: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">active_sessions</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-7-385"><a id="__codelineno-7-385" name="__codelineno-7-385" href="#__codelineno-7-385"></a>
</span><span id="__span-7-386"><a id="__codelineno-7-386" name="__codelineno-7-386" href="#__codelineno-7-386"></a>    <span class="c1"># Clean up</span>
</span><span id="__span-7-387"><a id="__codelineno-7-387" name="__codelineno-7-387" href="#__codelineno-7-387"></a>    <span class="n">session_manager</span><span class="o">.</span><span class="n">revoke_all_user_sessions</span><span class="p">(</span><span class="s2">&quot;user123&quot;</span><span class="p">)</span>
</span><span id="__span-7-388"><a id="__codelineno-7-388" name="__codelineno-7-388" href="#__codelineno-7-388"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All user sessions revoked&quot;</span><span class="p">)</span>
</span><span id="__span-7-389"><a id="__codelineno-7-389" name="__codelineno-7-389" href="#__codelineno-7-389"></a>
</span><span id="__span-7-390"><a id="__codelineno-7-390" name="__codelineno-7-390" href="#__codelineno-7-390"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-7-391"><a id="__codelineno-7-391" name="__codelineno-7-391" href="#__codelineno-7-391"></a>    <span class="n">session_management_example</span><span class="p">()</span>
</span></code></pre></div>
<h2 id="cors-and-cross-origin-security">CORS and Cross-Origin Security<a class="headerlink" href="#cors-and-cross-origin-security" title="Permanent link">&para;</a></h2>
<p>Cross-Origin Resource Sharing (CORS) is a critical security mechanism that controls how web applications can access resources from different domains.</p>
<h3 id="understanding-cors-security-model">Understanding CORS Security Model<a class="headerlink" href="#understanding-cors-security-model" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>@startuml CORS_Security_Flow
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>!theme plain
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>skinparam backgroundColor white
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>skinparam defaultFontName &quot;Arial&quot;
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>participant &quot;Web Browser&quot; as Browser
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>participant &quot;Client App\n(example.com)&quot; as Client
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>participant &quot;API Server\n(api.service.com)&quot; as API
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>Browser -&gt; Client: Load application
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>Client -&gt; Browser: Make API request to\ndifferent origin
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>note over Browser: Same-Origin Policy Check
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>Browser -&gt; Browser: Origin: example.com\nTarget: api.service.com\n(Different origins!)
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>Browser -&gt; API: Preflight REQUEST\nOPTIONS /api/data\nOrigin: example.com
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>API -&gt; API: Check CORS policy\nfor example.com
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>alt CORS Allowed
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>    API -&gt; Browser: 200 OK\nAccess-Control-Allow-Origin: example.com\nAccess-Control-Allow-Methods: GET, POST
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>    Browser -&gt; API: Actual REQUEST\nGET /api/data
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>    API -&gt; Browser: 200 OK + Data
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>    Browser -&gt; Client: Success response
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>else CORS Denied
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>    API -&gt; Browser: 403 Forbidden\n(No CORS headers)
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>    Browser -&gt; Browser: Block response
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>    Browser -&gt; Client: CORS Error
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a>end
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a>@enduml
</span></code></pre></div>
<h3 id="comprehensive-cors-implementation">Comprehensive CORS Implementation<a class="headerlink" href="#comprehensive-cors-implementation" title="Permanent link">&para;</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlparse</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="nd">@dataclass</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">CORSPolicy</span><span class="p">:</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;CORS policy configuration&quot;&quot;&quot;</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>    <span class="n">allowed_origins</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>    <span class="n">allowed_methods</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>    <span class="n">allowed_headers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>    <span class="n">exposed_headers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>    <span class="n">allow_credentials</span><span class="p">:</span> <span class="nb">bool</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>    <span class="n">max_age</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># Preflight cache duration in seconds</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="k">class</span><span class="w"> </span><span class="nc">CORSManager</span><span class="p">:</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Production-ready CORS management with security features&quot;&quot;&quot;</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">policies</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">CORSPolicy</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_policy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">CORSPolicy</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>        <span class="c1"># Security patterns</span>
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dangerous_origins</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a>            <span class="sa">r</span><span class="s1">&#39;.*\.evil\.com$&#39;</span><span class="p">,</span>
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>            <span class="sa">r</span><span class="s1">&#39;.*malicious.*&#39;</span><span class="p">,</span>
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>            <span class="sa">r</span><span class="s1">&#39;file://&#39;</span><span class="p">,</span>  <span class="c1"># Block file:// origins</span>
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a>            <span class="sa">r</span><span class="s1">&#39;data:&#39;</span><span class="p">,</span>    <span class="c1"># Block data: origins</span>
</span><span id="__span-9-29"><a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>        <span class="p">]</span>
</span><span id="__span-9-30"><a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a>
</span><span id="__span-9-31"><a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">policy_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">policy</span><span class="p">:</span> <span class="n">CORSPolicy</span><span class="p">):</span>
</span><span id="__span-9-32"><a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a named CORS policy&quot;&quot;&quot;</span>
</span><span id="__span-9-33"><a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">policies</span><span class="p">[</span><span class="n">policy_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">policy</span>
</span><span id="__span-9-34"><a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a>
</span><span id="__span-9-35"><a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_default_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">policy</span><span class="p">:</span> <span class="n">CORSPolicy</span><span class="p">):</span>
</span><span id="__span-9-36"><a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set default CORS policy&quot;&quot;&quot;</span>
</span><span id="__span-9-37"><a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_policy</span> <span class="o">=</span> <span class="n">policy</span>
</span><span id="__span-9-38"><a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a>
</span><span id="__span-9-39"><a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_secure_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allowed_origins</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> 
</span><span id="__span-9-40"><a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a>                           <span class="n">allow_credentials</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CORSPolicy</span><span class="p">:</span>
</span><span id="__span-9-41"><a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a secure CORS policy with safe defaults&quot;&quot;&quot;</span>
</span><span id="__span-9-42"><a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a>
</span><span id="__span-9-43"><a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a>        <span class="c1"># Validate origins for security</span>
</span><span id="__span-9-44"><a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a>        <span class="n">validated_origins</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-9-45"><a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a>        <span class="k">for</span> <span class="n">origin</span> <span class="ow">in</span> <span class="n">allowed_origins</span><span class="p">:</span>
</span><span id="__span-9-46"><a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_safe_origin</span><span class="p">(</span><span class="n">origin</span><span class="p">):</span>
</span><span id="__span-9-47"><a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a>                <span class="n">validated_origins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span>
</span><span id="__span-9-48"><a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-9-49"><a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Potentially unsafe origin blocked: </span><span class="si">{</span><span class="n">origin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-9-50"><a id="__codelineno-9-50" name="__codelineno-9-50" href="#__codelineno-9-50"></a>
</span><span id="__span-9-51"><a id="__codelineno-9-51" name="__codelineno-9-51" href="#__codelineno-9-51"></a>        <span class="k">return</span> <span class="n">CORSPolicy</span><span class="p">(</span>
</span><span id="__span-9-52"><a id="__codelineno-9-52" name="__codelineno-9-52" href="#__codelineno-9-52"></a>            <span class="n">allowed_origins</span><span class="o">=</span><span class="n">validated_origins</span><span class="p">,</span>
</span><span id="__span-9-53"><a id="__codelineno-9-53" name="__codelineno-9-53" href="#__codelineno-9-53"></a>            <span class="n">allowed_methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">,</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">,</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">],</span>
</span><span id="__span-9-54"><a id="__codelineno-9-54" name="__codelineno-9-54" href="#__codelineno-9-54"></a>            <span class="n">allowed_headers</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-9-55"><a id="__codelineno-9-55" name="__codelineno-9-55" href="#__codelineno-9-55"></a>                <span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span>
</span><span id="__span-9-56"><a id="__codelineno-9-56" name="__codelineno-9-56" href="#__codelineno-9-56"></a>                <span class="s1">&#39;Authorization&#39;</span><span class="p">,</span> 
</span><span id="__span-9-57"><a id="__codelineno-9-57" name="__codelineno-9-57" href="#__codelineno-9-57"></a>                <span class="s1">&#39;X-Requested-With&#39;</span><span class="p">,</span>
</span><span id="__span-9-58"><a id="__codelineno-9-58" name="__codelineno-9-58" href="#__codelineno-9-58"></a>                <span class="s1">&#39;X-CSRF-Token&#39;</span>
</span><span id="__span-9-59"><a id="__codelineno-9-59" name="__codelineno-9-59" href="#__codelineno-9-59"></a>            <span class="p">],</span>
</span><span id="__span-9-60"><a id="__codelineno-9-60" name="__codelineno-9-60" href="#__codelineno-9-60"></a>            <span class="n">exposed_headers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X-Total-Count&#39;</span><span class="p">,</span> <span class="s1">&#39;X-Page-Count&#39;</span><span class="p">],</span>
</span><span id="__span-9-61"><a id="__codelineno-9-61" name="__codelineno-9-61" href="#__codelineno-9-61"></a>            <span class="n">allow_credentials</span><span class="o">=</span><span class="n">allow_credentials</span><span class="p">,</span>
</span><span id="__span-9-62"><a id="__codelineno-9-62" name="__codelineno-9-62" href="#__codelineno-9-62"></a>            <span class="n">max_age</span><span class="o">=</span><span class="mi">86400</span>  <span class="c1"># 24 hours</span>
</span><span id="__span-9-63"><a id="__codelineno-9-63" name="__codelineno-9-63" href="#__codelineno-9-63"></a>        <span class="p">)</span>
</span><span id="__span-9-64"><a id="__codelineno-9-64" name="__codelineno-9-64" href="#__codelineno-9-64"></a>
</span><span id="__span-9-65"><a id="__codelineno-9-65" name="__codelineno-9-65" href="#__codelineno-9-65"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_is_safe_origin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-9-66"><a id="__codelineno-9-66" name="__codelineno-9-66" href="#__codelineno-9-66"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate origin against security patterns&quot;&quot;&quot;</span>
</span><span id="__span-9-67"><a id="__codelineno-9-67" name="__codelineno-9-67" href="#__codelineno-9-67"></a>
</span><span id="__span-9-68"><a id="__codelineno-9-68" name="__codelineno-9-68" href="#__codelineno-9-68"></a>        <span class="c1"># Check against dangerous patterns</span>
</span><span id="__span-9-69"><a id="__codelineno-9-69" name="__codelineno-9-69" href="#__codelineno-9-69"></a>        <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dangerous_origins</span><span class="p">:</span>
</span><span id="__span-9-70"><a id="__codelineno-9-70" name="__codelineno-9-70" href="#__codelineno-9-70"></a>            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
</span><span id="__span-9-71"><a id="__codelineno-9-71" name="__codelineno-9-71" href="#__codelineno-9-71"></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-9-72"><a id="__codelineno-9-72" name="__codelineno-9-72" href="#__codelineno-9-72"></a>
</span><span id="__span-9-73"><a id="__codelineno-9-73" name="__codelineno-9-73" href="#__codelineno-9-73"></a>        <span class="c1"># Validate URL format</span>
</span><span id="__span-9-74"><a id="__codelineno-9-74" name="__codelineno-9-74" href="#__codelineno-9-74"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-9-75"><a id="__codelineno-9-75" name="__codelineno-9-75" href="#__codelineno-9-75"></a>            <span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span>
</span><span id="__span-9-76"><a id="__codelineno-9-76" name="__codelineno-9-76" href="#__codelineno-9-76"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">parsed</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">parsed</span><span class="o">.</span><span class="n">netloc</span><span class="p">:</span>
</span><span id="__span-9-77"><a id="__codelineno-9-77" name="__codelineno-9-77" href="#__codelineno-9-77"></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-9-78"><a id="__codelineno-9-78" name="__codelineno-9-78" href="#__codelineno-9-78"></a>
</span><span id="__span-9-79"><a id="__codelineno-9-79" name="__codelineno-9-79" href="#__codelineno-9-79"></a>            <span class="c1"># Only allow HTTP/HTTPS</span>
</span><span id="__span-9-80"><a id="__codelineno-9-80" name="__codelineno-9-80" href="#__codelineno-9-80"></a>            <span class="k">if</span> <span class="n">parsed</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="s1">&#39;https&#39;</span><span class="p">]:</span>
</span><span id="__span-9-81"><a id="__codelineno-9-81" name="__codelineno-9-81" href="#__codelineno-9-81"></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-9-82"><a id="__codelineno-9-82" name="__codelineno-9-82" href="#__codelineno-9-82"></a>
</span><span id="__span-9-83"><a id="__codelineno-9-83" name="__codelineno-9-83" href="#__codelineno-9-83"></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="__span-9-84"><a id="__codelineno-9-84" name="__codelineno-9-84" href="#__codelineno-9-84"></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-9-85"><a id="__codelineno-9-85" name="__codelineno-9-85" href="#__codelineno-9-85"></a>
</span><span id="__span-9-86"><a id="__codelineno-9-86" name="__codelineno-9-86" href="#__codelineno-9-86"></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-9-87"><a id="__codelineno-9-87" name="__codelineno-9-87" href="#__codelineno-9-87"></a>
</span><span id="__span-9-88"><a id="__codelineno-9-88" name="__codelineno-9-88" href="#__codelineno-9-88"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">handle_preflight_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span><span id="__span-9-89"><a id="__codelineno-9-89" name="__codelineno-9-89" href="#__codelineno-9-89"></a>                                <span class="n">headers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">policy_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="__span-9-90"><a id="__codelineno-9-90" name="__codelineno-9-90" href="#__codelineno-9-90"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle CORS preflight request&quot;&quot;&quot;</span>
</span><span id="__span-9-91"><a id="__codelineno-9-91" name="__codelineno-9-91" href="#__codelineno-9-91"></a>
</span><span id="__span-9-92"><a id="__codelineno-9-92" name="__codelineno-9-92" href="#__codelineno-9-92"></a>        <span class="c1"># Get applicable policy</span>
</span><span id="__span-9-93"><a id="__codelineno-9-93" name="__codelineno-9-93" href="#__codelineno-9-93"></a>        <span class="n">policy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_policy</span><span class="p">(</span><span class="n">policy_name</span><span class="p">)</span>
</span><span id="__span-9-94"><a id="__codelineno-9-94" name="__codelineno-9-94" href="#__codelineno-9-94"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">policy</span><span class="p">:</span>
</span><span id="__span-9-95"><a id="__codelineno-9-95" name="__codelineno-9-95" href="#__codelineno-9-95"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_cors_denial</span><span class="p">()</span>
</span><span id="__span-9-96"><a id="__codelineno-9-96" name="__codelineno-9-96" href="#__codelineno-9-96"></a>
</span><span id="__span-9-97"><a id="__codelineno-9-97" name="__codelineno-9-97" href="#__codelineno-9-97"></a>        <span class="c1"># Validate origin</span>
</span><span id="__span-9-98"><a id="__codelineno-9-98" name="__codelineno-9-98" href="#__codelineno-9-98"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_origin_allowed</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">policy</span><span class="p">):</span>
</span><span id="__span-9-99"><a id="__codelineno-9-99" name="__codelineno-9-99" href="#__codelineno-9-99"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_cors_denial</span><span class="p">()</span>
</span><span id="__span-9-100"><a id="__codelineno-9-100" name="__codelineno-9-100" href="#__codelineno-9-100"></a>
</span><span id="__span-9-101"><a id="__codelineno-9-101" name="__codelineno-9-101" href="#__codelineno-9-101"></a>        <span class="c1"># Validate method</span>
</span><span id="__span-9-102"><a id="__codelineno-9-102" name="__codelineno-9-102" href="#__codelineno-9-102"></a>        <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">policy</span><span class="o">.</span><span class="n">allowed_methods</span><span class="p">:</span>
</span><span id="__span-9-103"><a id="__codelineno-9-103" name="__codelineno-9-103" href="#__codelineno-9-103"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_cors_denial</span><span class="p">()</span>
</span><span id="__span-9-104"><a id="__codelineno-9-104" name="__codelineno-9-104" href="#__codelineno-9-104"></a>
</span><span id="__span-9-105"><a id="__codelineno-9-105" name="__codelineno-9-105" href="#__codelineno-9-105"></a>        <span class="c1"># Validate headers</span>
</span><span id="__span-9-106"><a id="__codelineno-9-106" name="__codelineno-9-106" href="#__codelineno-9-106"></a>        <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
</span><span id="__span-9-107"><a id="__codelineno-9-107" name="__codelineno-9-107" href="#__codelineno-9-107"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_header_allowed</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">policy</span><span class="p">):</span>
</span><span id="__span-9-108"><a id="__codelineno-9-108" name="__codelineno-9-108" href="#__codelineno-9-108"></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_cors_denial</span><span class="p">()</span>
</span><span id="__span-9-109"><a id="__codelineno-9-109" name="__codelineno-9-109" href="#__codelineno-9-109"></a>
</span><span id="__span-9-110"><a id="__codelineno-9-110" name="__codelineno-9-110" href="#__codelineno-9-110"></a>        <span class="c1"># Create successful preflight response</span>
</span><span id="__span-9-111"><a id="__codelineno-9-111" name="__codelineno-9-111" href="#__codelineno-9-111"></a>        <span class="n">response_headers</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-9-112"><a id="__codelineno-9-112" name="__codelineno-9-112" href="#__codelineno-9-112"></a>            <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_origin_response</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">policy</span><span class="p">),</span>
</span><span id="__span-9-113"><a id="__codelineno-9-113" name="__codelineno-9-113" href="#__codelineno-9-113"></a>            <span class="s1">&#39;Access-Control-Allow-Methods&#39;</span><span class="p">:</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">policy</span><span class="o">.</span><span class="n">allowed_methods</span><span class="p">),</span>
</span><span id="__span-9-114"><a id="__codelineno-9-114" name="__codelineno-9-114" href="#__codelineno-9-114"></a>            <span class="s1">&#39;Access-Control-Allow-Headers&#39;</span><span class="p">:</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">policy</span><span class="o">.</span><span class="n">allowed_headers</span><span class="p">),</span>
</span><span id="__span-9-115"><a id="__codelineno-9-115" name="__codelineno-9-115" href="#__codelineno-9-115"></a>            <span class="s1">&#39;Access-Control-Max-Age&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">policy</span><span class="o">.</span><span class="n">max_age</span><span class="p">),</span>
</span><span id="__span-9-116"><a id="__codelineno-9-116" name="__codelineno-9-116" href="#__codelineno-9-116"></a>            <span class="s1">&#39;Vary&#39;</span><span class="p">:</span> <span class="s1">&#39;Origin&#39;</span>  <span class="c1"># Important for caching</span>
</span><span id="__span-9-117"><a id="__codelineno-9-117" name="__codelineno-9-117" href="#__codelineno-9-117"></a>        <span class="p">}</span>
</span><span id="__span-9-118"><a id="__codelineno-9-118" name="__codelineno-9-118" href="#__codelineno-9-118"></a>
</span><span id="__span-9-119"><a id="__codelineno-9-119" name="__codelineno-9-119" href="#__codelineno-9-119"></a>        <span class="k">if</span> <span class="n">policy</span><span class="o">.</span><span class="n">allow_credentials</span><span class="p">:</span>
</span><span id="__span-9-120"><a id="__codelineno-9-120" name="__codelineno-9-120" href="#__codelineno-9-120"></a>            <span class="n">response_headers</span><span class="p">[</span><span class="s1">&#39;Access-Control-Allow-Credentials&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span>
</span><span id="__span-9-121"><a id="__codelineno-9-121" name="__codelineno-9-121" href="#__codelineno-9-121"></a>
</span><span id="__span-9-122"><a id="__codelineno-9-122" name="__codelineno-9-122" href="#__codelineno-9-122"></a>        <span class="k">return</span> <span class="n">response_headers</span>
</span><span id="__span-9-123"><a id="__codelineno-9-123" name="__codelineno-9-123" href="#__codelineno-9-123"></a>
</span><span id="__span-9-124"><a id="__codelineno-9-124" name="__codelineno-9-124" href="#__codelineno-9-124"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">handle_actual_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">policy_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="__span-9-125"><a id="__codelineno-9-125" name="__codelineno-9-125" href="#__codelineno-9-125"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle actual CORS request&quot;&quot;&quot;</span>
</span><span id="__span-9-126"><a id="__codelineno-9-126" name="__codelineno-9-126" href="#__codelineno-9-126"></a>
</span><span id="__span-9-127"><a id="__codelineno-9-127" name="__codelineno-9-127" href="#__codelineno-9-127"></a>        <span class="c1"># Get applicable policy</span>
</span><span id="__span-9-128"><a id="__codelineno-9-128" name="__codelineno-9-128" href="#__codelineno-9-128"></a>        <span class="n">policy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_policy</span><span class="p">(</span><span class="n">policy_name</span><span class="p">)</span>
</span><span id="__span-9-129"><a id="__codelineno-9-129" name="__codelineno-9-129" href="#__codelineno-9-129"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">policy</span><span class="p">:</span>
</span><span id="__span-9-130"><a id="__codelineno-9-130" name="__codelineno-9-130" href="#__codelineno-9-130"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_cors_denial</span><span class="p">()</span>
</span><span id="__span-9-131"><a id="__codelineno-9-131" name="__codelineno-9-131" href="#__codelineno-9-131"></a>
</span><span id="__span-9-132"><a id="__codelineno-9-132" name="__codelineno-9-132" href="#__codelineno-9-132"></a>        <span class="c1"># Validate origin</span>
</span><span id="__span-9-133"><a id="__codelineno-9-133" name="__codelineno-9-133" href="#__codelineno-9-133"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_origin_allowed</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">policy</span><span class="p">):</span>
</span><span id="__span-9-134"><a id="__codelineno-9-134" name="__codelineno-9-134" href="#__codelineno-9-134"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_cors_denial</span><span class="p">()</span>
</span><span id="__span-9-135"><a id="__codelineno-9-135" name="__codelineno-9-135" href="#__codelineno-9-135"></a>
</span><span id="__span-9-136"><a id="__codelineno-9-136" name="__codelineno-9-136" href="#__codelineno-9-136"></a>        <span class="c1"># Create response headers</span>
</span><span id="__span-9-137"><a id="__codelineno-9-137" name="__codelineno-9-137" href="#__codelineno-9-137"></a>        <span class="n">response_headers</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-9-138"><a id="__codelineno-9-138" name="__codelineno-9-138" href="#__codelineno-9-138"></a>            <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_origin_response</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">policy</span><span class="p">),</span>
</span><span id="__span-9-139"><a id="__codelineno-9-139" name="__codelineno-9-139" href="#__codelineno-9-139"></a>            <span class="s1">&#39;Vary&#39;</span><span class="p">:</span> <span class="s1">&#39;Origin&#39;</span>
</span><span id="__span-9-140"><a id="__codelineno-9-140" name="__codelineno-9-140" href="#__codelineno-9-140"></a>        <span class="p">}</span>
</span><span id="__span-9-141"><a id="__codelineno-9-141" name="__codelineno-9-141" href="#__codelineno-9-141"></a>
</span><span id="__span-9-142"><a id="__codelineno-9-142" name="__codelineno-9-142" href="#__codelineno-9-142"></a>        <span class="k">if</span> <span class="n">policy</span><span class="o">.</span><span class="n">exposed_headers</span><span class="p">:</span>
</span><span id="__span-9-143"><a id="__codelineno-9-143" name="__codelineno-9-143" href="#__codelineno-9-143"></a>            <span class="n">response_headers</span><span class="p">[</span><span class="s1">&#39;Access-Control-Expose-Headers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">policy</span><span class="o">.</span><span class="n">exposed_headers</span><span class="p">)</span>
</span><span id="__span-9-144"><a id="__codelineno-9-144" name="__codelineno-9-144" href="#__codelineno-9-144"></a>
</span><span id="__span-9-145"><a id="__codelineno-9-145" name="__codelineno-9-145" href="#__codelineno-9-145"></a>        <span class="k">if</span> <span class="n">policy</span><span class="o">.</span><span class="n">allow_credentials</span><span class="p">:</span>
</span><span id="__span-9-146"><a id="__codelineno-9-146" name="__codelineno-9-146" href="#__codelineno-9-146"></a>            <span class="n">response_headers</span><span class="p">[</span><span class="s1">&#39;Access-Control-Allow-Credentials&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span>
</span><span id="__span-9-147"><a id="__codelineno-9-147" name="__codelineno-9-147" href="#__codelineno-9-147"></a>
</span><span id="__span-9-148"><a id="__codelineno-9-148" name="__codelineno-9-148" href="#__codelineno-9-148"></a>        <span class="k">return</span> <span class="n">response_headers</span>
</span><span id="__span-9-149"><a id="__codelineno-9-149" name="__codelineno-9-149" href="#__codelineno-9-149"></a>
</span><span id="__span-9-150"><a id="__codelineno-9-150" name="__codelineno-9-150" href="#__codelineno-9-150"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">policy_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">CORSPolicy</span><span class="p">]:</span>
</span><span id="__span-9-151"><a id="__codelineno-9-151" name="__codelineno-9-151" href="#__codelineno-9-151"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get policy by name or default&quot;&quot;&quot;</span>
</span><span id="__span-9-152"><a id="__codelineno-9-152" name="__codelineno-9-152" href="#__codelineno-9-152"></a>        <span class="k">if</span> <span class="n">policy_name</span> <span class="ow">and</span> <span class="n">policy_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">policies</span><span class="p">:</span>
</span><span id="__span-9-153"><a id="__codelineno-9-153" name="__codelineno-9-153" href="#__codelineno-9-153"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">policies</span><span class="p">[</span><span class="n">policy_name</span><span class="p">]</span>
</span><span id="__span-9-154"><a id="__codelineno-9-154" name="__codelineno-9-154" href="#__codelineno-9-154"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_policy</span>
</span><span id="__span-9-155"><a id="__codelineno-9-155" name="__codelineno-9-155" href="#__codelineno-9-155"></a>
</span><span id="__span-9-156"><a id="__codelineno-9-156" name="__codelineno-9-156" href="#__codelineno-9-156"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_is_origin_allowed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">policy</span><span class="p">:</span> <span class="n">CORSPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-9-157"><a id="__codelineno-9-157" name="__codelineno-9-157" href="#__codelineno-9-157"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if origin is allowed by policy&quot;&quot;&quot;</span>
</span><span id="__span-9-158"><a id="__codelineno-9-158" name="__codelineno-9-158" href="#__codelineno-9-158"></a>
</span><span id="__span-9-159"><a id="__codelineno-9-159" name="__codelineno-9-159" href="#__codelineno-9-159"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">origin</span><span class="p">:</span>
</span><span id="__span-9-160"><a id="__codelineno-9-160" name="__codelineno-9-160" href="#__codelineno-9-160"></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-9-161"><a id="__codelineno-9-161" name="__codelineno-9-161" href="#__codelineno-9-161"></a>
</span><span id="__span-9-162"><a id="__codelineno-9-162" name="__codelineno-9-162" href="#__codelineno-9-162"></a>        <span class="c1"># Check exact matches and wildcards</span>
</span><span id="__span-9-163"><a id="__codelineno-9-163" name="__codelineno-9-163" href="#__codelineno-9-163"></a>        <span class="k">for</span> <span class="n">allowed_origin</span> <span class="ow">in</span> <span class="n">policy</span><span class="o">.</span><span class="n">allowed_origins</span><span class="p">:</span>
</span><span id="__span-9-164"><a id="__codelineno-9-164" name="__codelineno-9-164" href="#__codelineno-9-164"></a>            <span class="k">if</span> <span class="n">allowed_origin</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
</span><span id="__span-9-165"><a id="__codelineno-9-165" name="__codelineno-9-165" href="#__codelineno-9-165"></a>                <span class="c1"># Wildcard only allowed if credentials are disabled</span>
</span><span id="__span-9-166"><a id="__codelineno-9-166" name="__codelineno-9-166" href="#__codelineno-9-166"></a>                <span class="k">return</span> <span class="ow">not</span> <span class="n">policy</span><span class="o">.</span><span class="n">allow_credentials</span>
</span><span id="__span-9-167"><a id="__codelineno-9-167" name="__codelineno-9-167" href="#__codelineno-9-167"></a>            <span class="k">elif</span> <span class="n">allowed_origin</span> <span class="o">==</span> <span class="n">origin</span><span class="p">:</span>
</span><span id="__span-9-168"><a id="__codelineno-9-168" name="__codelineno-9-168" href="#__codelineno-9-168"></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-9-169"><a id="__codelineno-9-169" name="__codelineno-9-169" href="#__codelineno-9-169"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match_origin_pattern</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">allowed_origin</span><span class="p">):</span>
</span><span id="__span-9-170"><a id="__codelineno-9-170" name="__codelineno-9-170" href="#__codelineno-9-170"></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-9-171"><a id="__codelineno-9-171" name="__codelineno-9-171" href="#__codelineno-9-171"></a>
</span><span id="__span-9-172"><a id="__codelineno-9-172" name="__codelineno-9-172" href="#__codelineno-9-172"></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-9-173"><a id="__codelineno-9-173" name="__codelineno-9-173" href="#__codelineno-9-173"></a>
</span><span id="__span-9-174"><a id="__codelineno-9-174" name="__codelineno-9-174" href="#__codelineno-9-174"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_match_origin_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-9-175"><a id="__codelineno-9-175" name="__codelineno-9-175" href="#__codelineno-9-175"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Match origin against pattern (supports simple wildcards)&quot;&quot;&quot;</span>
</span><span id="__span-9-176"><a id="__codelineno-9-176" name="__codelineno-9-176" href="#__codelineno-9-176"></a>
</span><span id="__span-9-177"><a id="__codelineno-9-177" name="__codelineno-9-177" href="#__codelineno-9-177"></a>        <span class="c1"># Convert simple wildcard pattern to regex</span>
</span><span id="__span-9-178"><a id="__codelineno-9-178" name="__codelineno-9-178" href="#__codelineno-9-178"></a>        <span class="k">if</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">:</span>
</span><span id="__span-9-179"><a id="__codelineno-9-179" name="__codelineno-9-179" href="#__codelineno-9-179"></a>            <span class="n">regex_pattern</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;[^.]*&#39;</span><span class="p">)</span>
</span><span id="__span-9-180"><a id="__codelineno-9-180" name="__codelineno-9-180" href="#__codelineno-9-180"></a>            <span class="n">regex_pattern</span> <span class="o">=</span> <span class="n">regex_pattern</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\.&#39;</span><span class="p">)</span>
</span><span id="__span-9-181"><a id="__codelineno-9-181" name="__codelineno-9-181" href="#__codelineno-9-181"></a>            <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;^</span><span class="si">{</span><span class="n">regex_pattern</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="p">))</span>
</span><span id="__span-9-182"><a id="__codelineno-9-182" name="__codelineno-9-182" href="#__codelineno-9-182"></a>
</span><span id="__span-9-183"><a id="__codelineno-9-183" name="__codelineno-9-183" href="#__codelineno-9-183"></a>        <span class="k">return</span> <span class="n">origin</span> <span class="o">==</span> <span class="n">pattern</span>
</span><span id="__span-9-184"><a id="__codelineno-9-184" name="__codelineno-9-184" href="#__codelineno-9-184"></a>
</span><span id="__span-9-185"><a id="__codelineno-9-185" name="__codelineno-9-185" href="#__codelineno-9-185"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_is_header_allowed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">policy</span><span class="p">:</span> <span class="n">CORSPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-9-186"><a id="__codelineno-9-186" name="__codelineno-9-186" href="#__codelineno-9-186"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if header is allowed&quot;&quot;&quot;</span>
</span><span id="__span-9-187"><a id="__codelineno-9-187" name="__codelineno-9-187" href="#__codelineno-9-187"></a>
</span><span id="__span-9-188"><a id="__codelineno-9-188" name="__codelineno-9-188" href="#__codelineno-9-188"></a>        <span class="c1"># Case-insensitive header comparison</span>
</span><span id="__span-9-189"><a id="__codelineno-9-189" name="__codelineno-9-189" href="#__codelineno-9-189"></a>        <span class="n">header_lower</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="__span-9-190"><a id="__codelineno-9-190" name="__codelineno-9-190" href="#__codelineno-9-190"></a>        <span class="n">allowed_headers_lower</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">policy</span><span class="o">.</span><span class="n">allowed_headers</span><span class="p">]</span>
</span><span id="__span-9-191"><a id="__codelineno-9-191" name="__codelineno-9-191" href="#__codelineno-9-191"></a>
</span><span id="__span-9-192"><a id="__codelineno-9-192" name="__codelineno-9-192" href="#__codelineno-9-192"></a>        <span class="k">return</span> <span class="n">header_lower</span> <span class="ow">in</span> <span class="n">allowed_headers_lower</span>
</span><span id="__span-9-193"><a id="__codelineno-9-193" name="__codelineno-9-193" href="#__codelineno-9-193"></a>
</span><span id="__span-9-194"><a id="__codelineno-9-194" name="__codelineno-9-194" href="#__codelineno-9-194"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_origin_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">policy</span><span class="p">:</span> <span class="n">CORSPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-9-195"><a id="__codelineno-9-195" name="__codelineno-9-195" href="#__codelineno-9-195"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get appropriate origin response value&quot;&quot;&quot;</span>
</span><span id="__span-9-196"><a id="__codelineno-9-196" name="__codelineno-9-196" href="#__codelineno-9-196"></a>
</span><span id="__span-9-197"><a id="__codelineno-9-197" name="__codelineno-9-197" href="#__codelineno-9-197"></a>        <span class="c1"># If credentials are allowed, must echo exact origin (not wildcard)</span>
</span><span id="__span-9-198"><a id="__codelineno-9-198" name="__codelineno-9-198" href="#__codelineno-9-198"></a>        <span class="k">if</span> <span class="n">policy</span><span class="o">.</span><span class="n">allow_credentials</span><span class="p">:</span>
</span><span id="__span-9-199"><a id="__codelineno-9-199" name="__codelineno-9-199" href="#__codelineno-9-199"></a>            <span class="k">return</span> <span class="n">origin</span>
</span><span id="__span-9-200"><a id="__codelineno-9-200" name="__codelineno-9-200" href="#__codelineno-9-200"></a>
</span><span id="__span-9-201"><a id="__codelineno-9-201" name="__codelineno-9-201" href="#__codelineno-9-201"></a>        <span class="c1"># Check if wildcard is in allowed origins</span>
</span><span id="__span-9-202"><a id="__codelineno-9-202" name="__codelineno-9-202" href="#__codelineno-9-202"></a>        <span class="k">if</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">policy</span><span class="o">.</span><span class="n">allowed_origins</span><span class="p">:</span>
</span><span id="__span-9-203"><a id="__codelineno-9-203" name="__codelineno-9-203" href="#__codelineno-9-203"></a>            <span class="k">return</span> <span class="s1">&#39;*&#39;</span>
</span><span id="__span-9-204"><a id="__codelineno-9-204" name="__codelineno-9-204" href="#__codelineno-9-204"></a>
</span><span id="__span-9-205"><a id="__codelineno-9-205" name="__codelineno-9-205" href="#__codelineno-9-205"></a>        <span class="k">return</span> <span class="n">origin</span>
</span><span id="__span-9-206"><a id="__codelineno-9-206" name="__codelineno-9-206" href="#__codelineno-9-206"></a>
</span><span id="__span-9-207"><a id="__codelineno-9-207" name="__codelineno-9-207" href="#__codelineno-9-207"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_create_cors_denial</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="__span-9-208"><a id="__codelineno-9-208" name="__codelineno-9-208" href="#__codelineno-9-208"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create CORS denial response (empty headers)&quot;&quot;&quot;</span>
</span><span id="__span-9-209"><a id="__codelineno-9-209" name="__codelineno-9-209" href="#__codelineno-9-209"></a>        <span class="k">return</span> <span class="p">{}</span>
</span><span id="__span-9-210"><a id="__codelineno-9-210" name="__codelineno-9-210" href="#__codelineno-9-210"></a>
</span><span id="__span-9-211"><a id="__codelineno-9-211" name="__codelineno-9-211" href="#__codelineno-9-211"></a><span class="k">class</span><span class="w"> </span><span class="nc">CORSSecurityMiddleware</span><span class="p">:</span>
</span><span id="__span-9-212"><a id="__codelineno-9-212" name="__codelineno-9-212" href="#__codelineno-9-212"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;CORS security middleware for web applications&quot;&quot;&quot;</span>
</span><span id="__span-9-213"><a id="__codelineno-9-213" name="__codelineno-9-213" href="#__codelineno-9-213"></a>
</span><span id="__span-9-214"><a id="__codelineno-9-214" name="__codelineno-9-214" href="#__codelineno-9-214"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cors_manager</span><span class="p">:</span> <span class="n">CORSManager</span><span class="p">):</span>
</span><span id="__span-9-215"><a id="__codelineno-9-215" name="__codelineno-9-215" href="#__codelineno-9-215"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cors_manager</span> <span class="o">=</span> <span class="n">cors_manager</span>
</span><span id="__span-9-216"><a id="__codelineno-9-216" name="__codelineno-9-216" href="#__codelineno-9-216"></a>
</span><span id="__span-9-217"><a id="__codelineno-9-217" name="__codelineno-9-217" href="#__codelineno-9-217"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> 
</span><span id="__span-9-218"><a id="__codelineno-9-218" name="__codelineno-9-218" href="#__codelineno-9-218"></a>                       <span class="n">policy_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]]:</span>
</span><span id="__span-9-219"><a id="__codelineno-9-219" name="__codelineno-9-219" href="#__codelineno-9-219"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process request with CORS handling&quot;&quot;&quot;</span>
</span><span id="__span-9-220"><a id="__codelineno-9-220" name="__codelineno-9-220" href="#__codelineno-9-220"></a>
</span><span id="__span-9-221"><a id="__codelineno-9-221" name="__codelineno-9-221" href="#__codelineno-9-221"></a>        <span class="n">origin</span> <span class="o">=</span> <span class="n">request_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;origin&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-9-222"><a id="__codelineno-9-222" name="__codelineno-9-222" href="#__codelineno-9-222"></a>        <span class="n">method</span> <span class="o">=</span> <span class="n">request_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">)</span>
</span><span id="__span-9-223"><a id="__codelineno-9-223" name="__codelineno-9-223" href="#__codelineno-9-223"></a>
</span><span id="__span-9-224"><a id="__codelineno-9-224" name="__codelineno-9-224" href="#__codelineno-9-224"></a>        <span class="c1"># Handle preflight requests</span>
</span><span id="__span-9-225"><a id="__codelineno-9-225" name="__codelineno-9-225" href="#__codelineno-9-225"></a>        <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span>
</span><span id="__span-9-226"><a id="__codelineno-9-226" name="__codelineno-9-226" href="#__codelineno-9-226"></a>            <span class="n">requested_method</span> <span class="o">=</span> <span class="n">request_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;access_control_request_method&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-9-227"><a id="__codelineno-9-227" name="__codelineno-9-227" href="#__codelineno-9-227"></a>            <span class="n">requested_headers</span> <span class="o">=</span> <span class="n">request_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;access_control_request_headers&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="__span-9-228"><a id="__codelineno-9-228" name="__codelineno-9-228" href="#__codelineno-9-228"></a>            <span class="n">requested_headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">requested_headers</span> <span class="k">if</span> <span class="n">h</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
</span><span id="__span-9-229"><a id="__codelineno-9-229" name="__codelineno-9-229" href="#__codelineno-9-229"></a>
</span><span id="__span-9-230"><a id="__codelineno-9-230" name="__codelineno-9-230" href="#__codelineno-9-230"></a>            <span class="n">cors_headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cors_manager</span><span class="o">.</span><span class="n">handle_preflight_request</span><span class="p">(</span>
</span><span id="__span-9-231"><a id="__codelineno-9-231" name="__codelineno-9-231" href="#__codelineno-9-231"></a>                <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span>
</span><span id="__span-9-232"><a id="__codelineno-9-232" name="__codelineno-9-232" href="#__codelineno-9-232"></a>                <span class="n">method</span><span class="o">=</span><span class="n">requested_method</span><span class="p">,</span>
</span><span id="__span-9-233"><a id="__codelineno-9-233" name="__codelineno-9-233" href="#__codelineno-9-233"></a>                <span class="n">headers</span><span class="o">=</span><span class="n">requested_headers</span><span class="p">,</span>
</span><span id="__span-9-234"><a id="__codelineno-9-234" name="__codelineno-9-234" href="#__codelineno-9-234"></a>                <span class="n">policy_name</span><span class="o">=</span><span class="n">policy_name</span>
</span><span id="__span-9-235"><a id="__codelineno-9-235" name="__codelineno-9-235" href="#__codelineno-9-235"></a>            <span class="p">)</span>
</span><span id="__span-9-236"><a id="__codelineno-9-236" name="__codelineno-9-236" href="#__codelineno-9-236"></a>
</span><span id="__span-9-237"><a id="__codelineno-9-237" name="__codelineno-9-237" href="#__codelineno-9-237"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">cors_headers</span><span class="p">:</span>
</span><span id="__span-9-238"><a id="__codelineno-9-238" name="__codelineno-9-238" href="#__codelineno-9-238"></a>                <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-9-239"><a id="__codelineno-9-239" name="__codelineno-9-239" href="#__codelineno-9-239"></a>                    <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="mi">403</span><span class="p">,</span>
</span><span id="__span-9-240"><a id="__codelineno-9-240" name="__codelineno-9-240" href="#__codelineno-9-240"></a>                    <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;CORS policy violation&#39;</span><span class="p">,</span>
</span><span id="__span-9-241"><a id="__codelineno-9-241" name="__codelineno-9-241" href="#__codelineno-9-241"></a>                    <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="p">{}</span>
</span><span id="__span-9-242"><a id="__codelineno-9-242" name="__codelineno-9-242" href="#__codelineno-9-242"></a>                <span class="p">}</span>
</span><span id="__span-9-243"><a id="__codelineno-9-243" name="__codelineno-9-243" href="#__codelineno-9-243"></a>
</span><span id="__span-9-244"><a id="__codelineno-9-244" name="__codelineno-9-244" href="#__codelineno-9-244"></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-9-245"><a id="__codelineno-9-245" name="__codelineno-9-245" href="#__codelineno-9-245"></a>                <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
</span><span id="__span-9-246"><a id="__codelineno-9-246" name="__codelineno-9-246" href="#__codelineno-9-246"></a>                <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="n">cors_headers</span>
</span><span id="__span-9-247"><a id="__codelineno-9-247" name="__codelineno-9-247" href="#__codelineno-9-247"></a>            <span class="p">}</span>
</span><span id="__span-9-248"><a id="__codelineno-9-248" name="__codelineno-9-248" href="#__codelineno-9-248"></a>
</span><span id="__span-9-249"><a id="__codelineno-9-249" name="__codelineno-9-249" href="#__codelineno-9-249"></a>        <span class="c1"># Handle actual requests</span>
</span><span id="__span-9-250"><a id="__codelineno-9-250" name="__codelineno-9-250" href="#__codelineno-9-250"></a>        <span class="n">cors_headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cors_manager</span><span class="o">.</span><span class="n">handle_actual_request</span><span class="p">(</span>
</span><span id="__span-9-251"><a id="__codelineno-9-251" name="__codelineno-9-251" href="#__codelineno-9-251"></a>            <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span>
</span><span id="__span-9-252"><a id="__codelineno-9-252" name="__codelineno-9-252" href="#__codelineno-9-252"></a>            <span class="n">policy_name</span><span class="o">=</span><span class="n">policy_name</span>
</span><span id="__span-9-253"><a id="__codelineno-9-253" name="__codelineno-9-253" href="#__codelineno-9-253"></a>        <span class="p">)</span>
</span><span id="__span-9-254"><a id="__codelineno-9-254" name="__codelineno-9-254" href="#__codelineno-9-254"></a>
</span><span id="__span-9-255"><a id="__codelineno-9-255" name="__codelineno-9-255" href="#__codelineno-9-255"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">cors_headers</span><span class="p">:</span>
</span><span id="__span-9-256"><a id="__codelineno-9-256" name="__codelineno-9-256" href="#__codelineno-9-256"></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-9-257"><a id="__codelineno-9-257" name="__codelineno-9-257" href="#__codelineno-9-257"></a>                <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="mi">403</span><span class="p">,</span>
</span><span id="__span-9-258"><a id="__codelineno-9-258" name="__codelineno-9-258" href="#__codelineno-9-258"></a>                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;CORS policy violation&#39;</span><span class="p">,</span>
</span><span id="__span-9-259"><a id="__codelineno-9-259" name="__codelineno-9-259" href="#__codelineno-9-259"></a>                <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="p">{}</span>
</span><span id="__span-9-260"><a id="__codelineno-9-260" name="__codelineno-9-260" href="#__codelineno-9-260"></a>            <span class="p">}</span>
</span><span id="__span-9-261"><a id="__codelineno-9-261" name="__codelineno-9-261" href="#__codelineno-9-261"></a>
</span><span id="__span-9-262"><a id="__codelineno-9-262" name="__codelineno-9-262" href="#__codelineno-9-262"></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-9-263"><a id="__codelineno-9-263" name="__codelineno-9-263" href="#__codelineno-9-263"></a>            <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
</span><span id="__span-9-264"><a id="__codelineno-9-264" name="__codelineno-9-264" href="#__codelineno-9-264"></a>            <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="n">cors_headers</span>
</span><span id="__span-9-265"><a id="__codelineno-9-265" name="__codelineno-9-265" href="#__codelineno-9-265"></a>        <span class="p">}</span>
</span><span id="__span-9-266"><a id="__codelineno-9-266" name="__codelineno-9-266" href="#__codelineno-9-266"></a>
</span><span id="__span-9-267"><a id="__codelineno-9-267" name="__codelineno-9-267" href="#__codelineno-9-267"></a><span class="k">def</span><span class="w"> </span><span class="nf">cors_security_example</span><span class="p">():</span>
</span><span id="__span-9-268"><a id="__codelineno-9-268" name="__codelineno-9-268" href="#__codelineno-9-268"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate CORS security implementation&quot;&quot;&quot;</span>
</span><span id="__span-9-269"><a id="__codelineno-9-269" name="__codelineno-9-269" href="#__codelineno-9-269"></a>
</span><span id="__span-9-270"><a id="__codelineno-9-270" name="__codelineno-9-270" href="#__codelineno-9-270"></a>    <span class="c1"># Initialize CORS manager</span>
</span><span id="__span-9-271"><a id="__codelineno-9-271" name="__codelineno-9-271" href="#__codelineno-9-271"></a>    <span class="n">cors_manager</span> <span class="o">=</span> <span class="n">CORSManager</span><span class="p">()</span>
</span><span id="__span-9-272"><a id="__codelineno-9-272" name="__codelineno-9-272" href="#__codelineno-9-272"></a>
</span><span id="__span-9-273"><a id="__codelineno-9-273" name="__codelineno-9-273" href="#__codelineno-9-273"></a>    <span class="c1"># Create secure policies for different environments</span>
</span><span id="__span-9-274"><a id="__codelineno-9-274" name="__codelineno-9-274" href="#__codelineno-9-274"></a>
</span><span id="__span-9-275"><a id="__codelineno-9-275" name="__codelineno-9-275" href="#__codelineno-9-275"></a>    <span class="c1"># Development policy (more permissive)</span>
</span><span id="__span-9-276"><a id="__codelineno-9-276" name="__codelineno-9-276" href="#__codelineno-9-276"></a>    <span class="n">dev_policy</span> <span class="o">=</span> <span class="n">cors_manager</span><span class="o">.</span><span class="n">create_secure_policy</span><span class="p">(</span>
</span><span id="__span-9-277"><a id="__codelineno-9-277" name="__codelineno-9-277" href="#__codelineno-9-277"></a>        <span class="n">allowed_origins</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-9-278"><a id="__codelineno-9-278" name="__codelineno-9-278" href="#__codelineno-9-278"></a>            <span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">,</span>
</span><span id="__span-9-279"><a id="__codelineno-9-279" name="__codelineno-9-279" href="#__codelineno-9-279"></a>            <span class="s1">&#39;http://localhost:8080&#39;</span><span class="p">,</span>
</span><span id="__span-9-280"><a id="__codelineno-9-280" name="__codelineno-9-280" href="#__codelineno-9-280"></a>            <span class="s1">&#39;http://127.0.0.1:3000&#39;</span>
</span><span id="__span-9-281"><a id="__codelineno-9-281" name="__codelineno-9-281" href="#__codelineno-9-281"></a>        <span class="p">],</span>
</span><span id="__span-9-282"><a id="__codelineno-9-282" name="__codelineno-9-282" href="#__codelineno-9-282"></a>        <span class="n">allow_credentials</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-9-283"><a id="__codelineno-9-283" name="__codelineno-9-283" href="#__codelineno-9-283"></a>    <span class="p">)</span>
</span><span id="__span-9-284"><a id="__codelineno-9-284" name="__codelineno-9-284" href="#__codelineno-9-284"></a>
</span><span id="__span-9-285"><a id="__codelineno-9-285" name="__codelineno-9-285" href="#__codelineno-9-285"></a>    <span class="c1"># Production policy (restrictive)</span>
</span><span id="__span-9-286"><a id="__codelineno-9-286" name="__codelineno-9-286" href="#__codelineno-9-286"></a>    <span class="n">prod_policy</span> <span class="o">=</span> <span class="n">cors_manager</span><span class="o">.</span><span class="n">create_secure_policy</span><span class="p">(</span>
</span><span id="__span-9-287"><a id="__codelineno-9-287" name="__codelineno-9-287" href="#__codelineno-9-287"></a>        <span class="n">allowed_origins</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-9-288"><a id="__codelineno-9-288" name="__codelineno-9-288" href="#__codelineno-9-288"></a>            <span class="s1">&#39;https://myapp.com&#39;</span><span class="p">,</span>
</span><span id="__span-9-289"><a id="__codelineno-9-289" name="__codelineno-9-289" href="#__codelineno-9-289"></a>            <span class="s1">&#39;https://www.myapp.com&#39;</span><span class="p">,</span>
</span><span id="__span-9-290"><a id="__codelineno-9-290" name="__codelineno-9-290" href="#__codelineno-9-290"></a>            <span class="s1">&#39;https://admin.myapp.com&#39;</span>
</span><span id="__span-9-291"><a id="__codelineno-9-291" name="__codelineno-9-291" href="#__codelineno-9-291"></a>        <span class="p">],</span>
</span><span id="__span-9-292"><a id="__codelineno-9-292" name="__codelineno-9-292" href="#__codelineno-9-292"></a>        <span class="n">allow_credentials</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-9-293"><a id="__codelineno-9-293" name="__codelineno-9-293" href="#__codelineno-9-293"></a>    <span class="p">)</span>
</span><span id="__span-9-294"><a id="__codelineno-9-294" name="__codelineno-9-294" href="#__codelineno-9-294"></a>
</span><span id="__span-9-295"><a id="__codelineno-9-295" name="__codelineno-9-295" href="#__codelineno-9-295"></a>    <span class="c1"># Public API policy (no credentials)</span>
</span><span id="__span-9-296"><a id="__codelineno-9-296" name="__codelineno-9-296" href="#__codelineno-9-296"></a>    <span class="n">public_policy</span> <span class="o">=</span> <span class="n">CORSPolicy</span><span class="p">(</span>
</span><span id="__span-9-297"><a id="__codelineno-9-297" name="__codelineno-9-297" href="#__codelineno-9-297"></a>        <span class="n">allowed_origins</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">],</span>
</span><span id="__span-9-298"><a id="__codelineno-9-298" name="__codelineno-9-298" href="#__codelineno-9-298"></a>        <span class="n">allowed_methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">],</span>
</span><span id="__span-9-299"><a id="__codelineno-9-299" name="__codelineno-9-299" href="#__codelineno-9-299"></a>        <span class="n">allowed_headers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">],</span>
</span><span id="__span-9-300"><a id="__codelineno-9-300" name="__codelineno-9-300" href="#__codelineno-9-300"></a>        <span class="n">exposed_headers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X-Rate-Limit-Remaining&#39;</span><span class="p">],</span>
</span><span id="__span-9-301"><a id="__codelineno-9-301" name="__codelineno-9-301" href="#__codelineno-9-301"></a>        <span class="n">allow_credentials</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-9-302"><a id="__codelineno-9-302" name="__codelineno-9-302" href="#__codelineno-9-302"></a>        <span class="n">max_age</span><span class="o">=</span><span class="mi">3600</span>
</span><span id="__span-9-303"><a id="__codelineno-9-303" name="__codelineno-9-303" href="#__codelineno-9-303"></a>    <span class="p">)</span>
</span><span id="__span-9-304"><a id="__codelineno-9-304" name="__codelineno-9-304" href="#__codelineno-9-304"></a>
</span><span id="__span-9-305"><a id="__codelineno-9-305" name="__codelineno-9-305" href="#__codelineno-9-305"></a>    <span class="c1"># Register policies</span>
</span><span id="__span-9-306"><a id="__codelineno-9-306" name="__codelineno-9-306" href="#__codelineno-9-306"></a>    <span class="n">cors_manager</span><span class="o">.</span><span class="n">add_policy</span><span class="p">(</span><span class="s1">&#39;development&#39;</span><span class="p">,</span> <span class="n">dev_policy</span><span class="p">)</span>
</span><span id="__span-9-307"><a id="__codelineno-9-307" name="__codelineno-9-307" href="#__codelineno-9-307"></a>    <span class="n">cors_manager</span><span class="o">.</span><span class="n">add_policy</span><span class="p">(</span><span class="s1">&#39;production&#39;</span><span class="p">,</span> <span class="n">prod_policy</span><span class="p">)</span>
</span><span id="__span-9-308"><a id="__codelineno-9-308" name="__codelineno-9-308" href="#__codelineno-9-308"></a>    <span class="n">cors_manager</span><span class="o">.</span><span class="n">add_policy</span><span class="p">(</span><span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="n">public_policy</span><span class="p">)</span>
</span><span id="__span-9-309"><a id="__codelineno-9-309" name="__codelineno-9-309" href="#__codelineno-9-309"></a>    <span class="n">cors_manager</span><span class="o">.</span><span class="n">set_default_policy</span><span class="p">(</span><span class="n">prod_policy</span><span class="p">)</span>
</span><span id="__span-9-310"><a id="__codelineno-9-310" name="__codelineno-9-310" href="#__codelineno-9-310"></a>
</span><span id="__span-9-311"><a id="__codelineno-9-311" name="__codelineno-9-311" href="#__codelineno-9-311"></a>    <span class="c1"># Create middleware</span>
</span><span id="__span-9-312"><a id="__codelineno-9-312" name="__codelineno-9-312" href="#__codelineno-9-312"></a>    <span class="n">cors_middleware</span> <span class="o">=</span> <span class="n">CORSSecurityMiddleware</span><span class="p">(</span><span class="n">cors_manager</span><span class="p">)</span>
</span><span id="__span-9-313"><a id="__codelineno-9-313" name="__codelineno-9-313" href="#__codelineno-9-313"></a>
</span><span id="__span-9-314"><a id="__codelineno-9-314" name="__codelineno-9-314" href="#__codelineno-9-314"></a>    <span class="c1"># Simulate preflight request</span>
</span><span id="__span-9-315"><a id="__codelineno-9-315" name="__codelineno-9-315" href="#__codelineno-9-315"></a>    <span class="n">preflight_request</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-9-316"><a id="__codelineno-9-316" name="__codelineno-9-316" href="#__codelineno-9-316"></a>        <span class="s1">&#39;origin&#39;</span><span class="p">:</span> <span class="s1">&#39;https://myapp.com&#39;</span><span class="p">,</span>
</span><span id="__span-9-317"><a id="__codelineno-9-317" name="__codelineno-9-317" href="#__codelineno-9-317"></a>        <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">,</span>
</span><span id="__span-9-318"><a id="__codelineno-9-318" name="__codelineno-9-318" href="#__codelineno-9-318"></a>        <span class="s1">&#39;access_control_request_method&#39;</span><span class="p">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span><span id="__span-9-319"><a id="__codelineno-9-319" name="__codelineno-9-319" href="#__codelineno-9-319"></a>        <span class="s1">&#39;access_control_request_headers&#39;</span><span class="p">:</span> <span class="s1">&#39;Content-Type, Authorization&#39;</span>
</span><span id="__span-9-320"><a id="__codelineno-9-320" name="__codelineno-9-320" href="#__codelineno-9-320"></a>    <span class="p">}</span>
</span><span id="__span-9-321"><a id="__codelineno-9-321" name="__codelineno-9-321" href="#__codelineno-9-321"></a>
</span><span id="__span-9-322"><a id="__codelineno-9-322" name="__codelineno-9-322" href="#__codelineno-9-322"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">cors_middleware</span><span class="o">.</span><span class="n">process_request</span><span class="p">(</span><span class="n">preflight_request</span><span class="p">,</span> <span class="s1">&#39;production&#39;</span><span class="p">)</span>
</span><span id="__span-9-323"><a id="__codelineno-9-323" name="__codelineno-9-323" href="#__codelineno-9-323"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Preflight result: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-9-324"><a id="__codelineno-9-324" name="__codelineno-9-324" href="#__codelineno-9-324"></a>
</span><span id="__span-9-325"><a id="__codelineno-9-325" name="__codelineno-9-325" href="#__codelineno-9-325"></a>    <span class="c1"># Simulate actual request</span>
</span><span id="__span-9-326"><a id="__codelineno-9-326" name="__codelineno-9-326" href="#__codelineno-9-326"></a>    <span class="n">actual_request</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-9-327"><a id="__codelineno-9-327" name="__codelineno-9-327" href="#__codelineno-9-327"></a>        <span class="s1">&#39;origin&#39;</span><span class="p">:</span> <span class="s1">&#39;https://myapp.com&#39;</span><span class="p">,</span>
</span><span id="__span-9-328"><a id="__codelineno-9-328" name="__codelineno-9-328" href="#__codelineno-9-328"></a>        <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;POST&#39;</span>
</span><span id="__span-9-329"><a id="__codelineno-9-329" name="__codelineno-9-329" href="#__codelineno-9-329"></a>    <span class="p">}</span>
</span><span id="__span-9-330"><a id="__codelineno-9-330" name="__codelineno-9-330" href="#__codelineno-9-330"></a>
</span><span id="__span-9-331"><a id="__codelineno-9-331" name="__codelineno-9-331" href="#__codelineno-9-331"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">cors_middleware</span><span class="o">.</span><span class="n">process_request</span><span class="p">(</span><span class="n">actual_request</span><span class="p">,</span> <span class="s1">&#39;production&#39;</span><span class="p">)</span>
</span><span id="__span-9-332"><a id="__codelineno-9-332" name="__codelineno-9-332" href="#__codelineno-9-332"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Actual request result: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-9-333"><a id="__codelineno-9-333" name="__codelineno-9-333" href="#__codelineno-9-333"></a>
</span><span id="__span-9-334"><a id="__codelineno-9-334" name="__codelineno-9-334" href="#__codelineno-9-334"></a>    <span class="c1"># Test blocked origin</span>
</span><span id="__span-9-335"><a id="__codelineno-9-335" name="__codelineno-9-335" href="#__codelineno-9-335"></a>    <span class="n">blocked_request</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-9-336"><a id="__codelineno-9-336" name="__codelineno-9-336" href="#__codelineno-9-336"></a>        <span class="s1">&#39;origin&#39;</span><span class="p">:</span> <span class="s1">&#39;https://malicious-site.com&#39;</span><span class="p">,</span>
</span><span id="__span-9-337"><a id="__codelineno-9-337" name="__codelineno-9-337" href="#__codelineno-9-337"></a>        <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;GET&#39;</span>
</span><span id="__span-9-338"><a id="__codelineno-9-338" name="__codelineno-9-338" href="#__codelineno-9-338"></a>    <span class="p">}</span>
</span><span id="__span-9-339"><a id="__codelineno-9-339" name="__codelineno-9-339" href="#__codelineno-9-339"></a>
</span><span id="__span-9-340"><a id="__codelineno-9-340" name="__codelineno-9-340" href="#__codelineno-9-340"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">cors_middleware</span><span class="o">.</span><span class="n">process_request</span><span class="p">(</span><span class="n">blocked_request</span><span class="p">,</span> <span class="s1">&#39;production&#39;</span><span class="p">)</span>
</span><span id="__span-9-341"><a id="__codelineno-9-341" name="__codelineno-9-341" href="#__codelineno-9-341"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Blocked request result: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-9-342"><a id="__codelineno-9-342" name="__codelineno-9-342" href="#__codelineno-9-342"></a>
</span><span id="__span-9-343"><a id="__codelineno-9-343" name="__codelineno-9-343" href="#__codelineno-9-343"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-9-344"><a id="__codelineno-9-344" name="__codelineno-9-344" href="#__codelineno-9-344"></a>    <span class="n">cors_security_example</span><span class="p">()</span>
</span></code></pre></div>
<h2 id="api-security-testing">API Security Testing<a class="headerlink" href="#api-security-testing" title="Permanent link">&para;</a></h2>
<p>Security testing is essential for identifying vulnerabilities in API implementations before they can be exploited by attackers.</p>
<h3 id="security-testing-methodology">Security Testing Methodology<a class="headerlink" href="#security-testing-methodology" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>@startuml API_Security_Testing_Process
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>!theme plain
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>skinparam backgroundColor white
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>skinparam defaultFontName &quot;Arial&quot;
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>start
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>:Threat Modeling;
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>note right: Identify attack vectors\nand security requirements
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>:Static Analysis;
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>note right: Code review\nVulnerability scanning
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>:Dynamic Testing;
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>split
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>  :Authentication Testing;
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>  note right: Token validation\nSession management
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>split again
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>  :Authorization Testing;
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>  note right: Access controls\nPrivilege escalation
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>split again
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a>  :Input Validation Testing;
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>  note right: Injection attacks\nData validation
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>split again
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>  :Rate Limiting Testing;
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a>  note right: DoS protection\nResource exhaustion
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>end split
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a>
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a>:Penetration Testing;
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a>note right: Manual exploitation\nReal-world scenarios
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a>
</span><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a>:Security Regression Testing;
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a>note right: Automated security\ntest suite
</span><span id="__span-10-33"><a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a>
</span><span id="__span-10-34"><a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a>stop
</span><span id="__span-10-35"><a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a>
</span><span id="__span-10-36"><a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a>@enduml
</span></code></pre></div>
<h3 id="automated-security-testing-framework">Automated Security Testing Framework<a class="headerlink" href="#automated-security-testing-framework" title="Permanent link">&para;</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">string</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Callable</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">concurrent.futures</span><span class="w"> </span><span class="kn">import</span> <span class="n">ThreadPoolExecutor</span><span class="p">,</span> <span class="n">as_completed</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urljoin</span><span class="p">,</span> <span class="n">urlparse</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="nd">@dataclass</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">SecurityTestResult</span><span class="p">:</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Result of a security test&quot;&quot;&quot;</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>    <span class="n">test_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>    <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>    <span class="n">passed</span><span class="p">:</span> <span class="nb">bool</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>    <span class="n">severity</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># &#39;low&#39;, &#39;medium&#39;, &#39;high&#39;, &#39;critical&#39;</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>    <span class="n">details</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>    <span class="n">remediation</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a><span class="nd">@dataclass</span>
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a><span class="k">class</span><span class="w"> </span><span class="nc">APIEndpoint</span><span class="p">:</span>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;API endpoint configuration for testing&quot;&quot;&quot;</span>
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-11-28"><a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a>    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-11-29"><a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a>    <span class="n">auth_required</span><span class="p">:</span> <span class="nb">bool</span>
</span><span id="__span-11-30"><a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a>    <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
</span><span id="__span-11-31"><a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a>    <span class="n">expected_status</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="__span-11-32"><a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a>
</span><span id="__span-11-33"><a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a><span class="k">class</span><span class="w"> </span><span class="nc">APISecurityTester</span><span class="p">:</span>
</span><span id="__span-11-34"><a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Comprehensive API security testing framework&quot;&quot;&quot;</span>
</span><span id="__span-11-35"><a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a>
</span><span id="__span-11-36"><a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">):</span>
</span><span id="__span-11-37"><a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="n">base_url</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span id="__span-11-38"><a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
</span><span id="__span-11-39"><a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
</span><span id="__span-11-40"><a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">SecurityTestResult</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-11-41"><a id="__codelineno-11-41" name="__codelineno-11-41" href="#__codelineno-11-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-11-42"><a id="__codelineno-11-42" name="__codelineno-11-42" href="#__codelineno-11-42"></a>
</span><span id="__span-11-43"><a id="__codelineno-11-43" name="__codelineno-11-43" href="#__codelineno-11-43"></a>        <span class="c1"># Common payloads for injection testing</span>
</span><span id="__span-11-44"><a id="__codelineno-11-44" name="__codelineno-11-44" href="#__codelineno-11-44"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sql_injection_payloads</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-11-45"><a id="__codelineno-11-45" name="__codelineno-11-45" href="#__codelineno-11-45"></a>            <span class="s2">&quot;&#39; OR &#39;1&#39;=&#39;1&quot;</span><span class="p">,</span>
</span><span id="__span-11-46"><a id="__codelineno-11-46" name="__codelineno-11-46" href="#__codelineno-11-46"></a>            <span class="s2">&quot;&#39;; DROP TABLE users;--&quot;</span><span class="p">,</span>
</span><span id="__span-11-47"><a id="__codelineno-11-47" name="__codelineno-11-47" href="#__codelineno-11-47"></a>            <span class="s2">&quot;1&#39; UNION SELECT NULL,username,password FROM users--&quot;</span><span class="p">,</span>
</span><span id="__span-11-48"><a id="__codelineno-11-48" name="__codelineno-11-48" href="#__codelineno-11-48"></a>            <span class="s2">&quot;admin&#39;--&quot;</span><span class="p">,</span>
</span><span id="__span-11-49"><a id="__codelineno-11-49" name="__codelineno-11-49" href="#__codelineno-11-49"></a>            <span class="s2">&quot;&#39; OR 1=1#&quot;</span>
</span><span id="__span-11-50"><a id="__codelineno-11-50" name="__codelineno-11-50" href="#__codelineno-11-50"></a>        <span class="p">]</span>
</span><span id="__span-11-51"><a id="__codelineno-11-51" name="__codelineno-11-51" href="#__codelineno-11-51"></a>
</span><span id="__span-11-52"><a id="__codelineno-11-52" name="__codelineno-11-52" href="#__codelineno-11-52"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">xss_payloads</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-11-53"><a id="__codelineno-11-53" name="__codelineno-11-53" href="#__codelineno-11-53"></a>            <span class="s2">&quot;&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;&quot;</span><span class="p">,</span>
</span><span id="__span-11-54"><a id="__codelineno-11-54" name="__codelineno-11-54" href="#__codelineno-11-54"></a>            <span class="s2">&quot;javascript:alert(&#39;XSS&#39;)&quot;</span><span class="p">,</span>
</span><span id="__span-11-55"><a id="__codelineno-11-55" name="__codelineno-11-55" href="#__codelineno-11-55"></a>            <span class="s2">&quot;&lt;img src=x onerror=alert(&#39;XSS&#39;)&gt;&quot;</span><span class="p">,</span>
</span><span id="__span-11-56"><a id="__codelineno-11-56" name="__codelineno-11-56" href="#__codelineno-11-56"></a>            <span class="s2">&quot;&#39;;alert(&#39;XSS&#39;);//&quot;</span><span class="p">,</span>
</span><span id="__span-11-57"><a id="__codelineno-11-57" name="__codelineno-11-57" href="#__codelineno-11-57"></a>            <span class="s2">&quot;&lt;svg onload=alert(&#39;XSS&#39;)&gt;&quot;</span>
</span><span id="__span-11-58"><a id="__codelineno-11-58" name="__codelineno-11-58" href="#__codelineno-11-58"></a>        <span class="p">]</span>
</span><span id="__span-11-59"><a id="__codelineno-11-59" name="__codelineno-11-59" href="#__codelineno-11-59"></a>
</span><span id="__span-11-60"><a id="__codelineno-11-60" name="__codelineno-11-60" href="#__codelineno-11-60"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">path_traversal_payloads</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-11-61"><a id="__codelineno-11-61" name="__codelineno-11-61" href="#__codelineno-11-61"></a>            <span class="s2">&quot;../../../etc/passwd&quot;</span><span class="p">,</span>
</span><span id="__span-11-62"><a id="__codelineno-11-62" name="__codelineno-11-62" href="#__codelineno-11-62"></a>            <span class="s2">&quot;..</span><span class="se">\\</span><span class="s2">..</span><span class="se">\\</span><span class="s2">..</span><span class="se">\\</span><span class="s2">windows</span><span class="se">\\</span><span class="s2">system32</span><span class="se">\\</span><span class="s2">drivers</span><span class="se">\\</span><span class="s2">etc</span><span class="se">\\</span><span class="s2">hosts&quot;</span><span class="p">,</span>
</span><span id="__span-11-63"><a id="__codelineno-11-63" name="__codelineno-11-63" href="#__codelineno-11-63"></a>            <span class="s2">&quot;....//....//....//etc/passwd&quot;</span><span class="p">,</span>
</span><span id="__span-11-64"><a id="__codelineno-11-64" name="__codelineno-11-64" href="#__codelineno-11-64"></a>            <span class="s2">&quot;</span><span class="si">%2e%2e%2f%2e%2e%2f%2e%2e%2f</span><span class="s2">etc</span><span class="si">%2f</span><span class="s2">passwd&quot;</span>
</span><span id="__span-11-65"><a id="__codelineno-11-65" name="__codelineno-11-65" href="#__codelineno-11-65"></a>        <span class="p">]</span>
</span><span id="__span-11-66"><a id="__codelineno-11-66" name="__codelineno-11-66" href="#__codelineno-11-66"></a>
</span><span id="__span-11-67"><a id="__codelineno-11-67" name="__codelineno-11-67" href="#__codelineno-11-67"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">auth_endpoint</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;/auth/login&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-11-68"><a id="__codelineno-11-68" name="__codelineno-11-68" href="#__codelineno-11-68"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Authenticate with the API and store session&quot;&quot;&quot;</span>
</span><span id="__span-11-69"><a id="__codelineno-11-69" name="__codelineno-11-69" href="#__codelineno-11-69"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-11-70"><a id="__codelineno-11-70" name="__codelineno-11-70" href="#__codelineno-11-70"></a>            <span class="n">auth_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="n">password</span><span class="p">}</span>
</span><span id="__span-11-71"><a id="__codelineno-11-71" name="__codelineno-11-71" href="#__codelineno-11-71"></a>            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="__span-11-72"><a id="__codelineno-11-72" name="__codelineno-11-72" href="#__codelineno-11-72"></a>                <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span> <span class="n">auth_endpoint</span><span class="p">),</span>
</span><span id="__span-11-73"><a id="__codelineno-11-73" name="__codelineno-11-73" href="#__codelineno-11-73"></a>                <span class="n">json</span><span class="o">=</span><span class="n">auth_data</span><span class="p">,</span>
</span><span id="__span-11-74"><a id="__codelineno-11-74" name="__codelineno-11-74" href="#__codelineno-11-74"></a>                <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span>
</span><span id="__span-11-75"><a id="__codelineno-11-75" name="__codelineno-11-75" href="#__codelineno-11-75"></a>            <span class="p">)</span>
</span><span id="__span-11-76"><a id="__codelineno-11-76" name="__codelineno-11-76" href="#__codelineno-11-76"></a>
</span><span id="__span-11-77"><a id="__codelineno-11-77" name="__codelineno-11-77" href="#__codelineno-11-77"></a>            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="__span-11-78"><a id="__codelineno-11-78" name="__codelineno-11-78" href="#__codelineno-11-78"></a>                <span class="c1"># Store authentication token if provided</span>
</span><span id="__span-11-79"><a id="__codelineno-11-79" name="__codelineno-11-79" href="#__codelineno-11-79"></a>                <span class="n">auth_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-11-80"><a id="__codelineno-11-80" name="__codelineno-11-80" href="#__codelineno-11-80"></a>                <span class="k">if</span> <span class="s1">&#39;token&#39;</span> <span class="ow">in</span> <span class="n">auth_data</span><span class="p">:</span>
</span><span id="__span-11-81"><a id="__codelineno-11-81" name="__codelineno-11-81" href="#__codelineno-11-81"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
</span><span id="__span-11-82"><a id="__codelineno-11-82" name="__codelineno-11-82" href="#__codelineno-11-82"></a>                        <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">auth_data</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-11-83"><a id="__codelineno-11-83" name="__codelineno-11-83" href="#__codelineno-11-83"></a>                    <span class="p">})</span>
</span><span id="__span-11-84"><a id="__codelineno-11-84" name="__codelineno-11-84" href="#__codelineno-11-84"></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-11-85"><a id="__codelineno-11-85" name="__codelineno-11-85" href="#__codelineno-11-85"></a>
</span><span id="__span-11-86"><a id="__codelineno-11-86" name="__codelineno-11-86" href="#__codelineno-11-86"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-11-87"><a id="__codelineno-11-87" name="__codelineno-11-87" href="#__codelineno-11-87"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Authentication failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-11-88"><a id="__codelineno-11-88" name="__codelineno-11-88" href="#__codelineno-11-88"></a>
</span><span id="__span-11-89"><a id="__codelineno-11-89" name="__codelineno-11-89" href="#__codelineno-11-89"></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-11-90"><a id="__codelineno-11-90" name="__codelineno-11-90" href="#__codelineno-11-90"></a>
</span><span id="__span-11-91"><a id="__codelineno-11-91" name="__codelineno-11-91" href="#__codelineno-11-91"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_authentication_vulnerabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">APIEndpoint</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SecurityTestResult</span><span class="p">]:</span>
</span><span id="__span-11-92"><a id="__codelineno-11-92" name="__codelineno-11-92" href="#__codelineno-11-92"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test for authentication vulnerabilities&quot;&quot;&quot;</span>
</span><span id="__span-11-93"><a id="__codelineno-11-93" name="__codelineno-11-93" href="#__codelineno-11-93"></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-11-94"><a id="__codelineno-11-94" name="__codelineno-11-94" href="#__codelineno-11-94"></a>
</span><span id="__span-11-95"><a id="__codelineno-11-95" name="__codelineno-11-95" href="#__codelineno-11-95"></a>        <span class="k">for</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="n">endpoints</span><span class="p">:</span>
</span><span id="__span-11-96"><a id="__codelineno-11-96" name="__codelineno-11-96" href="#__codelineno-11-96"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">auth_required</span><span class="p">:</span>
</span><span id="__span-11-97"><a id="__codelineno-11-97" name="__codelineno-11-97" href="#__codelineno-11-97"></a>                <span class="k">continue</span>
</span><span id="__span-11-98"><a id="__codelineno-11-98" name="__codelineno-11-98" href="#__codelineno-11-98"></a>
</span><span id="__span-11-99"><a id="__codelineno-11-99" name="__codelineno-11-99" href="#__codelineno-11-99"></a>            <span class="c1"># Test 1: Access without authentication</span>
</span><span id="__span-11-100"><a id="__codelineno-11-100" name="__codelineno-11-100" href="#__codelineno-11-100"></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_unauthenticated_access</span><span class="p">(</span><span class="n">endpoint</span><span class="p">))</span>
</span><span id="__span-11-101"><a id="__codelineno-11-101" name="__codelineno-11-101" href="#__codelineno-11-101"></a>
</span><span id="__span-11-102"><a id="__codelineno-11-102" name="__codelineno-11-102" href="#__codelineno-11-102"></a>            <span class="c1"># Test 2: Invalid token handling</span>
</span><span id="__span-11-103"><a id="__codelineno-11-103" name="__codelineno-11-103" href="#__codelineno-11-103"></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_invalid_token</span><span class="p">(</span><span class="n">endpoint</span><span class="p">))</span>
</span><span id="__span-11-104"><a id="__codelineno-11-104" name="__codelineno-11-104" href="#__codelineno-11-104"></a>
</span><span id="__span-11-105"><a id="__codelineno-11-105" name="__codelineno-11-105" href="#__codelineno-11-105"></a>            <span class="c1"># Test 3: Expired token handling</span>
</span><span id="__span-11-106"><a id="__codelineno-11-106" name="__codelineno-11-106" href="#__codelineno-11-106"></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_token_manipulation</span><span class="p">(</span><span class="n">endpoint</span><span class="p">))</span>
</span><span id="__span-11-107"><a id="__codelineno-11-107" name="__codelineno-11-107" href="#__codelineno-11-107"></a>
</span><span id="__span-11-108"><a id="__codelineno-11-108" name="__codelineno-11-108" href="#__codelineno-11-108"></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="__span-11-109"><a id="__codelineno-11-109" name="__codelineno-11-109" href="#__codelineno-11-109"></a>
</span><span id="__span-11-110"><a id="__codelineno-11-110" name="__codelineno-11-110" href="#__codelineno-11-110"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_test_unauthenticated_access</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="n">APIEndpoint</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SecurityTestResult</span><span class="p">:</span>
</span><span id="__span-11-111"><a id="__codelineno-11-111" name="__codelineno-11-111" href="#__codelineno-11-111"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test access to authenticated endpoint without credentials&quot;&quot;&quot;</span>
</span><span id="__span-11-112"><a id="__codelineno-11-112" name="__codelineno-11-112" href="#__codelineno-11-112"></a>
</span><span id="__span-11-113"><a id="__codelineno-11-113" name="__codelineno-11-113" href="#__codelineno-11-113"></a>        <span class="c1"># Remove authentication headers temporarily</span>
</span><span id="__span-11-114"><a id="__codelineno-11-114" name="__codelineno-11-114" href="#__codelineno-11-114"></a>        <span class="n">original_headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="__span-11-115"><a id="__codelineno-11-115" name="__codelineno-11-115" href="#__codelineno-11-115"></a>        <span class="k">if</span> <span class="s1">&#39;Authorization&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
</span><span id="__span-11-116"><a id="__codelineno-11-116" name="__codelineno-11-116" href="#__codelineno-11-116"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Authorization&#39;</span><span class="p">]</span>
</span><span id="__span-11-117"><a id="__codelineno-11-117" name="__codelineno-11-117" href="#__codelineno-11-117"></a>
</span><span id="__span-11-118"><a id="__codelineno-11-118" name="__codelineno-11-118" href="#__codelineno-11-118"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-11-119"><a id="__codelineno-11-119" name="__codelineno-11-119" href="#__codelineno-11-119"></a>            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
</span><span id="__span-11-120"><a id="__codelineno-11-120" name="__codelineno-11-120" href="#__codelineno-11-120"></a>                <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-121"><a id="__codelineno-11-121" name="__codelineno-11-121" href="#__codelineno-11-121"></a>                <span class="n">url</span><span class="o">=</span><span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">),</span>
</span><span id="__span-11-122"><a id="__codelineno-11-122" name="__codelineno-11-122" href="#__codelineno-11-122"></a>                <span class="n">params</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">parameters</span> <span class="k">if</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-11-123"><a id="__codelineno-11-123" name="__codelineno-11-123" href="#__codelineno-11-123"></a>                <span class="n">json</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">parameters</span> <span class="k">if</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-11-124"><a id="__codelineno-11-124" name="__codelineno-11-124" href="#__codelineno-11-124"></a>                <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span>
</span><span id="__span-11-125"><a id="__codelineno-11-125" name="__codelineno-11-125" href="#__codelineno-11-125"></a>            <span class="p">)</span>
</span><span id="__span-11-126"><a id="__codelineno-11-126" name="__codelineno-11-126" href="#__codelineno-11-126"></a>
</span><span id="__span-11-127"><a id="__codelineno-11-127" name="__codelineno-11-127" href="#__codelineno-11-127"></a>            <span class="c1"># Restore headers</span>
</span><span id="__span-11-128"><a id="__codelineno-11-128" name="__codelineno-11-128" href="#__codelineno-11-128"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="n">original_headers</span>
</span><span id="__span-11-129"><a id="__codelineno-11-129" name="__codelineno-11-129" href="#__codelineno-11-129"></a>
</span><span id="__span-11-130"><a id="__codelineno-11-130" name="__codelineno-11-130" href="#__codelineno-11-130"></a>            <span class="c1"># Should return 401 Unauthorized</span>
</span><span id="__span-11-131"><a id="__codelineno-11-131" name="__codelineno-11-131" href="#__codelineno-11-131"></a>            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
</span><span id="__span-11-132"><a id="__codelineno-11-132" name="__codelineno-11-132" href="#__codelineno-11-132"></a>                <span class="k">return</span> <span class="n">SecurityTestResult</span><span class="p">(</span>
</span><span id="__span-11-133"><a id="__codelineno-11-133" name="__codelineno-11-133" href="#__codelineno-11-133"></a>                    <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;Unauthenticated Access&quot;</span><span class="p">,</span>
</span><span id="__span-11-134"><a id="__codelineno-11-134" name="__codelineno-11-134" href="#__codelineno-11-134"></a>                    <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span><span id="__span-11-135"><a id="__codelineno-11-135" name="__codelineno-11-135" href="#__codelineno-11-135"></a>                    <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-136"><a id="__codelineno-11-136" name="__codelineno-11-136" href="#__codelineno-11-136"></a>                    <span class="n">passed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-11-137"><a id="__codelineno-11-137" name="__codelineno-11-137" href="#__codelineno-11-137"></a>                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;medium&quot;</span><span class="p">,</span>
</span><span id="__span-11-138"><a id="__codelineno-11-138" name="__codelineno-11-138" href="#__codelineno-11-138"></a>                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Endpoint properly requires authentication&quot;</span><span class="p">,</span>
</span><span id="__span-11-139"><a id="__codelineno-11-139" name="__codelineno-11-139" href="#__codelineno-11-139"></a>                    <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;status_code&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">},</span>
</span><span id="__span-11-140"><a id="__codelineno-11-140" name="__codelineno-11-140" href="#__codelineno-11-140"></a>                    <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Continue current authentication enforcement&quot;</span>
</span><span id="__span-11-141"><a id="__codelineno-11-141" name="__codelineno-11-141" href="#__codelineno-11-141"></a>                <span class="p">)</span>
</span><span id="__span-11-142"><a id="__codelineno-11-142" name="__codelineno-11-142" href="#__codelineno-11-142"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-11-143"><a id="__codelineno-11-143" name="__codelineno-11-143" href="#__codelineno-11-143"></a>                <span class="k">return</span> <span class="n">SecurityTestResult</span><span class="p">(</span>
</span><span id="__span-11-144"><a id="__codelineno-11-144" name="__codelineno-11-144" href="#__codelineno-11-144"></a>                    <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;Unauthenticated Access&quot;</span><span class="p">,</span>
</span><span id="__span-11-145"><a id="__codelineno-11-145" name="__codelineno-11-145" href="#__codelineno-11-145"></a>                    <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span><span id="__span-11-146"><a id="__codelineno-11-146" name="__codelineno-11-146" href="#__codelineno-11-146"></a>                    <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-147"><a id="__codelineno-11-147" name="__codelineno-11-147" href="#__codelineno-11-147"></a>                    <span class="n">passed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-11-148"><a id="__codelineno-11-148" name="__codelineno-11-148" href="#__codelineno-11-148"></a>                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;high&quot;</span><span class="p">,</span>
</span><span id="__span-11-149"><a id="__codelineno-11-149" name="__codelineno-11-149" href="#__codelineno-11-149"></a>                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Endpoint accessible without authentication&quot;</span><span class="p">,</span>
</span><span id="__span-11-150"><a id="__codelineno-11-150" name="__codelineno-11-150" href="#__codelineno-11-150"></a>                    <span class="n">details</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-11-151"><a id="__codelineno-11-151" name="__codelineno-11-151" href="#__codelineno-11-151"></a>                        <span class="s2">&quot;status_code&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
</span><span id="__span-11-152"><a id="__codelineno-11-152" name="__codelineno-11-152" href="#__codelineno-11-152"></a>                        <span class="s2">&quot;response_size&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span id="__span-11-153"><a id="__codelineno-11-153" name="__codelineno-11-153" href="#__codelineno-11-153"></a>                    <span class="p">},</span>
</span><span id="__span-11-154"><a id="__codelineno-11-154" name="__codelineno-11-154" href="#__codelineno-11-154"></a>                    <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Implement proper authentication checks&quot;</span>
</span><span id="__span-11-155"><a id="__codelineno-11-155" name="__codelineno-11-155" href="#__codelineno-11-155"></a>                <span class="p">)</span>
</span><span id="__span-11-156"><a id="__codelineno-11-156" name="__codelineno-11-156" href="#__codelineno-11-156"></a>
</span><span id="__span-11-157"><a id="__codelineno-11-157" name="__codelineno-11-157" href="#__codelineno-11-157"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-11-158"><a id="__codelineno-11-158" name="__codelineno-11-158" href="#__codelineno-11-158"></a>            <span class="k">return</span> <span class="n">SecurityTestResult</span><span class="p">(</span>
</span><span id="__span-11-159"><a id="__codelineno-11-159" name="__codelineno-11-159" href="#__codelineno-11-159"></a>                <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;Unauthenticated Access&quot;</span><span class="p">,</span>
</span><span id="__span-11-160"><a id="__codelineno-11-160" name="__codelineno-11-160" href="#__codelineno-11-160"></a>                <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span><span id="__span-11-161"><a id="__codelineno-11-161" name="__codelineno-11-161" href="#__codelineno-11-161"></a>                <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-162"><a id="__codelineno-11-162" name="__codelineno-11-162" href="#__codelineno-11-162"></a>                <span class="n">passed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-11-163"><a id="__codelineno-11-163" name="__codelineno-11-163" href="#__codelineno-11-163"></a>                <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;medium&quot;</span><span class="p">,</span>
</span><span id="__span-11-164"><a id="__codelineno-11-164" name="__codelineno-11-164" href="#__codelineno-11-164"></a>                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Error testing unauthenticated access&quot;</span><span class="p">,</span>
</span><span id="__span-11-165"><a id="__codelineno-11-165" name="__codelineno-11-165" href="#__codelineno-11-165"></a>                <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)},</span>
</span><span id="__span-11-166"><a id="__codelineno-11-166" name="__codelineno-11-166" href="#__codelineno-11-166"></a>                <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Review endpoint implementation&quot;</span>
</span><span id="__span-11-167"><a id="__codelineno-11-167" name="__codelineno-11-167" href="#__codelineno-11-167"></a>            <span class="p">)</span>
</span><span id="__span-11-168"><a id="__codelineno-11-168" name="__codelineno-11-168" href="#__codelineno-11-168"></a>
</span><span id="__span-11-169"><a id="__codelineno-11-169" name="__codelineno-11-169" href="#__codelineno-11-169"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_test_invalid_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="n">APIEndpoint</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SecurityTestResult</span><span class="p">:</span>
</span><span id="__span-11-170"><a id="__codelineno-11-170" name="__codelineno-11-170" href="#__codelineno-11-170"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test handling of invalid authentication tokens&quot;&quot;&quot;</span>
</span><span id="__span-11-171"><a id="__codelineno-11-171" name="__codelineno-11-171" href="#__codelineno-11-171"></a>
</span><span id="__span-11-172"><a id="__codelineno-11-172" name="__codelineno-11-172" href="#__codelineno-11-172"></a>        <span class="c1"># Store original authorization</span>
</span><span id="__span-11-173"><a id="__codelineno-11-173" name="__codelineno-11-173" href="#__codelineno-11-173"></a>        <span class="n">original_auth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-11-174"><a id="__codelineno-11-174" name="__codelineno-11-174" href="#__codelineno-11-174"></a>
</span><span id="__span-11-175"><a id="__codelineno-11-175" name="__codelineno-11-175" href="#__codelineno-11-175"></a>        <span class="c1"># Test with invalid token</span>
</span><span id="__span-11-176"><a id="__codelineno-11-176" name="__codelineno-11-176" href="#__codelineno-11-176"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Authorization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Bearer invalid_token_12345&#39;</span>
</span><span id="__span-11-177"><a id="__codelineno-11-177" name="__codelineno-11-177" href="#__codelineno-11-177"></a>
</span><span id="__span-11-178"><a id="__codelineno-11-178" name="__codelineno-11-178" href="#__codelineno-11-178"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-11-179"><a id="__codelineno-11-179" name="__codelineno-11-179" href="#__codelineno-11-179"></a>            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
</span><span id="__span-11-180"><a id="__codelineno-11-180" name="__codelineno-11-180" href="#__codelineno-11-180"></a>                <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-181"><a id="__codelineno-11-181" name="__codelineno-11-181" href="#__codelineno-11-181"></a>                <span class="n">url</span><span class="o">=</span><span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">),</span>
</span><span id="__span-11-182"><a id="__codelineno-11-182" name="__codelineno-11-182" href="#__codelineno-11-182"></a>                <span class="n">params</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">parameters</span> <span class="k">if</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-11-183"><a id="__codelineno-11-183" name="__codelineno-11-183" href="#__codelineno-11-183"></a>                <span class="n">json</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">parameters</span> <span class="k">if</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-11-184"><a id="__codelineno-11-184" name="__codelineno-11-184" href="#__codelineno-11-184"></a>                <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span>
</span><span id="__span-11-185"><a id="__codelineno-11-185" name="__codelineno-11-185" href="#__codelineno-11-185"></a>            <span class="p">)</span>
</span><span id="__span-11-186"><a id="__codelineno-11-186" name="__codelineno-11-186" href="#__codelineno-11-186"></a>
</span><span id="__span-11-187"><a id="__codelineno-11-187" name="__codelineno-11-187" href="#__codelineno-11-187"></a>            <span class="c1"># Restore original authorization</span>
</span><span id="__span-11-188"><a id="__codelineno-11-188" name="__codelineno-11-188" href="#__codelineno-11-188"></a>            <span class="k">if</span> <span class="n">original_auth</span><span class="p">:</span>
</span><span id="__span-11-189"><a id="__codelineno-11-189" name="__codelineno-11-189" href="#__codelineno-11-189"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Authorization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">original_auth</span>
</span><span id="__span-11-190"><a id="__codelineno-11-190" name="__codelineno-11-190" href="#__codelineno-11-190"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-11-191"><a id="__codelineno-11-191" name="__codelineno-11-191" href="#__codelineno-11-191"></a>                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Authorization&#39;</span><span class="p">]</span>
</span><span id="__span-11-192"><a id="__codelineno-11-192" name="__codelineno-11-192" href="#__codelineno-11-192"></a>
</span><span id="__span-11-193"><a id="__codelineno-11-193" name="__codelineno-11-193" href="#__codelineno-11-193"></a>            <span class="c1"># Should return 401 Unauthorized</span>
</span><span id="__span-11-194"><a id="__codelineno-11-194" name="__codelineno-11-194" href="#__codelineno-11-194"></a>            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
</span><span id="__span-11-195"><a id="__codelineno-11-195" name="__codelineno-11-195" href="#__codelineno-11-195"></a>                <span class="k">return</span> <span class="n">SecurityTestResult</span><span class="p">(</span>
</span><span id="__span-11-196"><a id="__codelineno-11-196" name="__codelineno-11-196" href="#__codelineno-11-196"></a>                    <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;Invalid Token Handling&quot;</span><span class="p">,</span>
</span><span id="__span-11-197"><a id="__codelineno-11-197" name="__codelineno-11-197" href="#__codelineno-11-197"></a>                    <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span><span id="__span-11-198"><a id="__codelineno-11-198" name="__codelineno-11-198" href="#__codelineno-11-198"></a>                    <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-199"><a id="__codelineno-11-199" name="__codelineno-11-199" href="#__codelineno-11-199"></a>                    <span class="n">passed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-11-200"><a id="__codelineno-11-200" name="__codelineno-11-200" href="#__codelineno-11-200"></a>                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;medium&quot;</span><span class="p">,</span>
</span><span id="__span-11-201"><a id="__codelineno-11-201" name="__codelineno-11-201" href="#__codelineno-11-201"></a>                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Invalid tokens properly rejected&quot;</span><span class="p">,</span>
</span><span id="__span-11-202"><a id="__codelineno-11-202" name="__codelineno-11-202" href="#__codelineno-11-202"></a>                    <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;status_code&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">},</span>
</span><span id="__span-11-203"><a id="__codelineno-11-203" name="__codelineno-11-203" href="#__codelineno-11-203"></a>                    <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Continue current token validation&quot;</span>
</span><span id="__span-11-204"><a id="__codelineno-11-204" name="__codelineno-11-204" href="#__codelineno-11-204"></a>                <span class="p">)</span>
</span><span id="__span-11-205"><a id="__codelineno-11-205" name="__codelineno-11-205" href="#__codelineno-11-205"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-11-206"><a id="__codelineno-11-206" name="__codelineno-11-206" href="#__codelineno-11-206"></a>                <span class="k">return</span> <span class="n">SecurityTestResult</span><span class="p">(</span>
</span><span id="__span-11-207"><a id="__codelineno-11-207" name="__codelineno-11-207" href="#__codelineno-11-207"></a>                    <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;Invalid Token Handling&quot;</span><span class="p">,</span>
</span><span id="__span-11-208"><a id="__codelineno-11-208" name="__codelineno-11-208" href="#__codelineno-11-208"></a>                    <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span><span id="__span-11-209"><a id="__codelineno-11-209" name="__codelineno-11-209" href="#__codelineno-11-209"></a>                    <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-210"><a id="__codelineno-11-210" name="__codelineno-11-210" href="#__codelineno-11-210"></a>                    <span class="n">passed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-11-211"><a id="__codelineno-11-211" name="__codelineno-11-211" href="#__codelineno-11-211"></a>                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;high&quot;</span><span class="p">,</span>
</span><span id="__span-11-212"><a id="__codelineno-11-212" name="__codelineno-11-212" href="#__codelineno-11-212"></a>                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Invalid token accepted or poor error handling&quot;</span><span class="p">,</span>
</span><span id="__span-11-213"><a id="__codelineno-11-213" name="__codelineno-11-213" href="#__codelineno-11-213"></a>                    <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;status_code&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">},</span>
</span><span id="__span-11-214"><a id="__codelineno-11-214" name="__codelineno-11-214" href="#__codelineno-11-214"></a>                    <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Implement proper token validation and error handling&quot;</span>
</span><span id="__span-11-215"><a id="__codelineno-11-215" name="__codelineno-11-215" href="#__codelineno-11-215"></a>                <span class="p">)</span>
</span><span id="__span-11-216"><a id="__codelineno-11-216" name="__codelineno-11-216" href="#__codelineno-11-216"></a>
</span><span id="__span-11-217"><a id="__codelineno-11-217" name="__codelineno-11-217" href="#__codelineno-11-217"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-11-218"><a id="__codelineno-11-218" name="__codelineno-11-218" href="#__codelineno-11-218"></a>            <span class="k">return</span> <span class="n">SecurityTestResult</span><span class="p">(</span>
</span><span id="__span-11-219"><a id="__codelineno-11-219" name="__codelineno-11-219" href="#__codelineno-11-219"></a>                <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;Invalid Token Handling&quot;</span><span class="p">,</span>
</span><span id="__span-11-220"><a id="__codelineno-11-220" name="__codelineno-11-220" href="#__codelineno-11-220"></a>                <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span><span id="__span-11-221"><a id="__codelineno-11-221" name="__codelineno-11-221" href="#__codelineno-11-221"></a>                <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-222"><a id="__codelineno-11-222" name="__codelineno-11-222" href="#__codelineno-11-222"></a>                <span class="n">passed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-11-223"><a id="__codelineno-11-223" name="__codelineno-11-223" href="#__codelineno-11-223"></a>                <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;medium&quot;</span><span class="p">,</span>
</span><span id="__span-11-224"><a id="__codelineno-11-224" name="__codelineno-11-224" href="#__codelineno-11-224"></a>                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Error testing invalid token&quot;</span><span class="p">,</span>
</span><span id="__span-11-225"><a id="__codelineno-11-225" name="__codelineno-11-225" href="#__codelineno-11-225"></a>                <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)},</span>
</span><span id="__span-11-226"><a id="__codelineno-11-226" name="__codelineno-11-226" href="#__codelineno-11-226"></a>                <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Review token validation implementation&quot;</span>
</span><span id="__span-11-227"><a id="__codelineno-11-227" name="__codelineno-11-227" href="#__codelineno-11-227"></a>            <span class="p">)</span>
</span><span id="__span-11-228"><a id="__codelineno-11-228" name="__codelineno-11-228" href="#__codelineno-11-228"></a>
</span><span id="__span-11-229"><a id="__codelineno-11-229" name="__codelineno-11-229" href="#__codelineno-11-229"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_test_token_manipulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="n">APIEndpoint</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SecurityTestResult</span><span class="p">:</span>
</span><span id="__span-11-230"><a id="__codelineno-11-230" name="__codelineno-11-230" href="#__codelineno-11-230"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test for token manipulation vulnerabilities&quot;&quot;&quot;</span>
</span><span id="__span-11-231"><a id="__codelineno-11-231" name="__codelineno-11-231" href="#__codelineno-11-231"></a>
</span><span id="__span-11-232"><a id="__codelineno-11-232" name="__codelineno-11-232" href="#__codelineno-11-232"></a>        <span class="n">original_auth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-11-233"><a id="__codelineno-11-233" name="__codelineno-11-233" href="#__codelineno-11-233"></a>
</span><span id="__span-11-234"><a id="__codelineno-11-234" name="__codelineno-11-234" href="#__codelineno-11-234"></a>        <span class="c1"># Test various token manipulations</span>
</span><span id="__span-11-235"><a id="__codelineno-11-235" name="__codelineno-11-235" href="#__codelineno-11-235"></a>        <span class="n">manipulated_tokens</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-11-236"><a id="__codelineno-11-236" name="__codelineno-11-236" href="#__codelineno-11-236"></a>            <span class="s1">&#39;Bearer &#39;</span><span class="p">,</span>  <span class="c1"># Empty token</span>
</span><span id="__span-11-237"><a id="__codelineno-11-237" name="__codelineno-11-237" href="#__codelineno-11-237"></a>            <span class="s1">&#39;Bearer null&#39;</span><span class="p">,</span>  <span class="c1"># Null token</span>
</span><span id="__span-11-238"><a id="__codelineno-11-238" name="__codelineno-11-238" href="#__codelineno-11-238"></a>            <span class="s1">&#39;Bearer eyJhbGciOiJub25lIn0.eyJzdWIiOiJhZG1pbiJ9.&#39;</span><span class="p">,</span>  <span class="c1"># None algorithm JWT</span>
</span><span id="__span-11-239"><a id="__codelineno-11-239" name="__codelineno-11-239" href="#__codelineno-11-239"></a>            <span class="s1">&#39;Basic YWRtaW46YWRtaW4=&#39;</span><span class="p">,</span>  <span class="c1"># Different auth scheme</span>
</span><span id="__span-11-240"><a id="__codelineno-11-240" name="__codelineno-11-240" href="#__codelineno-11-240"></a>        <span class="p">]</span>
</span><span id="__span-11-241"><a id="__codelineno-11-241" name="__codelineno-11-241" href="#__codelineno-11-241"></a>
</span><span id="__span-11-242"><a id="__codelineno-11-242" name="__codelineno-11-242" href="#__codelineno-11-242"></a>        <span class="n">vulnerabilities_found</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-11-243"><a id="__codelineno-11-243" name="__codelineno-11-243" href="#__codelineno-11-243"></a>
</span><span id="__span-11-244"><a id="__codelineno-11-244" name="__codelineno-11-244" href="#__codelineno-11-244"></a>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">manipulated_tokens</span><span class="p">:</span>
</span><span id="__span-11-245"><a id="__codelineno-11-245" name="__codelineno-11-245" href="#__codelineno-11-245"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Authorization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span>
</span><span id="__span-11-246"><a id="__codelineno-11-246" name="__codelineno-11-246" href="#__codelineno-11-246"></a>
</span><span id="__span-11-247"><a id="__codelineno-11-247" name="__codelineno-11-247" href="#__codelineno-11-247"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-11-248"><a id="__codelineno-11-248" name="__codelineno-11-248" href="#__codelineno-11-248"></a>                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
</span><span id="__span-11-249"><a id="__codelineno-11-249" name="__codelineno-11-249" href="#__codelineno-11-249"></a>                    <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-250"><a id="__codelineno-11-250" name="__codelineno-11-250" href="#__codelineno-11-250"></a>                    <span class="n">url</span><span class="o">=</span><span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">),</span>
</span><span id="__span-11-251"><a id="__codelineno-11-251" name="__codelineno-11-251" href="#__codelineno-11-251"></a>                    <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span>
</span><span id="__span-11-252"><a id="__codelineno-11-252" name="__codelineno-11-252" href="#__codelineno-11-252"></a>                <span class="p">)</span>
</span><span id="__span-11-253"><a id="__codelineno-11-253" name="__codelineno-11-253" href="#__codelineno-11-253"></a>
</span><span id="__span-11-254"><a id="__codelineno-11-254" name="__codelineno-11-254" href="#__codelineno-11-254"></a>                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">401</span><span class="p">:</span>
</span><span id="__span-11-255"><a id="__codelineno-11-255" name="__codelineno-11-255" href="#__codelineno-11-255"></a>                    <span class="n">vulnerabilities_found</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-11-256"><a id="__codelineno-11-256" name="__codelineno-11-256" href="#__codelineno-11-256"></a>                        <span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="n">token</span><span class="p">,</span>
</span><span id="__span-11-257"><a id="__codelineno-11-257" name="__codelineno-11-257" href="#__codelineno-11-257"></a>                        <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>
</span><span id="__span-11-258"><a id="__codelineno-11-258" name="__codelineno-11-258" href="#__codelineno-11-258"></a>                    <span class="p">})</span>
</span><span id="__span-11-259"><a id="__codelineno-11-259" name="__codelineno-11-259" href="#__codelineno-11-259"></a>
</span><span id="__span-11-260"><a id="__codelineno-11-260" name="__codelineno-11-260" href="#__codelineno-11-260"></a>            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="__span-11-261"><a id="__codelineno-11-261" name="__codelineno-11-261" href="#__codelineno-11-261"></a>                <span class="k">pass</span>
</span><span id="__span-11-262"><a id="__codelineno-11-262" name="__codelineno-11-262" href="#__codelineno-11-262"></a>
</span><span id="__span-11-263"><a id="__codelineno-11-263" name="__codelineno-11-263" href="#__codelineno-11-263"></a>        <span class="c1"># Restore original authorization</span>
</span><span id="__span-11-264"><a id="__codelineno-11-264" name="__codelineno-11-264" href="#__codelineno-11-264"></a>        <span class="k">if</span> <span class="n">original_auth</span><span class="p">:</span>
</span><span id="__span-11-265"><a id="__codelineno-11-265" name="__codelineno-11-265" href="#__codelineno-11-265"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Authorization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">original_auth</span>
</span><span id="__span-11-266"><a id="__codelineno-11-266" name="__codelineno-11-266" href="#__codelineno-11-266"></a>
</span><span id="__span-11-267"><a id="__codelineno-11-267" name="__codelineno-11-267" href="#__codelineno-11-267"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">vulnerabilities_found</span><span class="p">:</span>
</span><span id="__span-11-268"><a id="__codelineno-11-268" name="__codelineno-11-268" href="#__codelineno-11-268"></a>            <span class="k">return</span> <span class="n">SecurityTestResult</span><span class="p">(</span>
</span><span id="__span-11-269"><a id="__codelineno-11-269" name="__codelineno-11-269" href="#__codelineno-11-269"></a>                <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;Token Manipulation&quot;</span><span class="p">,</span>
</span><span id="__span-11-270"><a id="__codelineno-11-270" name="__codelineno-11-270" href="#__codelineno-11-270"></a>                <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span><span id="__span-11-271"><a id="__codelineno-11-271" name="__codelineno-11-271" href="#__codelineno-11-271"></a>                <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-272"><a id="__codelineno-11-272" name="__codelineno-11-272" href="#__codelineno-11-272"></a>                <span class="n">passed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-11-273"><a id="__codelineno-11-273" name="__codelineno-11-273" href="#__codelineno-11-273"></a>                <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;medium&quot;</span><span class="p">,</span>
</span><span id="__span-11-274"><a id="__codelineno-11-274" name="__codelineno-11-274" href="#__codelineno-11-274"></a>                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Token manipulation attempts properly blocked&quot;</span><span class="p">,</span>
</span><span id="__span-11-275"><a id="__codelineno-11-275" name="__codelineno-11-275" href="#__codelineno-11-275"></a>                <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;manipulations_tested&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">manipulated_tokens</span><span class="p">)},</span>
</span><span id="__span-11-276"><a id="__codelineno-11-276" name="__codelineno-11-276" href="#__codelineno-11-276"></a>                <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Continue current token validation&quot;</span>
</span><span id="__span-11-277"><a id="__codelineno-11-277" name="__codelineno-11-277" href="#__codelineno-11-277"></a>            <span class="p">)</span>
</span><span id="__span-11-278"><a id="__codelineno-11-278" name="__codelineno-11-278" href="#__codelineno-11-278"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-11-279"><a id="__codelineno-11-279" name="__codelineno-11-279" href="#__codelineno-11-279"></a>            <span class="k">return</span> <span class="n">SecurityTestResult</span><span class="p">(</span>
</span><span id="__span-11-280"><a id="__codelineno-11-280" name="__codelineno-11-280" href="#__codelineno-11-280"></a>                <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;Token Manipulation&quot;</span><span class="p">,</span>
</span><span id="__span-11-281"><a id="__codelineno-11-281" name="__codelineno-11-281" href="#__codelineno-11-281"></a>                <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span><span id="__span-11-282"><a id="__codelineno-11-282" name="__codelineno-11-282" href="#__codelineno-11-282"></a>                <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-283"><a id="__codelineno-11-283" name="__codelineno-11-283" href="#__codelineno-11-283"></a>                <span class="n">passed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-11-284"><a id="__codelineno-11-284" name="__codelineno-11-284" href="#__codelineno-11-284"></a>                <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;high&quot;</span><span class="p">,</span>
</span><span id="__span-11-285"><a id="__codelineno-11-285" name="__codelineno-11-285" href="#__codelineno-11-285"></a>                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Vulnerable to token manipulation&quot;</span><span class="p">,</span>
</span><span id="__span-11-286"><a id="__codelineno-11-286" name="__codelineno-11-286" href="#__codelineno-11-286"></a>                <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;vulnerabilities&quot;</span><span class="p">:</span> <span class="n">vulnerabilities_found</span><span class="p">},</span>
</span><span id="__span-11-287"><a id="__codelineno-11-287" name="__codelineno-11-287" href="#__codelineno-11-287"></a>                <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Implement stronger token validation and proper error handling&quot;</span>
</span><span id="__span-11-288"><a id="__codelineno-11-288" name="__codelineno-11-288" href="#__codelineno-11-288"></a>            <span class="p">)</span>
</span><span id="__span-11-289"><a id="__codelineno-11-289" name="__codelineno-11-289" href="#__codelineno-11-289"></a>
</span><span id="__span-11-290"><a id="__codelineno-11-290" name="__codelineno-11-290" href="#__codelineno-11-290"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_injection_vulnerabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">APIEndpoint</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SecurityTestResult</span><span class="p">]:</span>
</span><span id="__span-11-291"><a id="__codelineno-11-291" name="__codelineno-11-291" href="#__codelineno-11-291"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test for injection vulnerabilities&quot;&quot;&quot;</span>
</span><span id="__span-11-292"><a id="__codelineno-11-292" name="__codelineno-11-292" href="#__codelineno-11-292"></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-11-293"><a id="__codelineno-11-293" name="__codelineno-11-293" href="#__codelineno-11-293"></a>
</span><span id="__span-11-294"><a id="__codelineno-11-294" name="__codelineno-11-294" href="#__codelineno-11-294"></a>        <span class="k">for</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="n">endpoints</span><span class="p">:</span>
</span><span id="__span-11-295"><a id="__codelineno-11-295" name="__codelineno-11-295" href="#__codelineno-11-295"></a>            <span class="c1"># Test SQL injection</span>
</span><span id="__span-11-296"><a id="__codelineno-11-296" name="__codelineno-11-296" href="#__codelineno-11-296"></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_sql_injection</span><span class="p">(</span><span class="n">endpoint</span><span class="p">))</span>
</span><span id="__span-11-297"><a id="__codelineno-11-297" name="__codelineno-11-297" href="#__codelineno-11-297"></a>
</span><span id="__span-11-298"><a id="__codelineno-11-298" name="__codelineno-11-298" href="#__codelineno-11-298"></a>            <span class="c1"># Test XSS</span>
</span><span id="__span-11-299"><a id="__codelineno-11-299" name="__codelineno-11-299" href="#__codelineno-11-299"></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_xss_injection</span><span class="p">(</span><span class="n">endpoint</span><span class="p">))</span>
</span><span id="__span-11-300"><a id="__codelineno-11-300" name="__codelineno-11-300" href="#__codelineno-11-300"></a>
</span><span id="__span-11-301"><a id="__codelineno-11-301" name="__codelineno-11-301" href="#__codelineno-11-301"></a>            <span class="c1"># Test path traversal</span>
</span><span id="__span-11-302"><a id="__codelineno-11-302" name="__codelineno-11-302" href="#__codelineno-11-302"></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_path_traversal</span><span class="p">(</span><span class="n">endpoint</span><span class="p">))</span>
</span><span id="__span-11-303"><a id="__codelineno-11-303" name="__codelineno-11-303" href="#__codelineno-11-303"></a>
</span><span id="__span-11-304"><a id="__codelineno-11-304" name="__codelineno-11-304" href="#__codelineno-11-304"></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="__span-11-305"><a id="__codelineno-11-305" name="__codelineno-11-305" href="#__codelineno-11-305"></a>
</span><span id="__span-11-306"><a id="__codelineno-11-306" name="__codelineno-11-306" href="#__codelineno-11-306"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_test_sql_injection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="n">APIEndpoint</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SecurityTestResult</span><span class="p">:</span>
</span><span id="__span-11-307"><a id="__codelineno-11-307" name="__codelineno-11-307" href="#__codelineno-11-307"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test for SQL injection vulnerabilities&quot;&quot;&quot;</span>
</span><span id="__span-11-308"><a id="__codelineno-11-308" name="__codelineno-11-308" href="#__codelineno-11-308"></a>
</span><span id="__span-11-309"><a id="__codelineno-11-309" name="__codelineno-11-309" href="#__codelineno-11-309"></a>        <span class="n">vulnerabilities_found</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-11-310"><a id="__codelineno-11-310" name="__codelineno-11-310" href="#__codelineno-11-310"></a>
</span><span id="__span-11-311"><a id="__codelineno-11-311" name="__codelineno-11-311" href="#__codelineno-11-311"></a>        <span class="k">for</span> <span class="n">payload</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sql_injection_payloads</span><span class="p">:</span>
</span><span id="__span-11-312"><a id="__codelineno-11-312" name="__codelineno-11-312" href="#__codelineno-11-312"></a>            <span class="c1"># Test in different parameter positions</span>
</span><span id="__span-11-313"><a id="__codelineno-11-313" name="__codelineno-11-313" href="#__codelineno-11-313"></a>            <span class="k">for</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="__span-11-314"><a id="__codelineno-11-314" name="__codelineno-11-314" href="#__codelineno-11-314"></a>                <span class="n">test_params</span> <span class="o">=</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="__span-11-315"><a id="__codelineno-11-315" name="__codelineno-11-315" href="#__codelineno-11-315"></a>                <span class="n">test_params</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">payload</span>
</span><span id="__span-11-316"><a id="__codelineno-11-316" name="__codelineno-11-316" href="#__codelineno-11-316"></a>
</span><span id="__span-11-317"><a id="__codelineno-11-317" name="__codelineno-11-317" href="#__codelineno-11-317"></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="__span-11-318"><a id="__codelineno-11-318" name="__codelineno-11-318" href="#__codelineno-11-318"></a>                    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
</span><span id="__span-11-319"><a id="__codelineno-11-319" name="__codelineno-11-319" href="#__codelineno-11-319"></a>                        <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-320"><a id="__codelineno-11-320" name="__codelineno-11-320" href="#__codelineno-11-320"></a>                        <span class="n">url</span><span class="o">=</span><span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">),</span>
</span><span id="__span-11-321"><a id="__codelineno-11-321" name="__codelineno-11-321" href="#__codelineno-11-321"></a>                        <span class="n">params</span><span class="o">=</span><span class="n">test_params</span> <span class="k">if</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-11-322"><a id="__codelineno-11-322" name="__codelineno-11-322" href="#__codelineno-11-322"></a>                        <span class="n">json</span><span class="o">=</span><span class="n">test_params</span> <span class="k">if</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-11-323"><a id="__codelineno-11-323" name="__codelineno-11-323" href="#__codelineno-11-323"></a>                        <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span>
</span><span id="__span-11-324"><a id="__codelineno-11-324" name="__codelineno-11-324" href="#__codelineno-11-324"></a>                    <span class="p">)</span>
</span><span id="__span-11-325"><a id="__codelineno-11-325" name="__codelineno-11-325" href="#__codelineno-11-325"></a>
</span><span id="__span-11-326"><a id="__codelineno-11-326" name="__codelineno-11-326" href="#__codelineno-11-326"></a>                    <span class="c1"># Look for SQL error indicators</span>
</span><span id="__span-11-327"><a id="__codelineno-11-327" name="__codelineno-11-327" href="#__codelineno-11-327"></a>                    <span class="n">response_text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="__span-11-328"><a id="__codelineno-11-328" name="__codelineno-11-328" href="#__codelineno-11-328"></a>                    <span class="n">sql_errors</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-11-329"><a id="__codelineno-11-329" name="__codelineno-11-329" href="#__codelineno-11-329"></a>                        <span class="s1">&#39;sql syntax&#39;</span><span class="p">,</span> <span class="s1">&#39;mysql_fetch&#39;</span><span class="p">,</span> <span class="s1">&#39;ora-&#39;</span><span class="p">,</span> <span class="s1">&#39;postgresql&#39;</span><span class="p">,</span>
</span><span id="__span-11-330"><a id="__codelineno-11-330" name="__codelineno-11-330" href="#__codelineno-11-330"></a>                        <span class="s1">&#39;sqlite_&#39;</span><span class="p">,</span> <span class="s1">&#39;database error&#39;</span><span class="p">,</span> <span class="s1">&#39;sql statement&#39;</span><span class="p">,</span>
</span><span id="__span-11-331"><a id="__codelineno-11-331" name="__codelineno-11-331" href="#__codelineno-11-331"></a>                        <span class="s1">&#39;syntax error&#39;</span><span class="p">,</span> <span class="s1">&#39;table does not exist&#39;</span>
</span><span id="__span-11-332"><a id="__codelineno-11-332" name="__codelineno-11-332" href="#__codelineno-11-332"></a>                    <span class="p">]</span>
</span><span id="__span-11-333"><a id="__codelineno-11-333" name="__codelineno-11-333" href="#__codelineno-11-333"></a>
</span><span id="__span-11-334"><a id="__codelineno-11-334" name="__codelineno-11-334" href="#__codelineno-11-334"></a>                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">error</span> <span class="ow">in</span> <span class="n">response_text</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">sql_errors</span><span class="p">):</span>
</span><span id="__span-11-335"><a id="__codelineno-11-335" name="__codelineno-11-335" href="#__codelineno-11-335"></a>                        <span class="n">vulnerabilities_found</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-11-336"><a id="__codelineno-11-336" name="__codelineno-11-336" href="#__codelineno-11-336"></a>                            <span class="s1">&#39;parameter&#39;</span><span class="p">:</span> <span class="n">param_name</span><span class="p">,</span>
</span><span id="__span-11-337"><a id="__codelineno-11-337" name="__codelineno-11-337" href="#__codelineno-11-337"></a>                            <span class="s1">&#39;payload&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">,</span>
</span><span id="__span-11-338"><a id="__codelineno-11-338" name="__codelineno-11-338" href="#__codelineno-11-338"></a>                            <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
</span><span id="__span-11-339"><a id="__codelineno-11-339" name="__codelineno-11-339" href="#__codelineno-11-339"></a>                            <span class="s1">&#39;error_indicators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">err</span> <span class="k">for</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">sql_errors</span> <span class="k">if</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">response_text</span><span class="p">]</span>
</span><span id="__span-11-340"><a id="__codelineno-11-340" name="__codelineno-11-340" href="#__codelineno-11-340"></a>                        <span class="p">})</span>
</span><span id="__span-11-341"><a id="__codelineno-11-341" name="__codelineno-11-341" href="#__codelineno-11-341"></a>
</span><span id="__span-11-342"><a id="__codelineno-11-342" name="__codelineno-11-342" href="#__codelineno-11-342"></a>                    <span class="c1"># Also check for unusual response times (blind SQL injection)</span>
</span><span id="__span-11-343"><a id="__codelineno-11-343" name="__codelineno-11-343" href="#__codelineno-11-343"></a>                    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">elapsed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="__span-11-344"><a id="__codelineno-11-344" name="__codelineno-11-344" href="#__codelineno-11-344"></a>                        <span class="n">vulnerabilities_found</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-11-345"><a id="__codelineno-11-345" name="__codelineno-11-345" href="#__codelineno-11-345"></a>                            <span class="s1">&#39;parameter&#39;</span><span class="p">:</span> <span class="n">param_name</span><span class="p">,</span>
</span><span id="__span-11-346"><a id="__codelineno-11-346" name="__codelineno-11-346" href="#__codelineno-11-346"></a>                            <span class="s1">&#39;payload&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">,</span>
</span><span id="__span-11-347"><a id="__codelineno-11-347" name="__codelineno-11-347" href="#__codelineno-11-347"></a>                            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;time_based_blind&#39;</span><span class="p">,</span>
</span><span id="__span-11-348"><a id="__codelineno-11-348" name="__codelineno-11-348" href="#__codelineno-11-348"></a>                            <span class="s1">&#39;response_time&#39;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">elapsed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span id="__span-11-349"><a id="__codelineno-11-349" name="__codelineno-11-349" href="#__codelineno-11-349"></a>                        <span class="p">})</span>
</span><span id="__span-11-350"><a id="__codelineno-11-350" name="__codelineno-11-350" href="#__codelineno-11-350"></a>
</span><span id="__span-11-351"><a id="__codelineno-11-351" name="__codelineno-11-351" href="#__codelineno-11-351"></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-11-352"><a id="__codelineno-11-352" name="__codelineno-11-352" href="#__codelineno-11-352"></a>                    <span class="c1"># Connection errors might indicate successful injection</span>
</span><span id="__span-11-353"><a id="__codelineno-11-353" name="__codelineno-11-353" href="#__codelineno-11-353"></a>                    <span class="k">if</span> <span class="s1">&#39;timeout&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
</span><span id="__span-11-354"><a id="__codelineno-11-354" name="__codelineno-11-354" href="#__codelineno-11-354"></a>                        <span class="n">vulnerabilities_found</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-11-355"><a id="__codelineno-11-355" name="__codelineno-11-355" href="#__codelineno-11-355"></a>                            <span class="s1">&#39;parameter&#39;</span><span class="p">:</span> <span class="n">param_name</span><span class="p">,</span>
</span><span id="__span-11-356"><a id="__codelineno-11-356" name="__codelineno-11-356" href="#__codelineno-11-356"></a>                            <span class="s1">&#39;payload&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">,</span>
</span><span id="__span-11-357"><a id="__codelineno-11-357" name="__codelineno-11-357" href="#__codelineno-11-357"></a>                            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;timeout&#39;</span><span class="p">,</span>
</span><span id="__span-11-358"><a id="__codelineno-11-358" name="__codelineno-11-358" href="#__codelineno-11-358"></a>                            <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-11-359"><a id="__codelineno-11-359" name="__codelineno-11-359" href="#__codelineno-11-359"></a>                        <span class="p">})</span>
</span><span id="__span-11-360"><a id="__codelineno-11-360" name="__codelineno-11-360" href="#__codelineno-11-360"></a>
</span><span id="__span-11-361"><a id="__codelineno-11-361" name="__codelineno-11-361" href="#__codelineno-11-361"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">vulnerabilities_found</span><span class="p">:</span>
</span><span id="__span-11-362"><a id="__codelineno-11-362" name="__codelineno-11-362" href="#__codelineno-11-362"></a>            <span class="k">return</span> <span class="n">SecurityTestResult</span><span class="p">(</span>
</span><span id="__span-11-363"><a id="__codelineno-11-363" name="__codelineno-11-363" href="#__codelineno-11-363"></a>                <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;SQL Injection&quot;</span><span class="p">,</span>
</span><span id="__span-11-364"><a id="__codelineno-11-364" name="__codelineno-11-364" href="#__codelineno-11-364"></a>                <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span><span id="__span-11-365"><a id="__codelineno-11-365" name="__codelineno-11-365" href="#__codelineno-11-365"></a>                <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-366"><a id="__codelineno-11-366" name="__codelineno-11-366" href="#__codelineno-11-366"></a>                <span class="n">passed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-11-367"><a id="__codelineno-11-367" name="__codelineno-11-367" href="#__codelineno-11-367"></a>                <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
</span><span id="__span-11-368"><a id="__codelineno-11-368" name="__codelineno-11-368" href="#__codelineno-11-368"></a>                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;No SQL injection vulnerabilities detected&quot;</span><span class="p">,</span>
</span><span id="__span-11-369"><a id="__codelineno-11-369" name="__codelineno-11-369" href="#__codelineno-11-369"></a>                <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;payloads_tested&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sql_injection_payloads</span><span class="p">)},</span>
</span><span id="__span-11-370"><a id="__codelineno-11-370" name="__codelineno-11-370" href="#__codelineno-11-370"></a>                <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Continue using parameterized queries&quot;</span>
</span><span id="__span-11-371"><a id="__codelineno-11-371" name="__codelineno-11-371" href="#__codelineno-11-371"></a>            <span class="p">)</span>
</span><span id="__span-11-372"><a id="__codelineno-11-372" name="__codelineno-11-372" href="#__codelineno-11-372"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-11-373"><a id="__codelineno-11-373" name="__codelineno-11-373" href="#__codelineno-11-373"></a>            <span class="k">return</span> <span class="n">SecurityTestResult</span><span class="p">(</span>
</span><span id="__span-11-374"><a id="__codelineno-11-374" name="__codelineno-11-374" href="#__codelineno-11-374"></a>                <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;SQL Injection&quot;</span><span class="p">,</span>
</span><span id="__span-11-375"><a id="__codelineno-11-375" name="__codelineno-11-375" href="#__codelineno-11-375"></a>                <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span><span id="__span-11-376"><a id="__codelineno-11-376" name="__codelineno-11-376" href="#__codelineno-11-376"></a>                <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-377"><a id="__codelineno-11-377" name="__codelineno-11-377" href="#__codelineno-11-377"></a>                <span class="n">passed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-11-378"><a id="__codelineno-11-378" name="__codelineno-11-378" href="#__codelineno-11-378"></a>                <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
</span><span id="__span-11-379"><a id="__codelineno-11-379" name="__codelineno-11-379" href="#__codelineno-11-379"></a>                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;SQL injection vulnerability detected&quot;</span><span class="p">,</span>
</span><span id="__span-11-380"><a id="__codelineno-11-380" name="__codelineno-11-380" href="#__codelineno-11-380"></a>                <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;vulnerabilities&quot;</span><span class="p">:</span> <span class="n">vulnerabilities_found</span><span class="p">},</span>
</span><span id="__span-11-381"><a id="__codelineno-11-381" name="__codelineno-11-381" href="#__codelineno-11-381"></a>                <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Use parameterized queries and input validation&quot;</span>
</span><span id="__span-11-382"><a id="__codelineno-11-382" name="__codelineno-11-382" href="#__codelineno-11-382"></a>            <span class="p">)</span>
</span><span id="__span-11-383"><a id="__codelineno-11-383" name="__codelineno-11-383" href="#__codelineno-11-383"></a>
</span><span id="__span-11-384"><a id="__codelineno-11-384" name="__codelineno-11-384" href="#__codelineno-11-384"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_test_xss_injection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="n">APIEndpoint</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SecurityTestResult</span><span class="p">:</span>
</span><span id="__span-11-385"><a id="__codelineno-11-385" name="__codelineno-11-385" href="#__codelineno-11-385"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test for XSS vulnerabilities&quot;&quot;&quot;</span>
</span><span id="__span-11-386"><a id="__codelineno-11-386" name="__codelineno-11-386" href="#__codelineno-11-386"></a>
</span><span id="__span-11-387"><a id="__codelineno-11-387" name="__codelineno-11-387" href="#__codelineno-11-387"></a>        <span class="n">vulnerabilities_found</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-11-388"><a id="__codelineno-11-388" name="__codelineno-11-388" href="#__codelineno-11-388"></a>
</span><span id="__span-11-389"><a id="__codelineno-11-389" name="__codelineno-11-389" href="#__codelineno-11-389"></a>        <span class="k">for</span> <span class="n">payload</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xss_payloads</span><span class="p">:</span>
</span><span id="__span-11-390"><a id="__codelineno-11-390" name="__codelineno-11-390" href="#__codelineno-11-390"></a>            <span class="k">for</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="__span-11-391"><a id="__codelineno-11-391" name="__codelineno-11-391" href="#__codelineno-11-391"></a>                <span class="n">test_params</span> <span class="o">=</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="__span-11-392"><a id="__codelineno-11-392" name="__codelineno-11-392" href="#__codelineno-11-392"></a>                <span class="n">test_params</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">payload</span>
</span><span id="__span-11-393"><a id="__codelineno-11-393" name="__codelineno-11-393" href="#__codelineno-11-393"></a>
</span><span id="__span-11-394"><a id="__codelineno-11-394" name="__codelineno-11-394" href="#__codelineno-11-394"></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="__span-11-395"><a id="__codelineno-11-395" name="__codelineno-11-395" href="#__codelineno-11-395"></a>                    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
</span><span id="__span-11-396"><a id="__codelineno-11-396" name="__codelineno-11-396" href="#__codelineno-11-396"></a>                        <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-397"><a id="__codelineno-11-397" name="__codelineno-11-397" href="#__codelineno-11-397"></a>                        <span class="n">url</span><span class="o">=</span><span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">),</span>
</span><span id="__span-11-398"><a id="__codelineno-11-398" name="__codelineno-11-398" href="#__codelineno-11-398"></a>                        <span class="n">params</span><span class="o">=</span><span class="n">test_params</span> <span class="k">if</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-11-399"><a id="__codelineno-11-399" name="__codelineno-11-399" href="#__codelineno-11-399"></a>                        <span class="n">json</span><span class="o">=</span><span class="n">test_params</span> <span class="k">if</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-11-400"><a id="__codelineno-11-400" name="__codelineno-11-400" href="#__codelineno-11-400"></a>                        <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span>
</span><span id="__span-11-401"><a id="__codelineno-11-401" name="__codelineno-11-401" href="#__codelineno-11-401"></a>                    <span class="p">)</span>
</span><span id="__span-11-402"><a id="__codelineno-11-402" name="__codelineno-11-402" href="#__codelineno-11-402"></a>
</span><span id="__span-11-403"><a id="__codelineno-11-403" name="__codelineno-11-403" href="#__codelineno-11-403"></a>                    <span class="c1"># Check if payload is reflected in response</span>
</span><span id="__span-11-404"><a id="__codelineno-11-404" name="__codelineno-11-404" href="#__codelineno-11-404"></a>                    <span class="k">if</span> <span class="n">payload</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</span><span id="__span-11-405"><a id="__codelineno-11-405" name="__codelineno-11-405" href="#__codelineno-11-405"></a>                        <span class="n">vulnerabilities_found</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-11-406"><a id="__codelineno-11-406" name="__codelineno-11-406" href="#__codelineno-11-406"></a>                            <span class="s1">&#39;parameter&#39;</span><span class="p">:</span> <span class="n">param_name</span><span class="p">,</span>
</span><span id="__span-11-407"><a id="__codelineno-11-407" name="__codelineno-11-407" href="#__codelineno-11-407"></a>                            <span class="s1">&#39;payload&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">,</span>
</span><span id="__span-11-408"><a id="__codelineno-11-408" name="__codelineno-11-408" href="#__codelineno-11-408"></a>                            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;reflected_xss&#39;</span>
</span><span id="__span-11-409"><a id="__codelineno-11-409" name="__codelineno-11-409" href="#__codelineno-11-409"></a>                        <span class="p">})</span>
</span><span id="__span-11-410"><a id="__codelineno-11-410" name="__codelineno-11-410" href="#__codelineno-11-410"></a>
</span><span id="__span-11-411"><a id="__codelineno-11-411" name="__codelineno-11-411" href="#__codelineno-11-411"></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="__span-11-412"><a id="__codelineno-11-412" name="__codelineno-11-412" href="#__codelineno-11-412"></a>                    <span class="k">pass</span>
</span><span id="__span-11-413"><a id="__codelineno-11-413" name="__codelineno-11-413" href="#__codelineno-11-413"></a>
</span><span id="__span-11-414"><a id="__codelineno-11-414" name="__codelineno-11-414" href="#__codelineno-11-414"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">vulnerabilities_found</span><span class="p">:</span>
</span><span id="__span-11-415"><a id="__codelineno-11-415" name="__codelineno-11-415" href="#__codelineno-11-415"></a>            <span class="k">return</span> <span class="n">SecurityTestResult</span><span class="p">(</span>
</span><span id="__span-11-416"><a id="__codelineno-11-416" name="__codelineno-11-416" href="#__codelineno-11-416"></a>                <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;Cross-Site Scripting (XSS)&quot;</span><span class="p">,</span>
</span><span id="__span-11-417"><a id="__codelineno-11-417" name="__codelineno-11-417" href="#__codelineno-11-417"></a>                <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span><span id="__span-11-418"><a id="__codelineno-11-418" name="__codelineno-11-418" href="#__codelineno-11-418"></a>                <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-419"><a id="__codelineno-11-419" name="__codelineno-11-419" href="#__codelineno-11-419"></a>                <span class="n">passed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-11-420"><a id="__codelineno-11-420" name="__codelineno-11-420" href="#__codelineno-11-420"></a>                <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;high&quot;</span><span class="p">,</span>
</span><span id="__span-11-421"><a id="__codelineno-11-421" name="__codelineno-11-421" href="#__codelineno-11-421"></a>                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;No XSS vulnerabilities detected&quot;</span><span class="p">,</span>
</span><span id="__span-11-422"><a id="__codelineno-11-422" name="__codelineno-11-422" href="#__codelineno-11-422"></a>                <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;payloads_tested&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xss_payloads</span><span class="p">)},</span>
</span><span id="__span-11-423"><a id="__codelineno-11-423" name="__codelineno-11-423" href="#__codelineno-11-423"></a>                <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Continue proper output encoding&quot;</span>
</span><span id="__span-11-424"><a id="__codelineno-11-424" name="__codelineno-11-424" href="#__codelineno-11-424"></a>            <span class="p">)</span>
</span><span id="__span-11-425"><a id="__codelineno-11-425" name="__codelineno-11-425" href="#__codelineno-11-425"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-11-426"><a id="__codelineno-11-426" name="__codelineno-11-426" href="#__codelineno-11-426"></a>            <span class="k">return</span> <span class="n">SecurityTestResult</span><span class="p">(</span>
</span><span id="__span-11-427"><a id="__codelineno-11-427" name="__codelineno-11-427" href="#__codelineno-11-427"></a>                <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;Cross-Site Scripting (XSS)&quot;</span><span class="p">,</span>
</span><span id="__span-11-428"><a id="__codelineno-11-428" name="__codelineno-11-428" href="#__codelineno-11-428"></a>                <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span><span id="__span-11-429"><a id="__codelineno-11-429" name="__codelineno-11-429" href="#__codelineno-11-429"></a>                <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-430"><a id="__codelineno-11-430" name="__codelineno-11-430" href="#__codelineno-11-430"></a>                <span class="n">passed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-11-431"><a id="__codelineno-11-431" name="__codelineno-11-431" href="#__codelineno-11-431"></a>                <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;high&quot;</span><span class="p">,</span>
</span><span id="__span-11-432"><a id="__codelineno-11-432" name="__codelineno-11-432" href="#__codelineno-11-432"></a>                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;XSS vulnerability detected&quot;</span><span class="p">,</span>
</span><span id="__span-11-433"><a id="__codelineno-11-433" name="__codelineno-11-433" href="#__codelineno-11-433"></a>                <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;vulnerabilities&quot;</span><span class="p">:</span> <span class="n">vulnerabilities_found</span><span class="p">},</span>
</span><span id="__span-11-434"><a id="__codelineno-11-434" name="__codelineno-11-434" href="#__codelineno-11-434"></a>                <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Implement proper input validation and output encoding&quot;</span>
</span><span id="__span-11-435"><a id="__codelineno-11-435" name="__codelineno-11-435" href="#__codelineno-11-435"></a>            <span class="p">)</span>
</span><span id="__span-11-436"><a id="__codelineno-11-436" name="__codelineno-11-436" href="#__codelineno-11-436"></a>
</span><span id="__span-11-437"><a id="__codelineno-11-437" name="__codelineno-11-437" href="#__codelineno-11-437"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_test_path_traversal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="n">APIEndpoint</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SecurityTestResult</span><span class="p">:</span>
</span><span id="__span-11-438"><a id="__codelineno-11-438" name="__codelineno-11-438" href="#__codelineno-11-438"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test for path traversal vulnerabilities&quot;&quot;&quot;</span>
</span><span id="__span-11-439"><a id="__codelineno-11-439" name="__codelineno-11-439" href="#__codelineno-11-439"></a>
</span><span id="__span-11-440"><a id="__codelineno-11-440" name="__codelineno-11-440" href="#__codelineno-11-440"></a>        <span class="n">vulnerabilities_found</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-11-441"><a id="__codelineno-11-441" name="__codelineno-11-441" href="#__codelineno-11-441"></a>
</span><span id="__span-11-442"><a id="__codelineno-11-442" name="__codelineno-11-442" href="#__codelineno-11-442"></a>        <span class="k">for</span> <span class="n">payload</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_traversal_payloads</span><span class="p">:</span>
</span><span id="__span-11-443"><a id="__codelineno-11-443" name="__codelineno-11-443" href="#__codelineno-11-443"></a>            <span class="k">for</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="__span-11-444"><a id="__codelineno-11-444" name="__codelineno-11-444" href="#__codelineno-11-444"></a>                <span class="n">test_params</span> <span class="o">=</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="__span-11-445"><a id="__codelineno-11-445" name="__codelineno-11-445" href="#__codelineno-11-445"></a>                <span class="n">test_params</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">payload</span>
</span><span id="__span-11-446"><a id="__codelineno-11-446" name="__codelineno-11-446" href="#__codelineno-11-446"></a>
</span><span id="__span-11-447"><a id="__codelineno-11-447" name="__codelineno-11-447" href="#__codelineno-11-447"></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="__span-11-448"><a id="__codelineno-11-448" name="__codelineno-11-448" href="#__codelineno-11-448"></a>                    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
</span><span id="__span-11-449"><a id="__codelineno-11-449" name="__codelineno-11-449" href="#__codelineno-11-449"></a>                        <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-450"><a id="__codelineno-11-450" name="__codelineno-11-450" href="#__codelineno-11-450"></a>                        <span class="n">url</span><span class="o">=</span><span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">),</span>
</span><span id="__span-11-451"><a id="__codelineno-11-451" name="__codelineno-11-451" href="#__codelineno-11-451"></a>                        <span class="n">params</span><span class="o">=</span><span class="n">test_params</span> <span class="k">if</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-11-452"><a id="__codelineno-11-452" name="__codelineno-11-452" href="#__codelineno-11-452"></a>                        <span class="n">json</span><span class="o">=</span><span class="n">test_params</span> <span class="k">if</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-11-453"><a id="__codelineno-11-453" name="__codelineno-11-453" href="#__codelineno-11-453"></a>                        <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span>
</span><span id="__span-11-454"><a id="__codelineno-11-454" name="__codelineno-11-454" href="#__codelineno-11-454"></a>                    <span class="p">)</span>
</span><span id="__span-11-455"><a id="__codelineno-11-455" name="__codelineno-11-455" href="#__codelineno-11-455"></a>
</span><span id="__span-11-456"><a id="__codelineno-11-456" name="__codelineno-11-456" href="#__codelineno-11-456"></a>                    <span class="c1"># Look for system file indicators</span>
</span><span id="__span-11-457"><a id="__codelineno-11-457" name="__codelineno-11-457" href="#__codelineno-11-457"></a>                    <span class="n">response_text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="__span-11-458"><a id="__codelineno-11-458" name="__codelineno-11-458" href="#__codelineno-11-458"></a>                    <span class="n">system_indicators</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-11-459"><a id="__codelineno-11-459" name="__codelineno-11-459" href="#__codelineno-11-459"></a>                        <span class="s1">&#39;root:&#39;</span><span class="p">,</span> <span class="s1">&#39;bin/bash&#39;</span><span class="p">,</span> <span class="s1">&#39;windows</span><span class="se">\\</span><span class="s1">system32&#39;</span><span class="p">,</span>
</span><span id="__span-11-460"><a id="__codelineno-11-460" name="__codelineno-11-460" href="#__codelineno-11-460"></a>                        <span class="s1">&#39;/etc/passwd&#39;</span><span class="p">,</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="s1">&#39;127.0.0.1&#39;</span>
</span><span id="__span-11-461"><a id="__codelineno-11-461" name="__codelineno-11-461" href="#__codelineno-11-461"></a>                    <span class="p">]</span>
</span><span id="__span-11-462"><a id="__codelineno-11-462" name="__codelineno-11-462" href="#__codelineno-11-462"></a>
</span><span id="__span-11-463"><a id="__codelineno-11-463" name="__codelineno-11-463" href="#__codelineno-11-463"></a>                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">indicator</span> <span class="ow">in</span> <span class="n">response_text</span> <span class="k">for</span> <span class="n">indicator</span> <span class="ow">in</span> <span class="n">system_indicators</span><span class="p">):</span>
</span><span id="__span-11-464"><a id="__codelineno-11-464" name="__codelineno-11-464" href="#__codelineno-11-464"></a>                        <span class="n">vulnerabilities_found</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-11-465"><a id="__codelineno-11-465" name="__codelineno-11-465" href="#__codelineno-11-465"></a>                            <span class="s1">&#39;parameter&#39;</span><span class="p">:</span> <span class="n">param_name</span><span class="p">,</span>
</span><span id="__span-11-466"><a id="__codelineno-11-466" name="__codelineno-11-466" href="#__codelineno-11-466"></a>                            <span class="s1">&#39;payload&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">,</span>
</span><span id="__span-11-467"><a id="__codelineno-11-467" name="__codelineno-11-467" href="#__codelineno-11-467"></a>                            <span class="s1">&#39;indicators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ind</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">system_indicators</span> <span class="k">if</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">response_text</span><span class="p">]</span>
</span><span id="__span-11-468"><a id="__codelineno-11-468" name="__codelineno-11-468" href="#__codelineno-11-468"></a>                        <span class="p">})</span>
</span><span id="__span-11-469"><a id="__codelineno-11-469" name="__codelineno-11-469" href="#__codelineno-11-469"></a>
</span><span id="__span-11-470"><a id="__codelineno-11-470" name="__codelineno-11-470" href="#__codelineno-11-470"></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="__span-11-471"><a id="__codelineno-11-471" name="__codelineno-11-471" href="#__codelineno-11-471"></a>                    <span class="k">pass</span>
</span><span id="__span-11-472"><a id="__codelineno-11-472" name="__codelineno-11-472" href="#__codelineno-11-472"></a>
</span><span id="__span-11-473"><a id="__codelineno-11-473" name="__codelineno-11-473" href="#__codelineno-11-473"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">vulnerabilities_found</span><span class="p">:</span>
</span><span id="__span-11-474"><a id="__codelineno-11-474" name="__codelineno-11-474" href="#__codelineno-11-474"></a>            <span class="k">return</span> <span class="n">SecurityTestResult</span><span class="p">(</span>
</span><span id="__span-11-475"><a id="__codelineno-11-475" name="__codelineno-11-475" href="#__codelineno-11-475"></a>                <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;Path Traversal&quot;</span><span class="p">,</span>
</span><span id="__span-11-476"><a id="__codelineno-11-476" name="__codelineno-11-476" href="#__codelineno-11-476"></a>                <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span><span id="__span-11-477"><a id="__codelineno-11-477" name="__codelineno-11-477" href="#__codelineno-11-477"></a>                <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-478"><a id="__codelineno-11-478" name="__codelineno-11-478" href="#__codelineno-11-478"></a>                <span class="n">passed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-11-479"><a id="__codelineno-11-479" name="__codelineno-11-479" href="#__codelineno-11-479"></a>                <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;high&quot;</span><span class="p">,</span>
</span><span id="__span-11-480"><a id="__codelineno-11-480" name="__codelineno-11-480" href="#__codelineno-11-480"></a>                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;No path traversal vulnerabilities detected&quot;</span><span class="p">,</span>
</span><span id="__span-11-481"><a id="__codelineno-11-481" name="__codelineno-11-481" href="#__codelineno-11-481"></a>                <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;payloads_tested&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_traversal_payloads</span><span class="p">)},</span>
</span><span id="__span-11-482"><a id="__codelineno-11-482" name="__codelineno-11-482" href="#__codelineno-11-482"></a>                <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Continue proper file path validation&quot;</span>
</span><span id="__span-11-483"><a id="__codelineno-11-483" name="__codelineno-11-483" href="#__codelineno-11-483"></a>            <span class="p">)</span>
</span><span id="__span-11-484"><a id="__codelineno-11-484" name="__codelineno-11-484" href="#__codelineno-11-484"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-11-485"><a id="__codelineno-11-485" name="__codelineno-11-485" href="#__codelineno-11-485"></a>            <span class="k">return</span> <span class="n">SecurityTestResult</span><span class="p">(</span>
</span><span id="__span-11-486"><a id="__codelineno-11-486" name="__codelineno-11-486" href="#__codelineno-11-486"></a>                <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;Path Traversal&quot;</span><span class="p">,</span>
</span><span id="__span-11-487"><a id="__codelineno-11-487" name="__codelineno-11-487" href="#__codelineno-11-487"></a>                <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span><span id="__span-11-488"><a id="__codelineno-11-488" name="__codelineno-11-488" href="#__codelineno-11-488"></a>                <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-489"><a id="__codelineno-11-489" name="__codelineno-11-489" href="#__codelineno-11-489"></a>                <span class="n">passed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-11-490"><a id="__codelineno-11-490" name="__codelineno-11-490" href="#__codelineno-11-490"></a>                <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;high&quot;</span><span class="p">,</span>
</span><span id="__span-11-491"><a id="__codelineno-11-491" name="__codelineno-11-491" href="#__codelineno-11-491"></a>                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Path traversal vulnerability detected&quot;</span><span class="p">,</span>
</span><span id="__span-11-492"><a id="__codelineno-11-492" name="__codelineno-11-492" href="#__codelineno-11-492"></a>                <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;vulnerabilities&quot;</span><span class="p">:</span> <span class="n">vulnerabilities_found</span><span class="p">},</span>
</span><span id="__span-11-493"><a id="__codelineno-11-493" name="__codelineno-11-493" href="#__codelineno-11-493"></a>                <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Implement proper file path validation and sandboxing&quot;</span>
</span><span id="__span-11-494"><a id="__codelineno-11-494" name="__codelineno-11-494" href="#__codelineno-11-494"></a>            <span class="p">)</span>
</span><span id="__span-11-495"><a id="__codelineno-11-495" name="__codelineno-11-495" href="#__codelineno-11-495"></a>
</span><span id="__span-11-496"><a id="__codelineno-11-496" name="__codelineno-11-496" href="#__codelineno-11-496"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_rate_limiting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="n">APIEndpoint</span><span class="p">,</span> 
</span><span id="__span-11-497"><a id="__codelineno-11-497" name="__codelineno-11-497" href="#__codelineno-11-497"></a>                          <span class="n">requests_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> 
</span><span id="__span-11-498"><a id="__codelineno-11-498" name="__codelineno-11-498" href="#__codelineno-11-498"></a>                          <span class="n">time_window</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">60</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SecurityTestResult</span><span class="p">:</span>
</span><span id="__span-11-499"><a id="__codelineno-11-499" name="__codelineno-11-499" href="#__codelineno-11-499"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test rate limiting implementation&quot;&quot;&quot;</span>
</span><span id="__span-11-500"><a id="__codelineno-11-500" name="__codelineno-11-500" href="#__codelineno-11-500"></a>
</span><span id="__span-11-501"><a id="__codelineno-11-501" name="__codelineno-11-501" href="#__codelineno-11-501"></a>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-11-502"><a id="__codelineno-11-502" name="__codelineno-11-502" href="#__codelineno-11-502"></a>        <span class="n">status_codes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-11-503"><a id="__codelineno-11-503" name="__codelineno-11-503" href="#__codelineno-11-503"></a>        <span class="n">response_times</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-11-504"><a id="__codelineno-11-504" name="__codelineno-11-504" href="#__codelineno-11-504"></a>
</span><span id="__span-11-505"><a id="__codelineno-11-505" name="__codelineno-11-505" href="#__codelineno-11-505"></a>        <span class="c1"># Send rapid requests</span>
</span><span id="__span-11-506"><a id="__codelineno-11-506" name="__codelineno-11-506" href="#__codelineno-11-506"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">requests_count</span><span class="p">):</span>
</span><span id="__span-11-507"><a id="__codelineno-11-507" name="__codelineno-11-507" href="#__codelineno-11-507"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-11-508"><a id="__codelineno-11-508" name="__codelineno-11-508" href="#__codelineno-11-508"></a>                <span class="n">request_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-11-509"><a id="__codelineno-11-509" name="__codelineno-11-509" href="#__codelineno-11-509"></a>                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
</span><span id="__span-11-510"><a id="__codelineno-11-510" name="__codelineno-11-510" href="#__codelineno-11-510"></a>                    <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-511"><a id="__codelineno-11-511" name="__codelineno-11-511" href="#__codelineno-11-511"></a>                    <span class="n">url</span><span class="o">=</span><span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">),</span>
</span><span id="__span-11-512"><a id="__codelineno-11-512" name="__codelineno-11-512" href="#__codelineno-11-512"></a>                    <span class="n">params</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">parameters</span> <span class="k">if</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-11-513"><a id="__codelineno-11-513" name="__codelineno-11-513" href="#__codelineno-11-513"></a>                    <span class="n">json</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">parameters</span> <span class="k">if</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-11-514"><a id="__codelineno-11-514" name="__codelineno-11-514" href="#__codelineno-11-514"></a>                    <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span>
</span><span id="__span-11-515"><a id="__codelineno-11-515" name="__codelineno-11-515" href="#__codelineno-11-515"></a>                <span class="p">)</span>
</span><span id="__span-11-516"><a id="__codelineno-11-516" name="__codelineno-11-516" href="#__codelineno-11-516"></a>                <span class="n">request_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">request_start</span>
</span><span id="__span-11-517"><a id="__codelineno-11-517" name="__codelineno-11-517" href="#__codelineno-11-517"></a>
</span><span id="__span-11-518"><a id="__codelineno-11-518" name="__codelineno-11-518" href="#__codelineno-11-518"></a>                <span class="n">status_codes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
</span><span id="__span-11-519"><a id="__codelineno-11-519" name="__codelineno-11-519" href="#__codelineno-11-519"></a>                <span class="n">response_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">request_time</span><span class="p">)</span>
</span><span id="__span-11-520"><a id="__codelineno-11-520" name="__codelineno-11-520" href="#__codelineno-11-520"></a>
</span><span id="__span-11-521"><a id="__codelineno-11-521" name="__codelineno-11-521" href="#__codelineno-11-521"></a>                <span class="c1"># Short delay to avoid overwhelming the server</span>
</span><span id="__span-11-522"><a id="__codelineno-11-522" name="__codelineno-11-522" href="#__codelineno-11-522"></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="__span-11-523"><a id="__codelineno-11-523" name="__codelineno-11-523" href="#__codelineno-11-523"></a>
</span><span id="__span-11-524"><a id="__codelineno-11-524" name="__codelineno-11-524" href="#__codelineno-11-524"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-11-525"><a id="__codelineno-11-525" name="__codelineno-11-525" href="#__codelineno-11-525"></a>                <span class="n">status_codes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Connection error</span>
</span><span id="__span-11-526"><a id="__codelineno-11-526" name="__codelineno-11-526" href="#__codelineno-11-526"></a>                <span class="n">response_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="__span-11-527"><a id="__codelineno-11-527" name="__codelineno-11-527" href="#__codelineno-11-527"></a>
</span><span id="__span-11-528"><a id="__codelineno-11-528" name="__codelineno-11-528" href="#__codelineno-11-528"></a>        <span class="n">total_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
</span><span id="__span-11-529"><a id="__codelineno-11-529" name="__codelineno-11-529" href="#__codelineno-11-529"></a>
</span><span id="__span-11-530"><a id="__codelineno-11-530" name="__codelineno-11-530" href="#__codelineno-11-530"></a>        <span class="c1"># Analyze results</span>
</span><span id="__span-11-531"><a id="__codelineno-11-531" name="__codelineno-11-531" href="#__codelineno-11-531"></a>        <span class="n">rate_limited_responses</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">status_codes</span> <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">)</span>
</span><span id="__span-11-532"><a id="__codelineno-11-532" name="__codelineno-11-532" href="#__codelineno-11-532"></a>        <span class="n">successful_responses</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">status_codes</span> <span class="k">if</span> <span class="mi">200</span> <span class="o">&lt;=</span> <span class="n">code</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">)</span>
</span><span id="__span-11-533"><a id="__codelineno-11-533" name="__codelineno-11-533" href="#__codelineno-11-533"></a>
</span><span id="__span-11-534"><a id="__codelineno-11-534" name="__codelineno-11-534" href="#__codelineno-11-534"></a>        <span class="k">if</span> <span class="n">rate_limited_responses</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-11-535"><a id="__codelineno-11-535" name="__codelineno-11-535" href="#__codelineno-11-535"></a>            <span class="k">return</span> <span class="n">SecurityTestResult</span><span class="p">(</span>
</span><span id="__span-11-536"><a id="__codelineno-11-536" name="__codelineno-11-536" href="#__codelineno-11-536"></a>                <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;Rate Limiting&quot;</span><span class="p">,</span>
</span><span id="__span-11-537"><a id="__codelineno-11-537" name="__codelineno-11-537" href="#__codelineno-11-537"></a>                <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span><span id="__span-11-538"><a id="__codelineno-11-538" name="__codelineno-11-538" href="#__codelineno-11-538"></a>                <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-539"><a id="__codelineno-11-539" name="__codelineno-11-539" href="#__codelineno-11-539"></a>                <span class="n">passed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-11-540"><a id="__codelineno-11-540" name="__codelineno-11-540" href="#__codelineno-11-540"></a>                <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;medium&quot;</span><span class="p">,</span>
</span><span id="__span-11-541"><a id="__codelineno-11-541" name="__codelineno-11-541" href="#__codelineno-11-541"></a>                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Rate limiting is implemented&quot;</span><span class="p">,</span>
</span><span id="__span-11-542"><a id="__codelineno-11-542" name="__codelineno-11-542" href="#__codelineno-11-542"></a>                <span class="n">details</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-11-543"><a id="__codelineno-11-543" name="__codelineno-11-543" href="#__codelineno-11-543"></a>                    <span class="s2">&quot;total_requests&quot;</span><span class="p">:</span> <span class="n">requests_count</span><span class="p">,</span>
</span><span id="__span-11-544"><a id="__codelineno-11-544" name="__codelineno-11-544" href="#__codelineno-11-544"></a>                    <span class="s2">&quot;rate_limited&quot;</span><span class="p">:</span> <span class="n">rate_limited_responses</span><span class="p">,</span>
</span><span id="__span-11-545"><a id="__codelineno-11-545" name="__codelineno-11-545" href="#__codelineno-11-545"></a>                    <span class="s2">&quot;successful&quot;</span><span class="p">:</span> <span class="n">successful_responses</span><span class="p">,</span>
</span><span id="__span-11-546"><a id="__codelineno-11-546" name="__codelineno-11-546" href="#__codelineno-11-546"></a>                    <span class="s2">&quot;total_time&quot;</span><span class="p">:</span> <span class="n">total_time</span><span class="p">,</span>
</span><span id="__span-11-547"><a id="__codelineno-11-547" name="__codelineno-11-547" href="#__codelineno-11-547"></a>                    <span class="s2">&quot;avg_response_time&quot;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">response_times</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">response_times</span><span class="p">)</span>
</span><span id="__span-11-548"><a id="__codelineno-11-548" name="__codelineno-11-548" href="#__codelineno-11-548"></a>                <span class="p">},</span>
</span><span id="__span-11-549"><a id="__codelineno-11-549" name="__codelineno-11-549" href="#__codelineno-11-549"></a>                <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Continue current rate limiting implementation&quot;</span>
</span><span id="__span-11-550"><a id="__codelineno-11-550" name="__codelineno-11-550" href="#__codelineno-11-550"></a>            <span class="p">)</span>
</span><span id="__span-11-551"><a id="__codelineno-11-551" name="__codelineno-11-551" href="#__codelineno-11-551"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-11-552"><a id="__codelineno-11-552" name="__codelineno-11-552" href="#__codelineno-11-552"></a>            <span class="k">return</span> <span class="n">SecurityTestResult</span><span class="p">(</span>
</span><span id="__span-11-553"><a id="__codelineno-11-553" name="__codelineno-11-553" href="#__codelineno-11-553"></a>                <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;Rate Limiting&quot;</span><span class="p">,</span>
</span><span id="__span-11-554"><a id="__codelineno-11-554" name="__codelineno-11-554" href="#__codelineno-11-554"></a>                <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span><span id="__span-11-555"><a id="__codelineno-11-555" name="__codelineno-11-555" href="#__codelineno-11-555"></a>                <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-556"><a id="__codelineno-11-556" name="__codelineno-11-556" href="#__codelineno-11-556"></a>                <span class="n">passed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-11-557"><a id="__codelineno-11-557" name="__codelineno-11-557" href="#__codelineno-11-557"></a>                <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;medium&quot;</span><span class="p">,</span>
</span><span id="__span-11-558"><a id="__codelineno-11-558" name="__codelineno-11-558" href="#__codelineno-11-558"></a>                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;No rate limiting detected&quot;</span><span class="p">,</span>
</span><span id="__span-11-559"><a id="__codelineno-11-559" name="__codelineno-11-559" href="#__codelineno-11-559"></a>                <span class="n">details</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-11-560"><a id="__codelineno-11-560" name="__codelineno-11-560" href="#__codelineno-11-560"></a>                    <span class="s2">&quot;total_requests&quot;</span><span class="p">:</span> <span class="n">requests_count</span><span class="p">,</span>
</span><span id="__span-11-561"><a id="__codelineno-11-561" name="__codelineno-11-561" href="#__codelineno-11-561"></a>                    <span class="s2">&quot;successful&quot;</span><span class="p">:</span> <span class="n">successful_responses</span><span class="p">,</span>
</span><span id="__span-11-562"><a id="__codelineno-11-562" name="__codelineno-11-562" href="#__codelineno-11-562"></a>                    <span class="s2">&quot;total_time&quot;</span><span class="p">:</span> <span class="n">total_time</span>
</span><span id="__span-11-563"><a id="__codelineno-11-563" name="__codelineno-11-563" href="#__codelineno-11-563"></a>                <span class="p">},</span>
</span><span id="__span-11-564"><a id="__codelineno-11-564" name="__codelineno-11-564" href="#__codelineno-11-564"></a>                <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Implement rate limiting to prevent abuse&quot;</span>
</span><span id="__span-11-565"><a id="__codelineno-11-565" name="__codelineno-11-565" href="#__codelineno-11-565"></a>            <span class="p">)</span>
</span><span id="__span-11-566"><a id="__codelineno-11-566" name="__codelineno-11-566" href="#__codelineno-11-566"></a>
</span><span id="__span-11-567"><a id="__codelineno-11-567" name="__codelineno-11-567" href="#__codelineno-11-567"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_cors_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="n">APIEndpoint</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SecurityTestResult</span><span class="p">:</span>
</span><span id="__span-11-568"><a id="__codelineno-11-568" name="__codelineno-11-568" href="#__codelineno-11-568"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test CORS configuration security&quot;&quot;&quot;</span>
</span><span id="__span-11-569"><a id="__codelineno-11-569" name="__codelineno-11-569" href="#__codelineno-11-569"></a>
</span><span id="__span-11-570"><a id="__codelineno-11-570" name="__codelineno-11-570" href="#__codelineno-11-570"></a>        <span class="n">cors_issues</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-11-571"><a id="__codelineno-11-571" name="__codelineno-11-571" href="#__codelineno-11-571"></a>
</span><span id="__span-11-572"><a id="__codelineno-11-572" name="__codelineno-11-572" href="#__codelineno-11-572"></a>        <span class="c1"># Test with malicious origin</span>
</span><span id="__span-11-573"><a id="__codelineno-11-573" name="__codelineno-11-573" href="#__codelineno-11-573"></a>        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Origin&#39;</span><span class="p">:</span> <span class="s1">&#39;https://evil.com&#39;</span><span class="p">}</span>
</span><span id="__span-11-574"><a id="__codelineno-11-574" name="__codelineno-11-574" href="#__codelineno-11-574"></a>
</span><span id="__span-11-575"><a id="__codelineno-11-575" name="__codelineno-11-575" href="#__codelineno-11-575"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-11-576"><a id="__codelineno-11-576" name="__codelineno-11-576" href="#__codelineno-11-576"></a>            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
</span><span id="__span-11-577"><a id="__codelineno-11-577" name="__codelineno-11-577" href="#__codelineno-11-577"></a>                <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-578"><a id="__codelineno-11-578" name="__codelineno-11-578" href="#__codelineno-11-578"></a>                <span class="n">url</span><span class="o">=</span><span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">),</span>
</span><span id="__span-11-579"><a id="__codelineno-11-579" name="__codelineno-11-579" href="#__codelineno-11-579"></a>                <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
</span><span id="__span-11-580"><a id="__codelineno-11-580" name="__codelineno-11-580" href="#__codelineno-11-580"></a>                <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span>
</span><span id="__span-11-581"><a id="__codelineno-11-581" name="__codelineno-11-581" href="#__codelineno-11-581"></a>            <span class="p">)</span>
</span><span id="__span-11-582"><a id="__codelineno-11-582" name="__codelineno-11-582" href="#__codelineno-11-582"></a>
</span><span id="__span-11-583"><a id="__codelineno-11-583" name="__codelineno-11-583" href="#__codelineno-11-583"></a>            <span class="n">cors_origin</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-11-584"><a id="__codelineno-11-584" name="__codelineno-11-584" href="#__codelineno-11-584"></a>            <span class="n">cors_credentials</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Credentials&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-11-585"><a id="__codelineno-11-585" name="__codelineno-11-585" href="#__codelineno-11-585"></a>
</span><span id="__span-11-586"><a id="__codelineno-11-586" name="__codelineno-11-586" href="#__codelineno-11-586"></a>            <span class="c1"># Check for overly permissive CORS</span>
</span><span id="__span-11-587"><a id="__codelineno-11-587" name="__codelineno-11-587" href="#__codelineno-11-587"></a>            <span class="k">if</span> <span class="n">cors_origin</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span> <span class="ow">and</span> <span class="n">cors_credentials</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="p">:</span>
</span><span id="__span-11-588"><a id="__codelineno-11-588" name="__codelineno-11-588" href="#__codelineno-11-588"></a>                <span class="n">cors_issues</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-11-589"><a id="__codelineno-11-589" name="__codelineno-11-589" href="#__codelineno-11-589"></a>                    <span class="s1">&#39;issue&#39;</span><span class="p">:</span> <span class="s1">&#39;Wildcard origin with credentials&#39;</span><span class="p">,</span>
</span><span id="__span-11-590"><a id="__codelineno-11-590" name="__codelineno-11-590" href="#__codelineno-11-590"></a>                    <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="s1">&#39;high&#39;</span>
</span><span id="__span-11-591"><a id="__codelineno-11-591" name="__codelineno-11-591" href="#__codelineno-11-591"></a>                <span class="p">})</span>
</span><span id="__span-11-592"><a id="__codelineno-11-592" name="__codelineno-11-592" href="#__codelineno-11-592"></a>
</span><span id="__span-11-593"><a id="__codelineno-11-593" name="__codelineno-11-593" href="#__codelineno-11-593"></a>            <span class="k">if</span> <span class="n">cors_origin</span> <span class="o">==</span> <span class="s1">&#39;https://evil.com&#39;</span><span class="p">:</span>
</span><span id="__span-11-594"><a id="__codelineno-11-594" name="__codelineno-11-594" href="#__codelineno-11-594"></a>                <span class="n">cors_issues</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-11-595"><a id="__codelineno-11-595" name="__codelineno-11-595" href="#__codelineno-11-595"></a>                    <span class="s1">&#39;issue&#39;</span><span class="p">:</span> <span class="s1">&#39;Malicious origin accepted&#39;</span><span class="p">,</span>
</span><span id="__span-11-596"><a id="__codelineno-11-596" name="__codelineno-11-596" href="#__codelineno-11-596"></a>                    <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="s1">&#39;high&#39;</span>
</span><span id="__span-11-597"><a id="__codelineno-11-597" name="__codelineno-11-597" href="#__codelineno-11-597"></a>                <span class="p">})</span>
</span><span id="__span-11-598"><a id="__codelineno-11-598" name="__codelineno-11-598" href="#__codelineno-11-598"></a>
</span><span id="__span-11-599"><a id="__codelineno-11-599" name="__codelineno-11-599" href="#__codelineno-11-599"></a>            <span class="c1"># Test preflight request</span>
</span><span id="__span-11-600"><a id="__codelineno-11-600" name="__codelineno-11-600" href="#__codelineno-11-600"></a>            <span class="n">preflight_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
</span><span id="__span-11-601"><a id="__codelineno-11-601" name="__codelineno-11-601" href="#__codelineno-11-601"></a>                <span class="n">url</span><span class="o">=</span><span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">),</span>
</span><span id="__span-11-602"><a id="__codelineno-11-602" name="__codelineno-11-602" href="#__codelineno-11-602"></a>                <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-11-603"><a id="__codelineno-11-603" name="__codelineno-11-603" href="#__codelineno-11-603"></a>                    <span class="s1">&#39;Origin&#39;</span><span class="p">:</span> <span class="s1">&#39;https://evil.com&#39;</span><span class="p">,</span>
</span><span id="__span-11-604"><a id="__codelineno-11-604" name="__codelineno-11-604" href="#__codelineno-11-604"></a>                    <span class="s1">&#39;Access-Control-Request-Method&#39;</span><span class="p">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span><span id="__span-11-605"><a id="__codelineno-11-605" name="__codelineno-11-605" href="#__codelineno-11-605"></a>                    <span class="s1">&#39;Access-Control-Request-Headers&#39;</span><span class="p">:</span> <span class="s1">&#39;Content-Type&#39;</span>
</span><span id="__span-11-606"><a id="__codelineno-11-606" name="__codelineno-11-606" href="#__codelineno-11-606"></a>                <span class="p">},</span>
</span><span id="__span-11-607"><a id="__codelineno-11-607" name="__codelineno-11-607" href="#__codelineno-11-607"></a>                <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span>
</span><span id="__span-11-608"><a id="__codelineno-11-608" name="__codelineno-11-608" href="#__codelineno-11-608"></a>            <span class="p">)</span>
</span><span id="__span-11-609"><a id="__codelineno-11-609" name="__codelineno-11-609" href="#__codelineno-11-609"></a>
</span><span id="__span-11-610"><a id="__codelineno-11-610" name="__codelineno-11-610" href="#__codelineno-11-610"></a>            <span class="k">if</span> <span class="n">preflight_response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="__span-11-611"><a id="__codelineno-11-611" name="__codelineno-11-611" href="#__codelineno-11-611"></a>                <span class="n">allowed_methods</span> <span class="o">=</span> <span class="n">preflight_response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Methods&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-11-612"><a id="__codelineno-11-612" name="__codelineno-11-612" href="#__codelineno-11-612"></a>                <span class="k">if</span> <span class="s1">&#39;DELETE&#39;</span> <span class="ow">in</span> <span class="n">allowed_methods</span> <span class="ow">or</span> <span class="s1">&#39;PUT&#39;</span> <span class="ow">in</span> <span class="n">allowed_methods</span><span class="p">:</span>
</span><span id="__span-11-613"><a id="__codelineno-11-613" name="__codelineno-11-613" href="#__codelineno-11-613"></a>                    <span class="n">cors_issues</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-11-614"><a id="__codelineno-11-614" name="__codelineno-11-614" href="#__codelineno-11-614"></a>                        <span class="s1">&#39;issue&#39;</span><span class="p">:</span> <span class="s1">&#39;Dangerous methods allowed in CORS&#39;</span><span class="p">,</span>
</span><span id="__span-11-615"><a id="__codelineno-11-615" name="__codelineno-11-615" href="#__codelineno-11-615"></a>                        <span class="s1">&#39;methods&#39;</span><span class="p">:</span> <span class="n">allowed_methods</span><span class="p">,</span>
</span><span id="__span-11-616"><a id="__codelineno-11-616" name="__codelineno-11-616" href="#__codelineno-11-616"></a>                        <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="s1">&#39;medium&#39;</span>
</span><span id="__span-11-617"><a id="__codelineno-11-617" name="__codelineno-11-617" href="#__codelineno-11-617"></a>                    <span class="p">})</span>
</span><span id="__span-11-618"><a id="__codelineno-11-618" name="__codelineno-11-618" href="#__codelineno-11-618"></a>
</span><span id="__span-11-619"><a id="__codelineno-11-619" name="__codelineno-11-619" href="#__codelineno-11-619"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-11-620"><a id="__codelineno-11-620" name="__codelineno-11-620" href="#__codelineno-11-620"></a>            <span class="n">cors_issues</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-11-621"><a id="__codelineno-11-621" name="__codelineno-11-621" href="#__codelineno-11-621"></a>                <span class="s1">&#39;issue&#39;</span><span class="p">:</span> <span class="s1">&#39;Error testing CORS&#39;</span><span class="p">,</span>
</span><span id="__span-11-622"><a id="__codelineno-11-622" name="__codelineno-11-622" href="#__codelineno-11-622"></a>                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="__span-11-623"><a id="__codelineno-11-623" name="__codelineno-11-623" href="#__codelineno-11-623"></a>                <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="s1">&#39;low&#39;</span>
</span><span id="__span-11-624"><a id="__codelineno-11-624" name="__codelineno-11-624" href="#__codelineno-11-624"></a>            <span class="p">})</span>
</span><span id="__span-11-625"><a id="__codelineno-11-625" name="__codelineno-11-625" href="#__codelineno-11-625"></a>
</span><span id="__span-11-626"><a id="__codelineno-11-626" name="__codelineno-11-626" href="#__codelineno-11-626"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">cors_issues</span><span class="p">:</span>
</span><span id="__span-11-627"><a id="__codelineno-11-627" name="__codelineno-11-627" href="#__codelineno-11-627"></a>            <span class="k">return</span> <span class="n">SecurityTestResult</span><span class="p">(</span>
</span><span id="__span-11-628"><a id="__codelineno-11-628" name="__codelineno-11-628" href="#__codelineno-11-628"></a>                <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;CORS Configuration&quot;</span><span class="p">,</span>
</span><span id="__span-11-629"><a id="__codelineno-11-629" name="__codelineno-11-629" href="#__codelineno-11-629"></a>                <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span><span id="__span-11-630"><a id="__codelineno-11-630" name="__codelineno-11-630" href="#__codelineno-11-630"></a>                <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-631"><a id="__codelineno-11-631" name="__codelineno-11-631" href="#__codelineno-11-631"></a>                <span class="n">passed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-11-632"><a id="__codelineno-11-632" name="__codelineno-11-632" href="#__codelineno-11-632"></a>                <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;medium&quot;</span><span class="p">,</span>
</span><span id="__span-11-633"><a id="__codelineno-11-633" name="__codelineno-11-633" href="#__codelineno-11-633"></a>                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;CORS configuration appears secure&quot;</span><span class="p">,</span>
</span><span id="__span-11-634"><a id="__codelineno-11-634" name="__codelineno-11-634" href="#__codelineno-11-634"></a>                <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cors_headers&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">)},</span>
</span><span id="__span-11-635"><a id="__codelineno-11-635" name="__codelineno-11-635" href="#__codelineno-11-635"></a>                <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Continue current CORS policy&quot;</span>
</span><span id="__span-11-636"><a id="__codelineno-11-636" name="__codelineno-11-636" href="#__codelineno-11-636"></a>            <span class="p">)</span>
</span><span id="__span-11-637"><a id="__codelineno-11-637" name="__codelineno-11-637" href="#__codelineno-11-637"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-11-638"><a id="__codelineno-11-638" name="__codelineno-11-638" href="#__codelineno-11-638"></a>            <span class="k">return</span> <span class="n">SecurityTestResult</span><span class="p">(</span>
</span><span id="__span-11-639"><a id="__codelineno-11-639" name="__codelineno-11-639" href="#__codelineno-11-639"></a>                <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;CORS Configuration&quot;</span><span class="p">,</span>
</span><span id="__span-11-640"><a id="__codelineno-11-640" name="__codelineno-11-640" href="#__codelineno-11-640"></a>                <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span><span id="__span-11-641"><a id="__codelineno-11-641" name="__codelineno-11-641" href="#__codelineno-11-641"></a>                <span class="n">method</span><span class="o">=</span><span class="n">endpoint</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="__span-11-642"><a id="__codelineno-11-642" name="__codelineno-11-642" href="#__codelineno-11-642"></a>                <span class="n">passed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-11-643"><a id="__codelineno-11-643" name="__codelineno-11-643" href="#__codelineno-11-643"></a>                <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;medium&quot;</span><span class="p">,</span>
</span><span id="__span-11-644"><a id="__codelineno-11-644" name="__codelineno-11-644" href="#__codelineno-11-644"></a>                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;CORS configuration issues detected&quot;</span><span class="p">,</span>
</span><span id="__span-11-645"><a id="__codelineno-11-645" name="__codelineno-11-645" href="#__codelineno-11-645"></a>                <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;issues&quot;</span><span class="p">:</span> <span class="n">cors_issues</span><span class="p">},</span>
</span><span id="__span-11-646"><a id="__codelineno-11-646" name="__codelineno-11-646" href="#__codelineno-11-646"></a>                <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Review and tighten CORS policy&quot;</span>
</span><span id="__span-11-647"><a id="__codelineno-11-647" name="__codelineno-11-647" href="#__codelineno-11-647"></a>            <span class="p">)</span>
</span><span id="__span-11-648"><a id="__codelineno-11-648" name="__codelineno-11-648" href="#__codelineno-11-648"></a>
</span><span id="__span-11-649"><a id="__codelineno-11-649" name="__codelineno-11-649" href="#__codelineno-11-649"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_security_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="__span-11-650"><a id="__codelineno-11-650" name="__codelineno-11-650" href="#__codelineno-11-650"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate comprehensive security test report&quot;&quot;&quot;</span>
</span><span id="__span-11-651"><a id="__codelineno-11-651" name="__codelineno-11-651" href="#__codelineno-11-651"></a>
</span><span id="__span-11-652"><a id="__codelineno-11-652" name="__codelineno-11-652" href="#__codelineno-11-652"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
</span><span id="__span-11-653"><a id="__codelineno-11-653" name="__codelineno-11-653" href="#__codelineno-11-653"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;No test results available&quot;</span><span class="p">}</span>
</span><span id="__span-11-654"><a id="__codelineno-11-654" name="__codelineno-11-654" href="#__codelineno-11-654"></a>
</span><span id="__span-11-655"><a id="__codelineno-11-655" name="__codelineno-11-655" href="#__codelineno-11-655"></a>        <span class="c1"># Categorize results</span>
</span><span id="__span-11-656"><a id="__codelineno-11-656" name="__codelineno-11-656" href="#__codelineno-11-656"></a>        <span class="n">passed_tests</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">passed</span><span class="p">]</span>
</span><span id="__span-11-657"><a id="__codelineno-11-657" name="__codelineno-11-657" href="#__codelineno-11-657"></a>        <span class="n">failed_tests</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="o">.</span><span class="n">passed</span><span class="p">]</span>
</span><span id="__span-11-658"><a id="__codelineno-11-658" name="__codelineno-11-658" href="#__codelineno-11-658"></a>
</span><span id="__span-11-659"><a id="__codelineno-11-659" name="__codelineno-11-659" href="#__codelineno-11-659"></a>        <span class="c1"># Count by severity</span>
</span><span id="__span-11-660"><a id="__codelineno-11-660" name="__codelineno-11-660" href="#__codelineno-11-660"></a>        <span class="n">severity_counts</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-11-661"><a id="__codelineno-11-661" name="__codelineno-11-661" href="#__codelineno-11-661"></a>            <span class="s1">&#39;critical&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">failed_tests</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">severity</span> <span class="o">==</span> <span class="s1">&#39;critical&#39;</span><span class="p">]),</span>
</span><span id="__span-11-662"><a id="__codelineno-11-662" name="__codelineno-11-662" href="#__codelineno-11-662"></a>            <span class="s1">&#39;high&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">failed_tests</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">severity</span> <span class="o">==</span> <span class="s1">&#39;high&#39;</span><span class="p">]),</span>
</span><span id="__span-11-663"><a id="__codelineno-11-663" name="__codelineno-11-663" href="#__codelineno-11-663"></a>            <span class="s1">&#39;medium&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">failed_tests</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">severity</span> <span class="o">==</span> <span class="s1">&#39;medium&#39;</span><span class="p">]),</span>
</span><span id="__span-11-664"><a id="__codelineno-11-664" name="__codelineno-11-664" href="#__codelineno-11-664"></a>            <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">failed_tests</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">severity</span> <span class="o">==</span> <span class="s1">&#39;low&#39;</span><span class="p">])</span>
</span><span id="__span-11-665"><a id="__codelineno-11-665" name="__codelineno-11-665" href="#__codelineno-11-665"></a>        <span class="p">}</span>
</span><span id="__span-11-666"><a id="__codelineno-11-666" name="__codelineno-11-666" href="#__codelineno-11-666"></a>
</span><span id="__span-11-667"><a id="__codelineno-11-667" name="__codelineno-11-667" href="#__codelineno-11-667"></a>        <span class="c1"># Calculate security score</span>
</span><span id="__span-11-668"><a id="__codelineno-11-668" name="__codelineno-11-668" href="#__codelineno-11-668"></a>        <span class="n">total_tests</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">)</span>
</span><span id="__span-11-669"><a id="__codelineno-11-669" name="__codelineno-11-669" href="#__codelineno-11-669"></a>        <span class="n">security_score</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">passed_tests</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_tests</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">if</span> <span class="n">total_tests</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="__span-11-670"><a id="__codelineno-11-670" name="__codelineno-11-670" href="#__codelineno-11-670"></a>
</span><span id="__span-11-671"><a id="__codelineno-11-671" name="__codelineno-11-671" href="#__codelineno-11-671"></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-11-672"><a id="__codelineno-11-672" name="__codelineno-11-672" href="#__codelineno-11-672"></a>            <span class="s1">&#39;summary&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-11-673"><a id="__codelineno-11-673" name="__codelineno-11-673" href="#__codelineno-11-673"></a>                <span class="s1">&#39;total_tests&#39;</span><span class="p">:</span> <span class="n">total_tests</span><span class="p">,</span>
</span><span id="__span-11-674"><a id="__codelineno-11-674" name="__codelineno-11-674" href="#__codelineno-11-674"></a>                <span class="s1">&#39;passed&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">passed_tests</span><span class="p">),</span>
</span><span id="__span-11-675"><a id="__codelineno-11-675" name="__codelineno-11-675" href="#__codelineno-11-675"></a>                <span class="s1">&#39;failed&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">failed_tests</span><span class="p">),</span>
</span><span id="__span-11-676"><a id="__codelineno-11-676" name="__codelineno-11-676" href="#__codelineno-11-676"></a>                <span class="s1">&#39;security_score&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">security_score</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="__span-11-677"><a id="__codelineno-11-677" name="__codelineno-11-677" href="#__codelineno-11-677"></a>            <span class="p">},</span>
</span><span id="__span-11-678"><a id="__codelineno-11-678" name="__codelineno-11-678" href="#__codelineno-11-678"></a>            <span class="s1">&#39;severity_breakdown&#39;</span><span class="p">:</span> <span class="n">severity_counts</span><span class="p">,</span>
</span><span id="__span-11-679"><a id="__codelineno-11-679" name="__codelineno-11-679" href="#__codelineno-11-679"></a>            <span class="s1">&#39;failed_tests&#39;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-11-680"><a id="__codelineno-11-680" name="__codelineno-11-680" href="#__codelineno-11-680"></a>                <span class="p">{</span>
</span><span id="__span-11-681"><a id="__codelineno-11-681" name="__codelineno-11-681" href="#__codelineno-11-681"></a>                    <span class="s1">&#39;test&#39;</span><span class="p">:</span> <span class="n">test</span><span class="o">.</span><span class="n">test_name</span><span class="p">,</span>
</span><span id="__span-11-682"><a id="__codelineno-11-682" name="__codelineno-11-682" href="#__codelineno-11-682"></a>                    <span class="s1">&#39;endpoint&#39;</span><span class="p">:</span> <span class="n">test</span><span class="o">.</span><span class="n">endpoint</span><span class="p">,</span>
</span><span id="__span-11-683"><a id="__codelineno-11-683" name="__codelineno-11-683" href="#__codelineno-11-683"></a>                    <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="n">test</span><span class="o">.</span><span class="n">severity</span><span class="p">,</span>
</span><span id="__span-11-684"><a id="__codelineno-11-684" name="__codelineno-11-684" href="#__codelineno-11-684"></a>                    <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">test</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
</span><span id="__span-11-685"><a id="__codelineno-11-685" name="__codelineno-11-685" href="#__codelineno-11-685"></a>                    <span class="s1">&#39;remediation&#39;</span><span class="p">:</span> <span class="n">test</span><span class="o">.</span><span class="n">remediation</span>
</span><span id="__span-11-686"><a id="__codelineno-11-686" name="__codelineno-11-686" href="#__codelineno-11-686"></a>                <span class="p">}</span>
</span><span id="__span-11-687"><a id="__codelineno-11-687" name="__codelineno-11-687" href="#__codelineno-11-687"></a>                <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">failed_tests</span>
</span><span id="__span-11-688"><a id="__codelineno-11-688" name="__codelineno-11-688" href="#__codelineno-11-688"></a>            <span class="p">],</span>
</span><span id="__span-11-689"><a id="__codelineno-11-689" name="__codelineno-11-689" href="#__codelineno-11-689"></a>            <span class="s1">&#39;recommendations&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_recommendations</span><span class="p">(</span><span class="n">failed_tests</span><span class="p">)</span>
</span><span id="__span-11-690"><a id="__codelineno-11-690" name="__codelineno-11-690" href="#__codelineno-11-690"></a>        <span class="p">}</span>
</span><span id="__span-11-691"><a id="__codelineno-11-691" name="__codelineno-11-691" href="#__codelineno-11-691"></a>
</span><span id="__span-11-692"><a id="__codelineno-11-692" name="__codelineno-11-692" href="#__codelineno-11-692"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_recommendations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">failed_tests</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">SecurityTestResult</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="__span-11-693"><a id="__codelineno-11-693" name="__codelineno-11-693" href="#__codelineno-11-693"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate security recommendations based on test results&quot;&quot;&quot;</span>
</span><span id="__span-11-694"><a id="__codelineno-11-694" name="__codelineno-11-694" href="#__codelineno-11-694"></a>
</span><span id="__span-11-695"><a id="__codelineno-11-695" name="__codelineno-11-695" href="#__codelineno-11-695"></a>        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-11-696"><a id="__codelineno-11-696" name="__codelineno-11-696" href="#__codelineno-11-696"></a>
</span><span id="__span-11-697"><a id="__codelineno-11-697" name="__codelineno-11-697" href="#__codelineno-11-697"></a>        <span class="c1"># Check for critical issues</span>
</span><span id="__span-11-698"><a id="__codelineno-11-698" name="__codelineno-11-698" href="#__codelineno-11-698"></a>        <span class="n">critical_tests</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">failed_tests</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">severity</span> <span class="o">==</span> <span class="s1">&#39;critical&#39;</span><span class="p">]</span>
</span><span id="__span-11-699"><a id="__codelineno-11-699" name="__codelineno-11-699" href="#__codelineno-11-699"></a>        <span class="k">if</span> <span class="n">critical_tests</span><span class="p">:</span>
</span><span id="__span-11-700"><a id="__codelineno-11-700" name="__codelineno-11-700" href="#__codelineno-11-700"></a>            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="__span-11-701"><a id="__codelineno-11-701" name="__codelineno-11-701" href="#__codelineno-11-701"></a>                <span class="s2">&quot;CRITICAL: Address SQL injection vulnerabilities immediately using parameterized queries&quot;</span>
</span><span id="__span-11-702"><a id="__codelineno-11-702" name="__codelineno-11-702" href="#__codelineno-11-702"></a>            <span class="p">)</span>
</span><span id="__span-11-703"><a id="__codelineno-11-703" name="__codelineno-11-703" href="#__codelineno-11-703"></a>
</span><span id="__span-11-704"><a id="__codelineno-11-704" name="__codelineno-11-704" href="#__codelineno-11-704"></a>        <span class="c1"># Check for authentication issues</span>
</span><span id="__span-11-705"><a id="__codelineno-11-705" name="__codelineno-11-705" href="#__codelineno-11-705"></a>        <span class="n">auth_tests</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">failed_tests</span> <span class="k">if</span> <span class="s1">&#39;authentication&#39;</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">test_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
</span><span id="__span-11-706"><a id="__codelineno-11-706" name="__codelineno-11-706" href="#__codelineno-11-706"></a>        <span class="k">if</span> <span class="n">auth_tests</span><span class="p">:</span>
</span><span id="__span-11-707"><a id="__codelineno-11-707" name="__codelineno-11-707" href="#__codelineno-11-707"></a>            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="__span-11-708"><a id="__codelineno-11-708" name="__codelineno-11-708" href="#__codelineno-11-708"></a>                <span class="s2">&quot;Strengthen authentication mechanisms and token validation&quot;</span>
</span><span id="__span-11-709"><a id="__codelineno-11-709" name="__codelineno-11-709" href="#__codelineno-11-709"></a>            <span class="p">)</span>
</span><span id="__span-11-710"><a id="__codelineno-11-710" name="__codelineno-11-710" href="#__codelineno-11-710"></a>
</span><span id="__span-11-711"><a id="__codelineno-11-711" name="__codelineno-11-711" href="#__codelineno-11-711"></a>        <span class="c1"># Check for injection issues</span>
</span><span id="__span-11-712"><a id="__codelineno-11-712" name="__codelineno-11-712" href="#__codelineno-11-712"></a>        <span class="n">injection_tests</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">failed_tests</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
</span><span id="__span-11-713"><a id="__codelineno-11-713" name="__codelineno-11-713" href="#__codelineno-11-713"></a>            <span class="n">word</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">test_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;injection&#39;</span><span class="p">,</span> <span class="s1">&#39;xss&#39;</span><span class="p">,</span> <span class="s1">&#39;traversal&#39;</span><span class="p">]</span>
</span><span id="__span-11-714"><a id="__codelineno-11-714" name="__codelineno-11-714" href="#__codelineno-11-714"></a>        <span class="p">)]</span>
</span><span id="__span-11-715"><a id="__codelineno-11-715" name="__codelineno-11-715" href="#__codelineno-11-715"></a>        <span class="k">if</span> <span class="n">injection_tests</span><span class="p">:</span>
</span><span id="__span-11-716"><a id="__codelineno-11-716" name="__codelineno-11-716" href="#__codelineno-11-716"></a>            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="__span-11-717"><a id="__codelineno-11-717" name="__codelineno-11-717" href="#__codelineno-11-717"></a>                <span class="s2">&quot;Implement comprehensive input validation and output encoding&quot;</span>
</span><span id="__span-11-718"><a id="__codelineno-11-718" name="__codelineno-11-718" href="#__codelineno-11-718"></a>            <span class="p">)</span>
</span><span id="__span-11-719"><a id="__codelineno-11-719" name="__codelineno-11-719" href="#__codelineno-11-719"></a>
</span><span id="__span-11-720"><a id="__codelineno-11-720" name="__codelineno-11-720" href="#__codelineno-11-720"></a>        <span class="c1"># Check for CORS issues</span>
</span><span id="__span-11-721"><a id="__codelineno-11-721" name="__codelineno-11-721" href="#__codelineno-11-721"></a>        <span class="n">cors_tests</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">failed_tests</span> <span class="k">if</span> <span class="s1">&#39;cors&#39;</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">test_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
</span><span id="__span-11-722"><a id="__codelineno-11-722" name="__codelineno-11-722" href="#__codelineno-11-722"></a>        <span class="k">if</span> <span class="n">cors_tests</span><span class="p">:</span>
</span><span id="__span-11-723"><a id="__codelineno-11-723" name="__codelineno-11-723" href="#__codelineno-11-723"></a>            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="__span-11-724"><a id="__codelineno-11-724" name="__codelineno-11-724" href="#__codelineno-11-724"></a>                <span class="s2">&quot;Review and tighten CORS policies to prevent cross-origin attacks&quot;</span>
</span><span id="__span-11-725"><a id="__codelineno-11-725" name="__codelineno-11-725" href="#__codelineno-11-725"></a>            <span class="p">)</span>
</span><span id="__span-11-726"><a id="__codelineno-11-726" name="__codelineno-11-726" href="#__codelineno-11-726"></a>
</span><span id="__span-11-727"><a id="__codelineno-11-727" name="__codelineno-11-727" href="#__codelineno-11-727"></a>        <span class="k">return</span> <span class="n">recommendations</span>
</span><span id="__span-11-728"><a id="__codelineno-11-728" name="__codelineno-11-728" href="#__codelineno-11-728"></a>
</span><span id="__span-11-729"><a id="__codelineno-11-729" name="__codelineno-11-729" href="#__codelineno-11-729"></a><span class="k">def</span><span class="w"> </span><span class="nf">security_testing_example</span><span class="p">():</span>
</span><span id="__span-11-730"><a id="__codelineno-11-730" name="__codelineno-11-730" href="#__codelineno-11-730"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate API security testing&quot;&quot;&quot;</span>
</span><span id="__span-11-731"><a id="__codelineno-11-731" name="__codelineno-11-731" href="#__codelineno-11-731"></a>
</span><span id="__span-11-732"><a id="__codelineno-11-732" name="__codelineno-11-732" href="#__codelineno-11-732"></a>    <span class="c1"># Initialize security tester</span>
</span><span id="__span-11-733"><a id="__codelineno-11-733" name="__codelineno-11-733" href="#__codelineno-11-733"></a>    <span class="n">tester</span> <span class="o">=</span> <span class="n">APISecurityTester</span><span class="p">(</span><span class="s2">&quot;https://api.example.com&quot;</span><span class="p">)</span>
</span><span id="__span-11-734"><a id="__codelineno-11-734" name="__codelineno-11-734" href="#__codelineno-11-734"></a>
</span><span id="__span-11-735"><a id="__codelineno-11-735" name="__codelineno-11-735" href="#__codelineno-11-735"></a>    <span class="c1"># Define test endpoints</span>
</span><span id="__span-11-736"><a id="__codelineno-11-736" name="__codelineno-11-736" href="#__codelineno-11-736"></a>    <span class="n">test_endpoints</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-11-737"><a id="__codelineno-11-737" name="__codelineno-11-737" href="#__codelineno-11-737"></a>        <span class="n">APIEndpoint</span><span class="p">(</span>
</span><span id="__span-11-738"><a id="__codelineno-11-738" name="__codelineno-11-738" href="#__codelineno-11-738"></a>            <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/api/users&quot;</span><span class="p">,</span>
</span><span id="__span-11-739"><a id="__codelineno-11-739" name="__codelineno-11-739" href="#__codelineno-11-739"></a>            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
</span><span id="__span-11-740"><a id="__codelineno-11-740" name="__codelineno-11-740" href="#__codelineno-11-740"></a>            <span class="n">auth_required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-11-741"><a id="__codelineno-11-741" name="__codelineno-11-741" href="#__codelineno-11-741"></a>            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;page&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="s2">&quot;10&quot;</span><span class="p">},</span>
</span><span id="__span-11-742"><a id="__codelineno-11-742" name="__codelineno-11-742" href="#__codelineno-11-742"></a>            <span class="n">expected_status</span><span class="o">=</span><span class="mi">200</span>
</span><span id="__span-11-743"><a id="__codelineno-11-743" name="__codelineno-11-743" href="#__codelineno-11-743"></a>        <span class="p">),</span>
</span><span id="__span-11-744"><a id="__codelineno-11-744" name="__codelineno-11-744" href="#__codelineno-11-744"></a>        <span class="n">APIEndpoint</span><span class="p">(</span>
</span><span id="__span-11-745"><a id="__codelineno-11-745" name="__codelineno-11-745" href="#__codelineno-11-745"></a>            <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/api/users&quot;</span><span class="p">,</span>
</span><span id="__span-11-746"><a id="__codelineno-11-746" name="__codelineno-11-746" href="#__codelineno-11-746"></a>            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
</span><span id="__span-11-747"><a id="__codelineno-11-747" name="__codelineno-11-747" href="#__codelineno-11-747"></a>            <span class="n">auth_required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-11-748"><a id="__codelineno-11-748" name="__codelineno-11-748" href="#__codelineno-11-748"></a>            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;test@example.com&quot;</span><span class="p">},</span>
</span><span id="__span-11-749"><a id="__codelineno-11-749" name="__codelineno-11-749" href="#__codelineno-11-749"></a>            <span class="n">expected_status</span><span class="o">=</span><span class="mi">201</span>
</span><span id="__span-11-750"><a id="__codelineno-11-750" name="__codelineno-11-750" href="#__codelineno-11-750"></a>        <span class="p">),</span>
</span><span id="__span-11-751"><a id="__codelineno-11-751" name="__codelineno-11-751" href="#__codelineno-11-751"></a>        <span class="n">APIEndpoint</span><span class="p">(</span>
</span><span id="__span-11-752"><a id="__codelineno-11-752" name="__codelineno-11-752" href="#__codelineno-11-752"></a>            <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/api/files&quot;</span><span class="p">,</span>
</span><span id="__span-11-753"><a id="__codelineno-11-753" name="__codelineno-11-753" href="#__codelineno-11-753"></a>            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
</span><span id="__span-11-754"><a id="__codelineno-11-754" name="__codelineno-11-754" href="#__codelineno-11-754"></a>            <span class="n">auth_required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-11-755"><a id="__codelineno-11-755" name="__codelineno-11-755" href="#__codelineno-11-755"></a>            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;document.pdf&quot;</span><span class="p">},</span>
</span><span id="__span-11-756"><a id="__codelineno-11-756" name="__codelineno-11-756" href="#__codelineno-11-756"></a>            <span class="n">expected_status</span><span class="o">=</span><span class="mi">200</span>
</span><span id="__span-11-757"><a id="__codelineno-11-757" name="__codelineno-11-757" href="#__codelineno-11-757"></a>        <span class="p">)</span>
</span><span id="__span-11-758"><a id="__codelineno-11-758" name="__codelineno-11-758" href="#__codelineno-11-758"></a>    <span class="p">]</span>
</span><span id="__span-11-759"><a id="__codelineno-11-759" name="__codelineno-11-759" href="#__codelineno-11-759"></a>
</span><span id="__span-11-760"><a id="__codelineno-11-760" name="__codelineno-11-760" href="#__codelineno-11-760"></a>    <span class="c1"># Authenticate (if needed)</span>
</span><span id="__span-11-761"><a id="__codelineno-11-761" name="__codelineno-11-761" href="#__codelineno-11-761"></a>    <span class="k">if</span> <span class="n">tester</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="s2">&quot;testuser&quot;</span><span class="p">,</span> <span class="s2">&quot;testpass&quot;</span><span class="p">):</span>
</span><span id="__span-11-762"><a id="__codelineno-11-762" name="__codelineno-11-762" href="#__codelineno-11-762"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Authentication successful&quot;</span><span class="p">)</span>
</span><span id="__span-11-763"><a id="__codelineno-11-763" name="__codelineno-11-763" href="#__codelineno-11-763"></a>
</span><span id="__span-11-764"><a id="__codelineno-11-764" name="__codelineno-11-764" href="#__codelineno-11-764"></a>    <span class="c1"># Run security tests</span>
</span><span id="__span-11-765"><a id="__codelineno-11-765" name="__codelineno-11-765" href="#__codelineno-11-765"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running authentication tests...&quot;</span><span class="p">)</span>
</span><span id="__span-11-766"><a id="__codelineno-11-766" name="__codelineno-11-766" href="#__codelineno-11-766"></a>    <span class="n">auth_results</span> <span class="o">=</span> <span class="n">tester</span><span class="o">.</span><span class="n">test_authentication_vulnerabilities</span><span class="p">(</span><span class="n">test_endpoints</span><span class="p">)</span>
</span><span id="__span-11-767"><a id="__codelineno-11-767" name="__codelineno-11-767" href="#__codelineno-11-767"></a>    <span class="n">tester</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">auth_results</span><span class="p">)</span>
</span><span id="__span-11-768"><a id="__codelineno-11-768" name="__codelineno-11-768" href="#__codelineno-11-768"></a>
</span><span id="__span-11-769"><a id="__codelineno-11-769" name="__codelineno-11-769" href="#__codelineno-11-769"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running injection tests...&quot;</span><span class="p">)</span>
</span><span id="__span-11-770"><a id="__codelineno-11-770" name="__codelineno-11-770" href="#__codelineno-11-770"></a>    <span class="n">injection_results</span> <span class="o">=</span> <span class="n">tester</span><span class="o">.</span><span class="n">test_injection_vulnerabilities</span><span class="p">(</span><span class="n">test_endpoints</span><span class="p">)</span>
</span><span id="__span-11-771"><a id="__codelineno-11-771" name="__codelineno-11-771" href="#__codelineno-11-771"></a>    <span class="n">tester</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">injection_results</span><span class="p">)</span>
</span><span id="__span-11-772"><a id="__codelineno-11-772" name="__codelineno-11-772" href="#__codelineno-11-772"></a>
</span><span id="__span-11-773"><a id="__codelineno-11-773" name="__codelineno-11-773" href="#__codelineno-11-773"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running rate limiting tests...&quot;</span><span class="p">)</span>
</span><span id="__span-11-774"><a id="__codelineno-11-774" name="__codelineno-11-774" href="#__codelineno-11-774"></a>    <span class="k">for</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="n">test_endpoints</span><span class="p">:</span>
</span><span id="__span-11-775"><a id="__codelineno-11-775" name="__codelineno-11-775" href="#__codelineno-11-775"></a>        <span class="n">rate_result</span> <span class="o">=</span> <span class="n">tester</span><span class="o">.</span><span class="n">test_rate_limiting</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
</span><span id="__span-11-776"><a id="__codelineno-11-776" name="__codelineno-11-776" href="#__codelineno-11-776"></a>        <span class="n">tester</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rate_result</span><span class="p">)</span>
</span><span id="__span-11-777"><a id="__codelineno-11-777" name="__codelineno-11-777" href="#__codelineno-11-777"></a>
</span><span id="__span-11-778"><a id="__codelineno-11-778" name="__codelineno-11-778" href="#__codelineno-11-778"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running CORS tests...&quot;</span><span class="p">)</span>
</span><span id="__span-11-779"><a id="__codelineno-11-779" name="__codelineno-11-779" href="#__codelineno-11-779"></a>    <span class="k">for</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="n">test_endpoints</span><span class="p">:</span>
</span><span id="__span-11-780"><a id="__codelineno-11-780" name="__codelineno-11-780" href="#__codelineno-11-780"></a>        <span class="n">cors_result</span> <span class="o">=</span> <span class="n">tester</span><span class="o">.</span><span class="n">test_cors_configuration</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
</span><span id="__span-11-781"><a id="__codelineno-11-781" name="__codelineno-11-781" href="#__codelineno-11-781"></a>        <span class="n">tester</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cors_result</span><span class="p">)</span>
</span><span id="__span-11-782"><a id="__codelineno-11-782" name="__codelineno-11-782" href="#__codelineno-11-782"></a>
</span><span id="__span-11-783"><a id="__codelineno-11-783" name="__codelineno-11-783" href="#__codelineno-11-783"></a>    <span class="c1"># Generate report</span>
</span><span id="__span-11-784"><a id="__codelineno-11-784" name="__codelineno-11-784" href="#__codelineno-11-784"></a>    <span class="n">report</span> <span class="o">=</span> <span class="n">tester</span><span class="o">.</span><span class="n">generate_security_report</span><span class="p">()</span>
</span><span id="__span-11-785"><a id="__codelineno-11-785" name="__codelineno-11-785" href="#__codelineno-11-785"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Security Test Report:&quot;</span><span class="p">)</span>
</span><span id="__span-11-786"><a id="__codelineno-11-786" name="__codelineno-11-786" href="#__codelineno-11-786"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Security Score: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;security_score&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
</span><span id="__span-11-787"><a id="__codelineno-11-787" name="__codelineno-11-787" href="#__codelineno-11-787"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tests Passed: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;passed&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;total_tests&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-11-788"><a id="__codelineno-11-788" name="__codelineno-11-788" href="#__codelineno-11-788"></a>
</span><span id="__span-11-789"><a id="__codelineno-11-789" name="__codelineno-11-789" href="#__codelineno-11-789"></a>    <span class="k">if</span> <span class="n">report</span><span class="p">[</span><span class="s1">&#39;failed_tests&#39;</span><span class="p">]:</span>
</span><span id="__span-11-790"><a id="__codelineno-11-790" name="__codelineno-11-790" href="#__codelineno-11-790"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Failed Tests:&quot;</span><span class="p">)</span>
</span><span id="__span-11-791"><a id="__codelineno-11-791" name="__codelineno-11-791" href="#__codelineno-11-791"></a>        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">report</span><span class="p">[</span><span class="s1">&#39;failed_tests&#39;</span><span class="p">]:</span>
</span><span id="__span-11-792"><a id="__codelineno-11-792" name="__codelineno-11-792" href="#__codelineno-11-792"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;severity&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-11-793"><a id="__codelineno-11-793" name="__codelineno-11-793" href="#__codelineno-11-793"></a>
</span><span id="__span-11-794"><a id="__codelineno-11-794" name="__codelineno-11-794" href="#__codelineno-11-794"></a>    <span class="k">if</span> <span class="n">report</span><span class="p">[</span><span class="s1">&#39;recommendations&#39;</span><span class="p">]:</span>
</span><span id="__span-11-795"><a id="__codelineno-11-795" name="__codelineno-11-795" href="#__codelineno-11-795"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Recommendations:&quot;</span><span class="p">)</span>
</span><span id="__span-11-796"><a id="__codelineno-11-796" name="__codelineno-11-796" href="#__codelineno-11-796"></a>        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">report</span><span class="p">[</span><span class="s1">&#39;recommendations&#39;</span><span class="p">]:</span>
</span><span id="__span-11-797"><a id="__codelineno-11-797" name="__codelineno-11-797" href="#__codelineno-11-797"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">rec</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-11-798"><a id="__codelineno-11-798" name="__codelineno-11-798" href="#__codelineno-11-798"></a>
</span><span id="__span-11-799"><a id="__codelineno-11-799" name="__codelineno-11-799" href="#__codelineno-11-799"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-11-800"><a id="__codelineno-11-800" name="__codelineno-11-800" href="#__codelineno-11-800"></a>    <span class="n">security_testing_example</span><span class="p">()</span>
</span></code></pre></div>
<h2 id="building-a-complete-secure-rest-api">Building a Complete Secure REST API<a class="headerlink" href="#building-a-complete-secure-rest-api" title="Permanent link">&para;</a></h2>
<p>Now we&rsquo;ll integrate all the security concepts covered into a complete, production-ready REST API with comprehensive security features.</p>
<h3 id="secure-api-architecture">Secure API Architecture<a class="headerlink" href="#secure-api-architecture" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>@startuml Secure_API_Architecture
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>!theme plain
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>skinparam backgroundColor white
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>skinparam defaultFontName &quot;Arial&quot;
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>package &quot;Client Layer&quot; {
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>  [Web App]
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>  [Mobile App]
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>  [Third-party App]
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>}
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>package &quot;Security Layer&quot; {
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>  [Rate Limiter] as RL
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>  [CORS Handler] as CORS
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>  [Authentication] as Auth
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>  [Input Validator] as Validator
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>}
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>package &quot;API Layer&quot; {
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>  [User Controller]
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>  [Post Controller]
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>  [File Controller]
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a>}
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a>
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a>package &quot;Data Layer&quot; {
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a>  [Session Store]
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a>  [User Database]
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a>  [Content Database]
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a>}
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a>
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a>[Web App] --&gt; RL
</span><span id="__span-12-32"><a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a>[Mobile App] --&gt; RL
</span><span id="__span-12-33"><a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a>[Third-party App] --&gt; RL
</span><span id="__span-12-34"><a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a>
</span><span id="__span-12-35"><a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a>RL --&gt; CORS
</span><span id="__span-12-36"><a id="__codelineno-12-36" name="__codelineno-12-36" href="#__codelineno-12-36"></a>CORS --&gt; Auth
</span><span id="__span-12-37"><a id="__codelineno-12-37" name="__codelineno-12-37" href="#__codelineno-12-37"></a>Auth --&gt; Validator
</span><span id="__span-12-38"><a id="__codelineno-12-38" name="__codelineno-12-38" href="#__codelineno-12-38"></a>Validator --&gt; [User Controller]
</span><span id="__span-12-39"><a id="__codelineno-12-39" name="__codelineno-12-39" href="#__codelineno-12-39"></a>Validator --&gt; [Post Controller]
</span><span id="__span-12-40"><a id="__codelineno-12-40" name="__codelineno-12-40" href="#__codelineno-12-40"></a>Validator --&gt; [File Controller]
</span><span id="__span-12-41"><a id="__codelineno-12-41" name="__codelineno-12-41" href="#__codelineno-12-41"></a>
</span><span id="__span-12-42"><a id="__codelineno-12-42" name="__codelineno-12-42" href="#__codelineno-12-42"></a>[User Controller] --&gt; [Session Store]
</span><span id="__span-12-43"><a id="__codelineno-12-43" name="__codelineno-12-43" href="#__codelineno-12-43"></a>[User Controller] --&gt; [User Database]
</span><span id="__span-12-44"><a id="__codelineno-12-44" name="__codelineno-12-44" href="#__codelineno-12-44"></a>[Post Controller] --&gt; [Content Database]
</span><span id="__span-12-45"><a id="__codelineno-12-45" name="__codelineno-12-45" href="#__codelineno-12-45"></a>[File Controller] --&gt; [Content Database]
</span><span id="__span-12-46"><a id="__codelineno-12-46" name="__codelineno-12-46" href="#__codelineno-12-46"></a>
</span><span id="__span-12-47"><a id="__codelineno-12-47" name="__codelineno-12-47" href="#__codelineno-12-47"></a>@enduml
</span></code></pre></div>
<h3 id="complete-secure-api-implementation">Complete Secure API Implementation<a class="headerlink" href="#complete-secure-api-implementation" title="Permanent link">&para;</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">g</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">werkzeug.security</span><span class="w"> </span><span class="kn">import</span> <span class="n">generate_password_hash</span><span class="p">,</span> <span class="n">check_password_hash</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">wraps</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">secrets</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">List</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="c1"># Import our security components</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="c1"># (In a real application, these would be in separate modules)</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="k">class</span><span class="w"> </span><span class="nc">SecureTaskAPI</span><span class="p">:</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Complete secure REST API for task management&quot;&quot;&quot;</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>
</span><span id="__span-13-22"><a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a>        <span class="c1"># Initialize security components</span>
</span><span id="__span-13-23"><a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">jwt_manager</span> <span class="o">=</span> <span class="n">JWTManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">])</span>
</span><span id="__span-13-24"><a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span> <span class="o">=</span> <span class="n">RateLimiter</span><span class="p">()</span>
</span><span id="__span-13-25"><a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cors_manager</span> <span class="o">=</span> <span class="n">CORSManager</span><span class="p">()</span>
</span><span id="__span-13-26"><a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">session_manager</span> <span class="o">=</span> <span class="n">SecureSessionManager</span><span class="p">()</span>
</span><span id="__span-13-27"><a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">security_tester</span> <span class="o">=</span> <span class="n">APISecurityTester</span><span class="p">(</span><span class="s2">&quot;http://localhost:5000&quot;</span><span class="p">)</span>
</span><span id="__span-13-28"><a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a>
</span><span id="__span-13-29"><a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a>        <span class="c1"># Setup database</span>
</span><span id="__span-13-30"><a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">init_database</span><span class="p">()</span>
</span><span id="__span-13-31"><a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a>
</span><span id="__span-13-32"><a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a>        <span class="c1"># Configure CORS policies</span>
</span><span id="__span-13-33"><a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">setup_cors_policies</span><span class="p">()</span>
</span><span id="__span-13-34"><a id="__codelineno-13-34" name="__codelineno-13-34" href="#__codelineno-13-34"></a>
</span><span id="__span-13-35"><a id="__codelineno-13-35" name="__codelineno-13-35" href="#__codelineno-13-35"></a>        <span class="c1"># Setup rate limiting</span>
</span><span id="__span-13-36"><a id="__codelineno-13-36" name="__codelineno-13-36" href="#__codelineno-13-36"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">setup_rate_limiting</span><span class="p">()</span>
</span><span id="__span-13-37"><a id="__codelineno-13-37" name="__codelineno-13-37" href="#__codelineno-13-37"></a>
</span><span id="__span-13-38"><a id="__codelineno-13-38" name="__codelineno-13-38" href="#__codelineno-13-38"></a>        <span class="c1"># Register routes</span>
</span><span id="__span-13-39"><a id="__codelineno-13-39" name="__codelineno-13-39" href="#__codelineno-13-39"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">register_routes</span><span class="p">()</span>
</span><span id="__span-13-40"><a id="__codelineno-13-40" name="__codelineno-13-40" href="#__codelineno-13-40"></a>
</span><span id="__span-13-41"><a id="__codelineno-13-41" name="__codelineno-13-41" href="#__codelineno-13-41"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">init_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-13-42"><a id="__codelineno-13-42" name="__codelineno-13-42" href="#__codelineno-13-42"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize SQLite database with secure schema&quot;&quot;&quot;</span>
</span><span id="__span-13-43"><a id="__codelineno-13-43" name="__codelineno-13-43" href="#__codelineno-13-43"></a>        <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;secure_tasks.db&#39;</span><span class="p">)</span>
</span><span id="__span-13-44"><a id="__codelineno-13-44" name="__codelineno-13-44" href="#__codelineno-13-44"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span><span id="__span-13-45"><a id="__codelineno-13-45" name="__codelineno-13-45" href="#__codelineno-13-45"></a>
</span><span id="__span-13-46"><a id="__codelineno-13-46" name="__codelineno-13-46" href="#__codelineno-13-46"></a>        <span class="c1"># Users table with security features</span>
</span><span id="__span-13-47"><a id="__codelineno-13-47" name="__codelineno-13-47" href="#__codelineno-13-47"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
</span><span id="__span-13-48"><a id="__codelineno-13-48" name="__codelineno-13-48" href="#__codelineno-13-48"></a><span class="s1">            CREATE TABLE IF NOT EXISTS users (</span>
</span><span id="__span-13-49"><a id="__codelineno-13-49" name="__codelineno-13-49" href="#__codelineno-13-49"></a><span class="s1">                id INTEGER PRIMARY KEY AUTOINCREMENT,</span>
</span><span id="__span-13-50"><a id="__codelineno-13-50" name="__codelineno-13-50" href="#__codelineno-13-50"></a><span class="s1">                username TEXT UNIQUE NOT NULL,</span>
</span><span id="__span-13-51"><a id="__codelineno-13-51" name="__codelineno-13-51" href="#__codelineno-13-51"></a><span class="s1">                email TEXT UNIQUE NOT NULL,</span>
</span><span id="__span-13-52"><a id="__codelineno-13-52" name="__codelineno-13-52" href="#__codelineno-13-52"></a><span class="s1">                password_hash TEXT NOT NULL,</span>
</span><span id="__span-13-53"><a id="__codelineno-13-53" name="__codelineno-13-53" href="#__codelineno-13-53"></a><span class="s1">                salt TEXT NOT NULL,</span>
</span><span id="__span-13-54"><a id="__codelineno-13-54" name="__codelineno-13-54" href="#__codelineno-13-54"></a><span class="s1">                is_active BOOLEAN DEFAULT 1,</span>
</span><span id="__span-13-55"><a id="__codelineno-13-55" name="__codelineno-13-55" href="#__codelineno-13-55"></a><span class="s1">                failed_login_attempts INTEGER DEFAULT 0,</span>
</span><span id="__span-13-56"><a id="__codelineno-13-56" name="__codelineno-13-56" href="#__codelineno-13-56"></a><span class="s1">                last_failed_login TIMESTAMP,</span>
</span><span id="__span-13-57"><a id="__codelineno-13-57" name="__codelineno-13-57" href="#__codelineno-13-57"></a><span class="s1">                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,</span>
</span><span id="__span-13-58"><a id="__codelineno-13-58" name="__codelineno-13-58" href="#__codelineno-13-58"></a><span class="s1">                updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP</span>
</span><span id="__span-13-59"><a id="__codelineno-13-59" name="__codelineno-13-59" href="#__codelineno-13-59"></a><span class="s1">            )</span>
</span><span id="__span-13-60"><a id="__codelineno-13-60" name="__codelineno-13-60" href="#__codelineno-13-60"></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-13-61"><a id="__codelineno-13-61" name="__codelineno-13-61" href="#__codelineno-13-61"></a>
</span><span id="__span-13-62"><a id="__codelineno-13-62" name="__codelineno-13-62" href="#__codelineno-13-62"></a>        <span class="c1"># Tasks table</span>
</span><span id="__span-13-63"><a id="__codelineno-13-63" name="__codelineno-13-63" href="#__codelineno-13-63"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
</span><span id="__span-13-64"><a id="__codelineno-13-64" name="__codelineno-13-64" href="#__codelineno-13-64"></a><span class="s1">            CREATE TABLE IF NOT EXISTS tasks (</span>
</span><span id="__span-13-65"><a id="__codelineno-13-65" name="__codelineno-13-65" href="#__codelineno-13-65"></a><span class="s1">                id INTEGER PRIMARY KEY AUTOINCREMENT,</span>
</span><span id="__span-13-66"><a id="__codelineno-13-66" name="__codelineno-13-66" href="#__codelineno-13-66"></a><span class="s1">                user_id INTEGER NOT NULL,</span>
</span><span id="__span-13-67"><a id="__codelineno-13-67" name="__codelineno-13-67" href="#__codelineno-13-67"></a><span class="s1">                title TEXT NOT NULL,</span>
</span><span id="__span-13-68"><a id="__codelineno-13-68" name="__codelineno-13-68" href="#__codelineno-13-68"></a><span class="s1">                description TEXT,</span>
</span><span id="__span-13-69"><a id="__codelineno-13-69" name="__codelineno-13-69" href="#__codelineno-13-69"></a><span class="s1">                status TEXT DEFAULT &#39;pending&#39;,</span>
</span><span id="__span-13-70"><a id="__codelineno-13-70" name="__codelineno-13-70" href="#__codelineno-13-70"></a><span class="s1">                priority INTEGER DEFAULT 1,</span>
</span><span id="__span-13-71"><a id="__codelineno-13-71" name="__codelineno-13-71" href="#__codelineno-13-71"></a><span class="s1">                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,</span>
</span><span id="__span-13-72"><a id="__codelineno-13-72" name="__codelineno-13-72" href="#__codelineno-13-72"></a><span class="s1">                updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,</span>
</span><span id="__span-13-73"><a id="__codelineno-13-73" name="__codelineno-13-73" href="#__codelineno-13-73"></a><span class="s1">                FOREIGN KEY (user_id) REFERENCES users (id)</span>
</span><span id="__span-13-74"><a id="__codelineno-13-74" name="__codelineno-13-74" href="#__codelineno-13-74"></a><span class="s1">            )</span>
</span><span id="__span-13-75"><a id="__codelineno-13-75" name="__codelineno-13-75" href="#__codelineno-13-75"></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-13-76"><a id="__codelineno-13-76" name="__codelineno-13-76" href="#__codelineno-13-76"></a>
</span><span id="__span-13-77"><a id="__codelineno-13-77" name="__codelineno-13-77" href="#__codelineno-13-77"></a>        <span class="c1"># API keys table</span>
</span><span id="__span-13-78"><a id="__codelineno-13-78" name="__codelineno-13-78" href="#__codelineno-13-78"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
</span><span id="__span-13-79"><a id="__codelineno-13-79" name="__codelineno-13-79" href="#__codelineno-13-79"></a><span class="s1">            CREATE TABLE IF NOT EXISTS api_keys (</span>
</span><span id="__span-13-80"><a id="__codelineno-13-80" name="__codelineno-13-80" href="#__codelineno-13-80"></a><span class="s1">                id INTEGER PRIMARY KEY AUTOINCREMENT,</span>
</span><span id="__span-13-81"><a id="__codelineno-13-81" name="__codelineno-13-81" href="#__codelineno-13-81"></a><span class="s1">                key_id TEXT UNIQUE NOT NULL,</span>
</span><span id="__span-13-82"><a id="__codelineno-13-82" name="__codelineno-13-82" href="#__codelineno-13-82"></a><span class="s1">                key_hash TEXT NOT NULL,</span>
</span><span id="__span-13-83"><a id="__codelineno-13-83" name="__codelineno-13-83" href="#__codelineno-13-83"></a><span class="s1">                user_id INTEGER NOT NULL,</span>
</span><span id="__span-13-84"><a id="__codelineno-13-84" name="__codelineno-13-84" href="#__codelineno-13-84"></a><span class="s1">                name TEXT NOT NULL,</span>
</span><span id="__span-13-85"><a id="__codelineno-13-85" name="__codelineno-13-85" href="#__codelineno-13-85"></a><span class="s1">                permissions TEXT NOT NULL,</span>
</span><span id="__span-13-86"><a id="__codelineno-13-86" name="__codelineno-13-86" href="#__codelineno-13-86"></a><span class="s1">                is_active BOOLEAN DEFAULT 1,</span>
</span><span id="__span-13-87"><a id="__codelineno-13-87" name="__codelineno-13-87" href="#__codelineno-13-87"></a><span class="s1">                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,</span>
</span><span id="__span-13-88"><a id="__codelineno-13-88" name="__codelineno-13-88" href="#__codelineno-13-88"></a><span class="s1">                expires_at TIMESTAMP,</span>
</span><span id="__span-13-89"><a id="__codelineno-13-89" name="__codelineno-13-89" href="#__codelineno-13-89"></a><span class="s1">                FOREIGN KEY (user_id) REFERENCES users (id)</span>
</span><span id="__span-13-90"><a id="__codelineno-13-90" name="__codelineno-13-90" href="#__codelineno-13-90"></a><span class="s1">            )</span>
</span><span id="__span-13-91"><a id="__codelineno-13-91" name="__codelineno-13-91" href="#__codelineno-13-91"></a><span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-13-92"><a id="__codelineno-13-92" name="__codelineno-13-92" href="#__codelineno-13-92"></a>
</span><span id="__span-13-93"><a id="__codelineno-13-93" name="__codelineno-13-93" href="#__codelineno-13-93"></a>        <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span id="__span-13-94"><a id="__codelineno-13-94" name="__codelineno-13-94" href="#__codelineno-13-94"></a>        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-13-95"><a id="__codelineno-13-95" name="__codelineno-13-95" href="#__codelineno-13-95"></a>
</span><span id="__span-13-96"><a id="__codelineno-13-96" name="__codelineno-13-96" href="#__codelineno-13-96"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_cors_policies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-13-97"><a id="__codelineno-13-97" name="__codelineno-13-97" href="#__codelineno-13-97"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Configure CORS policies for different environments&quot;&quot;&quot;</span>
</span><span id="__span-13-98"><a id="__codelineno-13-98" name="__codelineno-13-98" href="#__codelineno-13-98"></a>
</span><span id="__span-13-99"><a id="__codelineno-13-99" name="__codelineno-13-99" href="#__codelineno-13-99"></a>        <span class="c1"># Development policy</span>
</span><span id="__span-13-100"><a id="__codelineno-13-100" name="__codelineno-13-100" href="#__codelineno-13-100"></a>        <span class="n">dev_policy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cors_manager</span><span class="o">.</span><span class="n">create_secure_policy</span><span class="p">(</span>
</span><span id="__span-13-101"><a id="__codelineno-13-101" name="__codelineno-13-101" href="#__codelineno-13-101"></a>            <span class="n">allowed_origins</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">,</span> <span class="s1">&#39;http://127.0.0.1:3000&#39;</span><span class="p">],</span>
</span><span id="__span-13-102"><a id="__codelineno-13-102" name="__codelineno-13-102" href="#__codelineno-13-102"></a>            <span class="n">allow_credentials</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-13-103"><a id="__codelineno-13-103" name="__codelineno-13-103" href="#__codelineno-13-103"></a>        <span class="p">)</span>
</span><span id="__span-13-104"><a id="__codelineno-13-104" name="__codelineno-13-104" href="#__codelineno-13-104"></a>
</span><span id="__span-13-105"><a id="__codelineno-13-105" name="__codelineno-13-105" href="#__codelineno-13-105"></a>        <span class="c1"># Production policy</span>
</span><span id="__span-13-106"><a id="__codelineno-13-106" name="__codelineno-13-106" href="#__codelineno-13-106"></a>        <span class="n">prod_policy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cors_manager</span><span class="o">.</span><span class="n">create_secure_policy</span><span class="p">(</span>
</span><span id="__span-13-107"><a id="__codelineno-13-107" name="__codelineno-13-107" href="#__codelineno-13-107"></a>            <span class="n">allowed_origins</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;https://taskapp.com&#39;</span><span class="p">,</span> <span class="s1">&#39;https://api.taskapp.com&#39;</span><span class="p">],</span>
</span><span id="__span-13-108"><a id="__codelineno-13-108" name="__codelineno-13-108" href="#__codelineno-13-108"></a>            <span class="n">allow_credentials</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-13-109"><a id="__codelineno-13-109" name="__codelineno-13-109" href="#__codelineno-13-109"></a>        <span class="p">)</span>
</span><span id="__span-13-110"><a id="__codelineno-13-110" name="__codelineno-13-110" href="#__codelineno-13-110"></a>
</span><span id="__span-13-111"><a id="__codelineno-13-111" name="__codelineno-13-111" href="#__codelineno-13-111"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cors_manager</span><span class="o">.</span><span class="n">add_policy</span><span class="p">(</span><span class="s1">&#39;development&#39;</span><span class="p">,</span> <span class="n">dev_policy</span><span class="p">)</span>
</span><span id="__span-13-112"><a id="__codelineno-13-112" name="__codelineno-13-112" href="#__codelineno-13-112"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cors_manager</span><span class="o">.</span><span class="n">add_policy</span><span class="p">(</span><span class="s1">&#39;production&#39;</span><span class="p">,</span> <span class="n">prod_policy</span><span class="p">)</span>
</span><span id="__span-13-113"><a id="__codelineno-13-113" name="__codelineno-13-113" href="#__codelineno-13-113"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cors_manager</span><span class="o">.</span><span class="n">set_default_policy</span><span class="p">(</span><span class="n">dev_policy</span><span class="p">)</span>  <span class="c1"># Use dev for demo</span>
</span><span id="__span-13-114"><a id="__codelineno-13-114" name="__codelineno-13-114" href="#__codelineno-13-114"></a>
</span><span id="__span-13-115"><a id="__codelineno-13-115" name="__codelineno-13-115" href="#__codelineno-13-115"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_rate_limiting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-13-116"><a id="__codelineno-13-116" name="__codelineno-13-116" href="#__codelineno-13-116"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Configure rate limiting for different endpoints&quot;&quot;&quot;</span>
</span><span id="__span-13-117"><a id="__codelineno-13-117" name="__codelineno-13-117" href="#__codelineno-13-117"></a>
</span><span id="__span-13-118"><a id="__codelineno-13-118" name="__codelineno-13-118" href="#__codelineno-13-118"></a>        <span class="c1"># Different limits for different endpoint types</span>
</span><span id="__span-13-119"><a id="__codelineno-13-119" name="__codelineno-13-119" href="#__codelineno-13-119"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="o">.</span><span class="n">create_rate_limit</span><span class="p">(</span><span class="s1">&#39;auth_endpoint&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>      <span class="c1"># 5 req/sec, burst 50</span>
</span><span id="__span-13-120"><a id="__codelineno-13-120" name="__codelineno-13-120" href="#__codelineno-13-120"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="o">.</span><span class="n">create_rate_limit</span><span class="p">(</span><span class="s1">&#39;api_endpoint&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>     <span class="c1"># 50 req/sec, burst 500</span>
</span><span id="__span-13-121"><a id="__codelineno-13-121" name="__codelineno-13-121" href="#__codelineno-13-121"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="o">.</span><span class="n">create_rate_limit</span><span class="p">(</span><span class="s1">&#39;public_endpoint&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>  <span class="c1"># 10 req/sec, burst 100</span>
</span><span id="__span-13-122"><a id="__codelineno-13-122" name="__codelineno-13-122" href="#__codelineno-13-122"></a>
</span><span id="__span-13-123"><a id="__codelineno-13-123" name="__codelineno-13-123" href="#__codelineno-13-123"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_db_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-13-124"><a id="__codelineno-13-124" name="__codelineno-13-124" href="#__codelineno-13-124"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get database connection with security considerations&quot;&quot;&quot;</span>
</span><span id="__span-13-125"><a id="__codelineno-13-125" name="__codelineno-13-125" href="#__codelineno-13-125"></a>        <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;secure_tasks.db&#39;</span><span class="p">)</span>
</span><span id="__span-13-126"><a id="__codelineno-13-126" name="__codelineno-13-126" href="#__codelineno-13-126"></a>        <span class="n">conn</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>  <span class="c1"># Enable column access by name</span>
</span><span id="__span-13-127"><a id="__codelineno-13-127" name="__codelineno-13-127" href="#__codelineno-13-127"></a>
</span><span id="__span-13-128"><a id="__codelineno-13-128" name="__codelineno-13-128" href="#__codelineno-13-128"></a>        <span class="c1"># Enable foreign key constraints</span>
</span><span id="__span-13-129"><a id="__codelineno-13-129" name="__codelineno-13-129" href="#__codelineno-13-129"></a>        <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;PRAGMA foreign_keys = ON&#39;</span><span class="p">)</span>
</span><span id="__span-13-130"><a id="__codelineno-13-130" name="__codelineno-13-130" href="#__codelineno-13-130"></a>
</span><span id="__span-13-131"><a id="__codelineno-13-131" name="__codelineno-13-131" href="#__codelineno-13-131"></a>        <span class="k">return</span> <span class="n">conn</span>
</span><span id="__span-13-132"><a id="__codelineno-13-132" name="__codelineno-13-132" href="#__codelineno-13-132"></a>
</span><span id="__span-13-133"><a id="__codelineno-13-133" name="__codelineno-13-133" href="#__codelineno-13-133"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">rules</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
</span><span id="__span-13-134"><a id="__codelineno-13-134" name="__codelineno-13-134" href="#__codelineno-13-134"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Comprehensive input validation&quot;&quot;&quot;</span>
</span><span id="__span-13-135"><a id="__codelineno-13-135" name="__codelineno-13-135" href="#__codelineno-13-135"></a>        <span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-13-136"><a id="__codelineno-13-136" name="__codelineno-13-136" href="#__codelineno-13-136"></a>
</span><span id="__span-13-137"><a id="__codelineno-13-137" name="__codelineno-13-137" href="#__codelineno-13-137"></a>        <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-13-138"><a id="__codelineno-13-138" name="__codelineno-13-138" href="#__codelineno-13-138"></a>            <span class="n">value</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-13-139"><a id="__codelineno-13-139" name="__codelineno-13-139" href="#__codelineno-13-139"></a>
</span><span id="__span-13-140"><a id="__codelineno-13-140" name="__codelineno-13-140" href="#__codelineno-13-140"></a>            <span class="c1"># Required field check</span>
</span><span id="__span-13-141"><a id="__codelineno-13-141" name="__codelineno-13-141" href="#__codelineno-13-141"></a>            <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
</span><span id="__span-13-142"><a id="__codelineno-13-142" name="__codelineno-13-142" href="#__codelineno-13-142"></a>                <span class="n">errors</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2"> is required&quot;</span>
</span><span id="__span-13-143"><a id="__codelineno-13-143" name="__codelineno-13-143" href="#__codelineno-13-143"></a>                <span class="k">continue</span>
</span><span id="__span-13-144"><a id="__codelineno-13-144" name="__codelineno-13-144" href="#__codelineno-13-144"></a>
</span><span id="__span-13-145"><a id="__codelineno-13-145" name="__codelineno-13-145" href="#__codelineno-13-145"></a>            <span class="c1"># Type validation</span>
</span><span id="__span-13-146"><a id="__codelineno-13-146" name="__codelineno-13-146" href="#__codelineno-13-146"></a>            <span class="n">expected_type</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="__span-13-147"><a id="__codelineno-13-147" name="__codelineno-13-147" href="#__codelineno-13-147"></a>            <span class="k">if</span> <span class="n">value</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">expected_type</span><span class="p">):</span>
</span><span id="__span-13-148"><a id="__codelineno-13-148" name="__codelineno-13-148" href="#__codelineno-13-148"></a>                <span class="n">errors</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2"> must be of type </span><span class="si">{</span><span class="n">expected_type</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-13-149"><a id="__codelineno-13-149" name="__codelineno-13-149" href="#__codelineno-13-149"></a>                <span class="k">continue</span>
</span><span id="__span-13-150"><a id="__codelineno-13-150" name="__codelineno-13-150" href="#__codelineno-13-150"></a>
</span><span id="__span-13-151"><a id="__codelineno-13-151" name="__codelineno-13-151" href="#__codelineno-13-151"></a>            <span class="c1"># Length validation</span>
</span><span id="__span-13-152"><a id="__codelineno-13-152" name="__codelineno-13-152" href="#__codelineno-13-152"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-13-153"><a id="__codelineno-13-153" name="__codelineno-13-153" href="#__codelineno-13-153"></a>                <span class="n">min_length</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;min_length&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-13-154"><a id="__codelineno-13-154" name="__codelineno-13-154" href="#__codelineno-13-154"></a>                <span class="n">max_length</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_length&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">))</span>
</span><span id="__span-13-155"><a id="__codelineno-13-155" name="__codelineno-13-155" href="#__codelineno-13-155"></a>
</span><span id="__span-13-156"><a id="__codelineno-13-156" name="__codelineno-13-156" href="#__codelineno-13-156"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_length</span><span class="p">:</span>
</span><span id="__span-13-157"><a id="__codelineno-13-157" name="__codelineno-13-157" href="#__codelineno-13-157"></a>                    <span class="n">errors</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2"> must be at least </span><span class="si">{</span><span class="n">min_length</span><span class="si">}</span><span class="s2"> characters&quot;</span>
</span><span id="__span-13-158"><a id="__codelineno-13-158" name="__codelineno-13-158" href="#__codelineno-13-158"></a>                    <span class="k">continue</span>
</span><span id="__span-13-159"><a id="__codelineno-13-159" name="__codelineno-13-159" href="#__codelineno-13-159"></a>
</span><span id="__span-13-160"><a id="__codelineno-13-160" name="__codelineno-13-160" href="#__codelineno-13-160"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_length</span><span class="p">:</span>
</span><span id="__span-13-161"><a id="__codelineno-13-161" name="__codelineno-13-161" href="#__codelineno-13-161"></a>                    <span class="n">errors</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2"> must be at most </span><span class="si">{</span><span class="n">max_length</span><span class="si">}</span><span class="s2"> characters&quot;</span>
</span><span id="__span-13-162"><a id="__codelineno-13-162" name="__codelineno-13-162" href="#__codelineno-13-162"></a>                    <span class="k">continue</span>
</span><span id="__span-13-163"><a id="__codelineno-13-163" name="__codelineno-13-163" href="#__codelineno-13-163"></a>
</span><span id="__span-13-164"><a id="__codelineno-13-164" name="__codelineno-13-164" href="#__codelineno-13-164"></a>            <span class="c1"># Pattern validation (regex)</span>
</span><span id="__span-13-165"><a id="__codelineno-13-165" name="__codelineno-13-165" href="#__codelineno-13-165"></a>            <span class="n">pattern</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pattern&#39;</span><span class="p">)</span>
</span><span id="__span-13-166"><a id="__codelineno-13-166" name="__codelineno-13-166" href="#__codelineno-13-166"></a>            <span class="k">if</span> <span class="n">pattern</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-13-167"><a id="__codelineno-13-167" name="__codelineno-13-167" href="#__codelineno-13-167"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="__span-13-168"><a id="__codelineno-13-168" name="__codelineno-13-168" href="#__codelineno-13-168"></a>                    <span class="n">errors</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2"> format is invalid&quot;</span>
</span><span id="__span-13-169"><a id="__codelineno-13-169" name="__codelineno-13-169" href="#__codelineno-13-169"></a>                    <span class="k">continue</span>
</span><span id="__span-13-170"><a id="__codelineno-13-170" name="__codelineno-13-170" href="#__codelineno-13-170"></a>
</span><span id="__span-13-171"><a id="__codelineno-13-171" name="__codelineno-13-171" href="#__codelineno-13-171"></a>            <span class="c1"># Custom validation function</span>
</span><span id="__span-13-172"><a id="__codelineno-13-172" name="__codelineno-13-172" href="#__codelineno-13-172"></a>            <span class="n">validator</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;validator&#39;</span><span class="p">)</span>
</span><span id="__span-13-173"><a id="__codelineno-13-173" name="__codelineno-13-173" href="#__codelineno-13-173"></a>            <span class="k">if</span> <span class="n">validator</span> <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="n">validator</span><span class="p">):</span>
</span><span id="__span-13-174"><a id="__codelineno-13-174" name="__codelineno-13-174" href="#__codelineno-13-174"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">validator</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
</span><span id="__span-13-175"><a id="__codelineno-13-175" name="__codelineno-13-175" href="#__codelineno-13-175"></a>                    <span class="n">errors</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2"> validation failed&quot;</span>
</span><span id="__span-13-176"><a id="__codelineno-13-176" name="__codelineno-13-176" href="#__codelineno-13-176"></a>
</span><span id="__span-13-177"><a id="__codelineno-13-177" name="__codelineno-13-177" href="#__codelineno-13-177"></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">errors</span>
</span><span id="__span-13-178"><a id="__codelineno-13-178" name="__codelineno-13-178" href="#__codelineno-13-178"></a>
</span><span id="__span-13-179"><a id="__codelineno-13-179" name="__codelineno-13-179" href="#__codelineno-13-179"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sanitize_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="__span-13-180"><a id="__codelineno-13-180" name="__codelineno-13-180" href="#__codelineno-13-180"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sanitize input data to prevent injection attacks&quot;&quot;&quot;</span>
</span><span id="__span-13-181"><a id="__codelineno-13-181" name="__codelineno-13-181" href="#__codelineno-13-181"></a>        <span class="n">sanitized</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-13-182"><a id="__codelineno-13-182" name="__codelineno-13-182" href="#__codelineno-13-182"></a>
</span><span id="__span-13-183"><a id="__codelineno-13-183" name="__codelineno-13-183" href="#__codelineno-13-183"></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-13-184"><a id="__codelineno-13-184" name="__codelineno-13-184" href="#__codelineno-13-184"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-13-185"><a id="__codelineno-13-185" name="__codelineno-13-185" href="#__codelineno-13-185"></a>                <span class="c1"># Remove potential SQL injection characters</span>
</span><span id="__span-13-186"><a id="__codelineno-13-186" name="__codelineno-13-186" href="#__codelineno-13-186"></a>                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&#39;&quot;</span><span class="p">)</span>  <span class="c1"># Escape single quotes</span>
</span><span id="__span-13-187"><a id="__codelineno-13-187" name="__codelineno-13-187" href="#__codelineno-13-187"></a>                <span class="n">value</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[&lt;&gt;&quot;</span><span class="se">\&#39;</span><span class="s1">]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>  <span class="c1"># Remove XSS characters</span>
</span><span id="__span-13-188"><a id="__codelineno-13-188" name="__codelineno-13-188" href="#__codelineno-13-188"></a>
</span><span id="__span-13-189"><a id="__codelineno-13-189" name="__codelineno-13-189" href="#__codelineno-13-189"></a>                <span class="c1"># Limit length to prevent buffer overflow</span>
</span><span id="__span-13-190"><a id="__codelineno-13-190" name="__codelineno-13-190" href="#__codelineno-13-190"></a>                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[:</span><span class="mi">1000</span><span class="p">]</span>
</span><span id="__span-13-191"><a id="__codelineno-13-191" name="__codelineno-13-191" href="#__codelineno-13-191"></a>
</span><span id="__span-13-192"><a id="__codelineno-13-192" name="__codelineno-13-192" href="#__codelineno-13-192"></a>                <span class="n">sanitized</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="__span-13-193"><a id="__codelineno-13-193" name="__codelineno-13-193" href="#__codelineno-13-193"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-13-194"><a id="__codelineno-13-194" name="__codelineno-13-194" href="#__codelineno-13-194"></a>                <span class="n">sanitized</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-13-195"><a id="__codelineno-13-195" name="__codelineno-13-195" href="#__codelineno-13-195"></a>
</span><span id="__span-13-196"><a id="__codelineno-13-196" name="__codelineno-13-196" href="#__codelineno-13-196"></a>        <span class="k">return</span> <span class="n">sanitized</span>
</span><span id="__span-13-197"><a id="__codelineno-13-197" name="__codelineno-13-197" href="#__codelineno-13-197"></a>
</span><span id="__span-13-198"><a id="__codelineno-13-198" name="__codelineno-13-198" href="#__codelineno-13-198"></a>    <span class="c1"># Security decorators</span>
</span><span id="__span-13-199"><a id="__codelineno-13-199" name="__codelineno-13-199" href="#__codelineno-13-199"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">require_auth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">permissions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="__span-13-200"><a id="__codelineno-13-200" name="__codelineno-13-200" href="#__codelineno-13-200"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Decorator for endpoints requiring authentication&quot;&quot;&quot;</span>
</span><span id="__span-13-201"><a id="__codelineno-13-201" name="__codelineno-13-201" href="#__codelineno-13-201"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
</span><span id="__span-13-202"><a id="__codelineno-13-202" name="__codelineno-13-202" href="#__codelineno-13-202"></a>            <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="__span-13-203"><a id="__codelineno-13-203" name="__codelineno-13-203" href="#__codelineno-13-203"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">decorated_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="__span-13-204"><a id="__codelineno-13-204" name="__codelineno-13-204" href="#__codelineno-13-204"></a>                <span class="c1"># Check rate limiting first</span>
</span><span id="__span-13-205"><a id="__codelineno-13-205" name="__codelineno-13-205" href="#__codelineno-13-205"></a>                <span class="n">client_ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">remote_addr</span>
</span><span id="__span-13-206"><a id="__codelineno-13-206" name="__codelineno-13-206" href="#__codelineno-13-206"></a>                <span class="n">allowed</span><span class="p">,</span> <span class="n">rate_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="o">.</span><span class="n">is_allowed</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;auth_</span><span class="si">{</span><span class="n">client_ip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-13-207"><a id="__codelineno-13-207" name="__codelineno-13-207" href="#__codelineno-13-207"></a>
</span><span id="__span-13-208"><a id="__codelineno-13-208" name="__codelineno-13-208" href="#__codelineno-13-208"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">allowed</span><span class="p">:</span>
</span><span id="__span-13-209"><a id="__codelineno-13-209" name="__codelineno-13-209" href="#__codelineno-13-209"></a>                    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
</span><span id="__span-13-210"><a id="__codelineno-13-210" name="__codelineno-13-210" href="#__codelineno-13-210"></a>                        <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Rate limit exceeded&#39;</span><span class="p">,</span>
</span><span id="__span-13-211"><a id="__codelineno-13-211" name="__codelineno-13-211" href="#__codelineno-13-211"></a>                        <span class="s1">&#39;retry_after&#39;</span><span class="p">:</span> <span class="n">rate_info</span><span class="p">[</span><span class="s1">&#39;retry_after&#39;</span><span class="p">]</span>
</span><span id="__span-13-212"><a id="__codelineno-13-212" name="__codelineno-13-212" href="#__codelineno-13-212"></a>                    <span class="p">}),</span> <span class="mi">429</span>
</span><span id="__span-13-213"><a id="__codelineno-13-213" name="__codelineno-13-213" href="#__codelineno-13-213"></a>
</span><span id="__span-13-214"><a id="__codelineno-13-214" name="__codelineno-13-214" href="#__codelineno-13-214"></a>                <span class="c1"># Get token from header</span>
</span><span id="__span-13-215"><a id="__codelineno-13-215" name="__codelineno-13-215" href="#__codelineno-13-215"></a>                <span class="n">auth_header</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-13-216"><a id="__codelineno-13-216" name="__codelineno-13-216" href="#__codelineno-13-216"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">auth_header</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Bearer &#39;</span><span class="p">):</span>
</span><span id="__span-13-217"><a id="__codelineno-13-217" name="__codelineno-13-217" href="#__codelineno-13-217"></a>                    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Missing or invalid authorization header&#39;</span><span class="p">}),</span> <span class="mi">401</span>
</span><span id="__span-13-218"><a id="__codelineno-13-218" name="__codelineno-13-218" href="#__codelineno-13-218"></a>
</span><span id="__span-13-219"><a id="__codelineno-13-219" name="__codelineno-13-219" href="#__codelineno-13-219"></a>                <span class="n">token</span> <span class="o">=</span> <span class="n">auth_header</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Bearer &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-13-220"><a id="__codelineno-13-220" name="__codelineno-13-220" href="#__codelineno-13-220"></a>
</span><span id="__span-13-221"><a id="__codelineno-13-221" name="__codelineno-13-221" href="#__codelineno-13-221"></a>                <span class="c1"># Validate JWT token</span>
</span><span id="__span-13-222"><a id="__codelineno-13-222" name="__codelineno-13-222" href="#__codelineno-13-222"></a>                <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jwt_manager</span><span class="o">.</span><span class="n">validate_token</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="__span-13-223"><a id="__codelineno-13-223" name="__codelineno-13-223" href="#__codelineno-13-223"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">payload</span><span class="p">:</span>
</span><span id="__span-13-224"><a id="__codelineno-13-224" name="__codelineno-13-224" href="#__codelineno-13-224"></a>                    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Invalid or expired token&#39;</span><span class="p">}),</span> <span class="mi">401</span>
</span><span id="__span-13-225"><a id="__codelineno-13-225" name="__codelineno-13-225" href="#__codelineno-13-225"></a>
</span><span id="__span-13-226"><a id="__codelineno-13-226" name="__codelineno-13-226" href="#__codelineno-13-226"></a>                <span class="c1"># Check permissions</span>
</span><span id="__span-13-227"><a id="__codelineno-13-227" name="__codelineno-13-227" href="#__codelineno-13-227"></a>                <span class="k">if</span> <span class="n">permissions</span><span class="p">:</span>
</span><span id="__span-13-228"><a id="__codelineno-13-228" name="__codelineno-13-228" href="#__codelineno-13-228"></a>                    <span class="n">user_permissions</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;permissions&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="__span-13-229"><a id="__codelineno-13-229" name="__codelineno-13-229" href="#__codelineno-13-229"></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">perm</span> <span class="ow">in</span> <span class="n">user_permissions</span> <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">permissions</span><span class="p">):</span>
</span><span id="__span-13-230"><a id="__codelineno-13-230" name="__codelineno-13-230" href="#__codelineno-13-230"></a>                        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Insufficient permissions&#39;</span><span class="p">}),</span> <span class="mi">403</span>
</span><span id="__span-13-231"><a id="__codelineno-13-231" name="__codelineno-13-231" href="#__codelineno-13-231"></a>
</span><span id="__span-13-232"><a id="__codelineno-13-232" name="__codelineno-13-232" href="#__codelineno-13-232"></a>                <span class="c1"># Store user info for use in endpoint</span>
</span><span id="__span-13-233"><a id="__codelineno-13-233" name="__codelineno-13-233" href="#__codelineno-13-233"></a>                <span class="n">g</span><span class="o">.</span><span class="n">current_user</span> <span class="o">=</span> <span class="n">payload</span>
</span><span id="__span-13-234"><a id="__codelineno-13-234" name="__codelineno-13-234" href="#__codelineno-13-234"></a>
</span><span id="__span-13-235"><a id="__codelineno-13-235" name="__codelineno-13-235" href="#__codelineno-13-235"></a>                <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-13-236"><a id="__codelineno-13-236" name="__codelineno-13-236" href="#__codelineno-13-236"></a>            <span class="k">return</span> <span class="n">decorated_function</span>
</span><span id="__span-13-237"><a id="__codelineno-13-237" name="__codelineno-13-237" href="#__codelineno-13-237"></a>        <span class="k">return</span> <span class="n">decorator</span>
</span><span id="__span-13-238"><a id="__codelineno-13-238" name="__codelineno-13-238" href="#__codelineno-13-238"></a>
</span><span id="__span-13-239"><a id="__codelineno-13-239" name="__codelineno-13-239" href="#__codelineno-13-239"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">require_cors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">policy_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="__span-13-240"><a id="__codelineno-13-240" name="__codelineno-13-240" href="#__codelineno-13-240"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Decorator for CORS handling&quot;&quot;&quot;</span>
</span><span id="__span-13-241"><a id="__codelineno-13-241" name="__codelineno-13-241" href="#__codelineno-13-241"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
</span><span id="__span-13-242"><a id="__codelineno-13-242" name="__codelineno-13-242" href="#__codelineno-13-242"></a>            <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="__span-13-243"><a id="__codelineno-13-243" name="__codelineno-13-243" href="#__codelineno-13-243"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">decorated_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="__span-13-244"><a id="__codelineno-13-244" name="__codelineno-13-244" href="#__codelineno-13-244"></a>                <span class="n">origin</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Origin&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-13-245"><a id="__codelineno-13-245" name="__codelineno-13-245" href="#__codelineno-13-245"></a>
</span><span id="__span-13-246"><a id="__codelineno-13-246" name="__codelineno-13-246" href="#__codelineno-13-246"></a>                <span class="c1"># Handle preflight requests</span>
</span><span id="__span-13-247"><a id="__codelineno-13-247" name="__codelineno-13-247" href="#__codelineno-13-247"></a>                <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span>
</span><span id="__span-13-248"><a id="__codelineno-13-248" name="__codelineno-13-248" href="#__codelineno-13-248"></a>                    <span class="n">cors_headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cors_manager</span><span class="o">.</span><span class="n">handle_preflight_request</span><span class="p">(</span>
</span><span id="__span-13-249"><a id="__codelineno-13-249" name="__codelineno-13-249" href="#__codelineno-13-249"></a>                        <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span>
</span><span id="__span-13-250"><a id="__codelineno-13-250" name="__codelineno-13-250" href="#__codelineno-13-250"></a>                        <span class="n">method</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Access-Control-Request-Method&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
</span><span id="__span-13-251"><a id="__codelineno-13-251" name="__codelineno-13-251" href="#__codelineno-13-251"></a>                        <span class="n">headers</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Access-Control-Request-Headers&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">),</span>
</span><span id="__span-13-252"><a id="__codelineno-13-252" name="__codelineno-13-252" href="#__codelineno-13-252"></a>                        <span class="n">policy_name</span><span class="o">=</span><span class="n">policy_name</span>
</span><span id="__span-13-253"><a id="__codelineno-13-253" name="__codelineno-13-253" href="#__codelineno-13-253"></a>                    <span class="p">)</span>
</span><span id="__span-13-254"><a id="__codelineno-13-254" name="__codelineno-13-254" href="#__codelineno-13-254"></a>
</span><span id="__span-13-255"><a id="__codelineno-13-255" name="__codelineno-13-255" href="#__codelineno-13-255"></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">cors_headers</span><span class="p">:</span>
</span><span id="__span-13-256"><a id="__codelineno-13-256" name="__codelineno-13-256" href="#__codelineno-13-256"></a>                        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;CORS policy violation&#39;</span><span class="p">}),</span> <span class="mi">403</span>
</span><span id="__span-13-257"><a id="__codelineno-13-257" name="__codelineno-13-257" href="#__codelineno-13-257"></a>
</span><span id="__span-13-258"><a id="__codelineno-13-258" name="__codelineno-13-258" href="#__codelineno-13-258"></a>                    <span class="n">response</span> <span class="o">=</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;preflight ok&#39;</span><span class="p">})</span>
</span><span id="__span-13-259"><a id="__codelineno-13-259" name="__codelineno-13-259" href="#__codelineno-13-259"></a>                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">cors_headers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-13-260"><a id="__codelineno-13-260" name="__codelineno-13-260" href="#__codelineno-13-260"></a>                        <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-13-261"><a id="__codelineno-13-261" name="__codelineno-13-261" href="#__codelineno-13-261"></a>
</span><span id="__span-13-262"><a id="__codelineno-13-262" name="__codelineno-13-262" href="#__codelineno-13-262"></a>                    <span class="k">return</span> <span class="n">response</span>
</span><span id="__span-13-263"><a id="__codelineno-13-263" name="__codelineno-13-263" href="#__codelineno-13-263"></a>
</span><span id="__span-13-264"><a id="__codelineno-13-264" name="__codelineno-13-264" href="#__codelineno-13-264"></a>                <span class="c1"># Handle actual request</span>
</span><span id="__span-13-265"><a id="__codelineno-13-265" name="__codelineno-13-265" href="#__codelineno-13-265"></a>                <span class="n">cors_headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cors_manager</span><span class="o">.</span><span class="n">handle_actual_request</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">policy_name</span><span class="p">)</span>
</span><span id="__span-13-266"><a id="__codelineno-13-266" name="__codelineno-13-266" href="#__codelineno-13-266"></a>
</span><span id="__span-13-267"><a id="__codelineno-13-267" name="__codelineno-13-267" href="#__codelineno-13-267"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">cors_headers</span><span class="p">:</span>
</span><span id="__span-13-268"><a id="__codelineno-13-268" name="__codelineno-13-268" href="#__codelineno-13-268"></a>                    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;CORS policy violation&#39;</span><span class="p">}),</span> <span class="mi">403</span>
</span><span id="__span-13-269"><a id="__codelineno-13-269" name="__codelineno-13-269" href="#__codelineno-13-269"></a>
</span><span id="__span-13-270"><a id="__codelineno-13-270" name="__codelineno-13-270" href="#__codelineno-13-270"></a>                <span class="c1"># Execute the actual function</span>
</span><span id="__span-13-271"><a id="__codelineno-13-271" name="__codelineno-13-271" href="#__codelineno-13-271"></a>                <span class="n">response</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-13-272"><a id="__codelineno-13-272" name="__codelineno-13-272" href="#__codelineno-13-272"></a>
</span><span id="__span-13-273"><a id="__codelineno-13-273" name="__codelineno-13-273" href="#__codelineno-13-273"></a>                <span class="c1"># Add CORS headers to response</span>
</span><span id="__span-13-274"><a id="__codelineno-13-274" name="__codelineno-13-274" href="#__codelineno-13-274"></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;headers&#39;</span><span class="p">):</span>
</span><span id="__span-13-275"><a id="__codelineno-13-275" name="__codelineno-13-275" href="#__codelineno-13-275"></a>                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">cors_headers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-13-276"><a id="__codelineno-13-276" name="__codelineno-13-276" href="#__codelineno-13-276"></a>                        <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-13-277"><a id="__codelineno-13-277" name="__codelineno-13-277" href="#__codelineno-13-277"></a>
</span><span id="__span-13-278"><a id="__codelineno-13-278" name="__codelineno-13-278" href="#__codelineno-13-278"></a>                <span class="k">return</span> <span class="n">response</span>
</span><span id="__span-13-279"><a id="__codelineno-13-279" name="__codelineno-13-279" href="#__codelineno-13-279"></a>            <span class="k">return</span> <span class="n">decorated_function</span>
</span><span id="__span-13-280"><a id="__codelineno-13-280" name="__codelineno-13-280" href="#__codelineno-13-280"></a>        <span class="k">return</span> <span class="n">decorator</span>
</span><span id="__span-13-281"><a id="__codelineno-13-281" name="__codelineno-13-281" href="#__codelineno-13-281"></a>
</span><span id="__span-13-282"><a id="__codelineno-13-282" name="__codelineno-13-282" href="#__codelineno-13-282"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">register_routes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-13-283"><a id="__codelineno-13-283" name="__codelineno-13-283" href="#__codelineno-13-283"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register all API routes with security&quot;&quot;&quot;</span>
</span><span id="__span-13-284"><a id="__codelineno-13-284" name="__codelineno-13-284" href="#__codelineno-13-284"></a>
</span><span id="__span-13-285"><a id="__codelineno-13-285" name="__codelineno-13-285" href="#__codelineno-13-285"></a>        <span class="c1"># Authentication endpoints</span>
</span><span id="__span-13-286"><a id="__codelineno-13-286" name="__codelineno-13-286" href="#__codelineno-13-286"></a>        <span class="nd">@self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/auth/register&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">])</span>
</span><span id="__span-13-287"><a id="__codelineno-13-287" name="__codelineno-13-287" href="#__codelineno-13-287"></a>        <span class="nd">@self</span><span class="o">.</span><span class="n">require_cors</span><span class="p">()</span>
</span><span id="__span-13-288"><a id="__codelineno-13-288" name="__codelineno-13-288" href="#__codelineno-13-288"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">register</span><span class="p">():</span>
</span><span id="__span-13-289"><a id="__codelineno-13-289" name="__codelineno-13-289" href="#__codelineno-13-289"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;User registration with security validation&quot;&quot;&quot;</span>
</span><span id="__span-13-290"><a id="__codelineno-13-290" name="__codelineno-13-290" href="#__codelineno-13-290"></a>            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span>
</span><span id="__span-13-291"><a id="__codelineno-13-291" name="__codelineno-13-291" href="#__codelineno-13-291"></a>                <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">200</span>  <span class="c1"># Handled by decorator</span>
</span><span id="__span-13-292"><a id="__codelineno-13-292" name="__codelineno-13-292" href="#__codelineno-13-292"></a>
</span><span id="__span-13-293"><a id="__codelineno-13-293" name="__codelineno-13-293" href="#__codelineno-13-293"></a>            <span class="c1"># Rate limiting for registration</span>
</span><span id="__span-13-294"><a id="__codelineno-13-294" name="__codelineno-13-294" href="#__codelineno-13-294"></a>            <span class="n">client_ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">remote_addr</span>
</span><span id="__span-13-295"><a id="__codelineno-13-295" name="__codelineno-13-295" href="#__codelineno-13-295"></a>            <span class="n">allowed</span><span class="p">,</span> <span class="n">rate_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="o">.</span><span class="n">sliding_window_check</span><span class="p">(</span>
</span><span id="__span-13-296"><a id="__codelineno-13-296" name="__codelineno-13-296" href="#__codelineno-13-296"></a>                <span class="sa">f</span><span class="s2">&quot;register_</span><span class="si">{</span><span class="n">client_ip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">3600</span><span class="p">,</span> <span class="mi">5</span>  <span class="c1"># 5 registrations per hour</span>
</span><span id="__span-13-297"><a id="__codelineno-13-297" name="__codelineno-13-297" href="#__codelineno-13-297"></a>            <span class="p">)</span>
</span><span id="__span-13-298"><a id="__codelineno-13-298" name="__codelineno-13-298" href="#__codelineno-13-298"></a>
</span><span id="__span-13-299"><a id="__codelineno-13-299" name="__codelineno-13-299" href="#__codelineno-13-299"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">allowed</span><span class="p">:</span>
</span><span id="__span-13-300"><a id="__codelineno-13-300" name="__codelineno-13-300" href="#__codelineno-13-300"></a>                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
</span><span id="__span-13-301"><a id="__codelineno-13-301" name="__codelineno-13-301" href="#__codelineno-13-301"></a>                    <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Registration rate limit exceeded&#39;</span><span class="p">,</span>
</span><span id="__span-13-302"><a id="__codelineno-13-302" name="__codelineno-13-302" href="#__codelineno-13-302"></a>                    <span class="s1">&#39;retry_after&#39;</span><span class="p">:</span> <span class="n">rate_info</span><span class="p">[</span><span class="s1">&#39;retry_after&#39;</span><span class="p">]</span>
</span><span id="__span-13-303"><a id="__codelineno-13-303" name="__codelineno-13-303" href="#__codelineno-13-303"></a>                <span class="p">}),</span> <span class="mi">429</span>
</span><span id="__span-13-304"><a id="__codelineno-13-304" name="__codelineno-13-304" href="#__codelineno-13-304"></a>
</span><span id="__span-13-305"><a id="__codelineno-13-305" name="__codelineno-13-305" href="#__codelineno-13-305"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
</span><span id="__span-13-306"><a id="__codelineno-13-306" name="__codelineno-13-306" href="#__codelineno-13-306"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="__span-13-307"><a id="__codelineno-13-307" name="__codelineno-13-307" href="#__codelineno-13-307"></a>                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Invalid JSON data&#39;</span><span class="p">}),</span> <span class="mi">400</span>
</span><span id="__span-13-308"><a id="__codelineno-13-308" name="__codelineno-13-308" href="#__codelineno-13-308"></a>
</span><span id="__span-13-309"><a id="__codelineno-13-309" name="__codelineno-13-309" href="#__codelineno-13-309"></a>            <span class="c1"># Input validation</span>
</span><span id="__span-13-310"><a id="__codelineno-13-310" name="__codelineno-13-310" href="#__codelineno-13-310"></a>            <span class="n">validation_rules</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-13-311"><a id="__codelineno-13-311" name="__codelineno-13-311" href="#__codelineno-13-311"></a>                <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-13-312"><a id="__codelineno-13-312" name="__codelineno-13-312" href="#__codelineno-13-312"></a>                    <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-13-313"><a id="__codelineno-13-313" name="__codelineno-13-313" href="#__codelineno-13-313"></a>                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-13-314"><a id="__codelineno-13-314" name="__codelineno-13-314" href="#__codelineno-13-314"></a>                    <span class="s1">&#39;min_length&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="__span-13-315"><a id="__codelineno-13-315" name="__codelineno-13-315" href="#__codelineno-13-315"></a>                    <span class="s1">&#39;max_length&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
</span><span id="__span-13-316"><a id="__codelineno-13-316" name="__codelineno-13-316" href="#__codelineno-13-316"></a>                    <span class="s1">&#39;pattern&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;^[a-zA-Z0-9_]+$&#39;</span>
</span><span id="__span-13-317"><a id="__codelineno-13-317" name="__codelineno-13-317" href="#__codelineno-13-317"></a>                <span class="p">},</span>
</span><span id="__span-13-318"><a id="__codelineno-13-318" name="__codelineno-13-318" href="#__codelineno-13-318"></a>                <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-13-319"><a id="__codelineno-13-319" name="__codelineno-13-319" href="#__codelineno-13-319"></a>                    <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-13-320"><a id="__codelineno-13-320" name="__codelineno-13-320" href="#__codelineno-13-320"></a>                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-13-321"><a id="__codelineno-13-321" name="__codelineno-13-321" href="#__codelineno-13-321"></a>                    <span class="s1">&#39;pattern&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$&#39;</span>
</span><span id="__span-13-322"><a id="__codelineno-13-322" name="__codelineno-13-322" href="#__codelineno-13-322"></a>                <span class="p">},</span>
</span><span id="__span-13-323"><a id="__codelineno-13-323" name="__codelineno-13-323" href="#__codelineno-13-323"></a>                <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-13-324"><a id="__codelineno-13-324" name="__codelineno-13-324" href="#__codelineno-13-324"></a>                    <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-13-325"><a id="__codelineno-13-325" name="__codelineno-13-325" href="#__codelineno-13-325"></a>                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-13-326"><a id="__codelineno-13-326" name="__codelineno-13-326" href="#__codelineno-13-326"></a>                    <span class="s1">&#39;min_length&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
</span><span id="__span-13-327"><a id="__codelineno-13-327" name="__codelineno-13-327" href="#__codelineno-13-327"></a>                    <span class="s1">&#39;validator&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="p">)</span> <span class="ow">and</span> 
</span><span id="__span-13-328"><a id="__codelineno-13-328" name="__codelineno-13-328" href="#__codelineno-13-328"></a>                                         <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">islower</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="p">)</span> <span class="ow">and</span> 
</span><span id="__span-13-329"><a id="__codelineno-13-329" name="__codelineno-13-329" href="#__codelineno-13-329"></a>                                         <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="p">)</span>
</span><span id="__span-13-330"><a id="__codelineno-13-330" name="__codelineno-13-330" href="#__codelineno-13-330"></a>                <span class="p">}</span>
</span><span id="__span-13-331"><a id="__codelineno-13-331" name="__codelineno-13-331" href="#__codelineno-13-331"></a>            <span class="p">}</span>
</span><span id="__span-13-332"><a id="__codelineno-13-332" name="__codelineno-13-332" href="#__codelineno-13-332"></a>
</span><span id="__span-13-333"><a id="__codelineno-13-333" name="__codelineno-13-333" href="#__codelineno-13-333"></a>            <span class="n">is_valid</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_input</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">validation_rules</span><span class="p">)</span>
</span><span id="__span-13-334"><a id="__codelineno-13-334" name="__codelineno-13-334" href="#__codelineno-13-334"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid</span><span class="p">:</span>
</span><span id="__span-13-335"><a id="__codelineno-13-335" name="__codelineno-13-335" href="#__codelineno-13-335"></a>                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Validation failed&#39;</span><span class="p">,</span> <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="n">errors</span><span class="p">}),</span> <span class="mi">400</span>
</span><span id="__span-13-336"><a id="__codelineno-13-336" name="__codelineno-13-336" href="#__codelineno-13-336"></a>
</span><span id="__span-13-337"><a id="__codelineno-13-337" name="__codelineno-13-337" href="#__codelineno-13-337"></a>            <span class="c1"># Sanitize input</span>
</span><span id="__span-13-338"><a id="__codelineno-13-338" name="__codelineno-13-338" href="#__codelineno-13-338"></a>            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sanitize_input</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-13-339"><a id="__codelineno-13-339" name="__codelineno-13-339" href="#__codelineno-13-339"></a>
</span><span id="__span-13-340"><a id="__codelineno-13-340" name="__codelineno-13-340" href="#__codelineno-13-340"></a>            <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_db_connection</span><span class="p">()</span>
</span><span id="__span-13-341"><a id="__codelineno-13-341" name="__codelineno-13-341" href="#__codelineno-13-341"></a>            <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span><span id="__span-13-342"><a id="__codelineno-13-342" name="__codelineno-13-342" href="#__codelineno-13-342"></a>
</span><span id="__span-13-343"><a id="__codelineno-13-343" name="__codelineno-13-343" href="#__codelineno-13-343"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-13-344"><a id="__codelineno-13-344" name="__codelineno-13-344" href="#__codelineno-13-344"></a>                <span class="c1"># Check if user already exists</span>
</span><span id="__span-13-345"><a id="__codelineno-13-345" name="__codelineno-13-345" href="#__codelineno-13-345"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT id FROM users WHERE username = ? OR email = ?&#39;</span><span class="p">,</span> 
</span><span id="__span-13-346"><a id="__codelineno-13-346" name="__codelineno-13-346" href="#__codelineno-13-346"></a>                             <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]))</span>
</span><span id="__span-13-347"><a id="__codelineno-13-347" name="__codelineno-13-347" href="#__codelineno-13-347"></a>                <span class="k">if</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">():</span>
</span><span id="__span-13-348"><a id="__codelineno-13-348" name="__codelineno-13-348" href="#__codelineno-13-348"></a>                    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;User already exists&#39;</span><span class="p">}),</span> <span class="mi">409</span>
</span><span id="__span-13-349"><a id="__codelineno-13-349" name="__codelineno-13-349" href="#__codelineno-13-349"></a>
</span><span id="__span-13-350"><a id="__codelineno-13-350" name="__codelineno-13-350" href="#__codelineno-13-350"></a>                <span class="c1"># Generate salt and hash password</span>
</span><span id="__span-13-351"><a id="__codelineno-13-351" name="__codelineno-13-351" href="#__codelineno-13-351"></a>                <span class="n">salt</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_hex</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
</span><span id="__span-13-352"><a id="__codelineno-13-352" name="__codelineno-13-352" href="#__codelineno-13-352"></a>                <span class="n">password_hash</span> <span class="o">=</span> <span class="n">generate_password_hash</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">salt</span><span class="p">)</span>
</span><span id="__span-13-353"><a id="__codelineno-13-353" name="__codelineno-13-353" href="#__codelineno-13-353"></a>
</span><span id="__span-13-354"><a id="__codelineno-13-354" name="__codelineno-13-354" href="#__codelineno-13-354"></a>                <span class="c1"># Insert user</span>
</span><span id="__span-13-355"><a id="__codelineno-13-355" name="__codelineno-13-355" href="#__codelineno-13-355"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
</span><span id="__span-13-356"><a id="__codelineno-13-356" name="__codelineno-13-356" href="#__codelineno-13-356"></a><span class="s1">                    INSERT INTO users (username, email, password_hash, salt)</span>
</span><span id="__span-13-357"><a id="__codelineno-13-357" name="__codelineno-13-357" href="#__codelineno-13-357"></a><span class="s1">                    VALUES (?, ?, ?, ?)</span>
</span><span id="__span-13-358"><a id="__codelineno-13-358" name="__codelineno-13-358" href="#__codelineno-13-358"></a><span class="s1">                &#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">],</span> <span class="n">password_hash</span><span class="p">,</span> <span class="n">salt</span><span class="p">))</span>
</span><span id="__span-13-359"><a id="__codelineno-13-359" name="__codelineno-13-359" href="#__codelineno-13-359"></a>
</span><span id="__span-13-360"><a id="__codelineno-13-360" name="__codelineno-13-360" href="#__codelineno-13-360"></a>                <span class="n">user_id</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">lastrowid</span>
</span><span id="__span-13-361"><a id="__codelineno-13-361" name="__codelineno-13-361" href="#__codelineno-13-361"></a>                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span id="__span-13-362"><a id="__codelineno-13-362" name="__codelineno-13-362" href="#__codelineno-13-362"></a>
</span><span id="__span-13-363"><a id="__codelineno-13-363" name="__codelineno-13-363" href="#__codelineno-13-363"></a>                <span class="c1"># Generate JWT token</span>
</span><span id="__span-13-364"><a id="__codelineno-13-364" name="__codelineno-13-364" href="#__codelineno-13-364"></a>                <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jwt_manager</span><span class="o">.</span><span class="n">generate_token</span><span class="p">(</span>
</span><span id="__span-13-365"><a id="__codelineno-13-365" name="__codelineno-13-365" href="#__codelineno-13-365"></a>                    <span class="n">user_id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span>
</span><span id="__span-13-366"><a id="__codelineno-13-366" name="__codelineno-13-366" href="#__codelineno-13-366"></a>                    <span class="n">permissions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="s1">&#39;write&#39;</span><span class="p">]</span>
</span><span id="__span-13-367"><a id="__codelineno-13-367" name="__codelineno-13-367" href="#__codelineno-13-367"></a>                <span class="p">)</span>
</span><span id="__span-13-368"><a id="__codelineno-13-368" name="__codelineno-13-368" href="#__codelineno-13-368"></a>
</span><span id="__span-13-369"><a id="__codelineno-13-369" name="__codelineno-13-369" href="#__codelineno-13-369"></a>                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
</span><span id="__span-13-370"><a id="__codelineno-13-370" name="__codelineno-13-370" href="#__codelineno-13-370"></a>                    <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;User registered successfully&#39;</span><span class="p">,</span>
</span><span id="__span-13-371"><a id="__codelineno-13-371" name="__codelineno-13-371" href="#__codelineno-13-371"></a>                    <span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="n">token</span><span class="p">,</span>
</span><span id="__span-13-372"><a id="__codelineno-13-372" name="__codelineno-13-372" href="#__codelineno-13-372"></a>                    <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-13-373"><a id="__codelineno-13-373" name="__codelineno-13-373" href="#__codelineno-13-373"></a>                        <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
</span><span id="__span-13-374"><a id="__codelineno-13-374" name="__codelineno-13-374" href="#__codelineno-13-374"></a>                        <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span>
</span><span id="__span-13-375"><a id="__codelineno-13-375" name="__codelineno-13-375" href="#__codelineno-13-375"></a>                        <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span>
</span><span id="__span-13-376"><a id="__codelineno-13-376" name="__codelineno-13-376" href="#__codelineno-13-376"></a>                    <span class="p">}</span>
</span><span id="__span-13-377"><a id="__codelineno-13-377" name="__codelineno-13-377" href="#__codelineno-13-377"></a>                <span class="p">}),</span> <span class="mi">201</span>
</span><span id="__span-13-378"><a id="__codelineno-13-378" name="__codelineno-13-378" href="#__codelineno-13-378"></a>
</span><span id="__span-13-379"><a id="__codelineno-13-379" name="__codelineno-13-379" href="#__codelineno-13-379"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-13-380"><a id="__codelineno-13-380" name="__codelineno-13-380" href="#__codelineno-13-380"></a>                <span class="n">conn</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
</span><span id="__span-13-381"><a id="__codelineno-13-381" name="__codelineno-13-381" href="#__codelineno-13-381"></a>                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Registration failed&#39;</span><span class="p">}),</span> <span class="mi">500</span>
</span><span id="__span-13-382"><a id="__codelineno-13-382" name="__codelineno-13-382" href="#__codelineno-13-382"></a>
</span><span id="__span-13-383"><a id="__codelineno-13-383" name="__codelineno-13-383" href="#__codelineno-13-383"></a>            <span class="k">finally</span><span class="p">:</span>
</span><span id="__span-13-384"><a id="__codelineno-13-384" name="__codelineno-13-384" href="#__codelineno-13-384"></a>                <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-13-385"><a id="__codelineno-13-385" name="__codelineno-13-385" href="#__codelineno-13-385"></a>
</span><span id="__span-13-386"><a id="__codelineno-13-386" name="__codelineno-13-386" href="#__codelineno-13-386"></a>        <span class="nd">@self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/auth/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">])</span>
</span><span id="__span-13-387"><a id="__codelineno-13-387" name="__codelineno-13-387" href="#__codelineno-13-387"></a>        <span class="nd">@self</span><span class="o">.</span><span class="n">require_cors</span><span class="p">()</span>
</span><span id="__span-13-388"><a id="__codelineno-13-388" name="__codelineno-13-388" href="#__codelineno-13-388"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">login</span><span class="p">():</span>
</span><span id="__span-13-389"><a id="__codelineno-13-389" name="__codelineno-13-389" href="#__codelineno-13-389"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;User login with brute force protection&quot;&quot;&quot;</span>
</span><span id="__span-13-390"><a id="__codelineno-13-390" name="__codelineno-13-390" href="#__codelineno-13-390"></a>            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span>
</span><span id="__span-13-391"><a id="__codelineno-13-391" name="__codelineno-13-391" href="#__codelineno-13-391"></a>                <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">200</span>
</span><span id="__span-13-392"><a id="__codelineno-13-392" name="__codelineno-13-392" href="#__codelineno-13-392"></a>
</span><span id="__span-13-393"><a id="__codelineno-13-393" name="__codelineno-13-393" href="#__codelineno-13-393"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
</span><span id="__span-13-394"><a id="__codelineno-13-394" name="__codelineno-13-394" href="#__codelineno-13-394"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="__span-13-395"><a id="__codelineno-13-395" name="__codelineno-13-395" href="#__codelineno-13-395"></a>                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Invalid JSON data&#39;</span><span class="p">}),</span> <span class="mi">400</span>
</span><span id="__span-13-396"><a id="__codelineno-13-396" name="__codelineno-13-396" href="#__codelineno-13-396"></a>
</span><span id="__span-13-397"><a id="__codelineno-13-397" name="__codelineno-13-397" href="#__codelineno-13-397"></a>            <span class="c1"># Input validation</span>
</span><span id="__span-13-398"><a id="__codelineno-13-398" name="__codelineno-13-398" href="#__codelineno-13-398"></a>            <span class="n">validation_rules</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-13-399"><a id="__codelineno-13-399" name="__codelineno-13-399" href="#__codelineno-13-399"></a>                <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">},</span>
</span><span id="__span-13-400"><a id="__codelineno-13-400" name="__codelineno-13-400" href="#__codelineno-13-400"></a>                <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">}</span>
</span><span id="__span-13-401"><a id="__codelineno-13-401" name="__codelineno-13-401" href="#__codelineno-13-401"></a>            <span class="p">}</span>
</span><span id="__span-13-402"><a id="__codelineno-13-402" name="__codelineno-13-402" href="#__codelineno-13-402"></a>
</span><span id="__span-13-403"><a id="__codelineno-13-403" name="__codelineno-13-403" href="#__codelineno-13-403"></a>            <span class="n">is_valid</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_input</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">validation_rules</span><span class="p">)</span>
</span><span id="__span-13-404"><a id="__codelineno-13-404" name="__codelineno-13-404" href="#__codelineno-13-404"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid</span><span class="p">:</span>
</span><span id="__span-13-405"><a id="__codelineno-13-405" name="__codelineno-13-405" href="#__codelineno-13-405"></a>                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Validation failed&#39;</span><span class="p">,</span> <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="n">errors</span><span class="p">}),</span> <span class="mi">400</span>
</span><span id="__span-13-406"><a id="__codelineno-13-406" name="__codelineno-13-406" href="#__codelineno-13-406"></a>
</span><span id="__span-13-407"><a id="__codelineno-13-407" name="__codelineno-13-407" href="#__codelineno-13-407"></a>            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sanitize_input</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-13-408"><a id="__codelineno-13-408" name="__codelineno-13-408" href="#__codelineno-13-408"></a>
</span><span id="__span-13-409"><a id="__codelineno-13-409" name="__codelineno-13-409" href="#__codelineno-13-409"></a>            <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_db_connection</span><span class="p">()</span>
</span><span id="__span-13-410"><a id="__codelineno-13-410" name="__codelineno-13-410" href="#__codelineno-13-410"></a>            <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span><span id="__span-13-411"><a id="__codelineno-13-411" name="__codelineno-13-411" href="#__codelineno-13-411"></a>
</span><span id="__span-13-412"><a id="__codelineno-13-412" name="__codelineno-13-412" href="#__codelineno-13-412"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-13-413"><a id="__codelineno-13-413" name="__codelineno-13-413" href="#__codelineno-13-413"></a>                <span class="c1"># Get user with security info</span>
</span><span id="__span-13-414"><a id="__codelineno-13-414" name="__codelineno-13-414" href="#__codelineno-13-414"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
</span><span id="__span-13-415"><a id="__codelineno-13-415" name="__codelineno-13-415" href="#__codelineno-13-415"></a><span class="s1">                    SELECT id, username, email, password_hash, salt, </span>
</span><span id="__span-13-416"><a id="__codelineno-13-416" name="__codelineno-13-416" href="#__codelineno-13-416"></a><span class="s1">                           failed_login_attempts, last_failed_login, is_active</span>
</span><span id="__span-13-417"><a id="__codelineno-13-417" name="__codelineno-13-417" href="#__codelineno-13-417"></a><span class="s1">                    FROM users WHERE username = ?</span>
</span><span id="__span-13-418"><a id="__codelineno-13-418" name="__codelineno-13-418" href="#__codelineno-13-418"></a><span class="s1">                &#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],))</span>
</span><span id="__span-13-419"><a id="__codelineno-13-419" name="__codelineno-13-419" href="#__codelineno-13-419"></a>
</span><span id="__span-13-420"><a id="__codelineno-13-420" name="__codelineno-13-420" href="#__codelineno-13-420"></a>                <span class="n">user</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="__span-13-421"><a id="__codelineno-13-421" name="__codelineno-13-421" href="#__codelineno-13-421"></a>
</span><span id="__span-13-422"><a id="__codelineno-13-422" name="__codelineno-13-422" href="#__codelineno-13-422"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;is_active&#39;</span><span class="p">]:</span>
</span><span id="__span-13-423"><a id="__codelineno-13-423" name="__codelineno-13-423" href="#__codelineno-13-423"></a>                    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Invalid credentials&#39;</span><span class="p">}),</span> <span class="mi">401</span>
</span><span id="__span-13-424"><a id="__codelineno-13-424" name="__codelineno-13-424" href="#__codelineno-13-424"></a>
</span><span id="__span-13-425"><a id="__codelineno-13-425" name="__codelineno-13-425" href="#__codelineno-13-425"></a>                <span class="c1"># Check for account lockout (brute force protection)</span>
</span><span id="__span-13-426"><a id="__codelineno-13-426" name="__codelineno-13-426" href="#__codelineno-13-426"></a>                <span class="k">if</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;failed_login_attempts&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="__span-13-427"><a id="__codelineno-13-427" name="__codelineno-13-427" href="#__codelineno-13-427"></a>                    <span class="n">last_failed</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;last_failed_login&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;last_failed_login&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="__span-13-428"><a id="__codelineno-13-428" name="__codelineno-13-428" href="#__codelineno-13-428"></a>                    <span class="k">if</span> <span class="n">last_failed</span> <span class="ow">and</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">last_failed</span> <span class="o">&lt;</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
</span><span id="__span-13-429"><a id="__codelineno-13-429" name="__codelineno-13-429" href="#__codelineno-13-429"></a>                        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
</span><span id="__span-13-430"><a id="__codelineno-13-430" name="__codelineno-13-430" href="#__codelineno-13-430"></a>                            <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Account temporarily locked due to failed login attempts&#39;</span>
</span><span id="__span-13-431"><a id="__codelineno-13-431" name="__codelineno-13-431" href="#__codelineno-13-431"></a>                        <span class="p">}),</span> <span class="mi">423</span>
</span><span id="__span-13-432"><a id="__codelineno-13-432" name="__codelineno-13-432" href="#__codelineno-13-432"></a>
</span><span id="__span-13-433"><a id="__codelineno-13-433" name="__codelineno-13-433" href="#__codelineno-13-433"></a>                <span class="c1"># Verify password</span>
</span><span id="__span-13-434"><a id="__codelineno-13-434" name="__codelineno-13-434" href="#__codelineno-13-434"></a>                <span class="k">if</span> <span class="n">check_password_hash</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;password_hash&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;salt&#39;</span><span class="p">]):</span>
</span><span id="__span-13-435"><a id="__codelineno-13-435" name="__codelineno-13-435" href="#__codelineno-13-435"></a>                    <span class="c1"># Reset failed attempts on successful login</span>
</span><span id="__span-13-436"><a id="__codelineno-13-436" name="__codelineno-13-436" href="#__codelineno-13-436"></a>                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
</span><span id="__span-13-437"><a id="__codelineno-13-437" name="__codelineno-13-437" href="#__codelineno-13-437"></a><span class="s1">                        UPDATE users SET failed_login_attempts = 0, last_failed_login = NULL </span>
</span><span id="__span-13-438"><a id="__codelineno-13-438" name="__codelineno-13-438" href="#__codelineno-13-438"></a><span class="s1">                        WHERE id = ?</span>
</span><span id="__span-13-439"><a id="__codelineno-13-439" name="__codelineno-13-439" href="#__codelineno-13-439"></a><span class="s1">                    &#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],))</span>
</span><span id="__span-13-440"><a id="__codelineno-13-440" name="__codelineno-13-440" href="#__codelineno-13-440"></a>                    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span id="__span-13-441"><a id="__codelineno-13-441" name="__codelineno-13-441" href="#__codelineno-13-441"></a>
</span><span id="__span-13-442"><a id="__codelineno-13-442" name="__codelineno-13-442" href="#__codelineno-13-442"></a>                    <span class="c1"># Generate JWT token</span>
</span><span id="__span-13-443"><a id="__codelineno-13-443" name="__codelineno-13-443" href="#__codelineno-13-443"></a>                    <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jwt_manager</span><span class="o">.</span><span class="n">generate_token</span><span class="p">(</span>
</span><span id="__span-13-444"><a id="__codelineno-13-444" name="__codelineno-13-444" href="#__codelineno-13-444"></a>                        <span class="n">user_id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]),</span>
</span><span id="__span-13-445"><a id="__codelineno-13-445" name="__codelineno-13-445" href="#__codelineno-13-445"></a>                        <span class="n">permissions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="s1">&#39;write&#39;</span><span class="p">]</span>
</span><span id="__span-13-446"><a id="__codelineno-13-446" name="__codelineno-13-446" href="#__codelineno-13-446"></a>                    <span class="p">)</span>
</span><span id="__span-13-447"><a id="__codelineno-13-447" name="__codelineno-13-447" href="#__codelineno-13-447"></a>
</span><span id="__span-13-448"><a id="__codelineno-13-448" name="__codelineno-13-448" href="#__codelineno-13-448"></a>                    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
</span><span id="__span-13-449"><a id="__codelineno-13-449" name="__codelineno-13-449" href="#__codelineno-13-449"></a>                        <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Login successful&#39;</span><span class="p">,</span>
</span><span id="__span-13-450"><a id="__codelineno-13-450" name="__codelineno-13-450" href="#__codelineno-13-450"></a>                        <span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="n">token</span><span class="p">,</span>
</span><span id="__span-13-451"><a id="__codelineno-13-451" name="__codelineno-13-451" href="#__codelineno-13-451"></a>                        <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-13-452"><a id="__codelineno-13-452" name="__codelineno-13-452" href="#__codelineno-13-452"></a>                            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
</span><span id="__span-13-453"><a id="__codelineno-13-453" name="__codelineno-13-453" href="#__codelineno-13-453"></a>                            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span>
</span><span id="__span-13-454"><a id="__codelineno-13-454" name="__codelineno-13-454" href="#__codelineno-13-454"></a>                            <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span>
</span><span id="__span-13-455"><a id="__codelineno-13-455" name="__codelineno-13-455" href="#__codelineno-13-455"></a>                        <span class="p">}</span>
</span><span id="__span-13-456"><a id="__codelineno-13-456" name="__codelineno-13-456" href="#__codelineno-13-456"></a>                    <span class="p">}),</span> <span class="mi">200</span>
</span><span id="__span-13-457"><a id="__codelineno-13-457" name="__codelineno-13-457" href="#__codelineno-13-457"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-13-458"><a id="__codelineno-13-458" name="__codelineno-13-458" href="#__codelineno-13-458"></a>                    <span class="c1"># Increment failed login attempts</span>
</span><span id="__span-13-459"><a id="__codelineno-13-459" name="__codelineno-13-459" href="#__codelineno-13-459"></a>                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
</span><span id="__span-13-460"><a id="__codelineno-13-460" name="__codelineno-13-460" href="#__codelineno-13-460"></a><span class="s1">                        UPDATE users SET </span>
</span><span id="__span-13-461"><a id="__codelineno-13-461" name="__codelineno-13-461" href="#__codelineno-13-461"></a><span class="s1">                            failed_login_attempts = failed_login_attempts + 1,</span>
</span><span id="__span-13-462"><a id="__codelineno-13-462" name="__codelineno-13-462" href="#__codelineno-13-462"></a><span class="s1">                            last_failed_login = CURRENT_TIMESTAMP</span>
</span><span id="__span-13-463"><a id="__codelineno-13-463" name="__codelineno-13-463" href="#__codelineno-13-463"></a><span class="s1">                        WHERE id = ?</span>
</span><span id="__span-13-464"><a id="__codelineno-13-464" name="__codelineno-13-464" href="#__codelineno-13-464"></a><span class="s1">                    &#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],))</span>
</span><span id="__span-13-465"><a id="__codelineno-13-465" name="__codelineno-13-465" href="#__codelineno-13-465"></a>                    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span id="__span-13-466"><a id="__codelineno-13-466" name="__codelineno-13-466" href="#__codelineno-13-466"></a>
</span><span id="__span-13-467"><a id="__codelineno-13-467" name="__codelineno-13-467" href="#__codelineno-13-467"></a>                    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Invalid credentials&#39;</span><span class="p">}),</span> <span class="mi">401</span>
</span><span id="__span-13-468"><a id="__codelineno-13-468" name="__codelineno-13-468" href="#__codelineno-13-468"></a>
</span><span id="__span-13-469"><a id="__codelineno-13-469" name="__codelineno-13-469" href="#__codelineno-13-469"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-13-470"><a id="__codelineno-13-470" name="__codelineno-13-470" href="#__codelineno-13-470"></a>                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Login failed&#39;</span><span class="p">}),</span> <span class="mi">500</span>
</span><span id="__span-13-471"><a id="__codelineno-13-471" name="__codelineno-13-471" href="#__codelineno-13-471"></a>
</span><span id="__span-13-472"><a id="__codelineno-13-472" name="__codelineno-13-472" href="#__codelineno-13-472"></a>            <span class="k">finally</span><span class="p">:</span>
</span><span id="__span-13-473"><a id="__codelineno-13-473" name="__codelineno-13-473" href="#__codelineno-13-473"></a>                <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-13-474"><a id="__codelineno-13-474" name="__codelineno-13-474" href="#__codelineno-13-474"></a>
</span><span id="__span-13-475"><a id="__codelineno-13-475" name="__codelineno-13-475" href="#__codelineno-13-475"></a>        <span class="c1"># Task management endpoints</span>
</span><span id="__span-13-476"><a id="__codelineno-13-476" name="__codelineno-13-476" href="#__codelineno-13-476"></a>        <span class="nd">@self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/tasks&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">])</span>
</span><span id="__span-13-477"><a id="__codelineno-13-477" name="__codelineno-13-477" href="#__codelineno-13-477"></a>        <span class="nd">@self</span><span class="o">.</span><span class="n">require_cors</span><span class="p">()</span>
</span><span id="__span-13-478"><a id="__codelineno-13-478" name="__codelineno-13-478" href="#__codelineno-13-478"></a>        <span class="nd">@self</span><span class="o">.</span><span class="n">require_auth</span><span class="p">([</span><span class="s1">&#39;read&#39;</span><span class="p">])</span>
</span><span id="__span-13-479"><a id="__codelineno-13-479" name="__codelineno-13-479" href="#__codelineno-13-479"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">get_tasks</span><span class="p">():</span>
</span><span id="__span-13-480"><a id="__codelineno-13-480" name="__codelineno-13-480" href="#__codelineno-13-480"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Get user&#39;s tasks with pagination&quot;&quot;&quot;</span>
</span><span id="__span-13-481"><a id="__codelineno-13-481" name="__codelineno-13-481" href="#__codelineno-13-481"></a>            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span>
</span><span id="__span-13-482"><a id="__codelineno-13-482" name="__codelineno-13-482" href="#__codelineno-13-482"></a>                <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">200</span>
</span><span id="__span-13-483"><a id="__codelineno-13-483" name="__codelineno-13-483" href="#__codelineno-13-483"></a>
</span><span id="__span-13-484"><a id="__codelineno-13-484" name="__codelineno-13-484" href="#__codelineno-13-484"></a>            <span class="c1"># Get pagination parameters</span>
</span><span id="__span-13-485"><a id="__codelineno-13-485" name="__codelineno-13-485" href="#__codelineno-13-485"></a>            <span class="n">page</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
</span><span id="__span-13-486"><a id="__codelineno-13-486" name="__codelineno-13-486" href="#__codelineno-13-486"></a>            <span class="n">limit</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;limit&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>  <span class="c1"># Cap at 100</span>
</span><span id="__span-13-487"><a id="__codelineno-13-487" name="__codelineno-13-487" href="#__codelineno-13-487"></a>            <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">limit</span>
</span><span id="__span-13-488"><a id="__codelineno-13-488" name="__codelineno-13-488" href="#__codelineno-13-488"></a>
</span><span id="__span-13-489"><a id="__codelineno-13-489" name="__codelineno-13-489" href="#__codelineno-13-489"></a>            <span class="c1"># Get filter parameters</span>
</span><span id="__span-13-490"><a id="__codelineno-13-490" name="__codelineno-13-490" href="#__codelineno-13-490"></a>            <span class="n">status_filter</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-13-491"><a id="__codelineno-13-491" name="__codelineno-13-491" href="#__codelineno-13-491"></a>            <span class="n">priority_filter</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;priority&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
</span><span id="__span-13-492"><a id="__codelineno-13-492" name="__codelineno-13-492" href="#__codelineno-13-492"></a>
</span><span id="__span-13-493"><a id="__codelineno-13-493" name="__codelineno-13-493" href="#__codelineno-13-493"></a>            <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_db_connection</span><span class="p">()</span>
</span><span id="__span-13-494"><a id="__codelineno-13-494" name="__codelineno-13-494" href="#__codelineno-13-494"></a>            <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span><span id="__span-13-495"><a id="__codelineno-13-495" name="__codelineno-13-495" href="#__codelineno-13-495"></a>
</span><span id="__span-13-496"><a id="__codelineno-13-496" name="__codelineno-13-496" href="#__codelineno-13-496"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-13-497"><a id="__codelineno-13-497" name="__codelineno-13-497" href="#__codelineno-13-497"></a>                <span class="c1"># Build query with filters</span>
</span><span id="__span-13-498"><a id="__codelineno-13-498" name="__codelineno-13-498" href="#__codelineno-13-498"></a>                <span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
</span><span id="__span-13-499"><a id="__codelineno-13-499" name="__codelineno-13-499" href="#__codelineno-13-499"></a><span class="s1">                    SELECT id, title, description, status, priority, created_at, updated_at</span>
</span><span id="__span-13-500"><a id="__codelineno-13-500" name="__codelineno-13-500" href="#__codelineno-13-500"></a><span class="s1">                    FROM tasks WHERE user_id = ?</span>
</span><span id="__span-13-501"><a id="__codelineno-13-501" name="__codelineno-13-501" href="#__codelineno-13-501"></a><span class="s1">                &#39;&#39;&#39;</span>
</span><span id="__span-13-502"><a id="__codelineno-13-502" name="__codelineno-13-502" href="#__codelineno-13-502"></a>                <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">current_user</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]]</span>
</span><span id="__span-13-503"><a id="__codelineno-13-503" name="__codelineno-13-503" href="#__codelineno-13-503"></a>
</span><span id="__span-13-504"><a id="__codelineno-13-504" name="__codelineno-13-504" href="#__codelineno-13-504"></a>                <span class="k">if</span> <span class="n">status_filter</span><span class="p">:</span>
</span><span id="__span-13-505"><a id="__codelineno-13-505" name="__codelineno-13-505" href="#__codelineno-13-505"></a>                    <span class="n">query</span> <span class="o">+=</span> <span class="s1">&#39; AND status = ?&#39;</span>
</span><span id="__span-13-506"><a id="__codelineno-13-506" name="__codelineno-13-506" href="#__codelineno-13-506"></a>                    <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">status_filter</span><span class="p">)</span>
</span><span id="__span-13-507"><a id="__codelineno-13-507" name="__codelineno-13-507" href="#__codelineno-13-507"></a>
</span><span id="__span-13-508"><a id="__codelineno-13-508" name="__codelineno-13-508" href="#__codelineno-13-508"></a>                <span class="k">if</span> <span class="n">priority_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-13-509"><a id="__codelineno-13-509" name="__codelineno-13-509" href="#__codelineno-13-509"></a>                    <span class="n">query</span> <span class="o">+=</span> <span class="s1">&#39; AND priority = ?&#39;</span>
</span><span id="__span-13-510"><a id="__codelineno-13-510" name="__codelineno-13-510" href="#__codelineno-13-510"></a>                    <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">priority_filter</span><span class="p">)</span>
</span><span id="__span-13-511"><a id="__codelineno-13-511" name="__codelineno-13-511" href="#__codelineno-13-511"></a>
</span><span id="__span-13-512"><a id="__codelineno-13-512" name="__codelineno-13-512" href="#__codelineno-13-512"></a>                <span class="n">query</span> <span class="o">+=</span> <span class="s1">&#39; ORDER BY created_at DESC LIMIT ? OFFSET ?&#39;</span>
</span><span id="__span-13-513"><a id="__codelineno-13-513" name="__codelineno-13-513" href="#__codelineno-13-513"></a>                <span class="n">params</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">limit</span><span class="p">,</span> <span class="n">offset</span><span class="p">])</span>
</span><span id="__span-13-514"><a id="__codelineno-13-514" name="__codelineno-13-514" href="#__codelineno-13-514"></a>
</span><span id="__span-13-515"><a id="__codelineno-13-515" name="__codelineno-13-515" href="#__codelineno-13-515"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</span><span id="__span-13-516"><a id="__codelineno-13-516" name="__codelineno-13-516" href="#__codelineno-13-516"></a>                <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
</span><span id="__span-13-517"><a id="__codelineno-13-517" name="__codelineno-13-517" href="#__codelineno-13-517"></a>
</span><span id="__span-13-518"><a id="__codelineno-13-518" name="__codelineno-13-518" href="#__codelineno-13-518"></a>                <span class="c1"># Get total count for pagination</span>
</span><span id="__span-13-519"><a id="__codelineno-13-519" name="__codelineno-13-519" href="#__codelineno-13-519"></a>                <span class="n">count_query</span> <span class="o">=</span> <span class="s1">&#39;SELECT COUNT(*) FROM tasks WHERE user_id = ?&#39;</span>
</span><span id="__span-13-520"><a id="__codelineno-13-520" name="__codelineno-13-520" href="#__codelineno-13-520"></a>                <span class="n">count_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">current_user</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]]</span>
</span><span id="__span-13-521"><a id="__codelineno-13-521" name="__codelineno-13-521" href="#__codelineno-13-521"></a>
</span><span id="__span-13-522"><a id="__codelineno-13-522" name="__codelineno-13-522" href="#__codelineno-13-522"></a>                <span class="k">if</span> <span class="n">status_filter</span><span class="p">:</span>
</span><span id="__span-13-523"><a id="__codelineno-13-523" name="__codelineno-13-523" href="#__codelineno-13-523"></a>                    <span class="n">count_query</span> <span class="o">+=</span> <span class="s1">&#39; AND status = ?&#39;</span>
</span><span id="__span-13-524"><a id="__codelineno-13-524" name="__codelineno-13-524" href="#__codelineno-13-524"></a>                    <span class="n">count_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">status_filter</span><span class="p">)</span>
</span><span id="__span-13-525"><a id="__codelineno-13-525" name="__codelineno-13-525" href="#__codelineno-13-525"></a>
</span><span id="__span-13-526"><a id="__codelineno-13-526" name="__codelineno-13-526" href="#__codelineno-13-526"></a>                <span class="k">if</span> <span class="n">priority_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-13-527"><a id="__codelineno-13-527" name="__codelineno-13-527" href="#__codelineno-13-527"></a>                    <span class="n">count_query</span> <span class="o">+=</span> <span class="s1">&#39; AND priority = ?&#39;</span>
</span><span id="__span-13-528"><a id="__codelineno-13-528" name="__codelineno-13-528" href="#__codelineno-13-528"></a>                    <span class="n">count_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">priority_filter</span><span class="p">)</span>
</span><span id="__span-13-529"><a id="__codelineno-13-529" name="__codelineno-13-529" href="#__codelineno-13-529"></a>
</span><span id="__span-13-530"><a id="__codelineno-13-530" name="__codelineno-13-530" href="#__codelineno-13-530"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">count_query</span><span class="p">,</span> <span class="n">count_params</span><span class="p">)</span>
</span><span id="__span-13-531"><a id="__codelineno-13-531" name="__codelineno-13-531" href="#__codelineno-13-531"></a>                <span class="n">total_count</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-13-532"><a id="__codelineno-13-532" name="__codelineno-13-532" href="#__codelineno-13-532"></a>
</span><span id="__span-13-533"><a id="__codelineno-13-533" name="__codelineno-13-533" href="#__codelineno-13-533"></a>                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
</span><span id="__span-13-534"><a id="__codelineno-13-534" name="__codelineno-13-534" href="#__codelineno-13-534"></a>                    <span class="s1">&#39;tasks&#39;</span><span class="p">:</span> <span class="n">tasks</span><span class="p">,</span>
</span><span id="__span-13-535"><a id="__codelineno-13-535" name="__codelineno-13-535" href="#__codelineno-13-535"></a>                    <span class="s1">&#39;pagination&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-13-536"><a id="__codelineno-13-536" name="__codelineno-13-536" href="#__codelineno-13-536"></a>                        <span class="s1">&#39;page&#39;</span><span class="p">:</span> <span class="n">page</span><span class="p">,</span>
</span><span id="__span-13-537"><a id="__codelineno-13-537" name="__codelineno-13-537" href="#__codelineno-13-537"></a>                        <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
</span><span id="__span-13-538"><a id="__codelineno-13-538" name="__codelineno-13-538" href="#__codelineno-13-538"></a>                        <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="n">total_count</span><span class="p">,</span>
</span><span id="__span-13-539"><a id="__codelineno-13-539" name="__codelineno-13-539" href="#__codelineno-13-539"></a>                        <span class="s1">&#39;pages&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">total_count</span> <span class="o">+</span> <span class="n">limit</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">limit</span>
</span><span id="__span-13-540"><a id="__codelineno-13-540" name="__codelineno-13-540" href="#__codelineno-13-540"></a>                    <span class="p">}</span>
</span><span id="__span-13-541"><a id="__codelineno-13-541" name="__codelineno-13-541" href="#__codelineno-13-541"></a>                <span class="p">}),</span> <span class="mi">200</span>
</span><span id="__span-13-542"><a id="__codelineno-13-542" name="__codelineno-13-542" href="#__codelineno-13-542"></a>
</span><span id="__span-13-543"><a id="__codelineno-13-543" name="__codelineno-13-543" href="#__codelineno-13-543"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-13-544"><a id="__codelineno-13-544" name="__codelineno-13-544" href="#__codelineno-13-544"></a>                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Failed to fetch tasks&#39;</span><span class="p">}),</span> <span class="mi">500</span>
</span><span id="__span-13-545"><a id="__codelineno-13-545" name="__codelineno-13-545" href="#__codelineno-13-545"></a>
</span><span id="__span-13-546"><a id="__codelineno-13-546" name="__codelineno-13-546" href="#__codelineno-13-546"></a>            <span class="k">finally</span><span class="p">:</span>
</span><span id="__span-13-547"><a id="__codelineno-13-547" name="__codelineno-13-547" href="#__codelineno-13-547"></a>                <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-13-548"><a id="__codelineno-13-548" name="__codelineno-13-548" href="#__codelineno-13-548"></a>
</span><span id="__span-13-549"><a id="__codelineno-13-549" name="__codelineno-13-549" href="#__codelineno-13-549"></a>        <span class="nd">@self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/tasks&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">])</span>
</span><span id="__span-13-550"><a id="__codelineno-13-550" name="__codelineno-13-550" href="#__codelineno-13-550"></a>        <span class="nd">@self</span><span class="o">.</span><span class="n">require_cors</span><span class="p">()</span>
</span><span id="__span-13-551"><a id="__codelineno-13-551" name="__codelineno-13-551" href="#__codelineno-13-551"></a>        <span class="nd">@self</span><span class="o">.</span><span class="n">require_auth</span><span class="p">([</span><span class="s1">&#39;write&#39;</span><span class="p">])</span>
</span><span id="__span-13-552"><a id="__codelineno-13-552" name="__codelineno-13-552" href="#__codelineno-13-552"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">create_task</span><span class="p">():</span>
</span><span id="__span-13-553"><a id="__codelineno-13-553" name="__codelineno-13-553" href="#__codelineno-13-553"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Create a new task&quot;&quot;&quot;</span>
</span><span id="__span-13-554"><a id="__codelineno-13-554" name="__codelineno-13-554" href="#__codelineno-13-554"></a>            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span>
</span><span id="__span-13-555"><a id="__codelineno-13-555" name="__codelineno-13-555" href="#__codelineno-13-555"></a>                <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">200</span>
</span><span id="__span-13-556"><a id="__codelineno-13-556" name="__codelineno-13-556" href="#__codelineno-13-556"></a>
</span><span id="__span-13-557"><a id="__codelineno-13-557" name="__codelineno-13-557" href="#__codelineno-13-557"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
</span><span id="__span-13-558"><a id="__codelineno-13-558" name="__codelineno-13-558" href="#__codelineno-13-558"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="__span-13-559"><a id="__codelineno-13-559" name="__codelineno-13-559" href="#__codelineno-13-559"></a>                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Invalid JSON data&#39;</span><span class="p">}),</span> <span class="mi">400</span>
</span><span id="__span-13-560"><a id="__codelineno-13-560" name="__codelineno-13-560" href="#__codelineno-13-560"></a>
</span><span id="__span-13-561"><a id="__codelineno-13-561" name="__codelineno-13-561" href="#__codelineno-13-561"></a>            <span class="c1"># Input validation</span>
</span><span id="__span-13-562"><a id="__codelineno-13-562" name="__codelineno-13-562" href="#__codelineno-13-562"></a>            <span class="n">validation_rules</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-13-563"><a id="__codelineno-13-563" name="__codelineno-13-563" href="#__codelineno-13-563"></a>                <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-13-564"><a id="__codelineno-13-564" name="__codelineno-13-564" href="#__codelineno-13-564"></a>                    <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-13-565"><a id="__codelineno-13-565" name="__codelineno-13-565" href="#__codelineno-13-565"></a>                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-13-566"><a id="__codelineno-13-566" name="__codelineno-13-566" href="#__codelineno-13-566"></a>                    <span class="s1">&#39;min_length&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="__span-13-567"><a id="__codelineno-13-567" name="__codelineno-13-567" href="#__codelineno-13-567"></a>                    <span class="s1">&#39;max_length&#39;</span><span class="p">:</span> <span class="mi">200</span>
</span><span id="__span-13-568"><a id="__codelineno-13-568" name="__codelineno-13-568" href="#__codelineno-13-568"></a>                <span class="p">},</span>
</span><span id="__span-13-569"><a id="__codelineno-13-569" name="__codelineno-13-569" href="#__codelineno-13-569"></a>                <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-13-570"><a id="__codelineno-13-570" name="__codelineno-13-570" href="#__codelineno-13-570"></a>                    <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-13-571"><a id="__codelineno-13-571" name="__codelineno-13-571" href="#__codelineno-13-571"></a>                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-13-572"><a id="__codelineno-13-572" name="__codelineno-13-572" href="#__codelineno-13-572"></a>                    <span class="s1">&#39;max_length&#39;</span><span class="p">:</span> <span class="mi">1000</span>
</span><span id="__span-13-573"><a id="__codelineno-13-573" name="__codelineno-13-573" href="#__codelineno-13-573"></a>                <span class="p">},</span>
</span><span id="__span-13-574"><a id="__codelineno-13-574" name="__codelineno-13-574" href="#__codelineno-13-574"></a>                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-13-575"><a id="__codelineno-13-575" name="__codelineno-13-575" href="#__codelineno-13-575"></a>                    <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-13-576"><a id="__codelineno-13-576" name="__codelineno-13-576" href="#__codelineno-13-576"></a>                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-13-577"><a id="__codelineno-13-577" name="__codelineno-13-577" href="#__codelineno-13-577"></a>                    <span class="s1">&#39;validator&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pending&#39;</span><span class="p">,</span> <span class="s1">&#39;in_progress&#39;</span><span class="p">,</span> <span class="s1">&#39;completed&#39;</span><span class="p">]</span>
</span><span id="__span-13-578"><a id="__codelineno-13-578" name="__codelineno-13-578" href="#__codelineno-13-578"></a>                <span class="p">},</span>
</span><span id="__span-13-579"><a id="__codelineno-13-579" name="__codelineno-13-579" href="#__codelineno-13-579"></a>                <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-13-580"><a id="__codelineno-13-580" name="__codelineno-13-580" href="#__codelineno-13-580"></a>                    <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-13-581"><a id="__codelineno-13-581" name="__codelineno-13-581" href="#__codelineno-13-581"></a>                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-13-582"><a id="__codelineno-13-582" name="__codelineno-13-582" href="#__codelineno-13-582"></a>                    <span class="s1">&#39;validator&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="mi">5</span>
</span><span id="__span-13-583"><a id="__codelineno-13-583" name="__codelineno-13-583" href="#__codelineno-13-583"></a>                <span class="p">}</span>
</span><span id="__span-13-584"><a id="__codelineno-13-584" name="__codelineno-13-584" href="#__codelineno-13-584"></a>            <span class="p">}</span>
</span><span id="__span-13-585"><a id="__codelineno-13-585" name="__codelineno-13-585" href="#__codelineno-13-585"></a>
</span><span id="__span-13-586"><a id="__codelineno-13-586" name="__codelineno-13-586" href="#__codelineno-13-586"></a>            <span class="n">is_valid</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_input</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">validation_rules</span><span class="p">)</span>
</span><span id="__span-13-587"><a id="__codelineno-13-587" name="__codelineno-13-587" href="#__codelineno-13-587"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid</span><span class="p">:</span>
</span><span id="__span-13-588"><a id="__codelineno-13-588" name="__codelineno-13-588" href="#__codelineno-13-588"></a>                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Validation failed&#39;</span><span class="p">,</span> <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="n">errors</span><span class="p">}),</span> <span class="mi">400</span>
</span><span id="__span-13-589"><a id="__codelineno-13-589" name="__codelineno-13-589" href="#__codelineno-13-589"></a>
</span><span id="__span-13-590"><a id="__codelineno-13-590" name="__codelineno-13-590" href="#__codelineno-13-590"></a>            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sanitize_input</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-13-591"><a id="__codelineno-13-591" name="__codelineno-13-591" href="#__codelineno-13-591"></a>
</span><span id="__span-13-592"><a id="__codelineno-13-592" name="__codelineno-13-592" href="#__codelineno-13-592"></a>            <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_db_connection</span><span class="p">()</span>
</span><span id="__span-13-593"><a id="__codelineno-13-593" name="__codelineno-13-593" href="#__codelineno-13-593"></a>            <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span><span id="__span-13-594"><a id="__codelineno-13-594" name="__codelineno-13-594" href="#__codelineno-13-594"></a>
</span><span id="__span-13-595"><a id="__codelineno-13-595" name="__codelineno-13-595" href="#__codelineno-13-595"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-13-596"><a id="__codelineno-13-596" name="__codelineno-13-596" href="#__codelineno-13-596"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
</span><span id="__span-13-597"><a id="__codelineno-13-597" name="__codelineno-13-597" href="#__codelineno-13-597"></a><span class="s1">                    INSERT INTO tasks (user_id, title, description, status, priority)</span>
</span><span id="__span-13-598"><a id="__codelineno-13-598" name="__codelineno-13-598" href="#__codelineno-13-598"></a><span class="s1">                    VALUES (?, ?, ?, ?, ?)</span>
</span><span id="__span-13-599"><a id="__codelineno-13-599" name="__codelineno-13-599" href="#__codelineno-13-599"></a><span class="s1">                &#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span>
</span><span id="__span-13-600"><a id="__codelineno-13-600" name="__codelineno-13-600" href="#__codelineno-13-600"></a>                    <span class="n">g</span><span class="o">.</span><span class="n">current_user</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">],</span>
</span><span id="__span-13-601"><a id="__codelineno-13-601" name="__codelineno-13-601" href="#__codelineno-13-601"></a>                    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span>
</span><span id="__span-13-602"><a id="__codelineno-13-602" name="__codelineno-13-602" href="#__codelineno-13-602"></a>                    <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
</span><span id="__span-13-603"><a id="__codelineno-13-603" name="__codelineno-13-603" href="#__codelineno-13-603"></a>                    <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;pending&#39;</span><span class="p">),</span>
</span><span id="__span-13-604"><a id="__codelineno-13-604" name="__codelineno-13-604" href="#__codelineno-13-604"></a>                    <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;priority&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-13-605"><a id="__codelineno-13-605" name="__codelineno-13-605" href="#__codelineno-13-605"></a>                <span class="p">))</span>
</span><span id="__span-13-606"><a id="__codelineno-13-606" name="__codelineno-13-606" href="#__codelineno-13-606"></a>
</span><span id="__span-13-607"><a id="__codelineno-13-607" name="__codelineno-13-607" href="#__codelineno-13-607"></a>                <span class="n">task_id</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">lastrowid</span>
</span><span id="__span-13-608"><a id="__codelineno-13-608" name="__codelineno-13-608" href="#__codelineno-13-608"></a>                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span id="__span-13-609"><a id="__codelineno-13-609" name="__codelineno-13-609" href="#__codelineno-13-609"></a>
</span><span id="__span-13-610"><a id="__codelineno-13-610" name="__codelineno-13-610" href="#__codelineno-13-610"></a>                <span class="c1"># Fetch the created task</span>
</span><span id="__span-13-611"><a id="__codelineno-13-611" name="__codelineno-13-611" href="#__codelineno-13-611"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
</span><span id="__span-13-612"><a id="__codelineno-13-612" name="__codelineno-13-612" href="#__codelineno-13-612"></a><span class="s1">                    SELECT id, title, description, status, priority, created_at, updated_at</span>
</span><span id="__span-13-613"><a id="__codelineno-13-613" name="__codelineno-13-613" href="#__codelineno-13-613"></a><span class="s1">                    FROM tasks WHERE id = ?</span>
</span><span id="__span-13-614"><a id="__codelineno-13-614" name="__codelineno-13-614" href="#__codelineno-13-614"></a><span class="s1">                &#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">task_id</span><span class="p">,))</span>
</span><span id="__span-13-615"><a id="__codelineno-13-615" name="__codelineno-13-615" href="#__codelineno-13-615"></a>
</span><span id="__span-13-616"><a id="__codelineno-13-616" name="__codelineno-13-616" href="#__codelineno-13-616"></a>                <span class="n">task</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">())</span>
</span><span id="__span-13-617"><a id="__codelineno-13-617" name="__codelineno-13-617" href="#__codelineno-13-617"></a>
</span><span id="__span-13-618"><a id="__codelineno-13-618" name="__codelineno-13-618" href="#__codelineno-13-618"></a>                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
</span><span id="__span-13-619"><a id="__codelineno-13-619" name="__codelineno-13-619" href="#__codelineno-13-619"></a>                    <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Task created successfully&#39;</span><span class="p">,</span>
</span><span id="__span-13-620"><a id="__codelineno-13-620" name="__codelineno-13-620" href="#__codelineno-13-620"></a>                    <span class="s1">&#39;task&#39;</span><span class="p">:</span> <span class="n">task</span>
</span><span id="__span-13-621"><a id="__codelineno-13-621" name="__codelineno-13-621" href="#__codelineno-13-621"></a>                <span class="p">}),</span> <span class="mi">201</span>
</span><span id="__span-13-622"><a id="__codelineno-13-622" name="__codelineno-13-622" href="#__codelineno-13-622"></a>
</span><span id="__span-13-623"><a id="__codelineno-13-623" name="__codelineno-13-623" href="#__codelineno-13-623"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-13-624"><a id="__codelineno-13-624" name="__codelineno-13-624" href="#__codelineno-13-624"></a>                <span class="n">conn</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
</span><span id="__span-13-625"><a id="__codelineno-13-625" name="__codelineno-13-625" href="#__codelineno-13-625"></a>                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Failed to create task&#39;</span><span class="p">}),</span> <span class="mi">500</span>
</span><span id="__span-13-626"><a id="__codelineno-13-626" name="__codelineno-13-626" href="#__codelineno-13-626"></a>
</span><span id="__span-13-627"><a id="__codelineno-13-627" name="__codelineno-13-627" href="#__codelineno-13-627"></a>            <span class="k">finally</span><span class="p">:</span>
</span><span id="__span-13-628"><a id="__codelineno-13-628" name="__codelineno-13-628" href="#__codelineno-13-628"></a>                <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-13-629"><a id="__codelineno-13-629" name="__codelineno-13-629" href="#__codelineno-13-629"></a>
</span><span id="__span-13-630"><a id="__codelineno-13-630" name="__codelineno-13-630" href="#__codelineno-13-630"></a>        <span class="nd">@self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/tasks/&lt;int:task_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;PUT&#39;</span><span class="p">,</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">])</span>
</span><span id="__span-13-631"><a id="__codelineno-13-631" name="__codelineno-13-631" href="#__codelineno-13-631"></a>        <span class="nd">@self</span><span class="o">.</span><span class="n">require_cors</span><span class="p">()</span>
</span><span id="__span-13-632"><a id="__codelineno-13-632" name="__codelineno-13-632" href="#__codelineno-13-632"></a>        <span class="nd">@self</span><span class="o">.</span><span class="n">require_auth</span><span class="p">([</span><span class="s1">&#39;write&#39;</span><span class="p">])</span>
</span><span id="__span-13-633"><a id="__codelineno-13-633" name="__codelineno-13-633" href="#__codelineno-13-633"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">update_task</span><span class="p">(</span><span class="n">task_id</span><span class="p">):</span>
</span><span id="__span-13-634"><a id="__codelineno-13-634" name="__codelineno-13-634" href="#__codelineno-13-634"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Update an existing task&quot;&quot;&quot;</span>
</span><span id="__span-13-635"><a id="__codelineno-13-635" name="__codelineno-13-635" href="#__codelineno-13-635"></a>            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span>
</span><span id="__span-13-636"><a id="__codelineno-13-636" name="__codelineno-13-636" href="#__codelineno-13-636"></a>                <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">200</span>
</span><span id="__span-13-637"><a id="__codelineno-13-637" name="__codelineno-13-637" href="#__codelineno-13-637"></a>
</span><span id="__span-13-638"><a id="__codelineno-13-638" name="__codelineno-13-638" href="#__codelineno-13-638"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
</span><span id="__span-13-639"><a id="__codelineno-13-639" name="__codelineno-13-639" href="#__codelineno-13-639"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="__span-13-640"><a id="__codelineno-13-640" name="__codelineno-13-640" href="#__codelineno-13-640"></a>                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Invalid JSON data&#39;</span><span class="p">}),</span> <span class="mi">400</span>
</span><span id="__span-13-641"><a id="__codelineno-13-641" name="__codelineno-13-641" href="#__codelineno-13-641"></a>
</span><span id="__span-13-642"><a id="__codelineno-13-642" name="__codelineno-13-642" href="#__codelineno-13-642"></a>            <span class="c1"># Input validation (same as create)</span>
</span><span id="__span-13-643"><a id="__codelineno-13-643" name="__codelineno-13-643" href="#__codelineno-13-643"></a>            <span class="n">validation_rules</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-13-644"><a id="__codelineno-13-644" name="__codelineno-13-644" href="#__codelineno-13-644"></a>                <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-13-645"><a id="__codelineno-13-645" name="__codelineno-13-645" href="#__codelineno-13-645"></a>                    <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-13-646"><a id="__codelineno-13-646" name="__codelineno-13-646" href="#__codelineno-13-646"></a>                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-13-647"><a id="__codelineno-13-647" name="__codelineno-13-647" href="#__codelineno-13-647"></a>                    <span class="s1">&#39;min_length&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="__span-13-648"><a id="__codelineno-13-648" name="__codelineno-13-648" href="#__codelineno-13-648"></a>                    <span class="s1">&#39;max_length&#39;</span><span class="p">:</span> <span class="mi">200</span>
</span><span id="__span-13-649"><a id="__codelineno-13-649" name="__codelineno-13-649" href="#__codelineno-13-649"></a>                <span class="p">},</span>
</span><span id="__span-13-650"><a id="__codelineno-13-650" name="__codelineno-13-650" href="#__codelineno-13-650"></a>                <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-13-651"><a id="__codelineno-13-651" name="__codelineno-13-651" href="#__codelineno-13-651"></a>                    <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-13-652"><a id="__codelineno-13-652" name="__codelineno-13-652" href="#__codelineno-13-652"></a>                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-13-653"><a id="__codelineno-13-653" name="__codelineno-13-653" href="#__codelineno-13-653"></a>                    <span class="s1">&#39;max_length&#39;</span><span class="p">:</span> <span class="mi">1000</span>
</span><span id="__span-13-654"><a id="__codelineno-13-654" name="__codelineno-13-654" href="#__codelineno-13-654"></a>                <span class="p">},</span>
</span><span id="__span-13-655"><a id="__codelineno-13-655" name="__codelineno-13-655" href="#__codelineno-13-655"></a>                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-13-656"><a id="__codelineno-13-656" name="__codelineno-13-656" href="#__codelineno-13-656"></a>                    <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-13-657"><a id="__codelineno-13-657" name="__codelineno-13-657" href="#__codelineno-13-657"></a>                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-13-658"><a id="__codelineno-13-658" name="__codelineno-13-658" href="#__codelineno-13-658"></a>                    <span class="s1">&#39;validator&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pending&#39;</span><span class="p">,</span> <span class="s1">&#39;in_progress&#39;</span><span class="p">,</span> <span class="s1">&#39;completed&#39;</span><span class="p">]</span>
</span><span id="__span-13-659"><a id="__codelineno-13-659" name="__codelineno-13-659" href="#__codelineno-13-659"></a>                <span class="p">},</span>
</span><span id="__span-13-660"><a id="__codelineno-13-660" name="__codelineno-13-660" href="#__codelineno-13-660"></a>                <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-13-661"><a id="__codelineno-13-661" name="__codelineno-13-661" href="#__codelineno-13-661"></a>                    <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-13-662"><a id="__codelineno-13-662" name="__codelineno-13-662" href="#__codelineno-13-662"></a>                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-13-663"><a id="__codelineno-13-663" name="__codelineno-13-663" href="#__codelineno-13-663"></a>                    <span class="s1">&#39;validator&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="mi">5</span>
</span><span id="__span-13-664"><a id="__codelineno-13-664" name="__codelineno-13-664" href="#__codelineno-13-664"></a>                <span class="p">}</span>
</span><span id="__span-13-665"><a id="__codelineno-13-665" name="__codelineno-13-665" href="#__codelineno-13-665"></a>            <span class="p">}</span>
</span><span id="__span-13-666"><a id="__codelineno-13-666" name="__codelineno-13-666" href="#__codelineno-13-666"></a>
</span><span id="__span-13-667"><a id="__codelineno-13-667" name="__codelineno-13-667" href="#__codelineno-13-667"></a>            <span class="n">is_valid</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_input</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">validation_rules</span><span class="p">)</span>
</span><span id="__span-13-668"><a id="__codelineno-13-668" name="__codelineno-13-668" href="#__codelineno-13-668"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid</span><span class="p">:</span>
</span><span id="__span-13-669"><a id="__codelineno-13-669" name="__codelineno-13-669" href="#__codelineno-13-669"></a>                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Validation failed&#39;</span><span class="p">,</span> <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="n">errors</span><span class="p">}),</span> <span class="mi">400</span>
</span><span id="__span-13-670"><a id="__codelineno-13-670" name="__codelineno-13-670" href="#__codelineno-13-670"></a>
</span><span id="__span-13-671"><a id="__codelineno-13-671" name="__codelineno-13-671" href="#__codelineno-13-671"></a>            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sanitize_input</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-13-672"><a id="__codelineno-13-672" name="__codelineno-13-672" href="#__codelineno-13-672"></a>
</span><span id="__span-13-673"><a id="__codelineno-13-673" name="__codelineno-13-673" href="#__codelineno-13-673"></a>            <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_db_connection</span><span class="p">()</span>
</span><span id="__span-13-674"><a id="__codelineno-13-674" name="__codelineno-13-674" href="#__codelineno-13-674"></a>            <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span><span id="__span-13-675"><a id="__codelineno-13-675" name="__codelineno-13-675" href="#__codelineno-13-675"></a>
</span><span id="__span-13-676"><a id="__codelineno-13-676" name="__codelineno-13-676" href="#__codelineno-13-676"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-13-677"><a id="__codelineno-13-677" name="__codelineno-13-677" href="#__codelineno-13-677"></a>                <span class="c1"># Check if task exists and belongs to user</span>
</span><span id="__span-13-678"><a id="__codelineno-13-678" name="__codelineno-13-678" href="#__codelineno-13-678"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
</span><span id="__span-13-679"><a id="__codelineno-13-679" name="__codelineno-13-679" href="#__codelineno-13-679"></a><span class="s1">                    SELECT id FROM tasks WHERE id = ? AND user_id = ?</span>
</span><span id="__span-13-680"><a id="__codelineno-13-680" name="__codelineno-13-680" href="#__codelineno-13-680"></a><span class="s1">                &#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">task_id</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">current_user</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]))</span>
</span><span id="__span-13-681"><a id="__codelineno-13-681" name="__codelineno-13-681" href="#__codelineno-13-681"></a>
</span><span id="__span-13-682"><a id="__codelineno-13-682" name="__codelineno-13-682" href="#__codelineno-13-682"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">():</span>
</span><span id="__span-13-683"><a id="__codelineno-13-683" name="__codelineno-13-683" href="#__codelineno-13-683"></a>                    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Task not found&#39;</span><span class="p">}),</span> <span class="mi">404</span>
</span><span id="__span-13-684"><a id="__codelineno-13-684" name="__codelineno-13-684" href="#__codelineno-13-684"></a>
</span><span id="__span-13-685"><a id="__codelineno-13-685" name="__codelineno-13-685" href="#__codelineno-13-685"></a>                <span class="c1"># Build update query dynamically</span>
</span><span id="__span-13-686"><a id="__codelineno-13-686" name="__codelineno-13-686" href="#__codelineno-13-686"></a>                <span class="n">update_fields</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-13-687"><a id="__codelineno-13-687" name="__codelineno-13-687" href="#__codelineno-13-687"></a>                <span class="n">update_values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-13-688"><a id="__codelineno-13-688" name="__codelineno-13-688" href="#__codelineno-13-688"></a>
</span><span id="__span-13-689"><a id="__codelineno-13-689" name="__codelineno-13-689" href="#__codelineno-13-689"></a>                <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;priority&#39;</span><span class="p">]:</span>
</span><span id="__span-13-690"><a id="__codelineno-13-690" name="__codelineno-13-690" href="#__codelineno-13-690"></a>                    <span class="k">if</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="__span-13-691"><a id="__codelineno-13-691" name="__codelineno-13-691" href="#__codelineno-13-691"></a>                        <span class="n">update_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2"> = ?&quot;</span><span class="p">)</span>
</span><span id="__span-13-692"><a id="__codelineno-13-692" name="__codelineno-13-692" href="#__codelineno-13-692"></a>                        <span class="n">update_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">])</span>
</span><span id="__span-13-693"><a id="__codelineno-13-693" name="__codelineno-13-693" href="#__codelineno-13-693"></a>
</span><span id="__span-13-694"><a id="__codelineno-13-694" name="__codelineno-13-694" href="#__codelineno-13-694"></a>                <span class="k">if</span> <span class="n">update_fields</span><span class="p">:</span>
</span><span id="__span-13-695"><a id="__codelineno-13-695" name="__codelineno-13-695" href="#__codelineno-13-695"></a>                    <span class="n">update_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;updated_at = CURRENT_TIMESTAMP&quot;</span><span class="p">)</span>
</span><span id="__span-13-696"><a id="__codelineno-13-696" name="__codelineno-13-696" href="#__codelineno-13-696"></a>                    <span class="n">update_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span>
</span><span id="__span-13-697"><a id="__codelineno-13-697" name="__codelineno-13-697" href="#__codelineno-13-697"></a>
</span><span id="__span-13-698"><a id="__codelineno-13-698" name="__codelineno-13-698" href="#__codelineno-13-698"></a>                    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;UPDATE tasks SET </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">update_fields</span><span class="p">)</span><span class="si">}</span><span class="s2"> WHERE id = ?&quot;</span>
</span><span id="__span-13-699"><a id="__codelineno-13-699" name="__codelineno-13-699" href="#__codelineno-13-699"></a>                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">update_values</span><span class="p">)</span>
</span><span id="__span-13-700"><a id="__codelineno-13-700" name="__codelineno-13-700" href="#__codelineno-13-700"></a>                    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span id="__span-13-701"><a id="__codelineno-13-701" name="__codelineno-13-701" href="#__codelineno-13-701"></a>
</span><span id="__span-13-702"><a id="__codelineno-13-702" name="__codelineno-13-702" href="#__codelineno-13-702"></a>                <span class="c1"># Fetch updated task</span>
</span><span id="__span-13-703"><a id="__codelineno-13-703" name="__codelineno-13-703" href="#__codelineno-13-703"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
</span><span id="__span-13-704"><a id="__codelineno-13-704" name="__codelineno-13-704" href="#__codelineno-13-704"></a><span class="s1">                    SELECT id, title, description, status, priority, created_at, updated_at</span>
</span><span id="__span-13-705"><a id="__codelineno-13-705" name="__codelineno-13-705" href="#__codelineno-13-705"></a><span class="s1">                    FROM tasks WHERE id = ?</span>
</span><span id="__span-13-706"><a id="__codelineno-13-706" name="__codelineno-13-706" href="#__codelineno-13-706"></a><span class="s1">                &#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">task_id</span><span class="p">,))</span>
</span><span id="__span-13-707"><a id="__codelineno-13-707" name="__codelineno-13-707" href="#__codelineno-13-707"></a>
</span><span id="__span-13-708"><a id="__codelineno-13-708" name="__codelineno-13-708" href="#__codelineno-13-708"></a>                <span class="n">task</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">())</span>
</span><span id="__span-13-709"><a id="__codelineno-13-709" name="__codelineno-13-709" href="#__codelineno-13-709"></a>
</span><span id="__span-13-710"><a id="__codelineno-13-710" name="__codelineno-13-710" href="#__codelineno-13-710"></a>                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
</span><span id="__span-13-711"><a id="__codelineno-13-711" name="__codelineno-13-711" href="#__codelineno-13-711"></a>                    <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Task updated successfully&#39;</span><span class="p">,</span>
</span><span id="__span-13-712"><a id="__codelineno-13-712" name="__codelineno-13-712" href="#__codelineno-13-712"></a>                    <span class="s1">&#39;task&#39;</span><span class="p">:</span> <span class="n">task</span>
</span><span id="__span-13-713"><a id="__codelineno-13-713" name="__codelineno-13-713" href="#__codelineno-13-713"></a>                <span class="p">}),</span> <span class="mi">200</span>
</span><span id="__span-13-714"><a id="__codelineno-13-714" name="__codelineno-13-714" href="#__codelineno-13-714"></a>
</span><span id="__span-13-715"><a id="__codelineno-13-715" name="__codelineno-13-715" href="#__codelineno-13-715"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-13-716"><a id="__codelineno-13-716" name="__codelineno-13-716" href="#__codelineno-13-716"></a>                <span class="n">conn</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
</span><span id="__span-13-717"><a id="__codelineno-13-717" name="__codelineno-13-717" href="#__codelineno-13-717"></a>                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Failed to update task&#39;</span><span class="p">}),</span> <span class="mi">500</span>
</span><span id="__span-13-718"><a id="__codelineno-13-718" name="__codelineno-13-718" href="#__codelineno-13-718"></a>
</span><span id="__span-13-719"><a id="__codelineno-13-719" name="__codelineno-13-719" href="#__codelineno-13-719"></a>            <span class="k">finally</span><span class="p">:</span>
</span><span id="__span-13-720"><a id="__codelineno-13-720" name="__codelineno-13-720" href="#__codelineno-13-720"></a>                <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-13-721"><a id="__codelineno-13-721" name="__codelineno-13-721" href="#__codelineno-13-721"></a>
</span><span id="__span-13-722"><a id="__codelineno-13-722" name="__codelineno-13-722" href="#__codelineno-13-722"></a>        <span class="nd">@self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/tasks/&lt;int:task_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DELETE&#39;</span><span class="p">,</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">])</span>
</span><span id="__span-13-723"><a id="__codelineno-13-723" name="__codelineno-13-723" href="#__codelineno-13-723"></a>        <span class="nd">@self</span><span class="o">.</span><span class="n">require_cors</span><span class="p">()</span>
</span><span id="__span-13-724"><a id="__codelineno-13-724" name="__codelineno-13-724" href="#__codelineno-13-724"></a>        <span class="nd">@self</span><span class="o">.</span><span class="n">require_auth</span><span class="p">([</span><span class="s1">&#39;write&#39;</span><span class="p">])</span>
</span><span id="__span-13-725"><a id="__codelineno-13-725" name="__codelineno-13-725" href="#__codelineno-13-725"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">delete_task</span><span class="p">(</span><span class="n">task_id</span><span class="p">):</span>
</span><span id="__span-13-726"><a id="__codelineno-13-726" name="__codelineno-13-726" href="#__codelineno-13-726"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Delete a task&quot;&quot;&quot;</span>
</span><span id="__span-13-727"><a id="__codelineno-13-727" name="__codelineno-13-727" href="#__codelineno-13-727"></a>            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span>
</span><span id="__span-13-728"><a id="__codelineno-13-728" name="__codelineno-13-728" href="#__codelineno-13-728"></a>                <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">200</span>
</span><span id="__span-13-729"><a id="__codelineno-13-729" name="__codelineno-13-729" href="#__codelineno-13-729"></a>
</span><span id="__span-13-730"><a id="__codelineno-13-730" name="__codelineno-13-730" href="#__codelineno-13-730"></a>            <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_db_connection</span><span class="p">()</span>
</span><span id="__span-13-731"><a id="__codelineno-13-731" name="__codelineno-13-731" href="#__codelineno-13-731"></a>            <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span><span id="__span-13-732"><a id="__codelineno-13-732" name="__codelineno-13-732" href="#__codelineno-13-732"></a>
</span><span id="__span-13-733"><a id="__codelineno-13-733" name="__codelineno-13-733" href="#__codelineno-13-733"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-13-734"><a id="__codelineno-13-734" name="__codelineno-13-734" href="#__codelineno-13-734"></a>                <span class="c1"># Check if task exists and belongs to user</span>
</span><span id="__span-13-735"><a id="__codelineno-13-735" name="__codelineno-13-735" href="#__codelineno-13-735"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
</span><span id="__span-13-736"><a id="__codelineno-13-736" name="__codelineno-13-736" href="#__codelineno-13-736"></a><span class="s1">                    SELECT id FROM tasks WHERE id = ? AND user_id = ?</span>
</span><span id="__span-13-737"><a id="__codelineno-13-737" name="__codelineno-13-737" href="#__codelineno-13-737"></a><span class="s1">                &#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">task_id</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">current_user</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]))</span>
</span><span id="__span-13-738"><a id="__codelineno-13-738" name="__codelineno-13-738" href="#__codelineno-13-738"></a>
</span><span id="__span-13-739"><a id="__codelineno-13-739" name="__codelineno-13-739" href="#__codelineno-13-739"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">():</span>
</span><span id="__span-13-740"><a id="__codelineno-13-740" name="__codelineno-13-740" href="#__codelineno-13-740"></a>                    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Task not found&#39;</span><span class="p">}),</span> <span class="mi">404</span>
</span><span id="__span-13-741"><a id="__codelineno-13-741" name="__codelineno-13-741" href="#__codelineno-13-741"></a>
</span><span id="__span-13-742"><a id="__codelineno-13-742" name="__codelineno-13-742" href="#__codelineno-13-742"></a>                <span class="c1"># Delete the task</span>
</span><span id="__span-13-743"><a id="__codelineno-13-743" name="__codelineno-13-743" href="#__codelineno-13-743"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;DELETE FROM tasks WHERE id = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">task_id</span><span class="p">,))</span>
</span><span id="__span-13-744"><a id="__codelineno-13-744" name="__codelineno-13-744" href="#__codelineno-13-744"></a>                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span id="__span-13-745"><a id="__codelineno-13-745" name="__codelineno-13-745" href="#__codelineno-13-745"></a>
</span><span id="__span-13-746"><a id="__codelineno-13-746" name="__codelineno-13-746" href="#__codelineno-13-746"></a>                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Task deleted successfully&#39;</span><span class="p">}),</span> <span class="mi">200</span>
</span><span id="__span-13-747"><a id="__codelineno-13-747" name="__codelineno-13-747" href="#__codelineno-13-747"></a>
</span><span id="__span-13-748"><a id="__codelineno-13-748" name="__codelineno-13-748" href="#__codelineno-13-748"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-13-749"><a id="__codelineno-13-749" name="__codelineno-13-749" href="#__codelineno-13-749"></a>                <span class="n">conn</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
</span><span id="__span-13-750"><a id="__codelineno-13-750" name="__codelineno-13-750" href="#__codelineno-13-750"></a>                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Failed to delete task&#39;</span><span class="p">}),</span> <span class="mi">500</span>
</span><span id="__span-13-751"><a id="__codelineno-13-751" name="__codelineno-13-751" href="#__codelineno-13-751"></a>
</span><span id="__span-13-752"><a id="__codelineno-13-752" name="__codelineno-13-752" href="#__codelineno-13-752"></a>            <span class="k">finally</span><span class="p">:</span>
</span><span id="__span-13-753"><a id="__codelineno-13-753" name="__codelineno-13-753" href="#__codelineno-13-753"></a>                <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-13-754"><a id="__codelineno-13-754" name="__codelineno-13-754" href="#__codelineno-13-754"></a>
</span><span id="__span-13-755"><a id="__codelineno-13-755" name="__codelineno-13-755" href="#__codelineno-13-755"></a>        <span class="c1"># Health check endpoint</span>
</span><span id="__span-13-756"><a id="__codelineno-13-756" name="__codelineno-13-756" href="#__codelineno-13-756"></a>        <span class="nd">@self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/health&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span><span id="__span-13-757"><a id="__codelineno-13-757" name="__codelineno-13-757" href="#__codelineno-13-757"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">health_check</span><span class="p">():</span>
</span><span id="__span-13-758"><a id="__codelineno-13-758" name="__codelineno-13-758" href="#__codelineno-13-758"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;API health check&quot;&quot;&quot;</span>
</span><span id="__span-13-759"><a id="__codelineno-13-759" name="__codelineno-13-759" href="#__codelineno-13-759"></a>            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
</span><span id="__span-13-760"><a id="__codelineno-13-760" name="__codelineno-13-760" href="#__codelineno-13-760"></a>                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;healthy&#39;</span><span class="p">,</span>
</span><span id="__span-13-761"><a id="__codelineno-13-761" name="__codelineno-13-761" href="#__codelineno-13-761"></a>                <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="__span-13-762"><a id="__codelineno-13-762" name="__codelineno-13-762" href="#__codelineno-13-762"></a>                <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;1.0.0&#39;</span>
</span><span id="__span-13-763"><a id="__codelineno-13-763" name="__codelineno-13-763" href="#__codelineno-13-763"></a>            <span class="p">}),</span> <span class="mi">200</span>
</span><span id="__span-13-764"><a id="__codelineno-13-764" name="__codelineno-13-764" href="#__codelineno-13-764"></a>
</span><span id="__span-13-765"><a id="__codelineno-13-765" name="__codelineno-13-765" href="#__codelineno-13-765"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-13-766"><a id="__codelineno-13-766" name="__codelineno-13-766" href="#__codelineno-13-766"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the secure API server&quot;&quot;&quot;</span>
</span><span id="__span-13-767"><a id="__codelineno-13-767" name="__codelineno-13-767" href="#__codelineno-13-767"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting Secure Task API...&quot;</span><span class="p">)</span>
</span><span id="__span-13-768"><a id="__codelineno-13-768" name="__codelineno-13-768" href="#__codelineno-13-768"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Available endpoints:&quot;</span><span class="p">)</span>
</span><span id="__span-13-769"><a id="__codelineno-13-769" name="__codelineno-13-769" href="#__codelineno-13-769"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;POST   /api/auth/register&quot;</span><span class="p">)</span>
</span><span id="__span-13-770"><a id="__codelineno-13-770" name="__codelineno-13-770" href="#__codelineno-13-770"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;POST   /api/auth/login&quot;</span><span class="p">)</span>
</span><span id="__span-13-771"><a id="__codelineno-13-771" name="__codelineno-13-771" href="#__codelineno-13-771"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GET    /api/tasks&quot;</span><span class="p">)</span>
</span><span id="__span-13-772"><a id="__codelineno-13-772" name="__codelineno-13-772" href="#__codelineno-13-772"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;POST   /api/tasks&quot;</span><span class="p">)</span>
</span><span id="__span-13-773"><a id="__codelineno-13-773" name="__codelineno-13-773" href="#__codelineno-13-773"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PUT    /api/tasks/&lt;id&gt;&quot;</span><span class="p">)</span>
</span><span id="__span-13-774"><a id="__codelineno-13-774" name="__codelineno-13-774" href="#__codelineno-13-774"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DELETE /api/tasks/&lt;id&gt;&quot;</span><span class="p">)</span>
</span><span id="__span-13-775"><a id="__codelineno-13-775" name="__codelineno-13-775" href="#__codelineno-13-775"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GET    /api/health&quot;</span><span class="p">)</span>
</span><span id="__span-13-776"><a id="__codelineno-13-776" name="__codelineno-13-776" href="#__codelineno-13-776"></a>
</span><span id="__span-13-777"><a id="__codelineno-13-777" name="__codelineno-13-777" href="#__codelineno-13-777"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
</span><span id="__span-13-778"><a id="__codelineno-13-778" name="__codelineno-13-778" href="#__codelineno-13-778"></a>
</span><span id="__span-13-779"><a id="__codelineno-13-779" name="__codelineno-13-779" href="#__codelineno-13-779"></a><span class="k">def</span><span class="w"> </span><span class="nf">api_demonstration</span><span class="p">():</span>
</span><span id="__span-13-780"><a id="__codelineno-13-780" name="__codelineno-13-780" href="#__codelineno-13-780"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate the complete secure API&quot;&quot;&quot;</span>
</span><span id="__span-13-781"><a id="__codelineno-13-781" name="__codelineno-13-781" href="#__codelineno-13-781"></a>
</span><span id="__span-13-782"><a id="__codelineno-13-782" name="__codelineno-13-782" href="#__codelineno-13-782"></a>    <span class="c1"># Create and configure the API</span>
</span><span id="__span-13-783"><a id="__codelineno-13-783" name="__codelineno-13-783" href="#__codelineno-13-783"></a>    <span class="n">api</span> <span class="o">=</span> <span class="n">SecureTaskAPI</span><span class="p">()</span>
</span><span id="__span-13-784"><a id="__codelineno-13-784" name="__codelineno-13-784" href="#__codelineno-13-784"></a>
</span><span id="__span-13-785"><a id="__codelineno-13-785" name="__codelineno-13-785" href="#__codelineno-13-785"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Secure Task API initialized with:&quot;</span><span class="p">)</span>
</span><span id="__span-13-786"><a id="__codelineno-13-786" name="__codelineno-13-786" href="#__codelineno-13-786"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ JWT Authentication&quot;</span><span class="p">)</span>
</span><span id="__span-13-787"><a id="__codelineno-13-787" name="__codelineno-13-787" href="#__codelineno-13-787"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Rate Limiting&quot;</span><span class="p">)</span>
</span><span id="__span-13-788"><a id="__codelineno-13-788" name="__codelineno-13-788" href="#__codelineno-13-788"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ CORS Protection&quot;</span><span class="p">)</span>
</span><span id="__span-13-789"><a id="__codelineno-13-789" name="__codelineno-13-789" href="#__codelineno-13-789"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Input Validation&quot;</span><span class="p">)</span>
</span><span id="__span-13-790"><a id="__codelineno-13-790" name="__codelineno-13-790" href="#__codelineno-13-790"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ SQL Injection Prevention&quot;</span><span class="p">)</span>
</span><span id="__span-13-791"><a id="__codelineno-13-791" name="__codelineno-13-791" href="#__codelineno-13-791"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Session Management&quot;</span><span class="p">)</span>
</span><span id="__span-13-792"><a id="__codelineno-13-792" name="__codelineno-13-792" href="#__codelineno-13-792"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Brute Force Protection&quot;</span><span class="p">)</span>
</span><span id="__span-13-793"><a id="__codelineno-13-793" name="__codelineno-13-793" href="#__codelineno-13-793"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Comprehensive Logging&quot;</span><span class="p">)</span>
</span><span id="__span-13-794"><a id="__codelineno-13-794" name="__codelineno-13-794" href="#__codelineno-13-794"></a>
</span><span id="__span-13-795"><a id="__codelineno-13-795" name="__codelineno-13-795" href="#__codelineno-13-795"></a>    <span class="c1"># In a real application, you would call api.run()</span>
</span><span id="__span-13-796"><a id="__codelineno-13-796" name="__codelineno-13-796" href="#__codelineno-13-796"></a>    <span class="c1"># For demonstration, we&#39;ll show the security features</span>
</span><span id="__span-13-797"><a id="__codelineno-13-797" name="__codelineno-13-797" href="#__codelineno-13-797"></a>
</span><span id="__span-13-798"><a id="__codelineno-13-798" name="__codelineno-13-798" href="#__codelineno-13-798"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">API Security Features:&quot;</span><span class="p">)</span>
</span><span id="__span-13-799"><a id="__codelineno-13-799" name="__codelineno-13-799" href="#__codelineno-13-799"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. Authentication: JWT tokens with expiration&quot;</span><span class="p">)</span>
</span><span id="__span-13-800"><a id="__codelineno-13-800" name="__codelineno-13-800" href="#__codelineno-13-800"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2. Authorization: Permission-based access control&quot;</span><span class="p">)</span>
</span><span id="__span-13-801"><a id="__codelineno-13-801" name="__codelineno-13-801" href="#__codelineno-13-801"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3. Rate Limiting: Prevents abuse and DoS attacks&quot;</span><span class="p">)</span>
</span><span id="__span-13-802"><a id="__codelineno-13-802" name="__codelineno-13-802" href="#__codelineno-13-802"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;4. Input Validation: Comprehensive data validation&quot;</span><span class="p">)</span>
</span><span id="__span-13-803"><a id="__codelineno-13-803" name="__codelineno-13-803" href="#__codelineno-13-803"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;5. CORS: Configurable cross-origin policies&quot;</span><span class="p">)</span>
</span><span id="__span-13-804"><a id="__codelineno-13-804" name="__codelineno-13-804" href="#__codelineno-13-804"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;6. SQL Injection: Parameterized queries&quot;</span><span class="p">)</span>
</span><span id="__span-13-805"><a id="__codelineno-13-805" name="__codelineno-13-805" href="#__codelineno-13-805"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;7. XSS Prevention: Input sanitization&quot;</span><span class="p">)</span>
</span><span id="__span-13-806"><a id="__codelineno-13-806" name="__codelineno-13-806" href="#__codelineno-13-806"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;8. Brute Force: Account lockout mechanisms&quot;</span><span class="p">)</span>
</span><span id="__span-13-807"><a id="__codelineno-13-807" name="__codelineno-13-807" href="#__codelineno-13-807"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;9. Session Security: Secure session management&quot;</span><span class="p">)</span>
</span><span id="__span-13-808"><a id="__codelineno-13-808" name="__codelineno-13-808" href="#__codelineno-13-808"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;10. Error Handling: Safe error messages&quot;</span><span class="p">)</span>
</span><span id="__span-13-809"><a id="__codelineno-13-809" name="__codelineno-13-809" href="#__codelineno-13-809"></a>
</span><span id="__span-13-810"><a id="__codelineno-13-810" name="__codelineno-13-810" href="#__codelineno-13-810"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-13-811"><a id="__codelineno-13-811" name="__codelineno-13-811" href="#__codelineno-13-811"></a>    <span class="n">api_demonstration</span><span class="p">()</span>
</span></code></pre></div>
<h2 id="summary-and-best-practices">Summary and Best Practices<a class="headerlink" href="#summary-and-best-practices" title="Permanent link">&para;</a></h2>
<p>This section has covered comprehensive API security through practical implementation. Here are the key takeaways:</p>
<h3 id="essential-security-principles">Essential Security Principles<a class="headerlink" href="#essential-security-principles" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Defense in Depth</strong>: Multiple layers of security controls</p>
</li>
<li>
<p><strong>Fail Securely</strong>: Default to secure states when errors occur</p>
</li>
<li>
<p><strong>Least Privilege</strong>: Grant minimum necessary permissions</p>
</li>
<li>
<p><strong>Security by Design</strong>: Build security from the ground up</p>
</li>
</ol>
<h3 id="implementation-checklist">Implementation Checklist<a class="headerlink" href="#implementation-checklist" title="Permanent link">&para;</a></h3>
<details class="example">
<summary>Authentication Security</summary>
<h4 id="api-keys">API Keys<a class="headerlink" href="#api-keys" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Cryptographically secure generation</p>
</li>
<li>
<p>Secure storage (hash, never plain text)</p>
</li>
<li>
<p>Expiration and revocation mechanisms</p>
</li>
<li>
<p>Rate limiting integration</p>
</li>
</ul>
<h4 id="jwt-tokens">JWT Tokens<a class="headerlink" href="#jwt-tokens" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Strong secret keys</p>
</li>
<li>
<p>Token expiration policies</p>
</li>
<li>
<p>Blacklist capabilities</p>
</li>
<li>
<p>Permission-based access control</p>
</li>
</ul>
<h4 id="oauth-20">OAuth 2.0<a class="headerlink" href="#oauth-20" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Proper flow implementation</p>
</li>
<li>
<p>Scope validation</p>
</li>
<li>
<p>State parameter for CSRF protection</p>
</li>
<li>
<p>Secure token storage</p>
</li>
</ul>
</details>
<details class="example">
<summary>Rate Limiting &amp; DoS Protection</summary>
<h4 id="token-bucket-algorithm">Token Bucket Algorithm<a class="headerlink" href="#token-bucket-algorithm" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Configurable rates per identifier</p>
</li>
<li>
<p>Burst capacity management</p>
</li>
<li>
<p>Thread-safe implementation</p>
</li>
</ul>
<h4 id="progressive-penalties">Progressive Penalties<a class="headerlink" href="#progressive-penalties" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Suspicion level calculation</p>
</li>
<li>
<p>IP-based blocking</p>
</li>
<li>
<p>Pattern recognition</p>
</li>
<li>
<p>Automated responses</p>
</li>
</ul>
</details>
<details class="example">
<summary>Session Management</summary>
<h4 id="secure-session-ids">Secure Session IDs<a class="headerlink" href="#secure-session-ids" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Cryptographically random generation</p>
</li>
<li>
<p>Session rotation to prevent fixation</p>
</li>
<li>
<p>Timeout management</p>
</li>
<li>
<p>IP and user agent validation</p>
</li>
</ul>
<h4 id="security-features">Security Features<a class="headerlink" href="#security-features" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>CSRF token protection</p>
</li>
<li>
<p>Concurrent session limits</p>
</li>
<li>
<p>Suspicious activity tracking</p>
</li>
<li>
<p>Secure cookie attributes</p>
</li>
</ul>
</details>
<details class="example">
<summary>CORS Security</summary>
<h4 id="origin-validation">Origin Validation<a class="headerlink" href="#origin-validation" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Whitelist-based origin control</p>
</li>
<li>
<p>Pattern matching with security checks</p>
</li>
<li>
<p>Credential-aware policies</p>
</li>
<li>
<p>Preflight request handling</p>
</li>
</ul>
<h4 id="security-patterns">Security Patterns<a class="headerlink" href="#security-patterns" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Dangerous origin blocking</p>
</li>
<li>
<p>Method restriction</p>
</li>
<li>
<p>Header validation</p>
</li>
<li>
<p>Environment-specific policies</p>
</li>
</ul>
</details>
<details class="example">
<summary>Security Testing</summary>
<h4 id="automated-testing">Automated Testing<a class="headerlink" href="#automated-testing" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Authentication vulnerability tests</p>
</li>
<li>
<p>Injection attack simulation</p>
</li>
<li>
<p>Rate limiting verification</p>
</li>
<li>
<p>CORS policy validation</p>
</li>
</ul>
<h4 id="comprehensive-coverage">Comprehensive Coverage<a class="headerlink" href="#comprehensive-coverage" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>SQL injection with real payloads</p>
</li>
<li>
<p>XSS detection mechanisms</p>
</li>
<li>
<p>Path traversal testing</p>
</li>
<li>
<p>Security score calculation</p>
</li>
</ul>
</details>
<h3 id="production-deployment-considerations">Production Deployment Considerations<a class="headerlink" href="#production-deployment-considerations" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>HTTPS Only</strong>: Never deploy APIs without TLS encryption</p>
</li>
<li>
<p><strong>Environment Separation</strong>: Different security policies for dev/staging/production</p>
</li>
<li>
<p><strong>Monitoring</strong>: Comprehensive logging and alerting</p>
</li>
<li>
<p><strong>Updates</strong>: Regular security patches and dependency updates</p>
</li>
<li>
<p><strong>Backup</strong>: Secure data backup and recovery procedures</p>
</li>
</ol>
<h3 id="common-pitfalls-to-avoid">Common Pitfalls to Avoid<a class="headerlink" href="#common-pitfalls-to-avoid" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>Overly Permissive CORS</strong>: Never use <code>*</code> with credentials enabled</p>
</li>
<li>
<p><strong>Weak Rate Limiting</strong>: Implement multiple rate limiting strategies</p>
</li>
<li>
<p><strong>Poor Error Messages</strong>: Don&rsquo;t leak sensitive information in errors</p>
</li>
<li>
<p><strong>Insufficient Logging</strong>: Log security events for monitoring</p>
</li>
<li>
<p><strong>Hardcoded Secrets</strong>: Use environment variables for sensitive data</p>
</li>
</ul>
<p>This comprehensive implementation provides a solid foundation for building secure APIs that protect against real-world threats while maintaining usability and performance.</p>
<h2 id="practice-questions-and-exercises">Practice Questions and Exercises<a class="headerlink" href="#practice-questions-and-exercises" title="Permanent link">&para;</a></h2>
<details class="tip">
<summary>Quick Review Questions</summary>
<ol>
<li>
<p>What are the three main components of a JWT token and what information does each contain?</p>
</li>
<li>
<p>Explain the difference between symmetric and asymmetric encryption in the context of API security.</p>
</li>
<li>
<p>How does the token bucket algorithm prevent DoS attacks while allowing legitimate burst traffic?</p>
</li>
<li>
<p>What is the purpose of the <code>OPTIONS</code> method in CORS preflight requests?</p>
</li>
<li>
<p>Why should API keys be stored as hashes rather than plain text?</p>
</li>
<li>
<p>What security vulnerabilities does session rotation help prevent?</p>
</li>
<li>
<p>Explain how rate limiting can be implemented at different layers of an API architecture.</p>
</li>
<li>
<p>What is the significance of the <code>nonce</code> parameter in OAuth 2.0 flows?</p>
</li>
<li>
<p>How do CSRF tokens protect against cross-site request forgery attacks?</p>
</li>
<li>
<p>What are the key indicators that an API security testing framework should monitor?</p>
</li>
</ol>
</details>
<details class="example">
<summary>Practical Programming Exercises</summary>
<h3 id="exercise-1-secure-registration-system">Exercise 1: Secure Registration System<a class="headerlink" href="#exercise-1-secure-registration-system" title="Permanent link">&para;</a></h3>
<p>Implement a user registration system that includes:</p>
<ul>
<li>
<p>Password strength validation (minimum 8 characters, mixed case, numbers, symbols)</p>
</li>
<li>
<p>Email verification with time-limited tokens</p>
</li>
<li>
<p>Rate limiting for registration attempts</p>
</li>
<li>
<p>SQL injection prevention</p>
</li>
<li>
<p>Input sanitization for all fields</p>
</li>
</ul>
<p><strong>Requirements:</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">SecureRegistration</span><span class="p">:</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_verification_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">verify_email_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">register_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</span></code></pre></div>
<h3 id="exercise-2-api-rate-limiter">Exercise 2: API Rate Limiter<a class="headerlink" href="#exercise-2-api-rate-limiter" title="Permanent link">&para;</a></h3>
<p>Create a configurable rate limiting system with:</p>
<ul>
<li>
<p>Multiple rate limiting strategies (fixed window, sliding window, token bucket)</p>
</li>
<li>
<p>Per-user and per-IP tracking</p>
</li>
<li>
<p>Redis backend for distributed applications</p>
</li>
<li>
<p>Automatic rate limit adjustment based on server load</p>
</li>
</ul>
<p><strong>Requirements:</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">AdvancedRateLimiter</span><span class="p">:</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_rate_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_rate_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reset_rate_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_rate_limit_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</span></code></pre></div>
<h3 id="exercise-3-cors-security-manager">Exercise 3: CORS Security Manager<a class="headerlink" href="#exercise-3-cors-security-manager" title="Permanent link">&para;</a></h3>
<p>Build a comprehensive CORS management system with:</p>
<ul>
<li>
<p>Environment-specific policies</p>
</li>
<li>
<p>Origin pattern matching with wildcards</p>
</li>
<li>
<p>Security validation for dangerous combinations</p>
</li>
<li>
<p>Real-time policy updates without service restart</p>
</li>
</ul>
<p><strong>Requirements:</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">EnhancedCORSManager</span><span class="p">:</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_origin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">policy</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">handle_preflight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">updates</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</span></code></pre></div>
<h3 id="exercise-4-security-testing-suite">Exercise 4: Security Testing Suite<a class="headerlink" href="#exercise-4-security-testing-suite" title="Permanent link">&para;</a></h3>
<p>Develop an automated security testing framework for:</p>
<ul>
<li>
<p>Authentication bypass testing</p>
</li>
<li>
<p>Authorization escalation detection</p>
</li>
<li>
<p>Input validation verification</p>
</li>
<li>
<p>Rate limiting effectiveness</p>
</li>
<li>
<p>Session security validation</p>
</li>
</ul>
<p><strong>Requirements:</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">SecurityTestSuite</span><span class="p">:</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_authentication</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_authorization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_roles</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_input_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_security_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</span></code></pre></div>
</details>
<details class="warning">
<summary>Case Study Analysis</summary>
<h3 id="case-study-e-commerce-api-security-breach">Case Study: E-commerce API Security Breach<a class="headerlink" href="#case-study-e-commerce-api-security-breach" title="Permanent link">&para;</a></h3>
<p><strong>Scenario:</strong> An e-commerce platform suffered a security breach where attackers:</p>
<ol>
<li>
<p>Exploited weak API authentication to access user accounts</p>
</li>
<li>
<p>Used SQL injection to extract customer payment data</p>
</li>
<li>
<p>Performed credential stuffing attacks due to lack of rate limiting</p>
</li>
<li>
<p>Bypassed CORS protections through domain spoofing</p>
</li>
</ol>
<p><strong>Analysis Questions:</strong></p>
<ol>
<li>
<p><strong>Authentication Vulnerabilities:</strong></p>
</li>
<li>
<p>What specific authentication weaknesses likely enabled the account access?</p>
</li>
<li>
<p>How could JWT implementation flaws contribute to this breach?</p>
</li>
<li>
<p>What multi-factor authentication strategies could have prevented this?</p>
</li>
<li>
<p><strong>Injection Prevention:</strong></p>
</li>
<li>
<p>Which input validation techniques would have stopped the SQL injection?</p>
</li>
<li>
<p>How should parameterized queries be implemented in the API layer?</p>
</li>
<li>
<p>What role does output encoding play in preventing data extraction?</p>
</li>
<li>
<p><strong>Rate Limiting Failures:</strong></p>
</li>
<li>
<p>Why might traditional rate limiting have failed against credential stuffing?</p>
</li>
<li>
<p>How could progressive penalties have detected the attack pattern?</p>
</li>
<li>
<p>What rate limiting strategies work best for authentication endpoints?</p>
</li>
<li>
<p><strong>CORS Bypass Analysis:</strong></p>
</li>
<li>
<p>How do attackers typically bypass CORS protections?</p>
</li>
<li>
<p>What origin validation techniques prevent domain spoofing?</p>
</li>
<li>
<p>How should CORS policies be configured for financial applications?</p>
</li>
</ol>
<p><strong>Remediation Plan:</strong></p>
<p>Design a comprehensive security improvement plan that addresses each vulnerability type with specific technical controls and monitoring mechanisms.</p>
</details>
<h2 id="summary-checklist">Summary Checklist<a class="headerlink" href="#summary-checklist" title="Permanent link">&para;</a></h2>
<p>Use this checklist to ensure comprehensive API security implementation:</p>
<h3 id="authentication-authorization">Authentication &amp; Authorization<a class="headerlink" href="#authentication-authorization" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item">
<p><input type="checkbox" disabled/> Strong password policies enforced</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Multi-factor authentication implemented</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> JWT tokens with proper expiration</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> API key rotation mechanisms</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> OAuth 2.0 secure flows</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Permission-based access control</p>
</li>
</ul>
<h3 id="rate-limiting-dos-protection">Rate Limiting &amp; DoS Protection<a class="headerlink" href="#rate-limiting-dos-protection" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item">
<p><input type="checkbox" disabled/> Multiple rate limiting strategies</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Progressive penalty systems</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> IP-based blocking capabilities</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Burst traffic handling</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Distributed rate limiting support</p>
</li>
</ul>
<h3 id="input-validation-sanitization">Input Validation &amp; Sanitization<a class="headerlink" href="#input-validation-sanitization" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item">
<p><input type="checkbox" disabled/> Comprehensive validation rules</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> SQL injection prevention</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> XSS protection mechanisms</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> File upload security</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Parameter tampering protection</p>
</li>
</ul>
<h3 id="session-management">Session Management<a class="headerlink" href="#session-management" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item">
<p><input type="checkbox" disabled/> Secure session ID generation</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Session rotation implementation</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Timeout management</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Concurrent session limits</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> CSRF protection</p>
</li>
</ul>
<h3 id="cors-cross-origin-security">CORS &amp; Cross-Origin Security<a class="headerlink" href="#cors-cross-origin-security" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item">
<p><input type="checkbox" disabled/> Whitelist-based origin control</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Preflight request handling</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Credential policy management</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Environment-specific policies</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Security header implementation</p>
</li>
</ul>
<h3 id="monitoring-testing">Monitoring &amp; Testing<a class="headerlink" href="#monitoring-testing" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item">
<p><input type="checkbox" disabled/> Automated security testing</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Vulnerability scanning</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Security event logging</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Incident response procedures</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Regular security audits</p>
</li>
</ul>
<h3 id="deployment-security">Deployment Security<a class="headerlink" href="#deployment-security" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item">
<p><input type="checkbox" disabled/> HTTPS enforcement</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Secure configuration management</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Environment separation</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Secret management</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled/> Regular updates and patches</p>
</li>
</ul>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="September 30, 2025 00:30:07 UTC">September 30, 2025</span>
  </span>

    
    
    
    
  </aside>


  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        Was this page helpful?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              
              
                
                
              
              Thanks for your feedback!
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              
              
                
                
              
              Thanks for your feedback! Help us improve this page by creating an <a href="https://github.com/Eatham532/Software-Engineering-HSC-Textbook/issues/new/choose" target="_blank" rel="noopener">issue</a> on github.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 Eatham532 – <a href="#__consent">Change cookie settings</a>

    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            



<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of the textbook. With your consent, you're helping us to make software engineering education better for everyone.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="github" checked>
      <span class="task-list-indicator"></span>
      GitHub
    </label>
  </li>

      
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="analytics" checked>
      <span class="task-list-indicator"></span>
      Google Analytics
    </label>
  </li>

      
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.top", "navigation.instant", "navigation.instant.prefetch", "search.highlight", "search.suggest", "content.code.annotate", "content.code.copy", "content.code.select", "content.tabs.link", "content.action.edit", "content.action.view", "toc.follow"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../../../assets/diagram-modal.js"></script>
      
        <script src="../../../../assets/quiz.js"></script>
      
    
  </body>
</html>